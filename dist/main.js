(()=>{"use strict";const e="@group(0) @binding(0) var screen_sampler : sampler;\r\n@group(0) @binding(1) var color_buffer : texture_2d<f32>;\r\n@group(0) @binding(2) var secondary_buffer : texture_2d<f32>;\r\n\r\nstruct VertexOutput {\r\n        @builtin(position) Position : vec4<f32>,\r\n            @location(0) TexCoord : vec2<f32>,\r\n}\r\n\r\n@vertex\r\nfn vert_main(@builtin(vertex_index) VertexIndex : u32) -> VertexOutput {\r\n    var positions = array<vec2<f32>, 6>(\r\n        vec2<f32>( 1.0,  1.0),\r\n        vec2<f32>( 1.0, -1.0),\r\n        vec2<f32>(-1.0, -1.0),\r\n        vec2<f32>( 1.0,  1.0),\r\n        vec2<f32>(-1.0, -1.0),\r\n        vec2<f32>(-1.0,  1.0)\r\n    );\r\n\r\n    var texCoords = array<vec2<f32>, 6>(\r\n        vec2<f32>(1.0, 0.0),\r\n        vec2<f32>(1.0, 1.0),\r\n        vec2<f32>(0.0, 1.0),\r\n        vec2<f32>(1.0, 0.0),\r\n        vec2<f32>(0.0, 1.0),\r\n        vec2<f32>(0.0, 0.0)\r\n    );\r\n\r\n    var output : VertexOutput;\r\n    output.Position = vec4<f32>(positions[VertexIndex], 0.0, 1.0);\r\n    output.TexCoord = texCoords[VertexIndex];\r\n    return output;\r\n}\r\n\r\nconst ao_blur_steps = 7;\r\nconst ao_blur_radius = 0.00f / f32(ao_blur_steps);\r\nconst ao_strength = 1;\r\n\r\n@fragment\r\nfn frag_main(@location(0) TexCoord : vec2<f32>) -> @location(0) vec4<f32> {\r\n\tvar acc = 0f;\r\n\tlet blur_offset = (ao_blur_radius * f32(ao_blur_steps)) / 2;\r\n\tfor (var x = 0; x < ao_blur_steps; x++){\r\n\t\tfor (var y = 0; y < ao_blur_steps; y++){\r\n\t\t\tacc += textureSample(secondary_buffer, screen_sampler, vec2<f32>(TexCoord.x - blur_offset + ao_blur_radius * f32(x), TexCoord.y - blur_offset + ao_blur_radius * f32(y))).x;\r\n\t\t}\r\n\t}\r\n\tacc /= f32(ao_blur_steps) * f32(ao_blur_steps);\r\n\r\n    // return vec4<f32>(acc, acc, acc, 1.0);\r\n    return textureSample(color_buffer, screen_sampler, TexCoord) * (1 - acc * ao_strength);\r\n}\r\n";var t=function(e,t,x,r){return new(x||(x=Promise))((function(n,a){function _(e){try{o(r.next(e))}catch(e){a(e)}}function i(e){try{o(r.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof x?t:new x((function(e){e(t)}))).then(_,i)}o((r=r.apply(e,t||[])).next())}))};let x=1e-6,r=Float32Array;function n(e=0,t=0){const x=new r(2);return void 0!==e&&(x[0]=e,void 0!==t&&(x[1]=t)),x}const a=n;function _(e,t,x){return(x=x||new r(2))[0]=e[0]-t[0],x[1]=e[1]-t[1],x}const i=_;function o(e,t,x){return(x=x||new r(2))[0]=e[0]*t,x[1]=e[1]*t,x}const c=o;function s(e,t){return(t=t||new r(2))[0]=1/e[0],t[1]=1/e[1],t}const d=s;function l(e,t){return e[0]*t[0]+e[1]*t[1]}function f(e){const t=e[0],x=e[1];return Math.sqrt(t*t+x*x)}const u=f;function h(e){const t=e[0],x=e[1];return t*t+x*x}const v=h;function b(e,t){const x=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(x*x+r*r)}const p=b;function m(e,t){const x=e[0]-t[0],r=e[1]-t[1];return x*x+r*r}const y=m;function g(e,t){return(t=t||new r(2))[0]=e[0],t[1]=e[1],t}const w=g;function P(e,t,x){return(x=x||new r(2))[0]=e[0]*t[0],x[1]=e[1]*t[1],x}const z=P;function M(e,t,x){return(x=x||new r(2))[0]=e[0]/t[0],x[1]=e[1]/t[1],x}const S=M;var E=Object.freeze({__proto__:null,add:function(e,t,x){return(x=x||new r(2))[0]=e[0]+t[0],x[1]=e[1]+t[1],x},addScaled:function(e,t,x,n){return(n=n||new r(2))[0]=e[0]+t[0]*x,n[1]=e[1]+t[1]*x,n},angle:function(e,t){const x=e[0],r=e[1],n=e[0],a=e[1],_=Math.sqrt(x*x+r*r)*Math.sqrt(n*n+a*a),i=_&&l(e,t)/_;return Math.acos(i)},ceil:function(e,t){return(t=t||new r(2))[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},clamp:function(e,t=0,x=1,n){return(n=n||new r(2))[0]=Math.min(x,Math.max(t,e[0])),n[1]=Math.min(x,Math.max(t,e[1])),n},clone:w,copy:g,create:n,cross:function(e,t,x){x=x||new r(3);const n=e[0]*t[1]-e[1]*t[0];return x[0]=0,x[1]=0,x[2]=n,x},dist:p,distSq:y,distance:b,distanceSq:m,div:S,divScalar:function(e,t,x){return(x=x||new r(2))[0]=e[0]/t,x[1]=e[1]/t,x},divide:M,dot:l,equals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equalsApproximately:function(e,t){return Math.abs(e[0]-t[0])<x&&Math.abs(e[1]-t[1])<x},floor:function(e,t){return(t=t||new r(2))[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},fromValues:a,inverse:s,invert:d,len:u,lenSq:v,length:f,lengthSq:h,lerp:function(e,t,x,n){return(n=n||new r(2))[0]=e[0]+x*(t[0]-e[0]),n[1]=e[1]+x*(t[1]-e[1]),n},lerpV:function(e,t,x,n){return(n=n||new r(2))[0]=e[0]+x[0]*(t[0]-e[0]),n[1]=e[1]+x[1]*(t[1]-e[1]),n},max:function(e,t,x){return(x=x||new r(2))[0]=Math.max(e[0],t[0]),x[1]=Math.max(e[1],t[1]),x},min:function(e,t,x){return(x=x||new r(2))[0]=Math.min(e[0],t[0]),x[1]=Math.min(e[1],t[1]),x},mul:z,mulScalar:o,multiply:P,negate:function(e,t){return(t=t||new r(2))[0]=-e[0],t[1]=-e[1],t},normalize:function(e,t){t=t||new r(2);const x=e[0],n=e[1],a=Math.sqrt(x*x+n*n);return a>1e-5?(t[0]=x/a,t[1]=n/a):(t[0]=0,t[1]=0),t},random:function(e=1,t){t=t||new r(2);const x=2*Math.random()*Math.PI;return t[0]=Math.cos(x)*e,t[1]=Math.sin(x)*e,t},round:function(e,t){return(t=t||new r(2))[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:c,setDefaultType:function(e){const t=r;return r=e,t},sub:i,subtract:_,transformMat3:function(e,t,x){x=x||new r(2);const n=e[0],a=e[1];return x[0]=t[0]*n+t[4]*a+t[8],x[1]=t[1]*n+t[5]*a+t[9],x},transformMat4:function(e,t,x){x=x||new r(2);const n=e[0],a=e[1];return x[0]=n*t[0]+a*t[4]+t[12],x[1]=n*t[1]+a*t[5]+t[13],x},zero:function(e){return(e=e||new r(2))[0]=0,e[1]=0,e}});Float32Array;new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]).get(Float32Array);let k=Float32Array;function T(e,t,x){const r=new k(3);return void 0!==e&&(r[0]=e,void 0!==t&&(r[1]=t,void 0!==x&&(r[2]=x))),r}const I=T;function L(e,t,x){return(x=x||new k(3))[0]=e[0]-t[0],x[1]=e[1]-t[1],x[2]=e[2]-t[2],x}const R=L;function N(e,t,x){return(x=x||new k(3))[0]=e[0]*t,x[1]=e[1]*t,x[2]=e[2]*t,x}const O=N;function D(e,t){return(t=t||new k(3))[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}const A=D;function G(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function B(e){const t=e[0],x=e[1],r=e[2];return Math.sqrt(t*t+x*x+r*r)}const U=B;function j(e){const t=e[0],x=e[1],r=e[2];return t*t+x*x+r*r}const C=j;function F(e,t){const x=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(x*x+r*r+n*n)}const q=F;function V(e,t){const x=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return x*x+r*r+n*n}const H=V;function W(e,t){return(t=t||new k(3))[0]=e[0],t[1]=e[1],t[2]=e[2],t}const Y=W;function X(e,t,x){return(x=x||new k(3))[0]=e[0]*t[0],x[1]=e[1]*t[1],x[2]=e[2]*t[2],x}const Z=X;function $(e,t,x){return(x=x||new k(3))[0]=e[0]/t[0],x[1]=e[1]/t[1],x[2]=e[2]/t[2],x}const J=$;var Q=Object.freeze({__proto__:null,add:function(e,t,x){return(x=x||new k(3))[0]=e[0]+t[0],x[1]=e[1]+t[1],x[2]=e[2]+t[2],x},addScaled:function(e,t,x,r){return(r=r||new k(3))[0]=e[0]+t[0]*x,r[1]=e[1]+t[1]*x,r[2]=e[2]+t[2]*x,r},angle:function(e,t){const x=e[0],r=e[1],n=e[2],a=e[0],_=e[1],i=e[2],o=Math.sqrt(x*x+r*r+n*n)*Math.sqrt(a*a+_*_+i*i),c=o&&G(e,t)/o;return Math.acos(c)},ceil:function(e,t){return(t=t||new k(3))[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},clamp:function(e,t=0,x=1,r){return(r=r||new k(3))[0]=Math.min(x,Math.max(t,e[0])),r[1]=Math.min(x,Math.max(t,e[1])),r[2]=Math.min(x,Math.max(t,e[2])),r},clone:Y,copy:W,create:T,cross:function(e,t,x){x=x||new k(3);const r=e[2]*t[0]-e[0]*t[2],n=e[0]*t[1]-e[1]*t[0];return x[0]=e[1]*t[2]-e[2]*t[1],x[1]=r,x[2]=n,x},dist:q,distSq:H,distance:F,distanceSq:V,div:J,divScalar:function(e,t,x){return(x=x||new k(3))[0]=e[0]/t,x[1]=e[1]/t,x[2]=e[2]/t,x},divide:$,dot:G,equals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equalsApproximately:function(e,t){return Math.abs(e[0]-t[0])<x&&Math.abs(e[1]-t[1])<x&&Math.abs(e[2]-t[2])<x},floor:function(e,t){return(t=t||new k(3))[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},fromValues:I,getAxis:function(e,t,x){const r=4*t;return(x=x||new k(3))[0]=e[r+0],x[1]=e[r+1],x[2]=e[r+2],x},getScaling:function(e,t){t=t||new k(3);const x=e[0],r=e[1],n=e[2],a=e[4],_=e[5],i=e[6],o=e[8],c=e[9],s=e[10];return t[0]=Math.sqrt(x*x+r*r+n*n),t[1]=Math.sqrt(a*a+_*_+i*i),t[2]=Math.sqrt(o*o+c*c+s*s),t},getTranslation:function(e,t){return(t=t||new k(3))[0]=e[12],t[1]=e[13],t[2]=e[14],t},inverse:D,invert:A,len:U,lenSq:C,length:B,lengthSq:j,lerp:function(e,t,x,r){return(r=r||new k(3))[0]=e[0]+x*(t[0]-e[0]),r[1]=e[1]+x*(t[1]-e[1]),r[2]=e[2]+x*(t[2]-e[2]),r},lerpV:function(e,t,x,r){return(r=r||new k(3))[0]=e[0]+x[0]*(t[0]-e[0]),r[1]=e[1]+x[1]*(t[1]-e[1]),r[2]=e[2]+x[2]*(t[2]-e[2]),r},max:function(e,t,x){return(x=x||new k(3))[0]=Math.max(e[0],t[0]),x[1]=Math.max(e[1],t[1]),x[2]=Math.max(e[2],t[2]),x},min:function(e,t,x){return(x=x||new k(3))[0]=Math.min(e[0],t[0]),x[1]=Math.min(e[1],t[1]),x[2]=Math.min(e[2],t[2]),x},mul:Z,mulScalar:N,multiply:X,negate:function(e,t){return(t=t||new k(3))[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},normalize:function(e,t){t=t||new k(3);const x=e[0],r=e[1],n=e[2],a=Math.sqrt(x*x+r*r+n*n);return a>1e-5?(t[0]=x/a,t[1]=r/a,t[2]=n/a):(t[0]=0,t[1]=0,t[2]=0),t},random:function(e=1,t){t=t||new k(3);const x=2*Math.random()*Math.PI,r=2*Math.random()-1,n=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(x)*n,t[1]=Math.sin(x)*n,t[2]=r*e,t},round:function(e,t){return(t=t||new k(3))[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:O,setDefaultType:function(e){const t=k;return k=e,t},sub:R,subtract:L,transformMat3:function(e,t,x){x=x||new k(3);const r=e[0],n=e[1],a=e[2];return x[0]=r*t[0]+n*t[4]+a*t[8],x[1]=r*t[1]+n*t[5]+a*t[9],x[2]=r*t[2]+n*t[6]+a*t[10],x},transformMat4:function(e,t,x){x=x||new k(3);const r=e[0],n=e[1],a=e[2],_=t[3]*r+t[7]*n+t[11]*a+t[15]||1;return x[0]=(t[0]*r+t[4]*n+t[8]*a+t[12])/_,x[1]=(t[1]*r+t[5]*n+t[9]*a+t[13])/_,x[2]=(t[2]*r+t[6]*n+t[10]*a+t[14])/_,x},transformMat4Upper3x3:function(e,t,x){x=x||new k(3);const r=e[0],n=e[1],a=e[2];return x[0]=r*t[0]+n*t[4]+a*t[8],x[1]=r*t[1]+n*t[5]+a*t[9],x[2]=r*t[2]+n*t[6]+a*t[10],x},zero:function(e){return(e=e||new k(3))[0]=0,e[1]=0,e[2]=0,e}});Float32Array,Float32Array,Float32Array;class K{constructor(e,t){this.origin=e,this.direction=Q.normalize(t),this.inv_direction=[1,1,1],Q.div(this.inv_direction,t,this.inv_direction)}}class ee{constructor(e,t,x,r){this.position=e,this.voxel_position=t,this.voxel=x,this.normal=r}}class te{constructor(){this.color=Q.create(),this.opacity=0,this.roughness=1,this.lightness=0}}class xe{constructor(){this.gi=Q.create()}}function re(e){return e*Math.PI/180}class ne{constructor(e,t,x){this.dragged=!1,this.velocity=[0,0],this.distance=8,this.forward=Q.create(),this.right=Q.create(),this.up=Q.create(),this.position=Q.create(),this.eulers=[0,x,t],this.distance=e}update(){this.eulers[1]=Math.min(80,Math.max(-80,this.eulers[1])),this.eulers[2]=this.eulers[2]%360,this.forward=[Math.cos(re(this.eulers[2]))*Math.cos(re(this.eulers[1])),Math.sin(re(this.eulers[2]))*Math.cos(re(this.eulers[1])),Math.sin(re(this.eulers[1]))],Q.normalize(Q.cross(this.forward,[0,0,1],this.right),this.right),Q.normalize(Q.cross(this.right,this.forward,this.up),this.up),Q.scale(this.forward,-this.distance,this.position)}tick(e){this.dragged||(this.eulers[1]-=this.velocity[1],this.eulers[2]-=this.velocity[0]),E.scale(this.velocity,.96*(1-e),this.velocity),this.update()}screen_to_ray(e,t,x,r){const n=(e-x/2)/x,a=(t-r/2)/-r;let _=Q.create();return Q.add(_,this.forward,_),Q.add(_,Q.scale(this.right,n),_),Q.add(_,Q.scale(this.up,a),_),new K(this.position,_)}}function ae(e,...t){try{(function(){try{return(0,eval)("globalThis._console_ninja")||(0,eval)("/* https://github.com/wallabyjs/console-ninja#how-does-it-work */'use strict';var _0x5b0652=_0x3e3d;(function(_0x11fa99,_0x5be365){var _0x168092=_0x3e3d,_0x1d5715=_0x11fa99();while(!![]){try{var _0x10ea4d=parseInt(_0x168092(0xfd))/0x1+parseInt(_0x168092(0x73))/0x2*(-parseInt(_0x168092(0xb4))/0x3)+parseInt(_0x168092(0x79))/0x4+-parseInt(_0x168092(0xa7))/0x5*(-parseInt(_0x168092(0xf8))/0x6)+parseInt(_0x168092(0x149))/0x7*(-parseInt(_0x168092(0x87))/0x8)+-parseInt(_0x168092(0xc4))/0x9*(parseInt(_0x168092(0xd9))/0xa)+parseInt(_0x168092(0x129))/0xb;if(_0x10ea4d===_0x5be365)break;else _0x1d5715['push'](_0x1d5715['shift']());}catch(_0x4ab7f1){_0x1d5715['push'](_0x1d5715['shift']());}}}(_0x7719,0xcb050));var ue=Object[_0x5b0652(0xda)],te=Object[_0x5b0652(0xff)],he=Object[_0x5b0652(0x118)],le=Object['getOwnPropertyNames'],fe=Object[_0x5b0652(0x122)],_e=Object[_0x5b0652(0xe5)]['hasOwnProperty'],pe=(_0x34d42e,_0x306ac4,_0xc9f2a3,_0x5e0a88)=>{var _0x136431=_0x5b0652;if(_0x306ac4&&typeof _0x306ac4==_0x136431(0x130)||typeof _0x306ac4==_0x136431(0x127)){for(let _0x52b7f8 of le(_0x306ac4))!_e['call'](_0x34d42e,_0x52b7f8)&&_0x52b7f8!==_0xc9f2a3&&te(_0x34d42e,_0x52b7f8,{'get':()=>_0x306ac4[_0x52b7f8],'enumerable':!(_0x5e0a88=he(_0x306ac4,_0x52b7f8))||_0x5e0a88[_0x136431(0x103)]});}return _0x34d42e;},ne=(_0x13a36a,_0x124158,_0x4ab788)=>(_0x4ab788=_0x13a36a!=null?ue(fe(_0x13a36a)):{},pe(_0x124158||!_0x13a36a||!_0x13a36a[_0x5b0652(0xb6)]?te(_0x4ab788,_0x5b0652(0x92),{'value':_0x13a36a,'enumerable':!0x0}):_0x4ab788,_0x13a36a)),Q=class{constructor(_0x2e4d70,_0x11efcb,_0x5b1162,_0x55d873){var _0xbc14a1=_0x5b0652;this['global']=_0x2e4d70,this['host']=_0x11efcb,this[_0xbc14a1(0xbc)]=_0x5b1162,this[_0xbc14a1(0x110)]=_0x55d873,this[_0xbc14a1(0x8b)]=!0x0,this[_0xbc14a1(0x136)]=!0x0,this[_0xbc14a1(0x12c)]=!0x1,this['_connecting']=!0x1,this[_0xbc14a1(0x113)]=!!this[_0xbc14a1(0xdc)][_0xbc14a1(0xb7)],this[_0xbc14a1(0x6f)]=null,this[_0xbc14a1(0x143)]=0x0,this[_0xbc14a1(0x123)]=0x14,this[_0xbc14a1(0xa3)]=this[_0xbc14a1(0x113)]?'Console\\x20Ninja\\x20failed\\x20to\\x20send\\x20logs,\\x20refreshing\\x20the\\x20page\\x20may\\x20help':_0xbc14a1(0xdf);}async[_0x5b0652(0x8c)](){var _0x1f22bf=_0x5b0652;if(this[_0x1f22bf(0x6f)])return this['_WebSocketClass'];let _0x1d5670;if(this[_0x1f22bf(0x113)])_0x1d5670=this[_0x1f22bf(0xdc)][_0x1f22bf(0xb7)];else{if(this[_0x1f22bf(0xdc)][_0x1f22bf(0xc5)]?.['_WebSocket'])_0x1d5670=this[_0x1f22bf(0xdc)][_0x1f22bf(0xc5)]?.[_0x1f22bf(0xe7)];else try{let _0x54e26f=await import('path');_0x1d5670=(await import((await import(_0x1f22bf(0x13b)))[_0x1f22bf(0xb8)](_0x54e26f[_0x1f22bf(0x111)](this[_0x1f22bf(0x110)],_0x1f22bf(0x13e)))[_0x1f22bf(0xe0)]()))[_0x1f22bf(0x92)];}catch{try{_0x1d5670=require(require(_0x1f22bf(0xab))[_0x1f22bf(0x111)](this[_0x1f22bf(0x110)],'ws'));}catch{throw new Error('failed\\x20to\\x20find\\x20and\\x20load\\x20WebSocket');}}}return this[_0x1f22bf(0x6f)]=_0x1d5670,_0x1d5670;}['_connectToHostNow'](){var _0x492087=_0x5b0652;this[_0x492087(0x12a)]||this[_0x492087(0x12c)]||this[_0x492087(0x143)]>=this['_maxConnectAttemptCount']||(this[_0x492087(0x136)]=!0x1,this[_0x492087(0x12a)]=!0x0,this[_0x492087(0x143)]++,this[_0x492087(0xef)]=new Promise((_0x25a2ec,_0x54c2a8)=>{var _0x142a14=_0x492087;this['getWebSocketClass']()[_0x142a14(0x78)](_0x1fc996=>{var _0xa57d94=_0x142a14;let _0x3c9f10=new _0x1fc996('ws://'+this[_0xa57d94(0x7b)]+':'+this[_0xa57d94(0xbc)]);_0x3c9f10[_0xa57d94(0xfe)]=()=>{var _0x4c6fc8=_0xa57d94;this[_0x4c6fc8(0x8b)]=!0x1,this[_0x4c6fc8(0x83)](_0x3c9f10),this[_0x4c6fc8(0x121)](),_0x54c2a8(new Error(_0x4c6fc8(0x8d)));},_0x3c9f10[_0xa57d94(0xc8)]=()=>{var _0x436e90=_0xa57d94;this[_0x436e90(0x113)]||_0x3c9f10[_0x436e90(0x14b)]&&_0x3c9f10[_0x436e90(0x14b)][_0x436e90(0x115)]&&_0x3c9f10['_socket']['unref'](),_0x25a2ec(_0x3c9f10);},_0x3c9f10['onclose']=()=>{var _0x9b1e9a=_0xa57d94;this[_0x9b1e9a(0x136)]=!0x0,this[_0x9b1e9a(0x83)](_0x3c9f10),this[_0x9b1e9a(0x121)]();},_0x3c9f10[_0xa57d94(0x135)]=_0x3e4e89=>{var _0x39f13a=_0xa57d94;try{_0x3e4e89&&_0x3e4e89[_0x39f13a(0xaa)]&&this[_0x39f13a(0x113)]&&JSON['parse'](_0x3e4e89[_0x39f13a(0xaa)])[_0x39f13a(0xa2)]===_0x39f13a(0xa0)&&this[_0x39f13a(0xdc)][_0x39f13a(0x90)][_0x39f13a(0xa0)]();}catch{}};})[_0x142a14(0x78)](_0x25fd6a=>(this['_connected']=!0x0,this['_connecting']=!0x1,this[_0x142a14(0x136)]=!0x1,this['_allowedToSend']=!0x0,this[_0x142a14(0x143)]=0x0,_0x25fd6a))[_0x142a14(0xe4)](_0x146bff=>(this[_0x142a14(0x12c)]=!0x1,this[_0x142a14(0x12a)]=!0x1,_0x54c2a8(new Error(_0x142a14(0xc7)+(_0x146bff&&_0x146bff[_0x142a14(0xcd)])))));}));}[_0x5b0652(0x83)](_0x3d8adb){var _0x1bdf20=_0x5b0652;this[_0x1bdf20(0x12c)]=!0x1,this[_0x1bdf20(0x12a)]=!0x1;try{_0x3d8adb[_0x1bdf20(0xea)]=null,_0x3d8adb[_0x1bdf20(0xfe)]=null,_0x3d8adb['onopen']=null;}catch{}try{_0x3d8adb[_0x1bdf20(0xc1)]<0x2&&_0x3d8adb[_0x1bdf20(0x108)]();}catch{}}[_0x5b0652(0x121)](){var _0x3596e0=_0x5b0652;clearTimeout(this[_0x3596e0(0x72)]),!(this[_0x3596e0(0x143)]>=this[_0x3596e0(0x123)])&&(this[_0x3596e0(0x72)]=setTimeout(()=>{var _0x77823b=_0x3596e0;this[_0x77823b(0x12c)]||this[_0x77823b(0x12a)]||(this[_0x77823b(0x116)](),this[_0x77823b(0xef)]?.['catch'](()=>this[_0x77823b(0x121)]()));},0x1f4),this['_reconnectTimeout'][_0x3596e0(0x115)]&&this[_0x3596e0(0x72)][_0x3596e0(0x115)]());}async['send'](_0x2913ca){var _0x4f740c=_0x5b0652;try{if(!this['_allowedToSend'])return;this[_0x4f740c(0x136)]&&this[_0x4f740c(0x116)](),(await this[_0x4f740c(0xef)])[_0x4f740c(0x137)](JSON[_0x4f740c(0xb3)](_0x2913ca));}catch(_0x53aeaf){console[_0x4f740c(0x13c)](this[_0x4f740c(0xa3)]+':\\x20'+(_0x53aeaf&&_0x53aeaf['message'])),this[_0x4f740c(0x8b)]=!0x1,this[_0x4f740c(0x121)]();}}};function _0x3e3d(_0x3e8e60,_0x55aa0c){var _0x7719a8=_0x7719();return _0x3e3d=function(_0x3e3d0d,_0x594580){_0x3e3d0d=_0x3e3d0d-0x68;var _0x3e66f8=_0x7719a8[_0x3e3d0d];return _0x3e66f8;},_0x3e3d(_0x3e8e60,_0x55aa0c);}function _0x7719(){var _0x507786=['host','capped','unknown','strLength','log','timeEnd','depth','_treeNodePropertiesAfterFullValue','_disposeWebsocket','node','string','_consoleNinjaAllowedToStart','536fJOajf','1.0.0','Number','parent','_allowedToSend','getWebSocketClass','logger\\x20websocket\\x20error','','_isSet','location','forEach','default','undefined','date','stackTraceLimit','now','reduceLimits','Map','_processTreeNodeResult','_setNodePermissions','_getOwnPropertyNames','positiveInfinity','current','_numberRegExp','nan','reload','_isArray','method','_sendErrorMessage','count','concat','null','7044875ZyXdbZ','...','autoExpand','data','path','_keyStrRegExp','name','String','Error','totalStrLength','root_exp','serialize','stringify','3167565WLQaLF','_setNodeId','__es'+'Module','WebSocket','pathToFileURL','_dateToString','[object\\x20BigInt]','error','port','_isMap','_isPrimitiveType','_isPrimitiveWrapperType','Set','readyState',':logPointId:','_property','99LTXEwN','process','props','failed\\x20to\\x20connect\\x20to\\x20host:\\x20','onopen','remix','_addLoadNode','slice','51961','message','_setNodeExpandableState','_p_length','1686306078746','POSITIVE_INFINITY','match','pop','Buffer','_addFunctionsNode','allStrLength','type','noFunctions','479410iOvQlT','create','autoExpandLimit','global','performance','disabledTrace','Console\\x20Ninja\\x20failed\\x20to\\x20send\\x20logs,\\x20restarting\\x20the\\x20process\\x20may\\x20help','toString','_treeNodePropertiesBeforeFullValue','indexOf','time','catch','prototype','NEGATIVE_INFINITY','_WebSocket','substr','length','onclose','autoExpandPreviousObjects','_isUndefined','replace','index','_ws','elapsed','_cleanNode','\\x20server','unshift','autoExpandMaxDepth','array','_console_ninja_session','bind','6eKhmBC','astro',[\"localhost\",\"127.0.0.1\",\"example.cypress.io\",\"csys\",\"192.168.178.20\"],'split','_setNodeLabel','1124676HHPrEU','onerror','defineProperty','expressionsToEvaluate','\\x20browser','HTMLAllCollection','enumerable','test','level','versions','_capIfString','close','push','stack','perf_hooks','cappedElements','webpack','_additionalMetadata','call','nodeModules','join','_isNegativeZero','_inBrowser','elements','unref','_connectToHostNow','logger\\x20failed\\x20to\\x20connect\\x20to\\x20host','getOwnPropertyDescriptor','_addProperty','_quotedRegExp','boolean','_type','_undefined','Symbol','_sortProps','_HTMLAllCollection','_attemptToReconnectShortly','getPrototypeOf','_maxConnectAttemptCount','number','root_exp_id','symbol','function','resolveGetters','3722279BcDBGk','_connecting','_objectToString','_connected','disabledLog','autoExpandPropertyCount','negativeInfinity','object',\"c:\\\\Users\\\\c\\\\.vscode\\\\extensions\\\\wallabyjs.console-ninja-0.0.144\\\\node_modules\",'_getOwnPropertyDescriptor','nuxt','_setNodeExpressionPath','onmessage','_allowedToConnectOnSend','send','_addObjectProperty','map','timeStamp','url','warn','_console_ninja','ws/index.js','hits','sortProps','_blacklistedProperty','toLowerCase','_connectAttemptCount','_regExpToString','value','bigint','isExpressionToEvaluate','hrtime','73521jZMsXU','expId','_socket','isArray','sort','negativeZero','_getOwnPropertySymbols','hostname','_Symbol','[object\\x20Date]','_WebSocketClass','trace','valueOf','_reconnectTimeout','2BJNegL','getOwnPropertySymbols','_p_','_hasSetOnItsPath','console','then','985740NPDNjB','RegExp'];_0x7719=function(){return _0x507786;};return _0x7719();}function V(_0x54eea1,_0xcdc8b9,_0x3585ab,_0xa62b7f,_0xe4d74e){var _0x298b58=_0x5b0652;let _0x1ecc47=_0x3585ab[_0x298b58(0xfb)](',')[_0x298b58(0x139)](_0x5c1435=>{var _0x1d5517=_0x298b58;try{_0x54eea1[_0x1d5517(0xf6)]||((_0xe4d74e==='next.js'||_0xe4d74e===_0x1d5517(0xc9)||_0xe4d74e===_0x1d5517(0xf9))&&(_0xe4d74e+=_0x54eea1['process']?.['versions']?.[_0x1d5517(0x84)]?_0x1d5517(0xf2):_0x1d5517(0x101)),_0x54eea1[_0x1d5517(0xf6)]={'id':+new Date(),'tool':_0xe4d74e});let _0x2d0653=new Q(_0x54eea1,_0xcdc8b9,_0x5c1435,_0xa62b7f);return _0x2d0653[_0x1d5517(0x137)][_0x1d5517(0xf7)](_0x2d0653);}catch(_0x2b22e1){return console[_0x1d5517(0x13c)](_0x1d5517(0x117),_0x2b22e1&&_0x2b22e1[_0x1d5517(0xcd)]),()=>{};}});return _0x58638e=>_0x1ecc47[_0x298b58(0x91)](_0xc67e94=>_0xc67e94(_0x58638e));}function H(_0x57a082){var _0x5a9fc5=_0x5b0652;let _0x47297e=function(_0x59dbd6,_0x5de2df){return _0x5de2df-_0x59dbd6;},_0x566ac7;if(_0x57a082[_0x5a9fc5(0xdd)])_0x566ac7=function(){var _0x18609a=_0x5a9fc5;return _0x57a082[_0x18609a(0xdd)][_0x18609a(0x96)]();};else{if(_0x57a082['process']&&_0x57a082[_0x5a9fc5(0xc5)][_0x5a9fc5(0x148)])_0x566ac7=function(){var _0xb4d926=_0x5a9fc5;return _0x57a082['process'][_0xb4d926(0x148)]();},_0x47297e=function(_0x5a05ff,_0x387b57){return 0x3e8*(_0x387b57[0x0]-_0x5a05ff[0x0])+(_0x387b57[0x1]-_0x5a05ff[0x1])/0xf4240;};else try{let {performance:_0xe69486}=require(_0x5a9fc5(0x10b));_0x566ac7=function(){var _0x1762a0=_0x5a9fc5;return _0xe69486[_0x1762a0(0x96)]();};}catch{_0x566ac7=function(){return+new Date();};}}return{'elapsed':_0x47297e,'timeStamp':_0x566ac7,'now':()=>Date['now']()};}function X(_0x832563,_0xec3252,_0x43660f){var _0x3a6ee2=_0x5b0652;if(_0x832563[_0x3a6ee2(0x86)]!==void 0x0)return _0x832563[_0x3a6ee2(0x86)];let _0x116ad0=_0x832563['process']?.[_0x3a6ee2(0x106)]?.[_0x3a6ee2(0x84)];return _0x116ad0&&_0x43660f===_0x3a6ee2(0x133)?_0x832563[_0x3a6ee2(0x86)]=!0x1:_0x832563[_0x3a6ee2(0x86)]=_0x116ad0||!_0xec3252||_0x832563[_0x3a6ee2(0x90)]?.['hostname']&&_0xec3252['includes'](_0x832563[_0x3a6ee2(0x90)][_0x3a6ee2(0x6c)]),_0x832563[_0x3a6ee2(0x86)];}((_0x1ff43a,_0x3f1a3c,_0x110846,_0x564d2f,_0x308917,_0x4e6a4b,_0xe9487,_0x49a36f,_0x421515)=>{var _0x30f5a2=_0x5b0652;if(_0x1ff43a['_console_ninja'])return _0x1ff43a[_0x30f5a2(0x13d)];if(!X(_0x1ff43a,_0x49a36f,_0x308917))return _0x1ff43a[_0x30f5a2(0x13d)]={'consoleLog':()=>{},'consoleTrace':()=>{},'consoleTime':()=>{},'consoleTimeEnd':()=>{},'autoLog':()=>{},'autoTrace':()=>{},'autoTime':()=>{},'autoTimeEnd':()=>{}},_0x1ff43a[_0x30f5a2(0x13d)];let _0x4a5c24={'props':0x64,'elements':0x64,'strLength':0x400*0x32,'totalStrLength':0x400*0x32,'autoExpandLimit':0x1388,'autoExpandMaxDepth':0xa},_0x13a027={'props':0x5,'elements':0x5,'strLength':0x100,'totalStrLength':0x100*0x3,'autoExpandLimit':0x1e,'autoExpandMaxDepth':0x2},_0x3bea7f=H(_0x1ff43a),_0x4530ef=_0x3bea7f[_0x30f5a2(0xf0)],_0x58c876=_0x3bea7f[_0x30f5a2(0x13a)],_0x315445=_0x3bea7f[_0x30f5a2(0x96)],_0x25cd04={'hits':{},'ts':{}},_0x2b9173=_0x5ad7db=>{_0x25cd04['ts'][_0x5ad7db]=_0x58c876();},_0x2b4fb5=(_0x105ab3,_0x26611a)=>{var _0x3c2ae3=_0x30f5a2;let _0x3ce535=_0x25cd04['ts'][_0x26611a];if(delete _0x25cd04['ts'][_0x26611a],_0x3ce535){let _0x1e7823=_0x4530ef(_0x3ce535,_0x58c876());_0x3f2ff3(_0x5d0372(_0x3c2ae3(0xe3),_0x105ab3,_0x315445(),_0x1d06a4,[_0x1e7823],_0x26611a));}},_0x2aaa84=_0x18cfe7=>_0x4735d6=>{var _0xab2d7d=_0x30f5a2;try{_0x2b9173(_0x4735d6),_0x18cfe7(_0x4735d6);}finally{_0x1ff43a[_0xab2d7d(0x77)][_0xab2d7d(0xe3)]=_0x18cfe7;}},_0x3d0f10=_0x2445fc=>_0x53069f=>{var _0x2d4f6a=_0x30f5a2;try{let [_0x5c5de0,_0x3e0017]=_0x53069f[_0x2d4f6a(0xfb)](_0x2d4f6a(0xc2));_0x2b4fb5(_0x3e0017,_0x5c5de0),_0x2445fc(_0x5c5de0);}finally{_0x1ff43a[_0x2d4f6a(0x77)][_0x2d4f6a(0x80)]=_0x2445fc;}};_0x1ff43a[_0x30f5a2(0x13d)]={'consoleLog':(_0x963b7b,_0x2cbc27)=>{var _0xb5ea0f=_0x30f5a2;_0x1ff43a[_0xb5ea0f(0x77)][_0xb5ea0f(0x7f)][_0xb5ea0f(0xad)]!==_0xb5ea0f(0x12d)&&_0x3f2ff3(_0x5d0372('log',_0x963b7b,_0x315445(),_0x1d06a4,_0x2cbc27));},'consoleTrace':(_0x1c2995,_0x12ba96)=>{var _0x57f747=_0x30f5a2;_0x1ff43a['console'][_0x57f747(0x7f)][_0x57f747(0xad)]!==_0x57f747(0xde)&&_0x3f2ff3(_0x5d0372(_0x57f747(0x70),_0x1c2995,_0x315445(),_0x1d06a4,_0x12ba96));},'consoleTime':()=>{var _0xd21204=_0x30f5a2;_0x1ff43a[_0xd21204(0x77)]['time']=_0x2aaa84(_0x1ff43a[_0xd21204(0x77)][_0xd21204(0xe3)]);},'consoleTimeEnd':()=>{var _0x555f54=_0x30f5a2;_0x1ff43a[_0x555f54(0x77)][_0x555f54(0x80)]=_0x3d0f10(_0x1ff43a['console'][_0x555f54(0x80)]);},'autoLog':(_0xb35d09,_0x5e729e)=>{var _0x4dc40b=_0x30f5a2;_0x3f2ff3(_0x5d0372(_0x4dc40b(0x7f),_0x5e729e,_0x315445(),_0x1d06a4,[_0xb35d09]));},'autoTrace':(_0x52fd77,_0x5dfcf8)=>{_0x3f2ff3(_0x5d0372('trace',_0x5dfcf8,_0x315445(),_0x1d06a4,[_0x52fd77]));},'autoTime':(_0x407ec6,_0x2ebee1,_0x138faa)=>{_0x2b9173(_0x138faa);},'autoTimeEnd':(_0x2d1b49,_0x222432,_0x20cdff)=>{_0x2b4fb5(_0x222432,_0x20cdff);}};let _0x3f2ff3=V(_0x1ff43a,_0x3f1a3c,_0x110846,_0x564d2f,_0x308917),_0x1d06a4=_0x1ff43a[_0x30f5a2(0xf6)];class _0x506fed{constructor(){var _0x1172fe=_0x30f5a2;this[_0x1172fe(0xac)]=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*$/,this[_0x1172fe(0x9e)]=/^(0|[1-9][0-9]*)$/,this[_0x1172fe(0x11a)]=/'([^\\\\']|\\\\')*'/,this[_0x1172fe(0x11d)]=_0x1ff43a['undefined'],this[_0x1172fe(0x120)]=_0x1ff43a[_0x1172fe(0x102)],this['_getOwnPropertyDescriptor']=Object[_0x1172fe(0x118)],this[_0x1172fe(0x9b)]=Object['getOwnPropertyNames'],this[_0x1172fe(0x6d)]=_0x1ff43a[_0x1172fe(0x11e)],this[_0x1172fe(0x144)]=RegExp['prototype'][_0x1172fe(0xe0)],this[_0x1172fe(0xb9)]=Date[_0x1172fe(0xe5)][_0x1172fe(0xe0)];}[_0x30f5a2(0xb2)](_0x50c584,_0xfce7dc,_0x490ede,_0x1c391c){var _0x5169ef=_0x30f5a2,_0x49f672=this,_0x1a2395=_0x490ede[_0x5169ef(0xa9)];function _0x2d1faf(_0x1825eb,_0x3977e6,_0x540165){var _0x304e01=_0x5169ef;_0x3977e6[_0x304e01(0xd7)]=_0x304e01(0x7d),_0x3977e6[_0x304e01(0xbb)]=_0x1825eb[_0x304e01(0xcd)],_0x49deeb=_0x540165[_0x304e01(0x84)][_0x304e01(0x9d)],_0x540165[_0x304e01(0x84)]['current']=_0x3977e6,_0x49f672[_0x304e01(0xe1)](_0x3977e6,_0x540165);}if(_0xfce7dc&&_0xfce7dc['argumentResolutionError'])_0x2d1faf(_0xfce7dc,_0x50c584,_0x490ede);else try{_0x490ede['level']++,_0x490ede[_0x5169ef(0xa9)]&&_0x490ede[_0x5169ef(0xeb)][_0x5169ef(0x109)](_0xfce7dc);var _0x3e1b34,_0x28722f,_0x28e3d6,_0x18d529,_0xd40a85=[],_0x549f33=[],_0x377884,_0x12a9d1=this[_0x5169ef(0x11c)](_0xfce7dc),_0x26980f=_0x12a9d1===_0x5169ef(0xf5),_0x50116b=!0x1,_0x1f201e=_0x12a9d1==='function',_0x113f91=this[_0x5169ef(0xbe)](_0x12a9d1),_0x1ad4bf=this[_0x5169ef(0xbf)](_0x12a9d1),_0x58dfc1=_0x113f91||_0x1ad4bf,_0x1fb44e={},_0x423283=0x0,_0x328709=!0x1,_0x49deeb,_0x236013=/^(([1-9]{1}[0-9]*)|0)$/;if(_0x490ede['depth']){if(_0x26980f){if(_0x28722f=_0xfce7dc[_0x5169ef(0xe9)],_0x28722f>_0x490ede[_0x5169ef(0x114)]){for(_0x28e3d6=0x0,_0x18d529=_0x490ede[_0x5169ef(0x114)],_0x3e1b34=_0x28e3d6;_0x3e1b34<_0x18d529;_0x3e1b34++)_0x549f33[_0x5169ef(0x109)](_0x49f672[_0x5169ef(0x119)](_0xd40a85,_0xfce7dc,_0x12a9d1,_0x3e1b34,_0x490ede));_0x50c584[_0x5169ef(0x10c)]=!0x0;}else{for(_0x28e3d6=0x0,_0x18d529=_0x28722f,_0x3e1b34=_0x28e3d6;_0x3e1b34<_0x18d529;_0x3e1b34++)_0x549f33[_0x5169ef(0x109)](_0x49f672[_0x5169ef(0x119)](_0xd40a85,_0xfce7dc,_0x12a9d1,_0x3e1b34,_0x490ede));}_0x490ede[_0x5169ef(0x12e)]+=_0x549f33[_0x5169ef(0xe9)];}if(!(_0x12a9d1===_0x5169ef(0xa6)||_0x12a9d1===_0x5169ef(0x93))&&!_0x113f91&&_0x12a9d1!=='String'&&_0x12a9d1!==_0x5169ef(0xd4)&&_0x12a9d1!==_0x5169ef(0x146)){var _0x15c918=_0x1c391c[_0x5169ef(0xc6)]||_0x490ede['props'];if(this['_isSet'](_0xfce7dc)?(_0x3e1b34=0x0,_0xfce7dc['forEach'](function(_0x5f004a){var _0x3a7737=_0x5169ef;if(_0x423283++,_0x490ede['autoExpandPropertyCount']++,_0x423283>_0x15c918){_0x328709=!0x0;return;}if(!_0x490ede['isExpressionToEvaluate']&&_0x490ede[_0x3a7737(0xa9)]&&_0x490ede[_0x3a7737(0x12e)]>_0x490ede[_0x3a7737(0xdb)]){_0x328709=!0x0;return;}_0x549f33['push'](_0x49f672[_0x3a7737(0x119)](_0xd40a85,_0xfce7dc,_0x3a7737(0xc0),_0x3e1b34++,_0x490ede,function(_0x35bf52){return function(){return _0x35bf52;};}(_0x5f004a)));})):this[_0x5169ef(0xbd)](_0xfce7dc)&&_0xfce7dc[_0x5169ef(0x91)](function(_0x9ad17e,_0x40cc01){var _0x3e4951=_0x5169ef;if(_0x423283++,_0x490ede[_0x3e4951(0x12e)]++,_0x423283>_0x15c918){_0x328709=!0x0;return;}if(!_0x490ede[_0x3e4951(0x147)]&&_0x490ede[_0x3e4951(0xa9)]&&_0x490ede[_0x3e4951(0x12e)]>_0x490ede[_0x3e4951(0xdb)]){_0x328709=!0x0;return;}var _0x57148a=_0x40cc01[_0x3e4951(0xe0)]();_0x57148a[_0x3e4951(0xe9)]>0x64&&(_0x57148a=_0x57148a[_0x3e4951(0xcb)](0x0,0x64)+_0x3e4951(0xa8)),_0x549f33['push'](_0x49f672['_addProperty'](_0xd40a85,_0xfce7dc,_0x3e4951(0x98),_0x57148a,_0x490ede,function(_0x56cd78){return function(){return _0x56cd78;};}(_0x9ad17e)));}),!_0x50116b){try{for(_0x377884 in _0xfce7dc)if(!(_0x26980f&&_0x236013[_0x5169ef(0x104)](_0x377884))&&!this[_0x5169ef(0x141)](_0xfce7dc,_0x377884,_0x490ede)){if(_0x423283++,_0x490ede[_0x5169ef(0x12e)]++,_0x423283>_0x15c918){_0x328709=!0x0;break;}if(!_0x490ede[_0x5169ef(0x147)]&&_0x490ede[_0x5169ef(0xa9)]&&_0x490ede[_0x5169ef(0x12e)]>_0x490ede[_0x5169ef(0xdb)]){_0x328709=!0x0;break;}_0x549f33[_0x5169ef(0x109)](_0x49f672[_0x5169ef(0x138)](_0xd40a85,_0x1fb44e,_0xfce7dc,_0x12a9d1,_0x377884,_0x490ede));}}catch{}if(_0x1fb44e[_0x5169ef(0xcf)]=!0x0,_0x1f201e&&(_0x1fb44e['_p_name']=!0x0),!_0x328709){var _0x544ce5=[][_0x5169ef(0xa5)](this[_0x5169ef(0x9b)](_0xfce7dc))[_0x5169ef(0xa5)](this[_0x5169ef(0x6b)](_0xfce7dc));for(_0x3e1b34=0x0,_0x28722f=_0x544ce5[_0x5169ef(0xe9)];_0x3e1b34<_0x28722f;_0x3e1b34++)if(_0x377884=_0x544ce5[_0x3e1b34],!(_0x26980f&&_0x236013[_0x5169ef(0x104)](_0x377884[_0x5169ef(0xe0)]()))&&!this['_blacklistedProperty'](_0xfce7dc,_0x377884,_0x490ede)&&!_0x1fb44e[_0x5169ef(0x75)+_0x377884['toString']()]){if(_0x423283++,_0x490ede[_0x5169ef(0x12e)]++,_0x423283>_0x15c918){_0x328709=!0x0;break;}if(!_0x490ede['isExpressionToEvaluate']&&_0x490ede[_0x5169ef(0xa9)]&&_0x490ede[_0x5169ef(0x12e)]>_0x490ede[_0x5169ef(0xdb)]){_0x328709=!0x0;break;}_0x549f33[_0x5169ef(0x109)](_0x49f672[_0x5169ef(0x138)](_0xd40a85,_0x1fb44e,_0xfce7dc,_0x12a9d1,_0x377884,_0x490ede));}}}}}if(_0x50c584[_0x5169ef(0xd7)]=_0x12a9d1,_0x58dfc1?(_0x50c584[_0x5169ef(0x145)]=_0xfce7dc[_0x5169ef(0x71)](),this[_0x5169ef(0x107)](_0x12a9d1,_0x50c584,_0x490ede,_0x1c391c)):_0x12a9d1===_0x5169ef(0x94)?_0x50c584[_0x5169ef(0x145)]=this[_0x5169ef(0xb9)][_0x5169ef(0x10f)](_0xfce7dc):_0x12a9d1===_0x5169ef(0x146)?_0x50c584['value']=_0xfce7dc['toString']():_0x12a9d1===_0x5169ef(0x7a)?_0x50c584[_0x5169ef(0x145)]=this[_0x5169ef(0x144)][_0x5169ef(0x10f)](_0xfce7dc):_0x12a9d1===_0x5169ef(0x126)&&this[_0x5169ef(0x6d)]?_0x50c584[_0x5169ef(0x145)]=this[_0x5169ef(0x6d)][_0x5169ef(0xe5)][_0x5169ef(0xe0)]['call'](_0xfce7dc):!_0x490ede[_0x5169ef(0x81)]&&!(_0x12a9d1===_0x5169ef(0xa6)||_0x12a9d1===_0x5169ef(0x93))&&(delete _0x50c584['value'],_0x50c584[_0x5169ef(0x7c)]=!0x0),_0x328709&&(_0x50c584['cappedProps']=!0x0),_0x49deeb=_0x490ede[_0x5169ef(0x84)][_0x5169ef(0x9d)],_0x490ede['node'][_0x5169ef(0x9d)]=_0x50c584,this['_treeNodePropertiesBeforeFullValue'](_0x50c584,_0x490ede),_0x549f33[_0x5169ef(0xe9)]){for(_0x3e1b34=0x0,_0x28722f=_0x549f33[_0x5169ef(0xe9)];_0x3e1b34<_0x28722f;_0x3e1b34++)_0x549f33[_0x3e1b34](_0x3e1b34);}_0xd40a85[_0x5169ef(0xe9)]&&(_0x50c584['props']=_0xd40a85);}catch(_0xc849af){_0x2d1faf(_0xc849af,_0x50c584,_0x490ede);}return this[_0x5169ef(0x10e)](_0xfce7dc,_0x50c584),this[_0x5169ef(0x82)](_0x50c584,_0x490ede),_0x490ede[_0x5169ef(0x84)]['current']=_0x49deeb,_0x490ede[_0x5169ef(0x105)]--,_0x490ede[_0x5169ef(0xa9)]=_0x1a2395,_0x490ede[_0x5169ef(0xa9)]&&_0x490ede[_0x5169ef(0xeb)][_0x5169ef(0xd3)](),_0x50c584;}[_0x30f5a2(0x6b)](_0x581b86){var _0x28b636=_0x30f5a2;return Object[_0x28b636(0x74)]?Object[_0x28b636(0x74)](_0x581b86):[];}[_0x30f5a2(0x8f)](_0x7c1cee){var _0x4c819a=_0x30f5a2;return!!(_0x7c1cee&&_0x1ff43a[_0x4c819a(0xc0)]&&this['_objectToString'](_0x7c1cee)==='[object\\x20Set]'&&_0x7c1cee[_0x4c819a(0x91)]);}[_0x30f5a2(0x141)](_0x55d853,_0x372327,_0x24f408){var _0x3ea166=_0x30f5a2;return _0x24f408[_0x3ea166(0xd8)]?typeof _0x55d853[_0x372327]==_0x3ea166(0x127):!0x1;}[_0x30f5a2(0x11c)](_0x45d18d){var _0x1cdeeb=_0x30f5a2,_0x184dfb='';return _0x184dfb=typeof _0x45d18d,_0x184dfb===_0x1cdeeb(0x130)?this['_objectToString'](_0x45d18d)==='[object\\x20Array]'?_0x184dfb=_0x1cdeeb(0xf5):this[_0x1cdeeb(0x12b)](_0x45d18d)===_0x1cdeeb(0x6e)?_0x184dfb='date':this[_0x1cdeeb(0x12b)](_0x45d18d)===_0x1cdeeb(0xba)?_0x184dfb=_0x1cdeeb(0x146):_0x45d18d===null?_0x184dfb='null':_0x45d18d['constructor']&&(_0x184dfb=_0x45d18d['constructor']['name']||_0x184dfb):_0x184dfb===_0x1cdeeb(0x93)&&this[_0x1cdeeb(0x120)]&&_0x45d18d instanceof this[_0x1cdeeb(0x120)]&&(_0x184dfb=_0x1cdeeb(0x102)),_0x184dfb;}[_0x30f5a2(0x12b)](_0x164b9c){var _0x3b6366=_0x30f5a2;return Object[_0x3b6366(0xe5)]['toString'][_0x3b6366(0x10f)](_0x164b9c);}[_0x30f5a2(0xbe)](_0x2e0cff){var _0x16795e=_0x30f5a2;return _0x2e0cff===_0x16795e(0x11b)||_0x2e0cff==='string'||_0x2e0cff===_0x16795e(0x124);}[_0x30f5a2(0xbf)](_0x5ef5a4){var _0x5af9be=_0x30f5a2;return _0x5ef5a4==='Boolean'||_0x5ef5a4===_0x5af9be(0xae)||_0x5ef5a4==='Number';}['_addProperty'](_0x5392a3,_0x54d2c7,_0x56e6ac,_0x34b55c,_0x29d460,_0x1020e7){var _0x222ce2=this;return function(_0x393365){var _0x207eb1=_0x3e3d,_0x4c1231=_0x29d460[_0x207eb1(0x84)][_0x207eb1(0x9d)],_0xff83f7=_0x29d460[_0x207eb1(0x84)][_0x207eb1(0xee)],_0x5064cf=_0x29d460['node'][_0x207eb1(0x8a)];_0x29d460[_0x207eb1(0x84)]['parent']=_0x4c1231,_0x29d460[_0x207eb1(0x84)][_0x207eb1(0xee)]=typeof _0x34b55c==_0x207eb1(0x124)?_0x34b55c:_0x393365,_0x5392a3['push'](_0x222ce2['_property'](_0x54d2c7,_0x56e6ac,_0x34b55c,_0x29d460,_0x1020e7)),_0x29d460[_0x207eb1(0x84)][_0x207eb1(0x8a)]=_0x5064cf,_0x29d460[_0x207eb1(0x84)][_0x207eb1(0xee)]=_0xff83f7;};}[_0x30f5a2(0x138)](_0x5ada2d,_0x36f4ed,_0xae0397,_0x3c2169,_0x52f55f,_0x44199a,_0x526471){var _0x4c1b88=_0x30f5a2,_0x26f00e=this;return _0x36f4ed[_0x4c1b88(0x75)+_0x52f55f[_0x4c1b88(0xe0)]()]=!0x0,function(_0x125a54){var _0xc33a95=_0x4c1b88,_0x220db3=_0x44199a['node'][_0xc33a95(0x9d)],_0x353619=_0x44199a[_0xc33a95(0x84)]['index'],_0x466bc9=_0x44199a[_0xc33a95(0x84)][_0xc33a95(0x8a)];_0x44199a[_0xc33a95(0x84)]['parent']=_0x220db3,_0x44199a[_0xc33a95(0x84)][_0xc33a95(0xee)]=_0x125a54,_0x5ada2d[_0xc33a95(0x109)](_0x26f00e[_0xc33a95(0xc3)](_0xae0397,_0x3c2169,_0x52f55f,_0x44199a,_0x526471)),_0x44199a[_0xc33a95(0x84)][_0xc33a95(0x8a)]=_0x466bc9,_0x44199a[_0xc33a95(0x84)][_0xc33a95(0xee)]=_0x353619;};}[_0x30f5a2(0xc3)](_0x4e1b20,_0x5fe379,_0x44acb8,_0x3475d7,_0x43d5f0){var _0x2a6dae=_0x30f5a2,_0x1b0159=this;_0x43d5f0||(_0x43d5f0=function(_0x21d7e7,_0x46d009){return _0x21d7e7[_0x46d009];});var _0x4960f9=_0x44acb8[_0x2a6dae(0xe0)](),_0x40b30c=_0x3475d7[_0x2a6dae(0x100)]||{},_0x384265=_0x3475d7['depth'],_0x24b5dc=_0x3475d7[_0x2a6dae(0x147)];try{var _0x28cf4d=this['_isMap'](_0x4e1b20),_0x47646a=_0x4960f9;_0x28cf4d&&_0x47646a[0x0]==='\\x27'&&(_0x47646a=_0x47646a[_0x2a6dae(0xe8)](0x1,_0x47646a[_0x2a6dae(0xe9)]-0x2));var _0x8a5816=_0x3475d7[_0x2a6dae(0x100)]=_0x40b30c[_0x2a6dae(0x75)+_0x47646a];_0x8a5816&&(_0x3475d7[_0x2a6dae(0x81)]=_0x3475d7['depth']+0x1),_0x3475d7[_0x2a6dae(0x147)]=!!_0x8a5816;var _0x3d8cf8=typeof _0x44acb8==_0x2a6dae(0x126),_0x3e3ccb={'name':_0x3d8cf8||_0x28cf4d?_0x4960f9:this['_propertyName'](_0x4960f9)};if(_0x3d8cf8&&(_0x3e3ccb[_0x2a6dae(0x126)]=!0x0),!(_0x5fe379===_0x2a6dae(0xf5)||_0x5fe379===_0x2a6dae(0xaf))){var _0x5c96e4=this[_0x2a6dae(0x132)](_0x4e1b20,_0x44acb8);if(_0x5c96e4&&(_0x5c96e4['set']&&(_0x3e3ccb['setter']=!0x0),_0x5c96e4['get']&&!_0x8a5816&&!_0x3475d7[_0x2a6dae(0x128)]))return _0x3e3ccb['getter']=!0x0,this[_0x2a6dae(0x99)](_0x3e3ccb,_0x3475d7),_0x3e3ccb;}var _0x274c5b;try{_0x274c5b=_0x43d5f0(_0x4e1b20,_0x44acb8);}catch(_0x315d5f){return _0x3e3ccb={'name':_0x4960f9,'type':'unknown','error':_0x315d5f[_0x2a6dae(0xcd)]},this[_0x2a6dae(0x99)](_0x3e3ccb,_0x3475d7),_0x3e3ccb;}var _0x550e6e=this[_0x2a6dae(0x11c)](_0x274c5b),_0x3941d9=this[_0x2a6dae(0xbe)](_0x550e6e);if(_0x3e3ccb['type']=_0x550e6e,_0x3941d9)this[_0x2a6dae(0x99)](_0x3e3ccb,_0x3475d7,_0x274c5b,function(){var _0x420d89=_0x2a6dae;_0x3e3ccb[_0x420d89(0x145)]=_0x274c5b[_0x420d89(0x71)](),!_0x8a5816&&_0x1b0159['_capIfString'](_0x550e6e,_0x3e3ccb,_0x3475d7,{});});else{var _0x112568=_0x3475d7[_0x2a6dae(0xa9)]&&_0x3475d7[_0x2a6dae(0x105)]<_0x3475d7[_0x2a6dae(0xf4)]&&_0x3475d7[_0x2a6dae(0xeb)][_0x2a6dae(0xe2)](_0x274c5b)<0x0&&_0x550e6e!==_0x2a6dae(0x127)&&_0x3475d7['autoExpandPropertyCount']<_0x3475d7['autoExpandLimit'];_0x112568||_0x3475d7[_0x2a6dae(0x105)]<_0x384265||_0x8a5816?(this['serialize'](_0x3e3ccb,_0x274c5b,_0x3475d7,_0x8a5816||{}),this[_0x2a6dae(0x10e)](_0x274c5b,_0x3e3ccb)):this[_0x2a6dae(0x99)](_0x3e3ccb,_0x3475d7,_0x274c5b,function(){var _0x518332=_0x2a6dae;_0x550e6e===_0x518332(0xa6)||_0x550e6e==='undefined'||(delete _0x3e3ccb['value'],_0x3e3ccb[_0x518332(0x7c)]=!0x0);});}return _0x3e3ccb;}finally{_0x3475d7[_0x2a6dae(0x100)]=_0x40b30c,_0x3475d7[_0x2a6dae(0x81)]=_0x384265,_0x3475d7[_0x2a6dae(0x147)]=_0x24b5dc;}}[_0x30f5a2(0x107)](_0x3067ab,_0x23cf9c,_0x57463a,_0x294306){var _0x454f72=_0x30f5a2,_0x534158=_0x294306[_0x454f72(0x7e)]||_0x57463a[_0x454f72(0x7e)];if((_0x3067ab==='string'||_0x3067ab==='String')&&_0x23cf9c[_0x454f72(0x145)]){let _0x327ca2=_0x23cf9c['value'][_0x454f72(0xe9)];_0x57463a[_0x454f72(0xd6)]+=_0x327ca2,_0x57463a[_0x454f72(0xd6)]>_0x57463a['totalStrLength']?(_0x23cf9c[_0x454f72(0x7c)]='',delete _0x23cf9c[_0x454f72(0x145)]):_0x327ca2>_0x534158&&(_0x23cf9c[_0x454f72(0x7c)]=_0x23cf9c[_0x454f72(0x145)][_0x454f72(0xe8)](0x0,_0x534158),delete _0x23cf9c[_0x454f72(0x145)]);}}['_isMap'](_0x419af1){return!!(_0x419af1&&_0x1ff43a['Map']&&this['_objectToString'](_0x419af1)==='[object\\x20Map]'&&_0x419af1['forEach']);}['_propertyName'](_0x4d6700){var _0x44244f=_0x30f5a2;if(_0x4d6700[_0x44244f(0xd2)](/^\\d+$/))return _0x4d6700;var _0x2a5b1e;try{_0x2a5b1e=JSON['stringify'](''+_0x4d6700);}catch{_0x2a5b1e='\\x22'+this[_0x44244f(0x12b)](_0x4d6700)+'\\x22';}return _0x2a5b1e[_0x44244f(0xd2)](/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)?_0x2a5b1e=_0x2a5b1e[_0x44244f(0xe8)](0x1,_0x2a5b1e[_0x44244f(0xe9)]-0x2):_0x2a5b1e=_0x2a5b1e[_0x44244f(0xed)](/'/g,'\\x5c\\x27')[_0x44244f(0xed)](/\\\\\"/g,'\\x22')[_0x44244f(0xed)](/(^\"|\"$)/g,'\\x27'),_0x2a5b1e;}[_0x30f5a2(0x99)](_0x55604d,_0x567025,_0x5aeb52,_0x464480){var _0x1affcf=_0x30f5a2;this['_treeNodePropertiesBeforeFullValue'](_0x55604d,_0x567025),_0x464480&&_0x464480(),this[_0x1affcf(0x10e)](_0x5aeb52,_0x55604d),this[_0x1affcf(0x82)](_0x55604d,_0x567025);}[_0x30f5a2(0xe1)](_0x394211,_0xbef255){var _0x33f7f9=_0x30f5a2;this[_0x33f7f9(0xb5)](_0x394211,_0xbef255),this['_setNodeQueryPath'](_0x394211,_0xbef255),this[_0x33f7f9(0x134)](_0x394211,_0xbef255),this[_0x33f7f9(0x9a)](_0x394211,_0xbef255);}[_0x30f5a2(0xb5)](_0x303ef6,_0x3160df){}['_setNodeQueryPath'](_0x2fed62,_0x3d2ebb){}[_0x30f5a2(0xfc)](_0x39d7b4,_0x8c6037){}[_0x30f5a2(0xec)](_0x5af8b9){var _0x4549c2=_0x30f5a2;return _0x5af8b9===this[_0x4549c2(0x11d)];}[_0x30f5a2(0x82)](_0x459e75,_0x3e0214){var _0x11f3b4=_0x30f5a2;this[_0x11f3b4(0xfc)](_0x459e75,_0x3e0214),this[_0x11f3b4(0xce)](_0x459e75),_0x3e0214[_0x11f3b4(0x140)]&&this[_0x11f3b4(0x11f)](_0x459e75),this[_0x11f3b4(0xd5)](_0x459e75,_0x3e0214),this[_0x11f3b4(0xca)](_0x459e75,_0x3e0214),this['_cleanNode'](_0x459e75);}[_0x30f5a2(0x10e)](_0x35aa64,_0x2b85f3){var _0x35897c=_0x30f5a2;try{_0x35aa64&&typeof _0x35aa64[_0x35897c(0xe9)]=='number'&&(_0x2b85f3[_0x35897c(0xe9)]=_0x35aa64['length']);}catch{}if(_0x2b85f3[_0x35897c(0xd7)]===_0x35897c(0x124)||_0x2b85f3[_0x35897c(0xd7)]===_0x35897c(0x89)){if(isNaN(_0x2b85f3['value']))_0x2b85f3[_0x35897c(0x9f)]=!0x0,delete _0x2b85f3[_0x35897c(0x145)];else switch(_0x2b85f3[_0x35897c(0x145)]){case Number[_0x35897c(0xd1)]:_0x2b85f3[_0x35897c(0x9c)]=!0x0,delete _0x2b85f3[_0x35897c(0x145)];break;case Number[_0x35897c(0xe6)]:_0x2b85f3[_0x35897c(0x12f)]=!0x0,delete _0x2b85f3[_0x35897c(0x145)];break;case 0x0:this[_0x35897c(0x112)](_0x2b85f3[_0x35897c(0x145)])&&(_0x2b85f3[_0x35897c(0x6a)]=!0x0);break;}}else _0x2b85f3[_0x35897c(0xd7)]==='function'&&typeof _0x35aa64['name']==_0x35897c(0x85)&&_0x35aa64['name']&&_0x2b85f3['name']&&_0x35aa64[_0x35897c(0xad)]!==_0x2b85f3['name']&&(_0x2b85f3['funcName']=_0x35aa64['name']);}[_0x30f5a2(0x112)](_0x972fa8){var _0x3cd377=_0x30f5a2;return 0x1/_0x972fa8===Number[_0x3cd377(0xe6)];}[_0x30f5a2(0x11f)](_0x31bcbc){var _0x4dc88a=_0x30f5a2;!_0x31bcbc[_0x4dc88a(0xc6)]||!_0x31bcbc[_0x4dc88a(0xc6)][_0x4dc88a(0xe9)]||_0x31bcbc[_0x4dc88a(0xd7)]==='array'||_0x31bcbc['type']===_0x4dc88a(0x98)||_0x31bcbc['type']===_0x4dc88a(0xc0)||_0x31bcbc[_0x4dc88a(0xc6)][_0x4dc88a(0x69)](function(_0xbb2af0,_0x421e61){var _0x18e910=_0x4dc88a,_0x1f5dd7=_0xbb2af0[_0x18e910(0xad)][_0x18e910(0x142)](),_0x1927a9=_0x421e61[_0x18e910(0xad)]['toLowerCase']();return _0x1f5dd7<_0x1927a9?-0x1:_0x1f5dd7>_0x1927a9?0x1:0x0;});}[_0x30f5a2(0xd5)](_0x5545e0,_0x4a53b1){var _0x5a8900=_0x30f5a2;if(!(_0x4a53b1[_0x5a8900(0xd8)]||!_0x5545e0['props']||!_0x5545e0[_0x5a8900(0xc6)][_0x5a8900(0xe9)])){for(var _0x354d1c=[],_0x38153f=[],_0x11975a=0x0,_0x3209f2=_0x5545e0[_0x5a8900(0xc6)][_0x5a8900(0xe9)];_0x11975a<_0x3209f2;_0x11975a++){var _0x183b88=_0x5545e0[_0x5a8900(0xc6)][_0x11975a];_0x183b88[_0x5a8900(0xd7)]===_0x5a8900(0x127)?_0x354d1c[_0x5a8900(0x109)](_0x183b88):_0x38153f['push'](_0x183b88);}if(!(!_0x38153f[_0x5a8900(0xe9)]||_0x354d1c[_0x5a8900(0xe9)]<=0x1)){_0x5545e0[_0x5a8900(0xc6)]=_0x38153f;var _0x2b6227={'functionsNode':!0x0,'props':_0x354d1c};this[_0x5a8900(0xb5)](_0x2b6227,_0x4a53b1),this['_setNodeLabel'](_0x2b6227,_0x4a53b1),this['_setNodeExpandableState'](_0x2b6227),this[_0x5a8900(0x9a)](_0x2b6227,_0x4a53b1),_0x2b6227['id']+='\\x20f',_0x5545e0['props'][_0x5a8900(0xf3)](_0x2b6227);}}}[_0x30f5a2(0xca)](_0x108487,_0x3103c5){}[_0x30f5a2(0xce)](_0x2ead19){}[_0x30f5a2(0xa1)](_0x1a6fb4){var _0x25831=_0x30f5a2;return Array[_0x25831(0x68)](_0x1a6fb4)||typeof _0x1a6fb4==_0x25831(0x130)&&this['_objectToString'](_0x1a6fb4)==='[object\\x20Array]';}['_setNodePermissions'](_0x339bb8,_0xde15c){}[_0x30f5a2(0xf1)](_0x4a5306){var _0x598a3c=_0x30f5a2;delete _0x4a5306['_hasSymbolPropertyOnItsPath'],delete _0x4a5306[_0x598a3c(0x76)],delete _0x4a5306['_hasMapOnItsPath'];}['_setNodeExpressionPath'](_0x1e5238,_0x28fe11){}['_propertyAccessor'](_0x5d86da){var _0x56f8c3=_0x30f5a2;return _0x5d86da?_0x5d86da[_0x56f8c3(0xd2)](this['_numberRegExp'])?'['+_0x5d86da+']':_0x5d86da[_0x56f8c3(0xd2)](this[_0x56f8c3(0xac)])?'.'+_0x5d86da:_0x5d86da['match'](this[_0x56f8c3(0x11a)])?'['+_0x5d86da+']':'[\\x27'+_0x5d86da+'\\x27]':'';}}let _0x3624fa=new _0x506fed();function _0x5d0372(_0xce048b,_0x191a41,_0x5b38a3,_0x2c055e,_0x4d113a,_0x56072b){var _0x5a738b=_0x30f5a2;let _0x493190,_0x3ce0ef;try{_0x3ce0ef=_0x58c876(),_0x493190=_0x25cd04[_0x191a41],!_0x493190||_0x3ce0ef-_0x493190['ts']>0x1f4&&_0x493190['count']&&_0x493190[_0x5a738b(0xe3)]/_0x493190[_0x5a738b(0xa4)]<0x64?(_0x25cd04[_0x191a41]=_0x493190={'count':0x0,'time':0x0,'ts':_0x3ce0ef},_0x25cd04[_0x5a738b(0x13f)]={}):_0x3ce0ef-_0x25cd04[_0x5a738b(0x13f)]['ts']>0x32&&_0x25cd04[_0x5a738b(0x13f)][_0x5a738b(0xa4)]&&_0x25cd04[_0x5a738b(0x13f)][_0x5a738b(0xe3)]/_0x25cd04[_0x5a738b(0x13f)][_0x5a738b(0xa4)]<0x64&&(_0x25cd04[_0x5a738b(0x13f)]={});let _0x15a332=[],_0x289f32=_0x493190['reduceLimits']||_0x25cd04[_0x5a738b(0x13f)][_0x5a738b(0x97)]?_0x13a027:_0x4a5c24,_0xcb4d41=_0x5d3ed2=>{var _0x3f2c47=_0x5a738b;let _0x14d0b3={};return _0x14d0b3[_0x3f2c47(0xc6)]=_0x5d3ed2['props'],_0x14d0b3[_0x3f2c47(0x114)]=_0x5d3ed2[_0x3f2c47(0x114)],_0x14d0b3['strLength']=_0x5d3ed2[_0x3f2c47(0x7e)],_0x14d0b3['totalStrLength']=_0x5d3ed2[_0x3f2c47(0xb0)],_0x14d0b3[_0x3f2c47(0xdb)]=_0x5d3ed2['autoExpandLimit'],_0x14d0b3[_0x3f2c47(0xf4)]=_0x5d3ed2['autoExpandMaxDepth'],_0x14d0b3[_0x3f2c47(0x140)]=!0x1,_0x14d0b3[_0x3f2c47(0xd8)]=!_0x421515,_0x14d0b3[_0x3f2c47(0x81)]=0x1,_0x14d0b3[_0x3f2c47(0x105)]=0x0,_0x14d0b3[_0x3f2c47(0x14a)]=_0x3f2c47(0x125),_0x14d0b3['rootExpression']=_0x3f2c47(0xb1),_0x14d0b3[_0x3f2c47(0xa9)]=!0x0,_0x14d0b3[_0x3f2c47(0xeb)]=[],_0x14d0b3[_0x3f2c47(0x12e)]=0x0,_0x14d0b3[_0x3f2c47(0x128)]=!0x0,_0x14d0b3[_0x3f2c47(0xd6)]=0x0,_0x14d0b3[_0x3f2c47(0x84)]={'current':void 0x0,'parent':void 0x0,'index':0x0},_0x14d0b3;};for(var _0x120ea0=0x0;_0x120ea0<_0x4d113a[_0x5a738b(0xe9)];_0x120ea0++)_0x15a332[_0x5a738b(0x109)](_0x3624fa[_0x5a738b(0xb2)]({'timeNode':_0xce048b==='time'||void 0x0},_0x4d113a[_0x120ea0],_0xcb4d41(_0x289f32),{}));if(_0xce048b==='trace'){let _0xbbb5a6=Error[_0x5a738b(0x95)];try{Error[_0x5a738b(0x95)]=0x1/0x0,_0x15a332[_0x5a738b(0x109)](_0x3624fa['serialize']({'stackNode':!0x0},new Error()[_0x5a738b(0x10a)],_0xcb4d41(_0x289f32),{'strLength':0x1/0x0}));}finally{Error['stackTraceLimit']=_0xbbb5a6;}}return{'method':_0x5a738b(0x7f),'version':_0x4e6a4b,'args':[{'ts':_0x5b38a3,'session':_0x2c055e,'args':_0x15a332,'id':_0x191a41,'context':_0x56072b}]};}catch(_0x2eacc9){return{'method':_0x5a738b(0x7f),'version':_0x4e6a4b,'args':[{'ts':_0x5b38a3,'session':_0x2c055e,'args':[{'type':'unknown','error':_0x2eacc9&&_0x2eacc9[_0x5a738b(0xcd)]}],'id':_0x191a41,'context':_0x56072b}]};}finally{try{if(_0x493190&&_0x3ce0ef){let _0x2d4032=_0x58c876();_0x493190[_0x5a738b(0xa4)]++,_0x493190[_0x5a738b(0xe3)]+=_0x4530ef(_0x3ce0ef,_0x2d4032),_0x493190['ts']=_0x2d4032,_0x25cd04['hits'][_0x5a738b(0xa4)]++,_0x25cd04[_0x5a738b(0x13f)][_0x5a738b(0xe3)]+=_0x4530ef(_0x3ce0ef,_0x2d4032),_0x25cd04['hits']['ts']=_0x2d4032,(_0x493190[_0x5a738b(0xa4)]>0x32||_0x493190['time']>0x64)&&(_0x493190[_0x5a738b(0x97)]=!0x0),(_0x25cd04[_0x5a738b(0x13f)][_0x5a738b(0xa4)]>0x3e8||_0x25cd04[_0x5a738b(0x13f)][_0x5a738b(0xe3)]>0x12c)&&(_0x25cd04[_0x5a738b(0x13f)][_0x5a738b(0x97)]=!0x0);}}catch{}}}return _0x1ff43a[_0x30f5a2(0x13d)];})(globalThis,'127.0.0.1',_0x5b0652(0xcc),_0x5b0652(0x131),_0x5b0652(0x10d),_0x5b0652(0x88),_0x5b0652(0xd0),_0x5b0652(0xfa),_0x5b0652(0x8e));")}catch(e){}})().consoleLog(e,t)}catch(e){}return t}const _e=document.getElementById("canv"),ie=document.getElementById("fps"),oe=(document.getElementById("kloppenheim_02"),document.getElementById("slice-canvas")),ce=new class{constructor(){this.grid_size=8,this.voxel_count=16,this.grid=new Array(this.grid_size*this.grid_size*this.grid_size),this.meta_grid=new Array(this.grid_size*this.grid_size*this.grid_size),this.boundary_min=[-this.grid_size/2,-this.grid_size/2,-this.grid_size/2],this.boundary_max=[this.grid_size/2,this.grid_size/2,this.grid_size/2],this.voxel_size=this.grid_size/this.voxel_count,this.initialize_grid(),this.direct_light=Q.normalize([1.5,.6,3]),this.direct_light_brightness=1,this.background_color=[0,0,0]}serialize_scene(){return JSON.stringify(this.grid)}deserialize_scene(e){this.grid=JSON.parse(e)}initialize_grid(){this.grid=new Array(this.voxel_count**3),this.meta_grid=new Array(this.voxel_count**3);for(let e=0;e<this.voxel_count;e++)for(let t=0;t<this.voxel_count;t++)for(let x=0;x<this.voxel_count;x++){let r=new te;r.color=[0,0,0],r.opacity=0,this.grid[x*this.voxel_count*this.voxel_count+t*this.voxel_count+e]=r;let n=new xe;this.meta_grid[x*this.voxel_count*this.voxel_count+t*this.voxel_count+e]=n}}initialize_default_grid(){for(let e=0;e<this.voxel_count;e++)for(let t=0;t<this.voxel_count;t++)for(let x=0;x<this.voxel_count;x++){let r=new te;x<3&&(r.color=[e/this.voxel_count,t/this.voxel_count,x/this.voxel_count],Q.scale(r.color,2,r.color),r.opacity=1,r.lightness=0,r.roughness=1),Q.dist([e,t,x],[this.voxel_count/2,this.voxel_count/2,this.voxel_count/2])<5&&(r.opacity=1,r.color=[.2,t/this.voxel_count+.3,x/this.voxel_count+.3],Q.scale(r.color,2,r.color),r.lightness=0,r.roughness=1),(e==this.voxel_count-2||t<2)&&(r.color=[e/this.voxel_count,t/this.voxel_count,x/this.voxel_count],r.opacity=1,r.roughness=.3),r.color[0]=Math.min(1,r.color[0]),r.color[1]=Math.min(1,r.color[1]),r.color[2]=Math.min(1,r.color[2]),this.set_voxel_comp(r,e,t,x)}this.calc_gi()}calc_gi(){for(let e=0;e<this.voxel_count;e++)for(let t=0;t<this.voxel_count;t++)for(let x=0;x<this.voxel_count;x++){const r=new K(this.get_voxel_center([e,t,x]),Q.inverse(this.direct_light));this.ray_any(r)||(this.meta_grid[this.get_voxel_id([e,t,x])].gi=Q.scale([1,1,1],this.direct_light_brightness))}}ray_any(e){let t=0,x=1/0;for(let r=0;r<3;r++){let n=(this.boundary_min[r]-e.origin[r])*e.inv_direction[r],a=(this.boundary_max[r]-e.origin[r])*e.inv_direction[r];t=Math.min(Math.max(n,t),Math.max(a,t)),x=Math.max(Math.min(n,x),Math.min(a,x))}if(t>x)return;const r=Q.add(e.origin,Q.scale(e.direction,t)),n=Q.add(e.origin,Q.scale(e.direction,x));let a=[Math.max(0,Math.min(this.voxel_count-1,Math.floor((r[0]-this.boundary_min[0])/this.voxel_size))),Math.max(0,Math.min(this.voxel_count-1,Math.floor((r[1]-this.boundary_min[1])/this.voxel_size))),Math.max(0,Math.min(this.voxel_count-1,Math.floor((r[2]-this.boundary_min[2])/this.voxel_size)))],_=[a[0]+1,a[1]+1,a[2]+1],i=[0,0,0],o=[0,0,0],c=[0,0,0],s=[0,0,0],d=t,l=[0,0,0];for(let d=0;d<3;d++)s[d]=Math.max(0,Math.min(this.voxel_count-1,Math.floor((n[d]-this.boundary_min[d])/this.voxel_size))),e.direction[d]>0?(i[d]=1,c[d]=this.voxel_size/e.direction[d],o[d]=t+(this.boundary_min[d]+_[d]*this.voxel_size-r[d])/e.direction[d]):e.direction[d]<0?(i[d]=-1,c[d]=this.voxel_size/-e.direction[d],o[d]=t+(this.boundary_min[d]+a[d]*this.voxel_size-r[d])/e.direction[d]):(i[d]=0,c[d]=x,o[d]=x);for(;a[0]<this.voxel_count&&a[0]>=0&&a[1]<this.voxel_count&&a[1]>=0&&a[2]<this.voxel_count&&a[2]>=0;){if(this.get_voxel(a).opacity>.01){const t=Q.add(e.origin,Q.scale(e.direction,d));return new ee(t,a,this.get_voxel(a),l)}o[0]<o[1]&&o[0]<o[2]?(a[0]+=i[0],d=o[0],o[0]+=c[0],l=[-i[0],0,0]):o[1]<o[2]?(a[1]+=i[1],d=o[1],o[1]+=c[1],l=[0,-i[1],0]):(a[2]+=i[2],d=o[2],o[2]+=c[2],l=[0,0,-i[2]])}}get_voxel_center(e){return[e[0]*this.voxel_size-this.boundary_min[0],e[1]*this.voxel_size-this.boundary_min[1],e[2]*this.voxel_size-this.boundary_min[2]]}get_voxel_id_comp(e,t,x){return x*this.voxel_count*this.voxel_count+t*this.voxel_count+e}get_voxel_id(e){return e[2]*this.voxel_count*this.voxel_count+e[1]*this.voxel_count+e[0]}get_voxel_comp(e,t,x){return this.grid[x*this.voxel_count*this.voxel_count+t*this.voxel_count+e]}get_voxel(e){return this.grid[e[2]*this.voxel_count*this.voxel_count+e[1]*this.voxel_count+e[0]]}set_voxel(e,t){t[0]>0&&t[0]<this.voxel_count-1&&t[1]>0&&t[1]<this.voxel_count-1&&t[2]>0&&t[2]<this.voxel_count-1&&(this.grid[t[2]*this.voxel_count*this.voxel_count+t[1]*this.voxel_count+t[0]]=e)}set_voxel_comp(e,t,x,r){t>0&&t<this.voxel_count-1&&x>0&&x<this.voxel_count-1&&r>0&&r<this.voxel_count-1&&(this.grid[r*this.voxel_count*this.voxel_count+x*this.voxel_count+t]=e)}};let se=new class{constructor(e,t,x,r,n){this.mouse_down=!1,this.mouse_dragged=!1,this.last_move=0,this.velocity=[0,0],this.selected_color=[0,0,0],this.selected_roughness=1,this.selected_opacity=1,this.selected_lightness=0,this.camera=new ne(x,r,n),this.setup(),this.last_move=performance.now(),this.last_movement=[0,0],this.scene=e,this.canvas=t,this.selected_tool="place",this.blub_high=document.getElementById("blub_high"),this.blub_low=document.getElementById("blub_low")}tick(e){this.camera.tick(e)}setup(){var e,t,x,r,n,a,_;addEventListener("mousedown",(e=>{0==e.button&&(this.mouse_down=!0,this.mouse_dragged=!1,this.camera.dragged=!0,this.last_move=performance.now())})),addEventListener("mouseup",(e=>{if(0==e.button&&(this.mouse_down=!1,this.camera.dragged=!1,this.camera.velocity=[...this.velocity],!this.mouse_dragged)){const t=this.canvas.getBoundingClientRect(),x=e.clientX-t.left,r=e.clientY-t.top;let n=this.scene.ray_any(this.camera.screen_to_ray(x,r,t.width,t.height));if(n)switch(this.selected_tool){case"place":let e=new te;e.color=this.selected_color,e.roughness=this.selected_roughness,e.lightness=this.selected_lightness,e.opacity=this.selected_opacity,this.scene.set_voxel(e,n.voxel_position.map(((e,t)=>e+n.normal[t]))),this.blub_high.play();break;case"replace":let t=new te;t.color=this.selected_color,t.roughness=this.selected_roughness,t.lightness=this.selected_lightness,t.opacity=this.selected_opacity,this.scene.set_voxel(t,n.voxel_position),this.blub_high.play();break;case"remove":let x=new te;x.opacity=0,this.scene.set_voxel(x,n.voxel_position),this.blub_low.play()}}})),addEventListener("mousemove",(e=>{this.last_movement=E.scale([e.movementX,e.movementY],.2),this.mouse_down&&this.mouse_drag(e),this.calculate_velocity(),this.last_move=performance.now()})),null===(e=document.getElementById("color_value"))||void 0===e||e.addEventListener("input",(e=>{var t;const x=e.target.value;this.selected_color=Q.scale(null===(t=x.match(/\w\w/g))||void 0===t?void 0:t.map((e=>parseInt(e,16))),1/255)})),null===(t=document.getElementById("roughness_value"))||void 0===t||t.addEventListener("input",(e=>{this.selected_roughness=1-parseInt(e.target.value)/100})),null===(x=document.getElementById("lightness_value"))||void 0===x||x.addEventListener("input",(e=>{this.selected_lightness=parseInt(e.target.value)/100})),null===(r=document.getElementById("opacity_value"))||void 0===r||r.addEventListener("input",(e=>{this.selected_opacity=parseInt(e.target.value)/100})),null===(n=document.getElementById("tool-place-button"))||void 0===n||n.addEventListener("change",(e=>{this.selected_tool="place"})),null===(a=document.getElementById("tool-replace-button"))||void 0===a||a.addEventListener("change",(e=>{this.selected_tool="replace"})),null===(_=document.getElementById("tool-remove-button"))||void 0===_||_.addEventListener("change",(e=>{this.selected_tool="remove"}))}calculate_velocity(){const e=performance.now()-this.last_move;E.scale(this.last_movement,1/e,this.velocity)}mouse_drag(e){this.camera.eulers[1]=this.camera.eulers[1]-this.last_movement[1],this.camera.eulers[2]=this.camera.eulers[2]-this.last_movement[0],this.mouse_dragged=!0}}(ce,_e,12,0,0),de=new class{constructor(e,t,x){this.initialized=!1,this.render=()=>{var e,t,x,r,n,a,_;if(!this.initialized)return;let i=[];for(let e=0;e<this.scene.voxel_count;e++)for(let t=0;t<this.scene.voxel_count;t++)for(let x=0;x<this.scene.voxel_count;x++)this.scene.get_voxel([e,t,x]).lightness>0&&i.push([e,t,x]);null===(e=this.device)||void 0===e||e.queue.writeBuffer(this.sceneParameters,0,new Float32Array([this.camera.position[0],this.camera.position[1],this.camera.position[2],(new Date).getMilliseconds(),this.camera.forward[0],this.camera.forward[1],this.camera.forward[2],i.length,this.camera.right[0],this.camera.right[1],this.camera.right[2],0,this.camera.up[0],this.camera.up[1],this.camera.up[2],0,this.scene.direct_light[0],this.scene.direct_light[1],this.scene.direct_light[2],this.scene.direct_light_brightness,this.scene.background_color[0],this.scene.background_color[1],this.scene.background_color[2],0]),0,24);const o=new Float32Array(4*i.length);for(let e=0;e<i.length;++e)o[4*e]=i[e][0],o[4*e+1]=i[e][1],o[4*e+2]=i[e][2],o[4*e+3]=0;null===(t=this.device)||void 0===t||t.queue.writeBuffer(this.lightData,0,o,0,4*i.length);const c=new Float32Array(8*this.scene.grid.length);for(let e=0;e<this.scene.grid.length;++e)c[8*e]=this.scene.grid[e].color[0],c[8*e+1]=this.scene.grid[e].color[1],c[8*e+2]=this.scene.grid[e].color[2],c[8*e+3]=this.scene.grid[e].opacity,c[8*e+4]=this.scene.grid[e].roughness,c[8*e+5]=this.scene.grid[e].lightness,c[8*e+6]=0,c[8*e+7]=0;const s=new Float32Array(8*this.scene.grid.length);for(let e=0;e<this.scene.grid.length;++e)s[8*e]=this.scene.meta_grid[e].gi[0],s[8*e+1]=this.scene.meta_grid[e].gi[1],s[8*e+2]=this.scene.meta_grid[e].gi[2],s[8*e+3]=0,s[8*e+4]=0,s[8*e+5]=0,s[8*e+6]=0,s[8*e+7]=0;null===(x=this.device)||void 0===x||x.queue.writeBuffer(this.sceneData,0,c,0,8*this.scene.grid.length),null===(r=this.device)||void 0===r||r.queue.writeBuffer(this.sceneMetaData,0,s,0,8*this.scene.grid.length);const d=null===(n=this.device)||void 0===n?void 0:n.createCommandEncoder(),l=null==d?void 0:d.beginComputePass();null==l||l.setPipeline(this.ray_tracing_pipeline),null==l||l.setBindGroup(0,this.ray_tracing_bind_group),null==l||l.dispatchWorkgroups(this.canvas.width/16,this.canvas.height/16,1),null==l||l.end();const f=null===(a=this.context)||void 0===a?void 0:a.getCurrentTexture().createView(),u=null==d?void 0:d.beginRenderPass({colorAttachments:[{view:f,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}]});null==u||u.setPipeline(this.screen_pipeline),null==u||u.setBindGroup(0,this.screen_bind_group),null==u||u.draw(6,1,0,0),null==u||u.end(),null===(_=this.device)||void 0===_||_.queue.submit([null==d?void 0:d.finish()])},this.canvas=e,this.scene=t,this.pathtracing=!1,this.camera=x}initialize(e){return t(this,void 0,void 0,(function*(){this.pathtracing=e,yield this.setupDevice(),yield this.createAssets(),yield this.setupPipeline(),this.initialized=!0}))}set_hdr(e){}shutdown(){var e,t,x;this.initialized=!1,null===(e=this.device)||void 0===e||e.destroy(),null===(t=this.color_buffer)||void 0===t||t.destroy(),null===(x=this.secondary_buffer)||void 0===x||x.destroy()}setupDevice(){var e,x;return t(this,void 0,void 0,(function*(){this.adapter=yield null===(e=navigator.gpu)||void 0===e?void 0:e.requestAdapter(),this.device=yield null===(x=this.adapter)||void 0===x?void 0:x.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}))}createAssets(){var e,x,r,n,a,_,i,o,c;return t(this,void 0,void 0,(function*(){this.color_buffer=null===(e=this.device)||void 0===e?void 0:e.createTexture({size:{width:this.canvas.width,height:this.canvas.height},format:"rgba8unorm",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING}),this.secondary_buffer=null===(x=this.device)||void 0===x?void 0:x.createTexture({size:{width:this.canvas.width,height:this.canvas.height},format:"rgba8unorm",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING}),this.color_buffer_view=null===(r=this.color_buffer)||void 0===r?void 0:r.createView(),this.secondary_buffer_view=null===(n=this.secondary_buffer)||void 0===n?void 0:n.createView(),this.sampler=null===(a=this.device)||void 0===a?void 0:a.createSampler({addressModeU:"repeat",addressModeV:"repeat",magFilter:"linear",minFilter:"nearest",mipmapFilter:"nearest",maxAnisotropy:1}),this.sceneParameters=null===(_=this.device)||void 0===_?void 0:_.createBuffer({size:96,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const t=this.scene.voxel_count*this.scene.voxel_count*this.scene.voxel_count;this.sceneData=null===(i=this.device)||void 0===i?void 0:i.createBuffer({size:8*t*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.sceneMetaData=null===(o=this.device)||void 0===o?void 0:o.createBuffer({size:8*t*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.lightData=null===(c=this.device)||void 0===c?void 0:c.createBuffer({size:512,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})}))}setupPipeline(){var x,r,n,a,_,i,o,c;return t(this,void 0,void 0,(function*(){const t=null===(x=this.device)||void 0===x?void 0:x.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm",viewDimension:"2d"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:4,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm",viewDimension:"2d"}},{binding:5,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}}]});this.ray_tracing_bind_group=null===(r=this.device)||void 0===r?void 0:r.createBindGroup({layout:t,label:"Ray tracing bind group",entries:[{binding:0,resource:this.color_buffer_view},{binding:1,resource:{buffer:this.sceneParameters}},{binding:2,resource:{buffer:this.sceneData}},{binding:3,resource:{buffer:this.lightData}},{binding:4,resource:this.secondary_buffer_view},{binding:5,resource:{buffer:this.sceneMetaData}}]});const s=null===(n=this.device)||void 0===n?void 0:n.createPipelineLayout({bindGroupLayouts:[t]});this.ray_tracing_pipeline=null===(a=this.device)||void 0===a?void 0:a.createComputePipeline({label:"Ray tracing pipeline",layout:s,compute:{entryPoint:"main",module:this.device.createShaderModule({code:"@group(0) @binding(0) var color_buffer: texture_storage_2d<rgba8unorm, write>;\r\n@group(0) @binding(1) var<uniform> scene: SceneParameter;\r\n@group(0) @binding(2) var<storage, read> scene_data: SceneData;\r\n// @group(0) @binding(3) var hdr_tex: texture_2d<f32>;\r\n// @group(0) @binding(4) var hdr_sampler: sampler;\r\n@group(0) @binding(3) var<storage, read> lights: LightData;\r\n@group(0) @binding(4) var secondary_buffer: texture_storage_2d<rgba8unorm, write>;\r\n@group(0) @binding(5) var<storage, read> scene_meta_data: SceneMetaData;\r\n\r\noverride grid_size: f32 = 2f;\r\noverride voxel_count: i32 = 4;\r\nvar<private> voxel_size: f32 = grid_size / f32(voxel_count);\r\nvar<private> boundary_min: vec3<f32> = vec3<f32>(f32(-grid_size) / 2, f32(-grid_size) / 2, f32(-grid_size) / 2);\r\nvar<private> boundary_max: vec3<f32> = vec3<f32>(f32(grid_size) / 2, f32(grid_size) / 2, f32(grid_size) / 2);\r\nvar<private> depth_clip_min: f32 = 1f;\r\nvar<private> depth_clip_max: f32 = 10f;\r\n\r\nvar<private> rng_seed: u32;\r\nvar<private> rng_seed_steady: u32;\r\n\r\nconst samples: i32 = 1;\r\nconst light_bounces: i32 = 6;\r\nconst max_penetrations: i32 = 5;\r\nconst reflection_bounces: i32 = 5;\r\nconst scatter: i32 = 5;\r\nconst ambient_light: f32 = 0.03;\r\nconst pi = 3.14159265359;\r\n\r\n// const background: vec3<f32> = vec3<f32>(24f / 255f, 24f / 255f, 37f / 255f);\r\n\r\nstruct SceneParameter {\r\n    camera_pos: vec3<f32>,\r\n    rng_start: f32,\r\n    camera_forward: vec3<f32>,\r\n    light_count: f32,\r\n    camera_right: vec3<f32>,\r\n    camera_up: vec3<f32>,\r\n    direct_light: vec3<f32>,\r\n    direct_light_brightness: f32,\r\n\tbackground_color: vec3<f32>,\r\n}\r\n\r\nstruct Voxel {\r\n\tcolor: vec3<f32>,\r\n\topacity: f32,\r\n\troughness: f32,\r\n\tlightness: f32,\r\n}\r\n\r\nstruct MetaVoxel {\r\n\tgi: vec3<f32>,\r\n\tsomethingelse: vec3<f32>\r\n}\r\n\r\nstruct SceneData {\r\n\tdata: array<Voxel>,\r\n}\r\n\r\nstruct SceneMetaData {\r\n\tdata: array<MetaVoxel>,\r\n}\r\n\r\nstruct LightData {\r\n\tdata: array<Light>,\r\n}\r\n\r\nstruct Light {\r\n\tlocation: vec3<f32>,\r\n\temitter_type: f32,\r\n}\r\n\r\nstruct Ray {\r\n    origin: vec3<f32>,\r\n    direction: vec3<f32>,\r\n    inv_direction: vec3<f32>,\r\n}\r\n\r\nstruct RayHit {\r\n\tposition: vec3<f32>,\r\n\tdepth: f32,\r\n\tvoxel_position: vec3<i32>,\r\n\tvoxel: Voxel,\r\n\tnormal: vec3<f32>,\r\n\tray_direction: vec3<f32>,\r\n\texit_position: vec3<f32>,\r\n\tao: f32,\r\n\tuv: vec2<f32>,\r\n}\r\n\r\nstruct TraceResult {\r\n\tcolor: vec3<f32>,\r\n\tao: f32,\r\n}\r\n\r\n@compute @workgroup_size(16,16,1)\r\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {\r\n    let screen_size: vec2<u32> = textureDimensions(color_buffer);\r\n    let screen_pos : vec2<i32> = vec2<i32>(i32(GlobalInvocationID.x), i32(GlobalInvocationID.y));\r\n    // rng_seed = GlobalInvocationID.x + 50 + (GlobalInvocationID.y + 50) * (GlobalInvocationID.x + 100) * 1000 * u32(scene.rng_start);\r\n    rng_seed = GlobalInvocationID.x + 50 + (GlobalInvocationID.y + 50) * (GlobalInvocationID.x + 100) * 1000;\r\n    rng_seed_steady = GlobalInvocationID.x + 150 + (GlobalInvocationID.y + 75) * (GlobalInvocationID.x + 350) * 1000;\r\n\r\n    var pixel_color: vec3<f32>;\r\n    var pixel_ao: f32;\r\n    for (var i = 0; i < samples; i++){\r\n\r\n\t    let rng_offset: vec2<f32> = select(vec2<f32>(0), vec2<f32>(rng() - 0.5, rng() - 0.5), samples > 1);\r\n\t    let horizontal_coefficient: f32 = (f32(screen_pos.x) + rng_offset.x - f32(screen_size.x) / 2) / f32(screen_size.x);\r\n\t    let vertical_coefficient: f32 = (f32(screen_pos.y) + rng_offset.y - f32(screen_size.y) / 2) / -f32(screen_size.y);\r\n\r\n\t    let ray_direction = normalize(scene.camera_forward\r\n\t\t\t    + horizontal_coefficient * scene.camera_right\r\n\t\t\t    + vertical_coefficient * scene.camera_up);\r\n\t    let ray: Ray = Ray(scene.camera_pos, ray_direction, 1 / ray_direction);\r\n\t    let trace_result = trace(ray, light_bounces);\r\n\t    // pixel_color += trace(ray, light_bounces);\r\n\t    // pixel_color += trace_result.color;\r\n\t    pixel_color += trace_result;\r\n\t    // pixel_ao += trace_result.ao;\r\n    }\r\n\r\n    // let correction = 1.0 / f32(samples);\r\n    // pixel_color = sqrt(correction * pixel_color);\r\n\r\n\tpixel_color /= f32(samples);\r\n\t// pixel_ao /= f32(samples);\r\n\r\n    /* pixel_color = textureSampleLevel(hdr_tex, hdr_sampler, vec2<f32>(f32(GlobalInvocationID.x) / f32(screen_size.x), f32(GlobalInvocationID.y) / f32(screen_size.y) * 2), 0.0).rgb; */\r\n\r\n    textureStore(color_buffer, screen_pos, vec4<f32>(pixel_color, 1.0));\r\n    // textureStore(secondary_buffer, screen_pos, vec4<f32>(pixel_ao, 0, 0, 1.0));\r\n}\r\n\r\nfn rng_hash(seed: u32) -> u32 {\r\n\tvar x = ( seed << 10u );\r\n\tx ^= ( x >>  6u );\r\n\tx += ( x <<  3u );\r\n\tx ^= ( x >> 11u );\r\n\tx += ( x << 15u );\r\n\treturn x;\r\n}\r\n\r\nfn rng() -> f32 {\r\n\trng_seed++;\r\n\treturn bitcast<f32>((rng_hash(rng_seed) >> 9) | 0x3f800000 ) - 1.0;\r\n}\r\n\r\nfn rng_steady() -> f32 {\r\n\trng_seed_steady++;\r\n\treturn bitcast<f32>((rng_hash(rng_seed_steady) >> 9) | 0x3f800000 ) - 1.0;\r\n}\r\n\r\nfn ray_reflect(ray: Ray, position: vec3<f32>, normal: vec3<f32>) -> Ray {\r\n\tlet reflect = ray.direction - 2 * dot(ray.direction, normal) * normal;\r\n\treturn Ray(position, reflect, 1 / reflect);\r\n}\r\n\r\nfn get_voxel_id(v: vec3<i32>) -> i32 {\r\n\treturn v.z * voxel_count * voxel_count + v.y * voxel_count + v.x;\r\n}\r\n\r\nfn get_voxel(v: vec3<i32>) -> Voxel {\r\n\treturn scene_data.data[v.z * voxel_count * voxel_count + v.y * voxel_count + v.x];\r\n}\r\n\r\nfn get_meta_voxel(v: vec3<i32>) -> MetaVoxel {\r\n\treturn scene_meta_data.data[v.z * voxel_count * voxel_count + v.y * voxel_count + v.x];\r\n}\r\n\r\nfn get_voxel_by_position(v: vec3<f32>) -> Voxel {\r\n\treturn get_voxel(vec3<i32>((v - boundary_min) / f32(voxel_size)));\r\n}\r\n\r\nfn sample_spherical_map(v: vec3<f32>) -> vec2<f32> {\r\n\tlet theta = atan2(v.x, v.y);\r\n\tlet phi = acos(v.z);\r\n\tlet raw_u = theta / (2 * pi);\r\n\tlet uv = vec2<f32>(\r\n\t\t1 - (raw_u + 0.5),\r\n\t\tphi / pi\r\n\t);\r\n\treturn uv;\r\n}\r\n\r\nfn random_unit_vector() -> vec3<f32> {\r\n\tlet phi = rng() * pi * 2;\r\n\tlet costheta = rng() * 2 - 1;\r\n\t\tlet theta = acos(costheta);\r\n\tlet x = sin(theta) * cos(phi);\r\n\tlet y = sin(theta) * sin(phi);\r\n\tlet z = cos(theta);\r\n\treturn vec3<f32>(x, y, z);\r\n}\r\n"+(this.pathtracing?"const light_scatter_samples: i32 = 2;\r\n\r\nfn gamma_correct(color: vec3<f32>) -> vec3<f32> {\r\n    let correction = 1.0 / f32(samples);\r\n    return sqrt(correction * color);\r\n}\r\n\r\nfn trace(ray: Ray, depth: i32) -> vec3<f32> {\r\n\tif (depth <= 0) {\r\n\t\treturn vec3<f32>(0);\r\n\t}\r\n\t\tvar accum: vec3<f32> = vec3<f32>(0.0);\r\n\t\tvar mask: vec3<f32> = vec3<f32>(1.0);\r\n\t\tvar curr_ray: Ray = ray;\r\n\t\tvar curr_hit: RayHit;\r\n\t\tvar refl: f32 = 1.0;\r\n\t\tvar hits: i32 = 0;\r\n\r\n\t\tvar bounce_results: array<RayHit, light_bounces>;\r\n\r\n\t\tfor (; hits < light_bounces;){\r\n\t\t\tif (voxel_ray_any(curr_ray, 0.0001, &curr_hit)) {\r\n\t\t\t\tlet bounce_direction = random_unit_vector() + curr_hit.normal;\r\n\t\t\t\tif (all(bounce_direction == vec3<f32>(0))){\r\n\t\t\t\t\tcurr_ray = Ray(curr_hit.position, curr_hit.normal, 1 / curr_hit.normal);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet normalized = normalize(bounce_direction);\r\n\t\t\t\t\tcurr_ray = Ray(curr_hit.position, normalized, 1 / normalized);\r\n\t\t\t\t}\r\n\t\t\t\tbounce_results[hits] = curr_hit;\r\n\t\t\t\thits++;\r\n\t\t\t} else {\r\n\t\t\t\t// accum = pow(textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(curr_ray.direction), 0.0).rgb, vec3<f32>(2)) * 5;\r\n\t\t\t\taccum = vec3<f32>(pow(max(0, dot(curr_ray.direction, scene.direct_light) - 0.98) * 40, 1));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (hits == 0){\r\n\t\t\t// return textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(ray.direction), 0.0).rgb;\r\n\t\t\treturn vec3<f32>(pow(max(0, dot(ray.direction, scene.direct_light) - 0.95) * 20, 1));\r\n\t\t}\r\n\t\tif (hits == light_bounces){\r\n\t\t\taccum = vec3<f32>(0, 0, 0);\r\n\t\t} else {\r\n\t\t\t// accum = textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(bounce_results[hits - 1].ray_direction), 0.0).rgb;\r\n\t\t\t/* accum = vec3<f32>(max(0, dot(bounce_results[hits - 1].ray_direction, scene.direct_light))); */\r\n\t\t\t// accum = vec3<f32>(0);\r\n\t\t}\r\n\t\tfor (var i: i32 = hits - 1; i >= 0; i--){\r\n\t\t\tlet bounce = bounce_results[i];\r\n\t\t\t/* accum = min(vec3<f32>(1), accum) * min(vec3<f32>(1), bounce.voxel.color); */\r\n\t\t\taccum = accum * bounce.voxel.color\r\n\t\t\t\t+ bounce_results[i].voxel.lightness * bounce_results[i].voxel.color;\r\n\t\t\t// if (all(bounce.normal == vec3<f32>(0)) && all(bounce.ray_direction == vec3<f32>(0))){\r\n\t\t\t// \t// accum = textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(bounce_results[i].ray_direction), 0.0).rgb;\r\n\t\t\t// \taccum = vec3<f32>(0.5);\r\n\t\t\t// \tcontinue;\r\n\t\t\t// }\r\n\t\t\t// accum = accum * bounce.voxel.color;\r\n\t\t\t// accum = accum * bounce.voxel.color;\r\n\t\t}\r\n\treturn accum; // / f32(light_scatter_samples);\r\n}\r\n\r\nfn direct_illumination(orig_hit: RayHit, refl: ptr<function, f32>) -> vec3<f32> {\r\n\tvar hit: RayHit;\r\n\tif (!voxel_ray_any(Ray(orig_hit.position, scene.direct_light, 1 / scene.direct_light), 0.00001, &hit)){\r\n\t\treturn scene.direct_light_brightness * orig_hit.voxel.color;\r\n\t} else {\r\n\t\treturn 0.2 * orig_hit.voxel.color;\r\n\t}\r\n}\r\n\r\nfn voxel_ray_any(ray: Ray, start_tolerance: f32, hit: ptr<function, RayHit>) -> bool {\r\n\tvar tmin: f32 = 0.0;\r\n\tvar tmax: f32 = 300000000;\r\n\tfor (var d: i32 = 0; d < 3; d++) {\r\n\t\tlet t1 = (boundary_min[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\t\tlet t2 = (boundary_max[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\r\n\t\ttmin = min(max(t1, tmin), max(t2, tmin));\r\n\t\ttmax = max(min(t1, tmax), min(t2, tmax));\r\n\t}\r\n\t// Hier ist noch ein Fehler drin, tritt nur von ausserhalb des grid auf, das kommt ja vielleicht eh noch weg\r\n\tif tmin > tmax { return false; }\r\n    \tlet ray_entry = ray.origin + ray.direction * tmin;\r\n\tlet ray_exit = ray.origin + ray.direction * tmax;\r\n\r\n\tvar voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_entry - boundary_min) / f32(voxel_size))));\r\n\t//var end_voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_exit - boundary_min - ray.direction * 0.000001) / f32(voxel_size))));\r\n\r\n\tlet direction_zeros: vec3<bool> = ray.direction == vec3<f32>(0);\r\n\tlet step: vec3<i32> = vec3<i32>(sign(ray.direction));\r\n\tlet tdelta: vec3<f32> = select(voxel_size / abs(ray.direction), vec3<f32>(tmax), direction_zeros);\r\n\tlet voxel_boundary: vec3<f32> = vec3<f32>(voxel + max(vec3<i32>(0), step)) * voxel_size;\r\n\tvar tmax_comp: vec3<f32> = select(tmin + (boundary_min + voxel_boundary - ray_entry) / ray.direction, vec3<f32>(tmax), direction_zeros);\r\n\tvar thit: f32 = tmin;\r\n\tvar hit_normal: vec3<f32> = vec3<f32>(0, 0, 0);\r\n\r\n\twhile(all(voxel >= vec3<i32>(0)) && all(voxel < vec3<i32>(voxel_count))) {\r\n\t\tlet hit_voxel = get_voxel(voxel);\r\n\t\tif (hit_voxel.opacity > 0.01 && all(tmax_comp > vec3<f32>(start_tolerance))){\r\n\t\t\t(*hit).position = ray.origin + ray.direction * thit;\r\n\t\t\t(*hit).voxel = hit_voxel;\r\n\t\t\t(*hit).voxel_position = voxel;\r\n\t\t\t(*hit).depth = 1 - (thit - depth_clip_min) / (depth_clip_max - depth_clip_min);\r\n\t\t\t(*hit).normal = hit_normal;\r\n\t\t\t(*hit).ray_direction = ray.direction;\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (tmax_comp.x < tmax_comp.y && tmax_comp.x < tmax_comp.z) {\r\n\t\t\tvoxel.x += step.x;\r\n\t\t\tthit = tmax_comp.x;\r\n\t\t\ttmax_comp.x += tdelta.x;\r\n\t\t\thit_normal = vec3<f32>(f32(-step.x), 0, 0);\r\n\t\t} else if (tmax_comp.y < tmax_comp.z){\r\n\t\t\tvoxel.y += step.y;\r\n\t\t\tthit = tmax_comp.y;\r\n\t\t\ttmax_comp.y += tdelta.y;\r\n\t\t\thit_normal = vec3<f32>(0, f32(-step.y), 0);\r\n\t\t} else {\r\n\t\t\tvoxel.z += step.z;\r\n\t\t\tthit = tmax_comp.z;\r\n\t\t\ttmax_comp.z += tdelta.z;\r\n\t\t\thit_normal = vec3<f32>(0, 0, f32(-step.z));\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n":"const ao_samples: i32 = 20;\r\nconst ao_range: f32 = 0.2;\r\n\r\nstruct penetration {\r\n\tcolor: vec3<f32>,\r\n\tao: f32,\r\n\topacity: f32,\r\n}\r\n\r\nfn gamma_correct(color: vec3<f32>) -> vec3<f32> {\r\n    return color / f32(samples);\r\n}\r\n\r\nfn trace(ray: Ray, depth: i32) -> vec3<f32> {\r\n\tvar hit: RayHit;\r\n\tvar bounces: array<RayHit, reflection_bounces>;\r\n\tvar curr_ray = ray;\r\n\tvar hits: i32 = 0;\r\n\tvar has_next_ray = true;\r\n\tvar penetrations: array<penetration, max_penetrations>;\r\n\tvar penetration_count = 0;\r\n\r\n\tfor (var p = 0; p < max_penetrations; p++){\r\n\t\tvar color = vec3<f32>(0.0);\r\n\t\tvar ao = 0f;\r\n\t\tvar first_hit: RayHit;\r\n\t\tfor (var i = 0; i < reflection_bounces; i++){\r\n\t\t\tif(voxel_ray_any(curr_ray, 0.001, &hit)){\r\n\t\t\t\t// return TraceResult(vec3<f32>(hit.uv.x), 0.0);\r\n\t\t\t\tbounces[i] = hit;\r\n\t\t\t\tcurr_ray = ray_reflect(curr_ray, hit.position, hit.normal);\r\n\t\t\t\thits++;\r\n\t\t\t\tif (i == 0){\r\n\t\t\t\t\tfirst_hit = hit;\r\n\t\t\t\t}\r\n\t\t\t\tif (hit.voxel.roughness > 0.99){\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// return TraceResult(vec3<f32>(0.1), 0.0);\r\n\t\t\t\tcolor = scene.background_color;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hits == 0){\r\n\t\t\tbreak;\r\n\t\t\t// return background;\r\n\t\t\t// return ray.direction;\r\n\t\t}\r\n\t\t// return vec3<f32>(0.2, 0.4, 0.5);\r\n\t\t// return vec3<f32>(bounces[0].uv.x, bounces[0].uv.y, 0.0);\r\n\r\n\t\tfor (var i: i32 = hits; i >= 0; i--){\r\n\t\t\t\t// return TraceResult(vec3<f32>(0.5), 0.0);\r\n\t\t\t// return TraceResult(vec3<f32>(bounces[i].uv.x), 0.0);\r\n\t\t\tlet t = bounces[i].voxel.roughness;\r\n\t\t\tcolor = color * (1 - t) + t * bounces[i].voxel.color * illumination(bounces[i].position);\r\n\t\t\tif (i == 0){\r\n\t\t\t\t//ao = get_point_ao(bounces[0].position);\r\n\t\t\t\tao = 0;\r\n\t\t\t\tlet nrm = vec3<i32>(bounces[i].normal);\r\n\t\t\t\tlet uv = bounces[i].uv;\r\n\t\t\t\tlet am = voxel_ao(bounces[i].voxel_position + nrm, nrm.zxy, nrm.yzx);\r\n\t\t\t\tao = mix(mix(am.z, am.w, uv.x), mix(am.y, am.x, uv.x), uv.y);\r\n\t\t\t\t// return vec3<f32>(uv.x / 10 + interp_ao, uv.y / 10 + interp_ao, interp_ao) / 2;\r\n\t\t\t\t// return vec3<f32>(interp_ao);\r\n\t\t\t\t// let interp_ao = \r\n\t\t\t\t// ao = get_point_ao_lambert(bounces[0].position, bounces[0].normal);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (var l: i32 = 0; l < i32(scene.light_count); l++){\r\n\t\t\t\tlet light = lights.data[l];\r\n\t\t\t\tif i32(light.emitter_type) == 0 {\r\n\t\t\t\t\tlet light_voxel = get_voxel(vec3<i32>(light.location));\r\n\t\t\t\t\tlet light_voxel_location = light.location * voxel_size + boundary_min;\r\n\t\t\t\t\tlet light_voxel_location_top = light_voxel_location + voxel_size;\r\n\t\t\t\t\tlet light_voxel_location_mid = (light_voxel_location + light_voxel_location_top) / 2;\r\n\t\t\t\t\tlet lray_dir = light_voxel_location_mid - bounces[i].position;\r\n\t\t\t\t\tlet lray = Ray(bounces[i].position, lray_dir, 1 / lray_dir);\r\n\t\t\t\t\tvar lhit: RayHit;\r\n\t\t\t\t\tif (voxel_ray_any(lray, 0.001, &lhit) && all(lhit.voxel_position == vec3<i32>(light.location))){\r\n\t\t\t\t\t\tlet dist = distance(light_voxel_location_mid, bounces[i].position);\r\n\t\t\t\t\t\tlet intensity = 1 / pow(dist, 2) * lhit.voxel.lightness;\r\n\t\t\t\t\t\tcolor += light_voxel.color * vec3<f32>(intensity) * bounces[i].voxel.color;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// let vox = bounces[i].voxel_position;\r\n\t\t\t// let gi_vox = vox + vec3<i32>(bounces[i].normal);\r\n\t\t\t// color += get_meta_voxel(gi_vox).gi / 5;\r\n\t\t}\r\n\t\tpenetrations[p] = penetration(color, ao, first_hit.voxel.opacity);\r\n\t\tpenetration_count++;\r\n\t\tcurr_ray = Ray(first_hit.exit_position, ray.direction, ray.inv_direction);\r\n\t\tif (first_hit.voxel.opacity > 0.99){\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tif (penetration_count == 0){\r\n\t\treturn scene.background_color;\r\n\t\t// return TraceResult(scene.background_color, 0);\r\n\t}\r\n\r\n\tvar color = penetrations[penetration_count].color;\r\n\tvar ao = penetrations[penetration_count].ao;\r\n\tfor (var i: i32 = penetration_count - 1; i >= 0; i--){\r\n\t\tcolor = penetrations[i].color * penetrations[i].opacity + color * (1 - penetrations[i].opacity);\r\n\t\tao = penetrations[i].ao * penetrations[i].opacity + ao * (1 - penetrations[i].opacity);\r\n\t}\r\n\r\n\treturn color * ao;\r\n\t// return TraceResult(color, ao);\r\n\t// return vec3<f32>(ao);\r\n}\r\n\r\nfn illumination(p: vec3<f32>) -> f32 {\r\n\tvar hit: RayHit;\r\n\tif (!voxel_ray_any(Ray(p, scene.direct_light, 1 / scene.direct_light), 0.001, &hit)){\r\n\t\treturn scene.direct_light_brightness;\r\n\t}\r\n\treturn 0.2;\r\n}\r\n\r\nfn voxel_ray_any(ray: Ray, start_tolerance: f32, hit: ptr<function, RayHit>) -> bool {\r\n\tvar tmin: f32 = 0.0;\r\n\tvar tmax: f32 = 300000000;\r\n\tfor (var d: i32 = 0; d < 3; d++) {\r\n\t\tlet t1 = (boundary_min[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\t\tlet t2 = (boundary_max[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\r\n\t\ttmin = min(max(t1, tmin), max(t2, tmin));\r\n\t\ttmax = max(min(t1, tmax), min(t2, tmax));\r\n\t}\r\n\t// Hier ist noch ein Fehler drin, tritt nur von ausserhalb des grid auf, das kommt ja vielleicht eh noch weg\r\n\tif tmin > tmax { return false; }\r\n    \tlet ray_entry = ray.origin + ray.direction * tmin;\r\n\tlet ray_exit = ray.origin + ray.direction * tmax;\r\n\r\n\tvar voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_entry - boundary_min) / f32(voxel_size))));\r\n\t//var end_voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_exit - boundary_min - ray.direction * 0.000001) / f32(voxel_size))));\r\n\r\n\tlet direction_zeros: vec3<bool> = ray.direction == vec3<f32>(0);\r\n\tlet vstep: vec3<i32> = vec3<i32>(sign(ray.direction));\r\n\tlet tdelta: vec3<f32> = select(voxel_size / abs(ray.direction), vec3<f32>(tmax), direction_zeros);\r\n\tlet voxel_boundary: vec3<f32> = vec3<f32>(voxel + max(vec3<i32>(0), vstep)) * voxel_size;\r\n\tvar tmax_comp: vec3<f32> = select(tmin + (boundary_min + voxel_boundary - ray_entry) / ray.direction, vec3<f32>(tmax), direction_zeros);\r\n\tvar thit: f32 = tmin;\r\n\tvar hit_normal: vec3<f32> = vec3<f32>(0, 0, 0);\r\n\tvar mask: vec3<f32>;\r\n\r\n\twhile(all(voxel >= vec3<i32>(0)) && all(voxel < vec3<i32>(voxel_count))) {\r\n\t\tlet hit_voxel = get_voxel(voxel);\r\n\t\tif (hit_voxel.opacity > 0.01 && all(tmax_comp > vec3<f32>(start_tolerance))){\r\n\t\t\t(*hit).position = ray.origin + ray.direction * thit;\r\n\t\t\t(*hit).voxel = hit_voxel;\r\n\t\t\t(*hit).voxel_position = voxel;\r\n\t\t\t(*hit).depth = 1 - (thit - depth_clip_min) / (depth_clip_max - depth_clip_min);\r\n\t\t\t(*hit).normal = hit_normal;\r\n\t\t\t(*hit).ray_direction = ray.direction;\r\n\t\t\t// let v_diff = (*hit).position - (vec3<f32>(voxel) * voxel_size - boundary_min);\r\n\t\t\tlet uv = (((*hit).position - boundary_min) - (vec3<f32>(voxel) * voxel_size)) / voxel_size;\r\n\t\t\tlet uvx = select(vec3<f32>(1) * mask - mask * uv.yzx, mask * uv.yzx, sign(ray.direction) < vec3<f32>(0));\r\n\t\t\tlet uvy = select(vec3<f32>(1) * mask - mask * uv.zxy, mask * uv.zxy, sign(ray.direction) < vec3<f32>(0));\r\n\t\t\t// let uvy = mask * uv.zxy;\r\n\t\t\t(*hit).uv = vec2<f32>(\r\n\t\t\t\tmax(uvx.x, max(uvx.y, uvx.z)),\r\n\t\t\t\tmax(uvy.x, max(uvy.y, uvy.z)),\r\n\t\t\t\t// dot(mask * v_diff.zxy, vec3<f32>(voxel_size)) / voxel_size,\r\n\t\t\t);\r\n\t\t\tlet next_mask = step(tmax_comp.xyz, tmax_comp.yzx) * step(tmax_comp.xyz, tmax_comp.zxy);\r\n\t\t\tlet tmax_masked = vec3<f32>(next_mask) * tmax_comp;\r\n\t\t\t(*hit).exit_position = ray.origin + ray.direction * max(tmax_masked.x, max(tmax_masked.y, tmax_masked.z));\r\n\r\n\t\t\t\t\t\t// if (tmax_comp.x < tmax_comp.y && tmax_comp.x < tmax_comp.z) {\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.x;\r\n\t\t\t// } else if (tmax_comp.y < tmax_comp.z){\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.y;\r\n\t\t\t// } else {\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.z;\r\n\t\t\t// }\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tmask = step(tmax_comp.xyz, tmax_comp.yzx) * step(tmax_comp.xyz, tmax_comp.zxy);\r\n\t\tvoxel += vstep * vec3<i32>(mask);\r\n\t\tlet tmax_masked = vec3<f32>(mask) * tmax_comp;\r\n\t\tthit = max(tmax_masked.x, max(tmax_masked.y, tmax_masked.z));\r\n\t\thit_normal = -(vec3<f32>(vstep) * mask);\r\n\t\ttmax_comp += mask * tdelta;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nfn voxel_ao(pos: vec3<i32>, d1: vec3<i32>, d2: vec3<i32>) -> vec4<f32> {\r\n\tlet side = vec4<f32>(get_voxel(pos + d1).opacity, get_voxel(pos + d2).opacity, get_voxel(pos - d1).opacity, get_voxel(pos - d2).opacity);\r\n\tlet corner = vec4<f32>(get_voxel(pos + d1 + d2).opacity, get_voxel(pos - d1 + d2).opacity, get_voxel(pos - d1 - d2).opacity, get_voxel(pos + d1 - d2).opacity);\r\n\tlet ao = vec4<f32>(\r\n\t\tvertex_ao(side.xy, corner.x),\r\n\t\tvertex_ao(side.yz, corner.y),\r\n\t\tvertex_ao(side.zw, corner.z),\r\n\t\tvertex_ao(side.wx, corner.w),\r\n\t);\r\n\treturn 1.0 - ao * 0.8;\r\n}\r\n\r\nfn vertex_ao(side: vec2<f32>, corner: f32) -> f32 {\r\n\t// return (side.x + side.y) / 2.0;\r\n\treturn max(side.x + side.y, max(corner, side.x * side.y)) / 2;\r\n\treturn (side.x + side.y + max(corner, side.x * side.y)) / 3.0;\r\n}\r\n\r\nfn get_point_ao_lambert(point: vec3<f32>, normal: vec3<f32>) -> f32 {\r\n\tvar ao: f32 = 0.0;\r\n\tfor (var i = 0; i < ao_samples; i++) {\r\n\t\tlet sample_point = (random_unit_vector() + normal) * rng() * voxel_size * 0.6 + point ;\r\n\t\tao += get_voxel_by_position(sample_point).opacity;\r\n\t}\r\n\treturn max(0, ao / f32(ao_samples));\r\n}\r\n\r\nfn get_point_ao(point: vec3<f32>) -> f32 {\r\n\tvar ao: f32 = 0.0;\r\n\tfor (var i = 0; i < ao_samples; i++) {\r\n\t\tlet sample_point = random_unit_vector() * rng() * ao_range + point;\r\n\t\tao += get_voxel_by_position(sample_point).opacity;\r\n\t}\r\n\treturn max(0, ao / f32(ao_samples) - 0.5);\r\n}\r\n")}),constants:{grid_size:this.scene.grid_size,voxel_count:this.scene.voxel_count}}});const d=null===(_=this.device)||void 0===_?void 0:_.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{}}]});this.screen_bind_group=null===(i=this.device)||void 0===i?void 0:i.createBindGroup({layout:d,entries:[{binding:0,resource:this.sampler},{binding:1,resource:this.color_buffer_view},{binding:2,resource:this.secondary_buffer_view}]});const l=null===(o=this.device)||void 0===o?void 0:o.createPipelineLayout({bindGroupLayouts:[d]});this.screen_pipeline=null===(c=this.device)||void 0===c?void 0:c.createRenderPipeline({layout:l,vertex:{module:this.device.createShaderModule({code:e}),entryPoint:"vert_main"},fragment:{module:this.device.createShaderModule({code:e}),entryPoint:"frag_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list",cullMode:"back",frontFace:"cw"}})}))}}(_e,ce,se.camera);ce.initialize_default_grid(),de.initialize(!1);let le=new class{constructor(e,t){this.background=[0,0,0],this.canvas=e,this.axis="z",this.slice=0,this.scene=t,this.context=e.getContext("2d");const x=document.getElementById("slice-input");x.addEventListener("change",(e=>{const t=Math.floor(parseInt(x.value)/100*this.scene.voxel_count);this.set_slice(t>this.scene.voxel_count-1?this.scene.voxel_count-1:t),console.log(...ae("a3871bd9_0",t))}))}set_background(e){this.background=e,this.update()}set_axis(e){this.axis=e,this.update()}set_slice(e){this.slice=e,this.update()}update(){const e=this.canvas.width,t=this.canvas.height,x=e/this.scene.voxel_count,r=t/this.scene.voxel_count;this.context.clearRect(0,0,e,t);for(let e=0;e<this.scene.voxel_count;e++)for(let t=0;t<this.scene.voxel_count;t++){const n="x"===this.axis?[this.slice,e,t]:"y"===this.axis?[e,this.slice,t]:[e,t,this.slice],a=this.scene.get_voxel(n);Q.floor(Q.scale(a.color,255)),this.context.fillStyle=this.color_to_string(a.color,a.opacity),this.context.fillRect(e*x,t*r,x,r)}}color_to_string(e,t){const x=Q.floor(Q.scale(e,255));return"#"+x[0].toString(16)+x[1].toString(16)+x[2].toString(16)+(255*t).toString(16)}}(oe,ce);le.slice=6,le.background=[30/255,30/255,46/255],le.update();let fe=performance.now(),ue=!1;addEventListener("scroll",(()=>{let e=Math.min(2,window.scrollY/window.innerHeight);document.documentElement.style.setProperty("--canv-offset",e.toString())})),requestAnimationFrame((function e(){de.render();const t=performance.now()-fe;se.tick(t/1e3),fe=performance.now(),ie.innerText=Math.round(1/t*1e3).toString()+" fps",requestAnimationFrame(e)})),addEventListener("mousedown",(e=>{2==e.button&&(ue=!0)}));let he="mocha";const ve=document.getElementById("menu_switch_theme");null==ve||ve.addEventListener("click",(e=>{"mocha"===he?(he="latte",function(){const e=document.querySelector(":root");document.documentElement.dataset.theme="latte",e.style.setProperty("--ctp-crust","#dce0e8"),e.style.setProperty("--ctp-mantle","#e6e9ef"),e.style.setProperty("--ctp-base","#eff1f5"),e.style.setProperty("--ctp-surface0","#ccd0da"),e.style.setProperty("--ctp-surface1","#bcc0cc"),e.style.setProperty("--ctp-surface2","#acb0be"),e.style.setProperty("--ctp-overlay0","#9ca0b0"),e.style.setProperty("--ctp-overlay1","#8c8fa1"),e.style.setProperty("--ctp-overlay2","#7c7f93"),e.style.setProperty("--ctp-subtext0","#6c6f85"),e.style.setProperty("--ctp-subtext1","#5c5f77"),e.style.setProperty("--ctp-text","#4c4f69"),e.style.setProperty("--ctp-lavender","#7287fd"),e.style.setProperty("--ctp-blue","#1e66f5"),e.style.setProperty("--ctp-sapphire","#209fb5"),e.style.setProperty("--ctp-sky","#04a5e5"),e.style.setProperty("--ctp-teal","#179299"),e.style.setProperty("--ctp-green","#40a02b"),e.style.setProperty("--ctp-yellow","#df8e1d"),e.style.setProperty("--ctp-peach","#fe640b"),e.style.setProperty("--ctp-maroon","#e64553"),e.style.setProperty("--ctp-red","#d20f39"),e.style.setProperty("--ctp-mauve","#8839ef"),e.style.setProperty("--ctp-pink","#ea76cb"),e.style.setProperty("--ctp-flamingo","#dd7878"),e.style.setProperty("--ctp-rosewater","#dc8a78")}(),ce.background_color=[.8,208/255,218/255],le.set_background([.8,208/255,218/255])):(he="mocha",function(){const e=document.querySelector(":root");document.documentElement.dataset.theme="mocha",e.style.setProperty("--ctp-crust","#11111b"),e.style.setProperty("--ctp-mantle","#181825"),e.style.setProperty("--ctp-base","#1e1e2e"),e.style.setProperty("--ctp-surface0","#313244"),e.style.setProperty("--ctp-surface1","#45475a"),e.style.setProperty("--ctp-surface2","#585b70"),e.style.setProperty("--ctp-overlay0","#6c7086"),e.style.setProperty("--ctp-overlay1","#7f849c"),e.style.setProperty("--ctp-overlay2","#9399b2"),e.style.setProperty("--ctp-subtext0","#a6adc8"),e.style.setProperty("--ctp-subtext1","#bac2de"),e.style.setProperty("--ctp-text","#cdd6f4"),e.style.setProperty("--ctp-lavender","#b4befe"),e.style.setProperty("--ctp-blue","#89b4fa"),e.style.setProperty("--ctp-sapphire","#74c7ec"),e.style.setProperty("--ctp-sky","#89dceb"),e.style.setProperty("--ctp-teal","#94e2d5"),e.style.setProperty("--ctp-green","#a6e3a1"),e.style.setProperty("--ctp-yellow","#f9e2af"),e.style.setProperty("--ctp-peach","#fab387"),e.style.setProperty("--ctp-maroon","#eba0ac"),e.style.setProperty("--ctp-red","#f38ba8"),e.style.setProperty("--ctp-mauve","#cba6f7"),e.style.setProperty("--ctp-pink","#f5c2e7"),e.style.setProperty("--ctp-flamingo","#f2cdcd"),e.style.setProperty("--ctp-rosewater","#f5e0dc")}(),ce.background_color=[30/255,30/255,46/255],le.set_background([30/255,30/255,46/255]))})),ce.background_color=[30/255,30/255,46/255];const be=document.getElementById("menu_rescale_canvas");function pe(){const e=document.querySelector(":root"),t=.8*Math.min(window.innerWidth,window.innerHeight);e.style.setProperty("--canv-x",t.toString()+"px"),e.style.setProperty("--canv-y",t.toString()+"px"),_e.height=t,_e.width=t,de.shutdown(),de.initialize(de.pathtracing)}null==be||be.addEventListener("click",(e=>{pe()})),pe();const me=document.getElementById("menu_save_scene");null==me||me.addEventListener("click",(e=>{!function(){const e=new Blob([ce.serialize_scene()],{type:"text/json"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="scene.json",t.click(),URL.revokeObjectURL(t.href)}()}));const ye=document.getElementById("menu_load_scene");null==ye||ye.addEventListener("click",(e=>{!function(){const e=document.createElement("input");e.type="file",e.addEventListener("change",(t=>{const x=(null==e?void 0:e.files)[0],r=new FileReader;r.readAsText(x,"UTF-8"),r.addEventListener("load",(e=>{var t;const x=null===(t=e.target)||void 0===t?void 0:t.result;ce.deserialize_scene(x)}))})),e.click()}()})),addEventListener("contextmenu",(e=>(e.preventDefault(),!1)))})();
//# sourceMappingURL=main.js.map