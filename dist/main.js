(()=>{"use strict";const t="@group(0) @binding(0) var screen_sampler : sampler;\r\n@group(0) @binding(1) var color_buffer : texture_2d<f32>;\r\n@group(0) @binding(2) var secondary_buffer : texture_2d<f32>;\r\n\r\nstruct VertexOutput {\r\n        @builtin(position) Position : vec4<f32>,\r\n            @location(0) TexCoord : vec2<f32>,\r\n}\r\n\r\n@vertex\r\nfn vert_main(@builtin(vertex_index) VertexIndex : u32) -> VertexOutput {\r\n    var positions = array<vec2<f32>, 6>(\r\n        vec2<f32>( 1.0,  1.0),\r\n        vec2<f32>( 1.0, -1.0),\r\n        vec2<f32>(-1.0, -1.0),\r\n        vec2<f32>( 1.0,  1.0),\r\n        vec2<f32>(-1.0, -1.0),\r\n        vec2<f32>(-1.0,  1.0)\r\n    );\r\n\r\n    var texCoords = array<vec2<f32>, 6>(\r\n        vec2<f32>(1.0, 0.0),\r\n        vec2<f32>(1.0, 1.0),\r\n        vec2<f32>(0.0, 1.0),\r\n        vec2<f32>(1.0, 0.0),\r\n        vec2<f32>(0.0, 1.0),\r\n        vec2<f32>(0.0, 0.0)\r\n    );\r\n\r\n    var output : VertexOutput;\r\n    output.Position = vec4<f32>(positions[VertexIndex], 0.0, 1.0);\r\n    output.TexCoord = texCoords[VertexIndex];\r\n    return output;\r\n}\r\n\r\nconst ao_blur_steps = 7;\r\nconst ao_blur_radius = 0.00f / f32(ao_blur_steps);\r\nconst ao_strength = 1;\r\n\r\n@fragment\r\nfn frag_main(@location(0) TexCoord : vec2<f32>) -> @location(0) vec4<f32> {\r\n\tvar acc = 0f;\r\n\tlet blur_offset = (ao_blur_radius * f32(ao_blur_steps)) / 2;\r\n\tfor (var x = 0; x < ao_blur_steps; x++){\r\n\t\tfor (var y = 0; y < ao_blur_steps; y++){\r\n\t\t\tacc += textureSample(secondary_buffer, screen_sampler, vec2<f32>(TexCoord.x - blur_offset + ao_blur_radius * f32(x), TexCoord.y - blur_offset + ao_blur_radius * f32(y))).x;\r\n\t\t}\r\n\t}\r\n\tacc /= f32(ao_blur_steps) * f32(ao_blur_steps);\r\n\r\n    // return vec4<f32>(acc, acc, acc, 1.0);\r\n    return textureSample(color_buffer, screen_sampler, TexCoord) * (1 - acc * ao_strength);\r\n}\r\n";var e=function(t,e,r,x){return new(r||(r=Promise))((function(n,_){function i(t){try{c(x.next(t))}catch(t){_(t)}}function a(t){try{c(x.throw(t))}catch(t){_(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,a)}c((x=x.apply(t,e||[])).next())}))};let r=1e-6,x=Float32Array;function n(t=0,e=0){const r=new x(2);return void 0!==t&&(r[0]=t,void 0!==e&&(r[1]=e)),r}const _=n;function i(t,e,r){return(r=r||new x(2))[0]=t[0]-e[0],r[1]=t[1]-e[1],r}const a=i;function c(t,e,r){return(r=r||new x(2))[0]=t[0]*e,r[1]=t[1]*e,r}const o=c;function s(t,e){return(e=e||new x(2))[0]=1/t[0],e[1]=1/t[1],e}const l=s;function d(t,e){return t[0]*e[0]+t[1]*e[1]}function f(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}const h=f;function u(t){const e=t[0],r=t[1];return e*e+r*r}const v=u;function b(t,e){const r=t[0]-e[0],x=t[1]-e[1];return Math.sqrt(r*r+x*x)}const p=b;function m(t,e){const r=t[0]-e[0],x=t[1]-e[1];return r*r+x*x}const g=m;function y(t,e){return(e=e||new x(2))[0]=t[0],e[1]=t[1],e}const w=y;function P(t,e,r){return(r=r||new x(2))[0]=t[0]*e[0],r[1]=t[1]*e[1],r}const z=P;function M(t,e,r){return(r=r||new x(2))[0]=t[0]/e[0],r[1]=t[1]/e[1],r}const S=M;var E=Object.freeze({__proto__:null,add:function(t,e,r){return(r=r||new x(2))[0]=t[0]+e[0],r[1]=t[1]+e[1],r},addScaled:function(t,e,r,n){return(n=n||new x(2))[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n},angle:function(t,e){const r=t[0],x=t[1],n=t[0],_=t[1],i=Math.sqrt(r*r+x*x)*Math.sqrt(n*n+_*_),a=i&&d(t,e)/i;return Math.acos(a)},ceil:function(t,e){return(e=e||new x(2))[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},clamp:function(t,e=0,r=1,n){return(n=n||new x(2))[0]=Math.min(r,Math.max(e,t[0])),n[1]=Math.min(r,Math.max(e,t[1])),n},clone:w,copy:y,create:n,cross:function(t,e,r){r=r||new x(3);const n=t[0]*e[1]-t[1]*e[0];return r[0]=0,r[1]=0,r[2]=n,r},dist:p,distSq:g,distance:b,distanceSq:m,div:S,divScalar:function(t,e,r){return(r=r||new x(2))[0]=t[0]/e,r[1]=t[1]/e,r},divide:M,dot:d,equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<r&&Math.abs(t[1]-e[1])<r},floor:function(t,e){return(e=e||new x(2))[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},fromValues:_,inverse:s,invert:l,len:h,lenSq:v,length:f,lengthSq:u,lerp:function(t,e,r,n){return(n=n||new x(2))[0]=t[0]+r*(e[0]-t[0]),n[1]=t[1]+r*(e[1]-t[1]),n},lerpV:function(t,e,r,n){return(n=n||new x(2))[0]=t[0]+r[0]*(e[0]-t[0]),n[1]=t[1]+r[1]*(e[1]-t[1]),n},max:function(t,e,r){return(r=r||new x(2))[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r},min:function(t,e,r){return(r=r||new x(2))[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r},mul:z,mulScalar:c,multiply:P,negate:function(t,e){return(e=e||new x(2))[0]=-t[0],e[1]=-t[1],e},normalize:function(t,e){e=e||new x(2);const r=t[0],n=t[1],_=Math.sqrt(r*r+n*n);return _>1e-5?(e[0]=r/_,e[1]=n/_):(e[0]=0,e[1]=0),e},random:function(t=1,e){e=e||new x(2);const r=2*Math.random()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},round:function(t,e){return(e=e||new x(2))[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:o,setDefaultType:function(t){const e=x;return x=t,e},sub:a,subtract:i,transformMat3:function(t,e,r){r=r||new x(2);const n=t[0],_=t[1];return r[0]=e[0]*n+e[4]*_+e[8],r[1]=e[1]*n+e[5]*_+e[9],r},transformMat4:function(t,e,r){r=r||new x(2);const n=t[0],_=t[1];return r[0]=n*e[0]+_*e[4]+e[12],r[1]=n*e[1]+_*e[5]+e[13],r},zero:function(t){return(t=t||new x(2))[0]=0,t[1]=0,t}});Float32Array;new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]).get(Float32Array);let I=Float32Array;function T(t,e,r){const x=new I(3);return void 0!==t&&(x[0]=t,void 0!==e&&(x[1]=e,void 0!==r&&(x[2]=r))),x}const k=T;function L(t,e,r){return(r=r||new I(3))[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}const R=L;function O(t,e,r){return(r=r||new I(3))[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}const A=O;function D(t,e){return(e=e||new I(3))[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}const N=D;function B(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function G(t){const e=t[0],r=t[1],x=t[2];return Math.sqrt(e*e+r*r+x*x)}const U=G;function C(t){const e=t[0],r=t[1],x=t[2];return e*e+r*r+x*x}const j=C;function F(t,e){const r=t[0]-e[0],x=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+x*x+n*n)}const q=F;function V(t,e){const r=t[0]-e[0],x=t[1]-e[1],n=t[2]-e[2];return r*r+x*x+n*n}const H=V;function Y(t,e){return(e=e||new I(3))[0]=t[0],e[1]=t[1],e[2]=t[2],e}const W=Y;function $(t,e,r){return(r=r||new I(3))[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}const X=$;function Z(t,e,r){return(r=r||new I(3))[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}const J=Z;var Q=Object.freeze({__proto__:null,add:function(t,e,r){return(r=r||new I(3))[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r},addScaled:function(t,e,r,x){return(x=x||new I(3))[0]=t[0]+e[0]*r,x[1]=t[1]+e[1]*r,x[2]=t[2]+e[2]*r,x},angle:function(t,e){const r=t[0],x=t[1],n=t[2],_=t[0],i=t[1],a=t[2],c=Math.sqrt(r*r+x*x+n*n)*Math.sqrt(_*_+i*i+a*a),o=c&&B(t,e)/c;return Math.acos(o)},ceil:function(t,e){return(e=e||new I(3))[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},clamp:function(t,e=0,r=1,x){return(x=x||new I(3))[0]=Math.min(r,Math.max(e,t[0])),x[1]=Math.min(r,Math.max(e,t[1])),x[2]=Math.min(r,Math.max(e,t[2])),x},clone:W,copy:Y,create:T,cross:function(t,e,r){r=r||new I(3);const x=t[2]*e[0]-t[0]*e[2],n=t[0]*e[1]-t[1]*e[0];return r[0]=t[1]*e[2]-t[2]*e[1],r[1]=x,r[2]=n,r},dist:q,distSq:H,distance:F,distanceSq:V,div:J,divScalar:function(t,e,r){return(r=r||new I(3))[0]=t[0]/e,r[1]=t[1]/e,r[2]=t[2]/e,r},divide:Z,dot:B,equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<r&&Math.abs(t[1]-e[1])<r&&Math.abs(t[2]-e[2])<r},floor:function(t,e){return(e=e||new I(3))[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},fromValues:k,getAxis:function(t,e,r){const x=4*e;return(r=r||new I(3))[0]=t[x+0],r[1]=t[x+1],r[2]=t[x+2],r},getScaling:function(t,e){e=e||new I(3);const r=t[0],x=t[1],n=t[2],_=t[4],i=t[5],a=t[6],c=t[8],o=t[9],s=t[10];return e[0]=Math.sqrt(r*r+x*x+n*n),e[1]=Math.sqrt(_*_+i*i+a*a),e[2]=Math.sqrt(c*c+o*o+s*s),e},getTranslation:function(t,e){return(e=e||new I(3))[0]=t[12],e[1]=t[13],e[2]=t[14],e},inverse:D,invert:N,len:U,lenSq:j,length:G,lengthSq:C,lerp:function(t,e,r,x){return(x=x||new I(3))[0]=t[0]+r*(e[0]-t[0]),x[1]=t[1]+r*(e[1]-t[1]),x[2]=t[2]+r*(e[2]-t[2]),x},lerpV:function(t,e,r,x){return(x=x||new I(3))[0]=t[0]+r[0]*(e[0]-t[0]),x[1]=t[1]+r[1]*(e[1]-t[1]),x[2]=t[2]+r[2]*(e[2]-t[2]),x},max:function(t,e,r){return(r=r||new I(3))[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r},min:function(t,e,r){return(r=r||new I(3))[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r},mul:X,mulScalar:O,multiply:$,negate:function(t,e){return(e=e||new I(3))[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},normalize:function(t,e){e=e||new I(3);const r=t[0],x=t[1],n=t[2],_=Math.sqrt(r*r+x*x+n*n);return _>1e-5?(e[0]=r/_,e[1]=x/_,e[2]=n/_):(e[0]=0,e[1]=0,e[2]=0),e},random:function(t=1,e){e=e||new I(3);const r=2*Math.random()*Math.PI,x=2*Math.random()-1,n=Math.sqrt(1-x*x)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=x*t,e},round:function(t,e){return(e=e||new I(3))[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:A,setDefaultType:function(t){const e=I;return I=t,e},sub:R,subtract:L,transformMat3:function(t,e,r){r=r||new I(3);const x=t[0],n=t[1],_=t[2];return r[0]=x*e[0]+n*e[4]+_*e[8],r[1]=x*e[1]+n*e[5]+_*e[9],r[2]=x*e[2]+n*e[6]+_*e[10],r},transformMat4:function(t,e,r){r=r||new I(3);const x=t[0],n=t[1],_=t[2],i=e[3]*x+e[7]*n+e[11]*_+e[15]||1;return r[0]=(e[0]*x+e[4]*n+e[8]*_+e[12])/i,r[1]=(e[1]*x+e[5]*n+e[9]*_+e[13])/i,r[2]=(e[2]*x+e[6]*n+e[10]*_+e[14])/i,r},transformMat4Upper3x3:function(t,e,r){r=r||new I(3);const x=t[0],n=t[1],_=t[2];return r[0]=x*e[0]+n*e[4]+_*e[8],r[1]=x*e[1]+n*e[5]+_*e[9],r[2]=x*e[2]+n*e[6]+_*e[10],r},zero:function(t){return(t=t||new I(3))[0]=0,t[1]=0,t[2]=0,t}});function K(t){return t*Math.PI/180}Float32Array,Float32Array,Float32Array;class tt{constructor(t,e){this.origin=t,this.direction=Q.normalize(e),this.inv_direction=[1,1,1],Q.div(this.inv_direction,e,this.inv_direction)}}class et{constructor(t,e,r,x){this.position=t,this.voxel_position=e,this.voxel=r,this.normal=x}}class rt{constructor(){this.color=Q.create(),this.opacity=0,this.roughness=1,this.lightness=0}}class xt{constructor(){this.gi=Q.create()}}class nt{constructor(t,e,r){this.dragged=!1,this.velocity=[0,0],this.distance=8,this.forward=Q.create(),this.right=Q.create(),this.up=Q.create(),this.position=Q.create(),this.eulers=[0,r,e],this.distance=t}update(){this.eulers[1]=Math.min(80,Math.max(-80,this.eulers[1])),this.eulers[2]=this.eulers[2]%360,this.forward=[Math.cos(K(this.eulers[2]))*Math.cos(K(this.eulers[1])),Math.sin(K(this.eulers[2]))*Math.cos(K(this.eulers[1])),Math.sin(K(this.eulers[1]))],Q.normalize(Q.cross(this.forward,[0,0,1],this.right),this.right),Q.normalize(Q.cross(this.right,this.forward,this.up),this.up),Q.scale(this.forward,-this.distance,this.position)}tick(t){this.dragged||(this.eulers[1]-=this.velocity[1],this.eulers[2]-=this.velocity[0]),E.scale(this.velocity,.96*(1-t),this.velocity),this.update()}screen_to_ray(t,e,r,x){const n=(t-r/2)/r,_=(e-x/2)/-x;let i=Q.create();return Q.add(i,this.forward,i),Q.add(i,Q.scale(this.right,n),i),Q.add(i,Q.scale(this.up,_),i),new tt(this.position,i)}}function _t(t,...e){try{(function(){try{return(0,eval)("globalThis._console_ninja")||(0,eval)("/* https://github.com/wallabyjs/console-ninja#how-does-it-work */'use strict';var _0x5b65ae=_0x1ad9;function _0x35db(){var _0x9ec155=['1056852fzppiF','location','reduceLimits','send','number','_connectAttemptCount','_setNodePermissions','url','autoExpandPreviousObjects','value','serialize','73244PdGshd','6DeuHKF','match','cappedElements','_allowedToSend','getOwnPropertySymbols','positiveInfinity','_hasSetOnItsPath','array','_cleanNode','reload','Error','substr','_attemptToReconnectShortly','pop','_setNodeLabel','_undefined','stringify','_setNodeQueryPath','_objectToString','timeEnd','argumentResolutionError','_disposeWebsocket','hrtime','negativeZero','442685StOQim','_consoleNinjaAllowedToStart','_addObjectProperty','_isMap','207fSpRtp','strLength','_socket','indexOf','disabledLog','__es'+'Module','HTMLAllCollection','push','create','replace','depth','','_treeNodePropertiesAfterFullValue','message','isExpressionToEvaluate','console','_p_name','getter',':logPointId:','[object\\x20Map]','_sortProps','_addLoadNode','test','expId','map','_processTreeNodeResult','7488128yEsYFT','node','pathToFileURL','process','\\x20browser','ws/index.js','disabledTrace','_addFunctionsNode','null','_allowedToConnectOnSend','readyState','_connecting','constructor','expressionsToEvaluate','Symbol','_maxConnectAttemptCount','funcName','3488715FjuFsI','data','onmessage','root_exp_id','unshift','bigint','remix','1.0.0','warn','performance','10203240hLdYuz','[object\\x20Set]','_regExpToString','autoExpandLimit','hostname','Set','_addProperty','String','index','global','WebSocket','includes','then','onclose','prototype','_getOwnPropertyDescriptor','enumerable','_connectToHostNow','NEGATIVE_INFINITY','hasOwnProperty','catch','_hasMapOnItsPath','sortProps','7IYRHke','stackTraceLimit','object','totalStrLength','_p_','_Symbol','34024fMIffX','_getOwnPropertySymbols','setter','_numberRegExp','string','noFunctions','boolean','resolveGetters','toString','nuxt','logger\\x20websocket\\x20error','_isNegativeZero','trace','capped','POSITIVE_INFINITY','_propertyAccessor','host','versions','concat','props','onopen','cappedProps','elements','undefined','function','valueOf','isArray','level','_keyStrRegExp','now','_setNodeExpressionPath','port','allStrLength','current','onerror','type','_sendErrorMessage','name','date','_property','split','_propertyName','failed\\x20to\\x20find\\x20and\\x20load\\x20WebSocket','default','[object\\x20Date]','[object\\x20BigInt]','\\x20server','Number','ws://','defineProperty','_treeNodePropertiesBeforeFullValue','next.js','forEach','unknown','_setNodeId','RegExp','_dateToString','sort','set','rootExpression','autoExpandMaxDepth','timeStamp','_p_length','logger\\x20failed\\x20to\\x20connect\\x20to\\x20host','Buffer','_quotedRegExp','...','count','_WebSocketClass','_console_ninja_session','getOwnPropertyNames','getWebSocketClass','_isPrimitiveWrapperType','parent','root_exp','failed\\x20to\\x20connect\\x20to\\x20host:\\x20','time','_isPrimitiveType','autoExpandPropertyCount','toLowerCase','_reconnectTimeout','getPrototypeOf','Boolean','symbol','_WebSocket','length','call','path','negativeInfinity','nodeModules','slice','_inBrowser','_additionalMetadata','_hasSymbolPropertyOnItsPath','_type','_connected',\"c:\\\\Users\\\\c\\\\.vscode\\\\extensions\\\\wallabyjs.console-ninja-0.0.149\\\\node_modules\",'_blacklistedProperty','autoExpand','close','_console_ninja','1686649490621','getOwnPropertyDescriptor','_ws','join','Map','perf_hooks','log','_capIfString','hits','unref','_getOwnPropertyNames','_isSet','_HTMLAllCollection'];_0x35db=function(){return _0x9ec155;};return _0x35db();}(function(_0x4a4af5,_0x491168){var _0x4196f5=_0x1ad9,_0x2d6157=_0x4a4af5();while(!![]){try{var _0x40eb03=parseInt(_0x4196f5(0x26e))/0x1+-parseInt(_0x4196f5(0x255))/0x2+-parseInt(_0x4196f5(0x272))/0x3*(-parseInt(_0x4196f5(0x2c4))/0x4)+parseInt(_0x4196f5(0x29d))/0x5*(-parseInt(_0x4196f5(0x256))/0x6)+-parseInt(_0x4196f5(0x2be))/0x7*(parseInt(_0x4196f5(0x28c))/0x8)+parseInt(_0x4196f5(0x24a))/0x9+parseInt(_0x4196f5(0x2a7))/0xa;if(_0x40eb03===_0x491168)break;else _0x2d6157['push'](_0x2d6157['shift']());}catch(_0x4bd6bc){_0x2d6157['push'](_0x2d6157['shift']());}}}(_0x35db,0x7954a));function _0x1ad9(_0x3f8695,_0xbc9cae){var _0x35dbdf=_0x35db();return _0x1ad9=function(_0x1ad960,_0xbdc8e9){_0x1ad960=_0x1ad960-0x1ef;var _0x426091=_0x35dbdf[_0x1ad960];return _0x426091;},_0x1ad9(_0x3f8695,_0xbc9cae);}var ue=Object[_0x5b65ae(0x27a)],te=Object[_0x5b65ae(0x209)],he=Object[_0x5b65ae(0x23e)],le=Object['getOwnPropertyNames'],fe=Object[_0x5b65ae(0x229)],_e=Object[_0x5b65ae(0x2b5)][_0x5b65ae(0x2ba)],pe=(_0x45a77d,_0x1966bc,_0x4c000d,_0x27cd0f)=>{var _0x470c51=_0x5b65ae;if(_0x1966bc&&typeof _0x1966bc=='object'||typeof _0x1966bc==_0x470c51(0x1f0)){for(let _0x5daa32 of le(_0x1966bc))!_e[_0x470c51(0x22e)](_0x45a77d,_0x5daa32)&&_0x5daa32!==_0x4c000d&&te(_0x45a77d,_0x5daa32,{'get':()=>_0x1966bc[_0x5daa32],'enumerable':!(_0x27cd0f=he(_0x1966bc,_0x5daa32))||_0x27cd0f[_0x470c51(0x2b7)]});}return _0x45a77d;},ne=(_0x19af4e,_0x43bc66,_0x3edec2)=>(_0x3edec2=_0x19af4e!=null?ue(fe(_0x19af4e)):{},pe(_0x43bc66||!_0x19af4e||!_0x19af4e[_0x5b65ae(0x277)]?te(_0x3edec2,_0x5b65ae(0x203),{'value':_0x19af4e,'enumerable':!0x0}):_0x3edec2,_0x19af4e)),Q=class{constructor(_0x1495c9,_0x10531c,_0x321856,_0x38a3d7){var _0x4405de=_0x5b65ae;this[_0x4405de(0x2b0)]=_0x1495c9,this[_0x4405de(0x2d4)]=_0x10531c,this[_0x4405de(0x1f7)]=_0x321856,this[_0x4405de(0x231)]=_0x38a3d7,this[_0x4405de(0x259)]=!0x0,this[_0x4405de(0x295)]=!0x0,this['_connected']=!0x1,this['_connecting']=!0x1,this[_0x4405de(0x233)]=!!this['global'][_0x4405de(0x2b1)],this[_0x4405de(0x21c)]=null,this['_connectAttemptCount']=0x0,this['_maxConnectAttemptCount']=0x14,this[_0x4405de(0x1fc)]=this[_0x4405de(0x233)]?'Console\\x20Ninja\\x20failed\\x20to\\x20send\\x20logs,\\x20refreshing\\x20the\\x20page\\x20may\\x20help':'Console\\x20Ninja\\x20failed\\x20to\\x20send\\x20logs,\\x20restarting\\x20the\\x20process\\x20may\\x20help';}async[_0x5b65ae(0x21f)](){var _0x36aa5f=_0x5b65ae;if(this[_0x36aa5f(0x21c)])return this['_WebSocketClass'];let _0xb4cbc1;if(this[_0x36aa5f(0x233)])_0xb4cbc1=this['global'][_0x36aa5f(0x2b1)];else{if(this[_0x36aa5f(0x2b0)][_0x36aa5f(0x28f)]?.[_0x36aa5f(0x22c)])_0xb4cbc1=this[_0x36aa5f(0x2b0)][_0x36aa5f(0x28f)]?.[_0x36aa5f(0x22c)];else try{let _0x4c168b=await import('path');_0xb4cbc1=(await import((await import(_0x36aa5f(0x251)))[_0x36aa5f(0x28e)](_0x4c168b['join'](this[_0x36aa5f(0x231)],_0x36aa5f(0x291)))[_0x36aa5f(0x2cc)]()))[_0x36aa5f(0x203)];}catch{try{_0xb4cbc1=require(require(_0x36aa5f(0x22f))[_0x36aa5f(0x240)](this[_0x36aa5f(0x231)],'ws'));}catch{throw new Error(_0x36aa5f(0x202));}}}return this['_WebSocketClass']=_0xb4cbc1,_0xb4cbc1;}[_0x5b65ae(0x2b8)](){var _0x5ef851=_0x5b65ae;this[_0x5ef851(0x297)]||this[_0x5ef851(0x237)]||this['_connectAttemptCount']>=this[_0x5ef851(0x29b)]||(this[_0x5ef851(0x295)]=!0x1,this[_0x5ef851(0x297)]=!0x0,this[_0x5ef851(0x24f)]++,this[_0x5ef851(0x23f)]=new Promise((_0x55ab9d,_0x100b48)=>{var _0x35fd24=_0x5ef851;this[_0x35fd24(0x21f)]()[_0x35fd24(0x2b3)](_0x61115a=>{var _0xbb2ea6=_0x35fd24;let _0x33f163=new _0x61115a(_0xbb2ea6(0x208)+this[_0xbb2ea6(0x2d4)]+':'+this[_0xbb2ea6(0x1f7)]);_0x33f163[_0xbb2ea6(0x1fa)]=()=>{var _0x4ffe0=_0xbb2ea6;this[_0x4ffe0(0x259)]=!0x1,this['_disposeWebsocket'](_0x33f163),this[_0x4ffe0(0x262)](),_0x100b48(new Error(_0x4ffe0(0x2ce)));},_0x33f163[_0xbb2ea6(0x2d8)]=()=>{var _0x324533=_0xbb2ea6;this['_inBrowser']||_0x33f163[_0x324533(0x274)]&&_0x33f163[_0x324533(0x274)][_0x324533(0x246)]&&_0x33f163[_0x324533(0x274)][_0x324533(0x246)](),_0x55ab9d(_0x33f163);},_0x33f163[_0xbb2ea6(0x2b4)]=()=>{var _0x3fbf0a=_0xbb2ea6;this['_allowedToConnectOnSend']=!0x0,this[_0x3fbf0a(0x26b)](_0x33f163),this[_0x3fbf0a(0x262)]();},_0x33f163[_0xbb2ea6(0x29f)]=_0x134e50=>{var _0x5b715b=_0xbb2ea6;try{_0x134e50&&_0x134e50[_0x5b715b(0x29e)]&&this['_inBrowser']&&JSON['parse'](_0x134e50['data'])['method']===_0x5b715b(0x25f)&&this[_0x5b715b(0x2b0)]['location'][_0x5b715b(0x25f)]();}catch{}};})['then'](_0x447ef0=>(this[_0x35fd24(0x237)]=!0x0,this[_0x35fd24(0x297)]=!0x1,this['_allowedToConnectOnSend']=!0x1,this[_0x35fd24(0x259)]=!0x0,this[_0x35fd24(0x24f)]=0x0,_0x447ef0))['catch'](_0x140c68=>(this[_0x35fd24(0x237)]=!0x1,this[_0x35fd24(0x297)]=!0x1,_0x100b48(new Error(_0x35fd24(0x223)+(_0x140c68&&_0x140c68['message'])))));}));}[_0x5b65ae(0x26b)](_0x2d7e66){var _0x343315=_0x5b65ae;this[_0x343315(0x237)]=!0x1,this['_connecting']=!0x1;try{_0x2d7e66[_0x343315(0x2b4)]=null,_0x2d7e66[_0x343315(0x1fa)]=null,_0x2d7e66[_0x343315(0x2d8)]=null;}catch{}try{_0x2d7e66[_0x343315(0x296)]<0x2&&_0x2d7e66[_0x343315(0x23b)]();}catch{}}[_0x5b65ae(0x262)](){var _0xca04b9=_0x5b65ae;clearTimeout(this[_0xca04b9(0x228)]),!(this['_connectAttemptCount']>=this[_0xca04b9(0x29b)])&&(this[_0xca04b9(0x228)]=setTimeout(()=>{var _0x44d343=_0xca04b9;this[_0x44d343(0x237)]||this[_0x44d343(0x297)]||(this[_0x44d343(0x2b8)](),this['_ws']?.[_0x44d343(0x2bb)](()=>this['_attemptToReconnectShortly']()));},0x1f4),this[_0xca04b9(0x228)][_0xca04b9(0x246)]&&this['_reconnectTimeout'][_0xca04b9(0x246)]());}async[_0x5b65ae(0x24d)](_0x1a44f3){var _0x1b8c99=_0x5b65ae;try{if(!this[_0x1b8c99(0x259)])return;this[_0x1b8c99(0x295)]&&this[_0x1b8c99(0x2b8)](),(await this['_ws'])[_0x1b8c99(0x24d)](JSON[_0x1b8c99(0x266)](_0x1a44f3));}catch(_0x3a3349){console[_0x1b8c99(0x2a5)](this[_0x1b8c99(0x1fc)]+':\\x20'+(_0x3a3349&&_0x3a3349[_0x1b8c99(0x27f)])),this[_0x1b8c99(0x259)]=!0x1,this[_0x1b8c99(0x262)]();}}};function V(_0x15b4d4,_0x22064a,_0x399d84,_0x4604df,_0x22d578){var _0x996d8e=_0x5b65ae;let _0x3ae9f3=_0x399d84[_0x996d8e(0x200)](',')[_0x996d8e(0x28a)](_0x578d67=>{var _0x46b6a5=_0x996d8e;try{_0x15b4d4[_0x46b6a5(0x21d)]||((_0x22d578===_0x46b6a5(0x20b)||_0x22d578===_0x46b6a5(0x2a3)||_0x22d578==='astro')&&(_0x22d578+=_0x15b4d4[_0x46b6a5(0x28f)]?.[_0x46b6a5(0x2d5)]?.[_0x46b6a5(0x28d)]?_0x46b6a5(0x206):_0x46b6a5(0x290)),_0x15b4d4[_0x46b6a5(0x21d)]={'id':+new Date(),'tool':_0x22d578});let _0x1d8538=new Q(_0x15b4d4,_0x22064a,_0x578d67,_0x4604df);return _0x1d8538[_0x46b6a5(0x24d)]['bind'](_0x1d8538);}catch(_0x34eab4){return console[_0x46b6a5(0x2a5)](_0x46b6a5(0x217),_0x34eab4&&_0x34eab4[_0x46b6a5(0x27f)]),()=>{};}});return _0x232254=>_0x3ae9f3[_0x996d8e(0x20c)](_0x2cb686=>_0x2cb686(_0x232254));}function H(_0x2302ab){var _0x18af7d=_0x5b65ae;let _0x30bd5c=function(_0x4701fa,_0x563823){return _0x563823-_0x4701fa;},_0x151b7b;if(_0x2302ab['performance'])_0x151b7b=function(){var _0x3386f4=_0x1ad9;return _0x2302ab[_0x3386f4(0x2a6)]['now']();};else{if(_0x2302ab[_0x18af7d(0x28f)]&&_0x2302ab[_0x18af7d(0x28f)][_0x18af7d(0x26c)])_0x151b7b=function(){var _0xada3ec=_0x18af7d;return _0x2302ab[_0xada3ec(0x28f)][_0xada3ec(0x26c)]();},_0x30bd5c=function(_0x2920f2,_0xd5e778){return 0x3e8*(_0xd5e778[0x0]-_0x2920f2[0x0])+(_0xd5e778[0x1]-_0x2920f2[0x1])/0xf4240;};else try{let {performance:_0x408f82}=require(_0x18af7d(0x242));_0x151b7b=function(){var _0x2fd3e4=_0x18af7d;return _0x408f82[_0x2fd3e4(0x1f5)]();};}catch{_0x151b7b=function(){return+new Date();};}}return{'elapsed':_0x30bd5c,'timeStamp':_0x151b7b,'now':()=>Date[_0x18af7d(0x1f5)]()};}function X(_0x291d7d,_0x5e65a1,_0x1ee7cb){var _0x13a7e1=_0x5b65ae;if(_0x291d7d[_0x13a7e1(0x26f)]!==void 0x0)return _0x291d7d[_0x13a7e1(0x26f)];let _0x5b9a62=_0x291d7d[_0x13a7e1(0x28f)]?.[_0x13a7e1(0x2d5)]?.[_0x13a7e1(0x28d)];return _0x5b9a62&&_0x1ee7cb===_0x13a7e1(0x2cd)?_0x291d7d['_consoleNinjaAllowedToStart']=!0x1:_0x291d7d[_0x13a7e1(0x26f)]=_0x5b9a62||!_0x5e65a1||_0x291d7d['location']?.[_0x13a7e1(0x2ab)]&&_0x5e65a1[_0x13a7e1(0x2b2)](_0x291d7d[_0x13a7e1(0x24b)][_0x13a7e1(0x2ab)]),_0x291d7d['_consoleNinjaAllowedToStart'];}((_0x372a2f,_0x3e0ff3,_0x47eb3d,_0x4a884e,_0x83d97b,_0x77ff4c,_0x4af6e9,_0x3a73ff,_0x5c9995)=>{var _0xc58029=_0x5b65ae;if(_0x372a2f[_0xc58029(0x23c)])return _0x372a2f[_0xc58029(0x23c)];if(!X(_0x372a2f,_0x3a73ff,_0x83d97b))return _0x372a2f['_console_ninja']={'consoleLog':()=>{},'consoleTrace':()=>{},'consoleTime':()=>{},'consoleTimeEnd':()=>{},'autoLog':()=>{},'autoTrace':()=>{},'autoTime':()=>{},'autoTimeEnd':()=>{}},_0x372a2f[_0xc58029(0x23c)];let _0x1e2060={'props':0x64,'elements':0x64,'strLength':0x400*0x32,'totalStrLength':0x400*0x32,'autoExpandLimit':0x1388,'autoExpandMaxDepth':0xa},_0x3e3aee={'props':0x5,'elements':0x5,'strLength':0x100,'totalStrLength':0x100*0x3,'autoExpandLimit':0x1e,'autoExpandMaxDepth':0x2},_0x14e96b=H(_0x372a2f),_0x3f16bf=_0x14e96b['elapsed'],_0x368491=_0x14e96b[_0xc58029(0x215)],_0x42f234=_0x14e96b[_0xc58029(0x1f5)],_0x793dfe={'hits':{},'ts':{}},_0x5898f6=_0xf8926c=>{_0x793dfe['ts'][_0xf8926c]=_0x368491();},_0x89ab22=(_0x2f4b4b,_0x5f972e)=>{var _0x1f19c3=_0xc58029;let _0x295b8e=_0x793dfe['ts'][_0x5f972e];if(delete _0x793dfe['ts'][_0x5f972e],_0x295b8e){let _0x2f0335=_0x3f16bf(_0x295b8e,_0x368491());_0x4f3dc7(_0x10cae1(_0x1f19c3(0x224),_0x2f4b4b,_0x42f234(),_0x4a85ec,[_0x2f0335],_0x5f972e));}},_0x39fbe0=_0x459d1d=>_0x5b0184=>{var _0x204665=_0xc58029;try{_0x5898f6(_0x5b0184),_0x459d1d(_0x5b0184);}finally{_0x372a2f[_0x204665(0x281)]['time']=_0x459d1d;}},_0x402ca8=_0x1b32d4=>_0x345b32=>{var _0x15a10c=_0xc58029;try{let [_0x3bc07e,_0x58d5a8]=_0x345b32[_0x15a10c(0x200)](_0x15a10c(0x284));_0x89ab22(_0x58d5a8,_0x3bc07e),_0x1b32d4(_0x3bc07e);}finally{_0x372a2f[_0x15a10c(0x281)][_0x15a10c(0x269)]=_0x1b32d4;}};_0x372a2f['_console_ninja']={'consoleLog':(_0x5ec685,_0x579967)=>{var _0x4db740=_0xc58029;_0x372a2f['console']['log']['name']!==_0x4db740(0x276)&&_0x4f3dc7(_0x10cae1(_0x4db740(0x243),_0x5ec685,_0x42f234(),_0x4a85ec,_0x579967));},'consoleTrace':(_0x35562d,_0x423ebd)=>{var _0x25ff11=_0xc58029;_0x372a2f[_0x25ff11(0x281)][_0x25ff11(0x243)]['name']!==_0x25ff11(0x292)&&_0x4f3dc7(_0x10cae1(_0x25ff11(0x2d0),_0x35562d,_0x42f234(),_0x4a85ec,_0x423ebd));},'consoleTime':()=>{var _0x128ffe=_0xc58029;_0x372a2f[_0x128ffe(0x281)][_0x128ffe(0x224)]=_0x39fbe0(_0x372a2f[_0x128ffe(0x281)][_0x128ffe(0x224)]);},'consoleTimeEnd':()=>{var _0x4eee35=_0xc58029;_0x372a2f['console'][_0x4eee35(0x269)]=_0x402ca8(_0x372a2f[_0x4eee35(0x281)][_0x4eee35(0x269)]);},'autoLog':(_0x4d3610,_0x4878ea)=>{var _0x1a9d18=_0xc58029;_0x4f3dc7(_0x10cae1(_0x1a9d18(0x243),_0x4878ea,_0x42f234(),_0x4a85ec,[_0x4d3610]));},'autoTrace':(_0x4a2be8,_0x246f59)=>{var _0x464f6a=_0xc58029;_0x4f3dc7(_0x10cae1(_0x464f6a(0x2d0),_0x246f59,_0x42f234(),_0x4a85ec,[_0x4a2be8]));},'autoTime':(_0x5b0d58,_0xaf5b7,_0x55e460)=>{_0x5898f6(_0x55e460);},'autoTimeEnd':(_0x1feb53,_0x130a7b,_0x5c9012)=>{_0x89ab22(_0x130a7b,_0x5c9012);}};let _0x4f3dc7=V(_0x372a2f,_0x3e0ff3,_0x47eb3d,_0x4a884e,_0x83d97b),_0x4a85ec=_0x372a2f[_0xc58029(0x21d)];class _0x1ae7d4{constructor(){var _0x1486f4=_0xc58029;this[_0x1486f4(0x1f4)]=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*$/,this[_0x1486f4(0x2c7)]=/^(0|[1-9][0-9]*)$/,this[_0x1486f4(0x219)]=/'([^\\\\']|\\\\')*'/,this[_0x1486f4(0x265)]=_0x372a2f['undefined'],this['_HTMLAllCollection']=_0x372a2f['HTMLAllCollection'],this[_0x1486f4(0x2b6)]=Object[_0x1486f4(0x23e)],this[_0x1486f4(0x247)]=Object[_0x1486f4(0x21e)],this[_0x1486f4(0x2c3)]=_0x372a2f[_0x1486f4(0x29a)],this[_0x1486f4(0x2a9)]=RegExp['prototype'][_0x1486f4(0x2cc)],this['_dateToString']=Date[_0x1486f4(0x2b5)][_0x1486f4(0x2cc)];}[_0xc58029(0x254)](_0x362a6f,_0x453b72,_0x400020,_0x30f41e){var _0x753c00=_0xc58029,_0x59ed99=this,_0x4bd0ee=_0x400020[_0x753c00(0x23a)];function _0x1c5131(_0x1feadb,_0x816b47,_0x328ae6){var _0xc22720=_0x753c00;_0x816b47[_0xc22720(0x1fb)]=_0xc22720(0x20d),_0x816b47['error']=_0x1feadb[_0xc22720(0x27f)],_0x205dff=_0x328ae6[_0xc22720(0x28d)]['current'],_0x328ae6['node'][_0xc22720(0x1f9)]=_0x816b47,_0x59ed99[_0xc22720(0x20a)](_0x816b47,_0x328ae6);}if(_0x453b72&&_0x453b72[_0x753c00(0x26a)])_0x1c5131(_0x453b72,_0x362a6f,_0x400020);else try{_0x400020[_0x753c00(0x1f3)]++,_0x400020['autoExpand']&&_0x400020[_0x753c00(0x252)]['push'](_0x453b72);var _0x5ec9cd,_0x2f2630,_0xf9e191,_0x504866,_0x3b5c32=[],_0xe32ee5=[],_0x1989ba,_0x4b275b=this[_0x753c00(0x236)](_0x453b72),_0x2d738f=_0x4b275b==='array',_0x376c08=!0x1,_0x2fd23d=_0x4b275b===_0x753c00(0x1f0),_0x3596e7=this[_0x753c00(0x225)](_0x4b275b),_0x1cca89=this[_0x753c00(0x220)](_0x4b275b),_0x3ee0ab=_0x3596e7||_0x1cca89,_0x120ba9={},_0x2fc20c=0x0,_0x1d3f35=!0x1,_0x205dff,_0x352b65=/^(([1-9]{1}[0-9]*)|0)$/;if(_0x400020[_0x753c00(0x27c)]){if(_0x2d738f){if(_0x2f2630=_0x453b72[_0x753c00(0x22d)],_0x2f2630>_0x400020['elements']){for(_0xf9e191=0x0,_0x504866=_0x400020[_0x753c00(0x2da)],_0x5ec9cd=_0xf9e191;_0x5ec9cd<_0x504866;_0x5ec9cd++)_0xe32ee5['push'](_0x59ed99['_addProperty'](_0x3b5c32,_0x453b72,_0x4b275b,_0x5ec9cd,_0x400020));_0x362a6f[_0x753c00(0x258)]=!0x0;}else{for(_0xf9e191=0x0,_0x504866=_0x2f2630,_0x5ec9cd=_0xf9e191;_0x5ec9cd<_0x504866;_0x5ec9cd++)_0xe32ee5[_0x753c00(0x279)](_0x59ed99[_0x753c00(0x2ad)](_0x3b5c32,_0x453b72,_0x4b275b,_0x5ec9cd,_0x400020));}_0x400020[_0x753c00(0x226)]+=_0xe32ee5['length'];}if(!(_0x4b275b===_0x753c00(0x294)||_0x4b275b==='undefined')&&!_0x3596e7&&_0x4b275b!==_0x753c00(0x2ae)&&_0x4b275b!==_0x753c00(0x218)&&_0x4b275b!==_0x753c00(0x2a2)){var _0x339a81=_0x30f41e[_0x753c00(0x2d7)]||_0x400020[_0x753c00(0x2d7)];if(this[_0x753c00(0x248)](_0x453b72)?(_0x5ec9cd=0x0,_0x453b72[_0x753c00(0x20c)](function(_0x363a14){var _0x3faea7=_0x753c00;if(_0x2fc20c++,_0x400020['autoExpandPropertyCount']++,_0x2fc20c>_0x339a81){_0x1d3f35=!0x0;return;}if(!_0x400020['isExpressionToEvaluate']&&_0x400020[_0x3faea7(0x23a)]&&_0x400020[_0x3faea7(0x226)]>_0x400020[_0x3faea7(0x2aa)]){_0x1d3f35=!0x0;return;}_0xe32ee5[_0x3faea7(0x279)](_0x59ed99['_addProperty'](_0x3b5c32,_0x453b72,_0x3faea7(0x2ac),_0x5ec9cd++,_0x400020,function(_0x354f89){return function(){return _0x354f89;};}(_0x363a14)));})):this[_0x753c00(0x271)](_0x453b72)&&_0x453b72['forEach'](function(_0x2bdad5,_0x500da9){var _0x591456=_0x753c00;if(_0x2fc20c++,_0x400020[_0x591456(0x226)]++,_0x2fc20c>_0x339a81){_0x1d3f35=!0x0;return;}if(!_0x400020[_0x591456(0x280)]&&_0x400020[_0x591456(0x23a)]&&_0x400020[_0x591456(0x226)]>_0x400020['autoExpandLimit']){_0x1d3f35=!0x0;return;}var _0x336d28=_0x500da9['toString']();_0x336d28[_0x591456(0x22d)]>0x64&&(_0x336d28=_0x336d28[_0x591456(0x232)](0x0,0x64)+_0x591456(0x21a)),_0xe32ee5['push'](_0x59ed99[_0x591456(0x2ad)](_0x3b5c32,_0x453b72,_0x591456(0x241),_0x336d28,_0x400020,function(_0x1a23c6){return function(){return _0x1a23c6;};}(_0x2bdad5)));}),!_0x376c08){try{for(_0x1989ba in _0x453b72)if(!(_0x2d738f&&_0x352b65['test'](_0x1989ba))&&!this['_blacklistedProperty'](_0x453b72,_0x1989ba,_0x400020)){if(_0x2fc20c++,_0x400020[_0x753c00(0x226)]++,_0x2fc20c>_0x339a81){_0x1d3f35=!0x0;break;}if(!_0x400020[_0x753c00(0x280)]&&_0x400020[_0x753c00(0x23a)]&&_0x400020[_0x753c00(0x226)]>_0x400020[_0x753c00(0x2aa)]){_0x1d3f35=!0x0;break;}_0xe32ee5[_0x753c00(0x279)](_0x59ed99[_0x753c00(0x270)](_0x3b5c32,_0x120ba9,_0x453b72,_0x4b275b,_0x1989ba,_0x400020));}}catch{}if(_0x120ba9[_0x753c00(0x216)]=!0x0,_0x2fd23d&&(_0x120ba9[_0x753c00(0x282)]=!0x0),!_0x1d3f35){var _0x2fd771=[][_0x753c00(0x2d6)](this[_0x753c00(0x247)](_0x453b72))[_0x753c00(0x2d6)](this[_0x753c00(0x2c5)](_0x453b72));for(_0x5ec9cd=0x0,_0x2f2630=_0x2fd771[_0x753c00(0x22d)];_0x5ec9cd<_0x2f2630;_0x5ec9cd++)if(_0x1989ba=_0x2fd771[_0x5ec9cd],!(_0x2d738f&&_0x352b65[_0x753c00(0x288)](_0x1989ba[_0x753c00(0x2cc)]()))&&!this['_blacklistedProperty'](_0x453b72,_0x1989ba,_0x400020)&&!_0x120ba9[_0x753c00(0x2c2)+_0x1989ba[_0x753c00(0x2cc)]()]){if(_0x2fc20c++,_0x400020[_0x753c00(0x226)]++,_0x2fc20c>_0x339a81){_0x1d3f35=!0x0;break;}if(!_0x400020[_0x753c00(0x280)]&&_0x400020[_0x753c00(0x23a)]&&_0x400020[_0x753c00(0x226)]>_0x400020['autoExpandLimit']){_0x1d3f35=!0x0;break;}_0xe32ee5[_0x753c00(0x279)](_0x59ed99[_0x753c00(0x270)](_0x3b5c32,_0x120ba9,_0x453b72,_0x4b275b,_0x1989ba,_0x400020));}}}}}if(_0x362a6f['type']=_0x4b275b,_0x3ee0ab?(_0x362a6f[_0x753c00(0x253)]=_0x453b72[_0x753c00(0x1f1)](),this[_0x753c00(0x244)](_0x4b275b,_0x362a6f,_0x400020,_0x30f41e)):_0x4b275b===_0x753c00(0x1fe)?_0x362a6f[_0x753c00(0x253)]=this[_0x753c00(0x210)][_0x753c00(0x22e)](_0x453b72):_0x4b275b===_0x753c00(0x2a2)?_0x362a6f['value']=_0x453b72['toString']():_0x4b275b===_0x753c00(0x20f)?_0x362a6f[_0x753c00(0x253)]=this['_regExpToString'][_0x753c00(0x22e)](_0x453b72):_0x4b275b===_0x753c00(0x22b)&&this[_0x753c00(0x2c3)]?_0x362a6f[_0x753c00(0x253)]=this[_0x753c00(0x2c3)][_0x753c00(0x2b5)][_0x753c00(0x2cc)][_0x753c00(0x22e)](_0x453b72):!_0x400020['depth']&&!(_0x4b275b===_0x753c00(0x294)||_0x4b275b===_0x753c00(0x1ef))&&(delete _0x362a6f['value'],_0x362a6f[_0x753c00(0x2d1)]=!0x0),_0x1d3f35&&(_0x362a6f[_0x753c00(0x2d9)]=!0x0),_0x205dff=_0x400020[_0x753c00(0x28d)][_0x753c00(0x1f9)],_0x400020[_0x753c00(0x28d)][_0x753c00(0x1f9)]=_0x362a6f,this[_0x753c00(0x20a)](_0x362a6f,_0x400020),_0xe32ee5[_0x753c00(0x22d)]){for(_0x5ec9cd=0x0,_0x2f2630=_0xe32ee5[_0x753c00(0x22d)];_0x5ec9cd<_0x2f2630;_0x5ec9cd++)_0xe32ee5[_0x5ec9cd](_0x5ec9cd);}_0x3b5c32[_0x753c00(0x22d)]&&(_0x362a6f['props']=_0x3b5c32);}catch(_0x1ea2b3){_0x1c5131(_0x1ea2b3,_0x362a6f,_0x400020);}return this[_0x753c00(0x234)](_0x453b72,_0x362a6f),this[_0x753c00(0x27e)](_0x362a6f,_0x400020),_0x400020[_0x753c00(0x28d)][_0x753c00(0x1f9)]=_0x205dff,_0x400020[_0x753c00(0x1f3)]--,_0x400020['autoExpand']=_0x4bd0ee,_0x400020[_0x753c00(0x23a)]&&_0x400020['autoExpandPreviousObjects'][_0x753c00(0x263)](),_0x362a6f;}[_0xc58029(0x2c5)](_0x2f9708){var _0x5e537c=_0xc58029;return Object[_0x5e537c(0x25a)]?Object[_0x5e537c(0x25a)](_0x2f9708):[];}[_0xc58029(0x248)](_0x4b5e55){var _0x25a41d=_0xc58029;return!!(_0x4b5e55&&_0x372a2f[_0x25a41d(0x2ac)]&&this[_0x25a41d(0x268)](_0x4b5e55)===_0x25a41d(0x2a8)&&_0x4b5e55[_0x25a41d(0x20c)]);}[_0xc58029(0x239)](_0x2125e1,_0x334c7d,_0x244e6e){var _0x522912=_0xc58029;return _0x244e6e[_0x522912(0x2c9)]?typeof _0x2125e1[_0x334c7d]==_0x522912(0x1f0):!0x1;}[_0xc58029(0x236)](_0x3768d5){var _0x2118c9=_0xc58029,_0x4dd151='';return _0x4dd151=typeof _0x3768d5,_0x4dd151===_0x2118c9(0x2c0)?this[_0x2118c9(0x268)](_0x3768d5)==='[object\\x20Array]'?_0x4dd151=_0x2118c9(0x25d):this[_0x2118c9(0x268)](_0x3768d5)===_0x2118c9(0x204)?_0x4dd151=_0x2118c9(0x1fe):this[_0x2118c9(0x268)](_0x3768d5)===_0x2118c9(0x205)?_0x4dd151='bigint':_0x3768d5===null?_0x4dd151=_0x2118c9(0x294):_0x3768d5[_0x2118c9(0x298)]&&(_0x4dd151=_0x3768d5[_0x2118c9(0x298)][_0x2118c9(0x1fd)]||_0x4dd151):_0x4dd151==='undefined'&&this[_0x2118c9(0x249)]&&_0x3768d5 instanceof this[_0x2118c9(0x249)]&&(_0x4dd151=_0x2118c9(0x278)),_0x4dd151;}[_0xc58029(0x268)](_0x4ace5d){var _0x5c96d7=_0xc58029;return Object[_0x5c96d7(0x2b5)][_0x5c96d7(0x2cc)][_0x5c96d7(0x22e)](_0x4ace5d);}[_0xc58029(0x225)](_0x4c6acb){var _0x1fbcc8=_0xc58029;return _0x4c6acb===_0x1fbcc8(0x2ca)||_0x4c6acb===_0x1fbcc8(0x2c8)||_0x4c6acb===_0x1fbcc8(0x24e);}['_isPrimitiveWrapperType'](_0x37dd65){var _0x1fe9f3=_0xc58029;return _0x37dd65===_0x1fe9f3(0x22a)||_0x37dd65===_0x1fe9f3(0x2ae)||_0x37dd65===_0x1fe9f3(0x207);}[_0xc58029(0x2ad)](_0x151846,_0x128875,_0x3ce0fb,_0x499774,_0x24c725,_0x2b4204){var _0x1a6828=this;return function(_0x4ce70c){var _0x49dae5=_0x1ad9,_0x5f44ee=_0x24c725[_0x49dae5(0x28d)][_0x49dae5(0x1f9)],_0x59d2a4=_0x24c725[_0x49dae5(0x28d)][_0x49dae5(0x2af)],_0x4d5999=_0x24c725[_0x49dae5(0x28d)]['parent'];_0x24c725[_0x49dae5(0x28d)]['parent']=_0x5f44ee,_0x24c725['node'][_0x49dae5(0x2af)]=typeof _0x499774==_0x49dae5(0x24e)?_0x499774:_0x4ce70c,_0x151846[_0x49dae5(0x279)](_0x1a6828[_0x49dae5(0x1ff)](_0x128875,_0x3ce0fb,_0x499774,_0x24c725,_0x2b4204)),_0x24c725[_0x49dae5(0x28d)][_0x49dae5(0x221)]=_0x4d5999,_0x24c725[_0x49dae5(0x28d)][_0x49dae5(0x2af)]=_0x59d2a4;};}['_addObjectProperty'](_0x5cf2be,_0x2d264d,_0xc3b5e1,_0x5ea3ab,_0x5b0b8a,_0x56f6de,_0xcf1a14){var _0x2e4469=_0xc58029,_0x835d73=this;return _0x2d264d[_0x2e4469(0x2c2)+_0x5b0b8a[_0x2e4469(0x2cc)]()]=!0x0,function(_0x105e87){var _0xc83f2c=_0x2e4469,_0x2188ef=_0x56f6de[_0xc83f2c(0x28d)][_0xc83f2c(0x1f9)],_0xc99380=_0x56f6de['node'][_0xc83f2c(0x2af)],_0xcd46e8=_0x56f6de[_0xc83f2c(0x28d)][_0xc83f2c(0x221)];_0x56f6de[_0xc83f2c(0x28d)][_0xc83f2c(0x221)]=_0x2188ef,_0x56f6de[_0xc83f2c(0x28d)][_0xc83f2c(0x2af)]=_0x105e87,_0x5cf2be[_0xc83f2c(0x279)](_0x835d73['_property'](_0xc3b5e1,_0x5ea3ab,_0x5b0b8a,_0x56f6de,_0xcf1a14)),_0x56f6de[_0xc83f2c(0x28d)][_0xc83f2c(0x221)]=_0xcd46e8,_0x56f6de[_0xc83f2c(0x28d)]['index']=_0xc99380;};}[_0xc58029(0x1ff)](_0x238b41,_0x4ccebe,_0x41aac8,_0x5a70c0,_0x3dfb82){var _0x2775fa=_0xc58029,_0x25c284=this;_0x3dfb82||(_0x3dfb82=function(_0x56979f,_0x16166f){return _0x56979f[_0x16166f];});var _0x3e70d5=_0x41aac8[_0x2775fa(0x2cc)](),_0x38e6ac=_0x5a70c0['expressionsToEvaluate']||{},_0x106715=_0x5a70c0[_0x2775fa(0x27c)],_0x1442bb=_0x5a70c0['isExpressionToEvaluate'];try{var _0x87f529=this[_0x2775fa(0x271)](_0x238b41),_0x51796d=_0x3e70d5;_0x87f529&&_0x51796d[0x0]==='\\x27'&&(_0x51796d=_0x51796d[_0x2775fa(0x261)](0x1,_0x51796d[_0x2775fa(0x22d)]-0x2));var _0x50b8fa=_0x5a70c0[_0x2775fa(0x299)]=_0x38e6ac[_0x2775fa(0x2c2)+_0x51796d];_0x50b8fa&&(_0x5a70c0[_0x2775fa(0x27c)]=_0x5a70c0[_0x2775fa(0x27c)]+0x1),_0x5a70c0[_0x2775fa(0x280)]=!!_0x50b8fa;var _0x5711d0=typeof _0x41aac8==_0x2775fa(0x22b),_0xd04337={'name':_0x5711d0||_0x87f529?_0x3e70d5:this['_propertyName'](_0x3e70d5)};if(_0x5711d0&&(_0xd04337[_0x2775fa(0x22b)]=!0x0),!(_0x4ccebe===_0x2775fa(0x25d)||_0x4ccebe===_0x2775fa(0x260))){var _0x4f64dd=this['_getOwnPropertyDescriptor'](_0x238b41,_0x41aac8);if(_0x4f64dd&&(_0x4f64dd[_0x2775fa(0x212)]&&(_0xd04337[_0x2775fa(0x2c6)]=!0x0),_0x4f64dd['get']&&!_0x50b8fa&&!_0x5a70c0[_0x2775fa(0x2cb)]))return _0xd04337[_0x2775fa(0x283)]=!0x0,this[_0x2775fa(0x28b)](_0xd04337,_0x5a70c0),_0xd04337;}var _0x2fd050;try{_0x2fd050=_0x3dfb82(_0x238b41,_0x41aac8);}catch(_0x16b3f2){return _0xd04337={'name':_0x3e70d5,'type':_0x2775fa(0x20d),'error':_0x16b3f2['message']},this['_processTreeNodeResult'](_0xd04337,_0x5a70c0),_0xd04337;}var _0x466c5b=this['_type'](_0x2fd050),_0x2fa9a7=this[_0x2775fa(0x225)](_0x466c5b);if(_0xd04337[_0x2775fa(0x1fb)]=_0x466c5b,_0x2fa9a7)this[_0x2775fa(0x28b)](_0xd04337,_0x5a70c0,_0x2fd050,function(){var _0x3a4081=_0x2775fa;_0xd04337[_0x3a4081(0x253)]=_0x2fd050['valueOf'](),!_0x50b8fa&&_0x25c284[_0x3a4081(0x244)](_0x466c5b,_0xd04337,_0x5a70c0,{});});else{var _0x464fe7=_0x5a70c0[_0x2775fa(0x23a)]&&_0x5a70c0[_0x2775fa(0x1f3)]<_0x5a70c0[_0x2775fa(0x214)]&&_0x5a70c0[_0x2775fa(0x252)][_0x2775fa(0x275)](_0x2fd050)<0x0&&_0x466c5b!=='function'&&_0x5a70c0['autoExpandPropertyCount']<_0x5a70c0['autoExpandLimit'];_0x464fe7||_0x5a70c0['level']<_0x106715||_0x50b8fa?(this[_0x2775fa(0x254)](_0xd04337,_0x2fd050,_0x5a70c0,_0x50b8fa||{}),this[_0x2775fa(0x234)](_0x2fd050,_0xd04337)):this[_0x2775fa(0x28b)](_0xd04337,_0x5a70c0,_0x2fd050,function(){var _0x2ccc15=_0x2775fa;_0x466c5b===_0x2ccc15(0x294)||_0x466c5b===_0x2ccc15(0x1ef)||(delete _0xd04337['value'],_0xd04337[_0x2ccc15(0x2d1)]=!0x0);});}return _0xd04337;}finally{_0x5a70c0[_0x2775fa(0x299)]=_0x38e6ac,_0x5a70c0[_0x2775fa(0x27c)]=_0x106715,_0x5a70c0[_0x2775fa(0x280)]=_0x1442bb;}}[_0xc58029(0x244)](_0x42ac20,_0x246c78,_0x1894bd,_0x528869){var _0x5d40f2=_0xc58029,_0x3ba7e0=_0x528869['strLength']||_0x1894bd[_0x5d40f2(0x273)];if((_0x42ac20==='string'||_0x42ac20===_0x5d40f2(0x2ae))&&_0x246c78[_0x5d40f2(0x253)]){let _0x1422f7=_0x246c78[_0x5d40f2(0x253)]['length'];_0x1894bd[_0x5d40f2(0x1f8)]+=_0x1422f7,_0x1894bd['allStrLength']>_0x1894bd[_0x5d40f2(0x2c1)]?(_0x246c78['capped']='',delete _0x246c78[_0x5d40f2(0x253)]):_0x1422f7>_0x3ba7e0&&(_0x246c78[_0x5d40f2(0x2d1)]=_0x246c78[_0x5d40f2(0x253)][_0x5d40f2(0x261)](0x0,_0x3ba7e0),delete _0x246c78['value']);}}[_0xc58029(0x271)](_0x1d197a){var _0x516613=_0xc58029;return!!(_0x1d197a&&_0x372a2f[_0x516613(0x241)]&&this[_0x516613(0x268)](_0x1d197a)===_0x516613(0x285)&&_0x1d197a[_0x516613(0x20c)]);}[_0xc58029(0x201)](_0x1f4af8){var _0x329593=_0xc58029;if(_0x1f4af8['match'](/^\\d+$/))return _0x1f4af8;var _0xe3b70a;try{_0xe3b70a=JSON[_0x329593(0x266)](''+_0x1f4af8);}catch{_0xe3b70a='\\x22'+this[_0x329593(0x268)](_0x1f4af8)+'\\x22';}return _0xe3b70a[_0x329593(0x257)](/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)?_0xe3b70a=_0xe3b70a[_0x329593(0x261)](0x1,_0xe3b70a[_0x329593(0x22d)]-0x2):_0xe3b70a=_0xe3b70a['replace'](/'/g,'\\x5c\\x27')[_0x329593(0x27b)](/\\\\\"/g,'\\x22')[_0x329593(0x27b)](/(^\"|\"$)/g,'\\x27'),_0xe3b70a;}[_0xc58029(0x28b)](_0x4956fe,_0x1a3226,_0xa21d78,_0x15453a){var _0x36d7b0=_0xc58029;this['_treeNodePropertiesBeforeFullValue'](_0x4956fe,_0x1a3226),_0x15453a&&_0x15453a(),this[_0x36d7b0(0x234)](_0xa21d78,_0x4956fe),this[_0x36d7b0(0x27e)](_0x4956fe,_0x1a3226);}[_0xc58029(0x20a)](_0x481b11,_0x51f8c9){var _0x75b509=_0xc58029;this[_0x75b509(0x20e)](_0x481b11,_0x51f8c9),this[_0x75b509(0x267)](_0x481b11,_0x51f8c9),this[_0x75b509(0x1f6)](_0x481b11,_0x51f8c9),this[_0x75b509(0x250)](_0x481b11,_0x51f8c9);}[_0xc58029(0x20e)](_0x10e3e6,_0x522b37){}[_0xc58029(0x267)](_0x36f07c,_0xb037ef){}[_0xc58029(0x264)](_0x14b0d4,_0xd682f2){}['_isUndefined'](_0x151d1c){return _0x151d1c===this['_undefined'];}[_0xc58029(0x27e)](_0x23ae17,_0x3ef0b3){var _0x45f5c9=_0xc58029;this[_0x45f5c9(0x264)](_0x23ae17,_0x3ef0b3),this['_setNodeExpandableState'](_0x23ae17),_0x3ef0b3[_0x45f5c9(0x2bd)]&&this[_0x45f5c9(0x286)](_0x23ae17),this[_0x45f5c9(0x293)](_0x23ae17,_0x3ef0b3),this[_0x45f5c9(0x287)](_0x23ae17,_0x3ef0b3),this[_0x45f5c9(0x25e)](_0x23ae17);}[_0xc58029(0x234)](_0x2031c1,_0x3a4e4d){var _0x190e26=_0xc58029;try{_0x2031c1&&typeof _0x2031c1[_0x190e26(0x22d)]==_0x190e26(0x24e)&&(_0x3a4e4d[_0x190e26(0x22d)]=_0x2031c1[_0x190e26(0x22d)]);}catch{}if(_0x3a4e4d['type']==='number'||_0x3a4e4d[_0x190e26(0x1fb)]===_0x190e26(0x207)){if(isNaN(_0x3a4e4d[_0x190e26(0x253)]))_0x3a4e4d['nan']=!0x0,delete _0x3a4e4d[_0x190e26(0x253)];else switch(_0x3a4e4d['value']){case Number[_0x190e26(0x2d2)]:_0x3a4e4d[_0x190e26(0x25b)]=!0x0,delete _0x3a4e4d[_0x190e26(0x253)];break;case Number[_0x190e26(0x2b9)]:_0x3a4e4d[_0x190e26(0x230)]=!0x0,delete _0x3a4e4d['value'];break;case 0x0:this[_0x190e26(0x2cf)](_0x3a4e4d[_0x190e26(0x253)])&&(_0x3a4e4d[_0x190e26(0x26d)]=!0x0);break;}}else _0x3a4e4d['type']===_0x190e26(0x1f0)&&typeof _0x2031c1[_0x190e26(0x1fd)]==_0x190e26(0x2c8)&&_0x2031c1['name']&&_0x3a4e4d['name']&&_0x2031c1[_0x190e26(0x1fd)]!==_0x3a4e4d[_0x190e26(0x1fd)]&&(_0x3a4e4d[_0x190e26(0x29c)]=_0x2031c1[_0x190e26(0x1fd)]);}[_0xc58029(0x2cf)](_0x1bf00b){var _0x2ce1b7=_0xc58029;return 0x1/_0x1bf00b===Number[_0x2ce1b7(0x2b9)];}[_0xc58029(0x286)](_0x36e25f){var _0x595d85=_0xc58029;!_0x36e25f['props']||!_0x36e25f[_0x595d85(0x2d7)][_0x595d85(0x22d)]||_0x36e25f[_0x595d85(0x1fb)]===_0x595d85(0x25d)||_0x36e25f['type']===_0x595d85(0x241)||_0x36e25f[_0x595d85(0x1fb)]===_0x595d85(0x2ac)||_0x36e25f[_0x595d85(0x2d7)][_0x595d85(0x211)](function(_0x2eea19,_0x24e5e2){var _0x4eafc1=_0x595d85,_0x2fbd21=_0x2eea19[_0x4eafc1(0x1fd)][_0x4eafc1(0x227)](),_0x19e5b5=_0x24e5e2[_0x4eafc1(0x1fd)]['toLowerCase']();return _0x2fbd21<_0x19e5b5?-0x1:_0x2fbd21>_0x19e5b5?0x1:0x0;});}[_0xc58029(0x293)](_0x56540c,_0x5975e8){var _0x4a3a8f=_0xc58029;if(!(_0x5975e8[_0x4a3a8f(0x2c9)]||!_0x56540c['props']||!_0x56540c[_0x4a3a8f(0x2d7)][_0x4a3a8f(0x22d)])){for(var _0x5eec4b=[],_0x4c5b42=[],_0x32e65d=0x0,_0x4579e1=_0x56540c[_0x4a3a8f(0x2d7)][_0x4a3a8f(0x22d)];_0x32e65d<_0x4579e1;_0x32e65d++){var _0x19feef=_0x56540c[_0x4a3a8f(0x2d7)][_0x32e65d];_0x19feef[_0x4a3a8f(0x1fb)]===_0x4a3a8f(0x1f0)?_0x5eec4b['push'](_0x19feef):_0x4c5b42['push'](_0x19feef);}if(!(!_0x4c5b42[_0x4a3a8f(0x22d)]||_0x5eec4b[_0x4a3a8f(0x22d)]<=0x1)){_0x56540c['props']=_0x4c5b42;var _0x1af482={'functionsNode':!0x0,'props':_0x5eec4b};this[_0x4a3a8f(0x20e)](_0x1af482,_0x5975e8),this[_0x4a3a8f(0x264)](_0x1af482,_0x5975e8),this['_setNodeExpandableState'](_0x1af482),this['_setNodePermissions'](_0x1af482,_0x5975e8),_0x1af482['id']+='\\x20f',_0x56540c['props'][_0x4a3a8f(0x2a1)](_0x1af482);}}}[_0xc58029(0x287)](_0x587b26,_0x3d5e6a){}['_setNodeExpandableState'](_0x42d149){}['_isArray'](_0x28ba0f){var _0x38f891=_0xc58029;return Array[_0x38f891(0x1f2)](_0x28ba0f)||typeof _0x28ba0f=='object'&&this[_0x38f891(0x268)](_0x28ba0f)==='[object\\x20Array]';}[_0xc58029(0x250)](_0x2968b3,_0x3b3a0e){}[_0xc58029(0x25e)](_0x4ebab8){var _0x10a259=_0xc58029;delete _0x4ebab8[_0x10a259(0x235)],delete _0x4ebab8[_0x10a259(0x25c)],delete _0x4ebab8[_0x10a259(0x2bc)];}[_0xc58029(0x1f6)](_0x5e86b2,_0x282cab){}[_0xc58029(0x2d3)](_0x18954f){var _0x4e974a=_0xc58029;return _0x18954f?_0x18954f['match'](this[_0x4e974a(0x2c7)])?'['+_0x18954f+']':_0x18954f['match'](this[_0x4e974a(0x1f4)])?'.'+_0x18954f:_0x18954f[_0x4e974a(0x257)](this[_0x4e974a(0x219)])?'['+_0x18954f+']':'[\\x27'+_0x18954f+'\\x27]':'';}}let _0x56d998=new _0x1ae7d4();function _0x10cae1(_0x3d8cf1,_0x24b4e6,_0xdf8570,_0x3e180d,_0x31ee80,_0x1a8000){var _0x1e6707=_0xc58029;let _0x565354,_0x314a17;try{_0x314a17=_0x368491(),_0x565354=_0x793dfe[_0x24b4e6],!_0x565354||_0x314a17-_0x565354['ts']>0x1f4&&_0x565354[_0x1e6707(0x21b)]&&_0x565354['time']/_0x565354[_0x1e6707(0x21b)]<0x64?(_0x793dfe[_0x24b4e6]=_0x565354={'count':0x0,'time':0x0,'ts':_0x314a17},_0x793dfe[_0x1e6707(0x245)]={}):_0x314a17-_0x793dfe[_0x1e6707(0x245)]['ts']>0x32&&_0x793dfe[_0x1e6707(0x245)]['count']&&_0x793dfe[_0x1e6707(0x245)][_0x1e6707(0x224)]/_0x793dfe[_0x1e6707(0x245)][_0x1e6707(0x21b)]<0x64&&(_0x793dfe[_0x1e6707(0x245)]={});let _0x40e0aa=[],_0x155284=_0x565354[_0x1e6707(0x24c)]||_0x793dfe[_0x1e6707(0x245)][_0x1e6707(0x24c)]?_0x3e3aee:_0x1e2060,_0x4211f5=_0x3dc4b2=>{var _0x425951=_0x1e6707;let _0x217229={};return _0x217229['props']=_0x3dc4b2[_0x425951(0x2d7)],_0x217229[_0x425951(0x2da)]=_0x3dc4b2[_0x425951(0x2da)],_0x217229[_0x425951(0x273)]=_0x3dc4b2[_0x425951(0x273)],_0x217229[_0x425951(0x2c1)]=_0x3dc4b2[_0x425951(0x2c1)],_0x217229[_0x425951(0x2aa)]=_0x3dc4b2[_0x425951(0x2aa)],_0x217229[_0x425951(0x214)]=_0x3dc4b2[_0x425951(0x214)],_0x217229['sortProps']=!0x1,_0x217229['noFunctions']=!_0x5c9995,_0x217229[_0x425951(0x27c)]=0x1,_0x217229[_0x425951(0x1f3)]=0x0,_0x217229[_0x425951(0x289)]=_0x425951(0x2a0),_0x217229[_0x425951(0x213)]=_0x425951(0x222),_0x217229['autoExpand']=!0x0,_0x217229['autoExpandPreviousObjects']=[],_0x217229[_0x425951(0x226)]=0x0,_0x217229[_0x425951(0x2cb)]=!0x0,_0x217229[_0x425951(0x1f8)]=0x0,_0x217229[_0x425951(0x28d)]={'current':void 0x0,'parent':void 0x0,'index':0x0},_0x217229;};for(var _0x364558=0x0;_0x364558<_0x31ee80['length'];_0x364558++)_0x40e0aa[_0x1e6707(0x279)](_0x56d998['serialize']({'timeNode':_0x3d8cf1===_0x1e6707(0x224)||void 0x0},_0x31ee80[_0x364558],_0x4211f5(_0x155284),{}));if(_0x3d8cf1==='trace'){let _0x396e60=Error[_0x1e6707(0x2bf)];try{Error[_0x1e6707(0x2bf)]=0x1/0x0,_0x40e0aa[_0x1e6707(0x279)](_0x56d998['serialize']({'stackNode':!0x0},new Error()['stack'],_0x4211f5(_0x155284),{'strLength':0x1/0x0}));}finally{Error['stackTraceLimit']=_0x396e60;}}return{'method':_0x1e6707(0x243),'version':_0x77ff4c,'args':[{'ts':_0xdf8570,'session':_0x3e180d,'args':_0x40e0aa,'id':_0x24b4e6,'context':_0x1a8000}]};}catch(_0x2c4590){return{'method':'log','version':_0x77ff4c,'args':[{'ts':_0xdf8570,'session':_0x3e180d,'args':[{'type':_0x1e6707(0x20d),'error':_0x2c4590&&_0x2c4590['message']}],'id':_0x24b4e6,'context':_0x1a8000}]};}finally{try{if(_0x565354&&_0x314a17){let _0x53e16f=_0x368491();_0x565354[_0x1e6707(0x21b)]++,_0x565354[_0x1e6707(0x224)]+=_0x3f16bf(_0x314a17,_0x53e16f),_0x565354['ts']=_0x53e16f,_0x793dfe[_0x1e6707(0x245)]['count']++,_0x793dfe['hits'][_0x1e6707(0x224)]+=_0x3f16bf(_0x314a17,_0x53e16f),_0x793dfe[_0x1e6707(0x245)]['ts']=_0x53e16f,(_0x565354[_0x1e6707(0x21b)]>0x32||_0x565354[_0x1e6707(0x224)]>0x64)&&(_0x565354[_0x1e6707(0x24c)]=!0x0),(_0x793dfe[_0x1e6707(0x245)][_0x1e6707(0x21b)]>0x3e8||_0x793dfe['hits'][_0x1e6707(0x224)]>0x12c)&&(_0x793dfe[_0x1e6707(0x245)][_0x1e6707(0x24c)]=!0x0);}}catch{}}}return _0x372a2f[_0xc58029(0x23c)];})(globalThis,'127.0.0.1','51961',_0x5b65ae(0x238),'webpack',_0x5b65ae(0x2a4),_0x5b65ae(0x23d),[\"localhost\",\"127.0.0.1\",\"example.cypress.io\",\"csys\",\"192.168.178.20\"],_0x5b65ae(0x27d));")}catch(t){}})().consoleLog(t,e)}catch(t){}return e}const it=document.getElementById("canv"),at=document.getElementById("fps"),ct=(document.getElementById("kloppenheim_02"),document.getElementById("slice-canvas")),ot=new class{constructor(){this.grid_size=9,this.voxel_count=24,this.direct_light_phi=0,this.direct_light_theta=0,this.ao_strength=.8,this.ambient_light=.2,this.grid=new Array(this.grid_size*this.grid_size*this.grid_size),this.meta_grid=new Array(this.grid_size*this.grid_size*this.grid_size),this.boundary_min=[-this.grid_size/2,-this.grid_size/2,-this.grid_size/2],this.boundary_max=[this.grid_size/2,this.grid_size/2,this.grid_size/2],this.voxel_size=this.grid_size/this.voxel_count,this.initialize_grid(),this.direct_light=Q.normalize([1.5,.6,3]),this.direct_light_brightness=1,this.background_color=[0,0,0],this.input_direct_light=document.getElementById("sun_strength"),this.input_direct_light.addEventListener("input",(t=>{this.direct_light_brightness=parseInt(this.input_direct_light.value)/50})),this.input_direct_light_phi=document.getElementById("sun_phi"),this.input_direct_light_theta=document.getElementById("sun_theta"),this.input_direct_light_phi.addEventListener("input",(t=>{this.updateDirectLight(parseInt(this.input_direct_light_phi.value),parseInt(this.input_direct_light_theta.value))})),this.input_direct_light_theta.addEventListener("input",(t=>{this.updateDirectLight(parseInt(this.input_direct_light_phi.value),parseInt(this.input_direct_light_theta.value))})),this.input_ao_strength=document.getElementById("ao_strength"),this.input_ao_strength.addEventListener("input",(t=>{this.ao_strength=parseInt(this.input_ao_strength.value)/100})),this.input_ambient_light=document.getElementById("ambient_light"),this.input_ambient_light.addEventListener("input",(t=>{this.ambient_light=parseInt(this.input_ambient_light.value)/100}))}updateDirectLight(t,e){this.direct_light_phi=t,this.direct_light_theta=e,this.direct_light=[Math.cos(K(e))*Math.cos(K(t)),Math.sin(K(e))*Math.cos(K(t)),Math.sin(K(t))]}serialize_scene(){return JSON.stringify(this)}deserialize_scene(t){const e=JSON.parse(t);this.grid=e.grid,this.background_color=e.background_color,this.grid_size=this.grid_size,this.boundary_min=e.boundary_min,this.boundary_max=e.boundary_max,this.voxel_count=e.voxel_count,this.direct_light=e.direct_light,this.direct_light_brightness=e.direct_light_brightness,this.input_direct_light.value=(100*e.direct_light_brightness).toString(),this.ao_strength=e.ao_strength,this.input_ao_strength.value=(100*e.ao_strength).toString(),this.ambient_light=e.ambient_light,this.input_ambient_light.value=(100*e.ambient_light).toString(),this.direct_light_phi=e.direct_light_phi,this.input_direct_light_phi.value=e.direct_light_phi.toString(),this.direct_light_theta=e.direct_light_theta,this.input_direct_light_theta.value=e.direct_light_theta.toString()}initialize_grid(){this.grid=new Array(this.voxel_count**3),this.meta_grid=new Array(this.voxel_count**3);for(let t=0;t<this.voxel_count;t++)for(let e=0;e<this.voxel_count;e++)for(let r=0;r<this.voxel_count;r++){let x=new rt;x.color=[0,0,0],x.opacity=0,this.grid[r*this.voxel_count*this.voxel_count+e*this.voxel_count+t]=x;let n=new xt;this.meta_grid[r*this.voxel_count*this.voxel_count+e*this.voxel_count+t]=n}}initialize_default_grid(){for(let t=0;t<this.voxel_count;t++)for(let e=0;e<this.voxel_count;e++)for(let r=0;r<this.voxel_count;r++){let x=new rt;r<3&&(x.color=[t/this.voxel_count,e/this.voxel_count,r/this.voxel_count],Q.scale(x.color,2,x.color),x.opacity=1,x.lightness=0,x.roughness=1),x.color[0]=Math.min(1,x.color[0]),x.color[1]=Math.min(1,x.color[1]),x.color[2]=Math.min(1,x.color[2]),this.set_voxel_comp(x,t,e,r)}this.calc_gi()}calc_gi(){for(let t=0;t<this.voxel_count;t++)for(let e=0;e<this.voxel_count;e++)for(let r=0;r<this.voxel_count;r++){const x=new tt(this.get_voxel_center([t,e,r]),Q.inverse(this.direct_light));this.ray_any(x)||(this.meta_grid[this.get_voxel_id([t,e,r])].gi=Q.scale([1,1,1],this.direct_light_brightness))}}ray_any(t){let e=0,r=1/0;for(let x=0;x<3;x++){let n=(this.boundary_min[x]-t.origin[x])*t.inv_direction[x],_=(this.boundary_max[x]-t.origin[x])*t.inv_direction[x];e=Math.min(Math.max(n,e),Math.max(_,e)),r=Math.max(Math.min(n,r),Math.min(_,r))}if(e>r)return;const x=Q.add(t.origin,Q.scale(t.direction,e)),n=Q.add(t.origin,Q.scale(t.direction,r));let _=[Math.max(0,Math.min(this.voxel_count-1,Math.floor((x[0]-this.boundary_min[0])/this.voxel_size))),Math.max(0,Math.min(this.voxel_count-1,Math.floor((x[1]-this.boundary_min[1])/this.voxel_size))),Math.max(0,Math.min(this.voxel_count-1,Math.floor((x[2]-this.boundary_min[2])/this.voxel_size)))],i=[_[0]+1,_[1]+1,_[2]+1],a=[0,0,0],c=[0,0,0],o=[0,0,0],s=[0,0,0],l=e,d=[0,0,0];for(let l=0;l<3;l++)s[l]=Math.max(0,Math.min(this.voxel_count-1,Math.floor((n[l]-this.boundary_min[l])/this.voxel_size))),t.direction[l]>0?(a[l]=1,o[l]=this.voxel_size/t.direction[l],c[l]=e+(this.boundary_min[l]+i[l]*this.voxel_size-x[l])/t.direction[l]):t.direction[l]<0?(a[l]=-1,o[l]=this.voxel_size/-t.direction[l],c[l]=e+(this.boundary_min[l]+_[l]*this.voxel_size-x[l])/t.direction[l]):(a[l]=0,o[l]=r,c[l]=r);for(;_[0]<this.voxel_count&&_[0]>=0&&_[1]<this.voxel_count&&_[1]>=0&&_[2]<this.voxel_count&&_[2]>=0;){if(this.get_voxel(_).opacity>.01){const e=Q.add(t.origin,Q.scale(t.direction,l));return new et(e,_,this.get_voxel(_),d)}c[0]<c[1]&&c[0]<c[2]?(_[0]+=a[0],l=c[0],c[0]+=o[0],d=[-a[0],0,0]):c[1]<c[2]?(_[1]+=a[1],l=c[1],c[1]+=o[1],d=[0,-a[1],0]):(_[2]+=a[2],l=c[2],c[2]+=o[2],d=[0,0,-a[2]])}}get_voxel_center(t){return[t[0]*this.voxel_size-this.boundary_min[0],t[1]*this.voxel_size-this.boundary_min[1],t[2]*this.voxel_size-this.boundary_min[2]]}get_voxel_id_comp(t,e,r){return r*this.voxel_count*this.voxel_count+e*this.voxel_count+t}get_voxel_id(t){return t[2]*this.voxel_count*this.voxel_count+t[1]*this.voxel_count+t[0]}get_voxel_comp(t,e,r){return this.grid[r*this.voxel_count*this.voxel_count+e*this.voxel_count+t]}get_voxel(t){return this.grid[t[2]*this.voxel_count*this.voxel_count+t[1]*this.voxel_count+t[0]]}set_voxel(t,e){e[0]>0&&e[0]<this.voxel_count-1&&e[1]>0&&e[1]<this.voxel_count-1&&e[2]>0&&e[2]<this.voxel_count-1&&(this.grid[e[2]*this.voxel_count*this.voxel_count+e[1]*this.voxel_count+e[0]]=t)}set_voxel_comp(t,e,r,x){e>0&&e<this.voxel_count-1&&r>0&&r<this.voxel_count-1&&x>0&&x<this.voxel_count-1&&(this.grid[x*this.voxel_count*this.voxel_count+r*this.voxel_count+e]=t)}};let st=new class{constructor(t,e,r,x,n){this.mouse_down=!1,this.mouse_dragged=!1,this.over_canvas=!1,this.last_move=0,this.velocity=[0,0],this.selected_color=[0,0,0],this.selected_roughness=1,this.selected_opacity=1,this.selected_lightness=0,this.multidraw=!1,this.last_drawn=[0,0,0],this.camera=new nt(r,x,n),this.last_move=performance.now(),this.last_movement=[0,0],this.scene=t,this.canvas=e,this.selected_tool="place",this.blub_high=document.getElementById("blub_high"),this.blub_low=document.getElementById("blub_low"),this.setup()}tick(t){this.camera.tick(t)}setup(){var t,e,r,x,n,_,i;this.canvas.addEventListener("mouseover",(t=>{this.over_canvas=!0})),this.canvas.addEventListener("mouseout",(t=>{this.over_canvas=!1})),addEventListener("mousedown",(t=>{this.over_canvas&&0==t.button&&(t.shiftKey&&(this.multidraw=!0),this.mouse_down=!0,this.mouse_dragged=!1,this.camera.dragged=!0,this.last_move=performance.now())})),addEventListener("mouseup",(t=>{if(0==t.button&&(this.mouse_down&&(this.camera.velocity=[...this.velocity]),this.mouse_down=!1,this.camera.dragged=!1,this.multidraw=!1,!this.mouse_dragged)){const e=this.canvas.getBoundingClientRect(),r=t.clientX-e.left,x=t.clientY-e.top;let n=this.scene.ray_any(this.camera.screen_to_ray(r,x,e.width,e.height));if(n)switch(this.selected_tool){case"place":let t=new rt;t.color=this.selected_color,t.roughness=this.selected_roughness,t.lightness=this.selected_lightness,t.opacity=this.selected_opacity;let e=n.voxel_position.map(((t,e)=>t+n.normal[e]));this.scene.set_voxel(t,e),this.blub_high.play(),this.last_drawn=e;break;case"replace":let r=new rt;r.color=this.selected_color,r.roughness=this.selected_roughness,r.lightness=this.selected_lightness,r.opacity=this.selected_opacity,this.scene.set_voxel(r,n.voxel_position),this.blub_high.play(),this.last_drawn=n.voxel_position;break;case"remove":let x=new rt;x.opacity=0,this.scene.set_voxel(x,n.voxel_position),this.blub_low.play()}}})),addEventListener("mousemove",(t=>{if(this.last_movement=E.scale([t.movementX,t.movementY],.2),this.mouse_down&&(this.mouse_drag(t),this.multidraw)){const e=this.canvas.getBoundingClientRect(),r=t.clientX-e.left,x=t.clientY-e.top;let n=this.scene.ray_any(this.camera.screen_to_ray(r,x,e.width,e.height));if(n&&n.voxel_position.toString()!==this.last_drawn.toString()){if("place"==this.selected_tool){let t=new rt;t.color=this.selected_color,t.roughness=this.selected_roughness,t.lightness=this.selected_lightness,t.opacity=this.selected_opacity;let e=n.voxel_position.map(((t,e)=>t+n.normal[e]));this.scene.set_voxel(t,e),this.blub_high.play(),this.last_drawn=e}if("replace"==this.selected_tool){let t=new rt;t.color=this.selected_color,t.roughness=this.selected_roughness,t.lightness=this.selected_lightness,t.opacity=this.selected_opacity,this.scene.set_voxel(t,n.voxel_position),this.blub_high.play(),this.last_drawn=n.voxel_position}if("remove"==this.selected_tool){let t=new rt;t.opacity=0,this.scene.set_voxel(t,n.voxel_position),this.blub_low.play();let _=this.scene.ray_any(this.camera.screen_to_ray(r,x,e.width,e.height));_&&(this.last_drawn=_.voxel_position)}}}this.calculate_velocity(),this.last_move=performance.now()})),null===(t=document.getElementById("color_value"))||void 0===t||t.addEventListener("input",(t=>{var e;const r=t.target.value;this.selected_color=Q.scale(null===(e=r.match(/\w\w/g))||void 0===e?void 0:e.map((t=>parseInt(t,16))),1/255)})),null===(e=document.getElementById("roughness_value"))||void 0===e||e.addEventListener("input",(t=>{this.selected_roughness=1-parseInt(t.target.value)/100})),null===(r=document.getElementById("lightness_value"))||void 0===r||r.addEventListener("input",(t=>{this.selected_lightness=parseInt(t.target.value)/25})),null===(x=document.getElementById("opacity_value"))||void 0===x||x.addEventListener("input",(t=>{this.selected_opacity=parseInt(t.target.value)/100})),null===(n=document.getElementById("tool-place-button"))||void 0===n||n.addEventListener("change",(t=>{this.selected_tool="place"})),null===(_=document.getElementById("tool-replace-button"))||void 0===_||_.addEventListener("change",(t=>{this.selected_tool="replace"})),null===(i=document.getElementById("tool-remove-button"))||void 0===i||i.addEventListener("change",(t=>{this.selected_tool="remove"}))}calculate_velocity(){const t=performance.now()-this.last_move;E.scale(this.last_movement,1/t,this.velocity)}mouse_drag(t){this.multidraw||(this.camera.eulers[1]=this.camera.eulers[1]-this.last_movement[1],this.camera.eulers[2]=this.camera.eulers[2]-this.last_movement[0],this.mouse_dragged=!0)}}(ot,it,12,0,0),lt=new class{constructor(t,e,r){this.initialized=!1,this.render=()=>{var t,e,r,x,n,_,i;if(!this.initialized)return;let a=[];for(let t=0;t<this.scene.voxel_count;t++)for(let e=0;e<this.scene.voxel_count;e++)for(let r=0;r<this.scene.voxel_count;r++)this.scene.get_voxel([t,e,r]).lightness>0&&a.push([t,e,r]);null===(t=this.device)||void 0===t||t.queue.writeBuffer(this.sceneParameters,0,new Float32Array([this.camera.position[0],this.camera.position[1],this.camera.position[2],(new Date).getMilliseconds(),this.camera.forward[0],this.camera.forward[1],this.camera.forward[2],a.length,this.camera.right[0],this.camera.right[1],this.camera.right[2],this.scene.ao_strength,this.camera.up[0],this.camera.up[1],this.camera.up[2],this.scene.ambient_light,this.scene.direct_light[0],this.scene.direct_light[1],this.scene.direct_light[2],this.scene.direct_light_brightness,this.scene.background_color[0],this.scene.background_color[1],this.scene.background_color[2],0]),0,24);const c=new Float32Array(4*a.length);for(let t=0;t<a.length;++t)c[4*t]=a[t][0],c[4*t+1]=a[t][1],c[4*t+2]=a[t][2],c[4*t+3]=0;null===(e=this.device)||void 0===e||e.queue.writeBuffer(this.lightData,0,c,0,4*a.length);const o=new Float32Array(8*this.scene.grid.length);for(let t=0;t<this.scene.grid.length;++t)o[8*t]=this.scene.grid[t].color[0],o[8*t+1]=this.scene.grid[t].color[1],o[8*t+2]=this.scene.grid[t].color[2],o[8*t+3]=this.scene.grid[t].opacity,o[8*t+4]=this.scene.grid[t].roughness,o[8*t+5]=this.scene.grid[t].lightness,o[8*t+6]=0,o[8*t+7]=0;const s=new Float32Array(8*this.scene.grid.length);for(let t=0;t<this.scene.grid.length;++t)s[8*t]=this.scene.meta_grid[t].gi[0],s[8*t+1]=this.scene.meta_grid[t].gi[1],s[8*t+2]=this.scene.meta_grid[t].gi[2],s[8*t+3]=0,s[8*t+4]=0,s[8*t+5]=0,s[8*t+6]=0,s[8*t+7]=0;null===(r=this.device)||void 0===r||r.queue.writeBuffer(this.sceneData,0,o,0,8*this.scene.grid.length),null===(x=this.device)||void 0===x||x.queue.writeBuffer(this.sceneMetaData,0,s,0,8*this.scene.grid.length);const l=null===(n=this.device)||void 0===n?void 0:n.createCommandEncoder(),d=null==l?void 0:l.beginComputePass();null==d||d.setPipeline(this.ray_tracing_pipeline),null==d||d.setBindGroup(0,this.ray_tracing_bind_group),null==d||d.dispatchWorkgroups(this.canvas.width/16,this.canvas.height/16,1),null==d||d.end();const f=null===(_=this.context)||void 0===_?void 0:_.getCurrentTexture().createView(),h=null==l?void 0:l.beginRenderPass({colorAttachments:[{view:f,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}]});null==h||h.setPipeline(this.screen_pipeline),null==h||h.setBindGroup(0,this.screen_bind_group),null==h||h.draw(6,1,0,0),null==h||h.end(),null===(i=this.device)||void 0===i||i.queue.submit([null==l?void 0:l.finish()])},this.canvas=t,this.scene=e,this.pathtracing=!1,this.camera=r}initialize(t){return e(this,void 0,void 0,(function*(){this.pathtracing=t,yield this.setupDevice(),yield this.createAssets(),yield this.setupPipeline(),this.initialized=!0}))}set_hdr(t){}shutdown(){var t,e,r;this.initialized=!1,null===(t=this.device)||void 0===t||t.destroy(),null===(e=this.color_buffer)||void 0===e||e.destroy(),null===(r=this.secondary_buffer)||void 0===r||r.destroy()}setupDevice(){var t,r;return e(this,void 0,void 0,(function*(){this.adapter=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter(),this.device=yield null===(r=this.adapter)||void 0===r?void 0:r.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}))}createAssets(){var t,r,x,n,_,i,a,c,o;return e(this,void 0,void 0,(function*(){this.color_buffer=null===(t=this.device)||void 0===t?void 0:t.createTexture({size:{width:this.canvas.width,height:this.canvas.height},format:"rgba8unorm",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING}),this.secondary_buffer=null===(r=this.device)||void 0===r?void 0:r.createTexture({size:{width:this.canvas.width,height:this.canvas.height},format:"rgba8unorm",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING}),this.color_buffer_view=null===(x=this.color_buffer)||void 0===x?void 0:x.createView(),this.secondary_buffer_view=null===(n=this.secondary_buffer)||void 0===n?void 0:n.createView(),this.sampler=null===(_=this.device)||void 0===_?void 0:_.createSampler({addressModeU:"repeat",addressModeV:"repeat",magFilter:"linear",minFilter:"nearest",mipmapFilter:"nearest",maxAnisotropy:1}),this.sceneParameters=null===(i=this.device)||void 0===i?void 0:i.createBuffer({size:96,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const e=this.scene.voxel_count*this.scene.voxel_count*this.scene.voxel_count;this.sceneData=null===(a=this.device)||void 0===a?void 0:a.createBuffer({size:8*e*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.sceneMetaData=null===(c=this.device)||void 0===c?void 0:c.createBuffer({size:8*e*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.lightData=null===(o=this.device)||void 0===o?void 0:o.createBuffer({size:512,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})}))}setupPipeline(){var r,x,n,_,i,a,c,o;return e(this,void 0,void 0,(function*(){const e=null===(r=this.device)||void 0===r?void 0:r.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm",viewDimension:"2d"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:4,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm",viewDimension:"2d"}},{binding:5,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}}]});this.ray_tracing_bind_group=null===(x=this.device)||void 0===x?void 0:x.createBindGroup({layout:e,label:"Ray tracing bind group",entries:[{binding:0,resource:this.color_buffer_view},{binding:1,resource:{buffer:this.sceneParameters}},{binding:2,resource:{buffer:this.sceneData}},{binding:3,resource:{buffer:this.lightData}},{binding:4,resource:this.secondary_buffer_view},{binding:5,resource:{buffer:this.sceneMetaData}}]});const s=null===(n=this.device)||void 0===n?void 0:n.createPipelineLayout({bindGroupLayouts:[e]});this.ray_tracing_pipeline=null===(_=this.device)||void 0===_?void 0:_.createComputePipeline({label:"Ray tracing pipeline",layout:s,compute:{entryPoint:"main",module:this.device.createShaderModule({code:"@group(0) @binding(0) var color_buffer: texture_storage_2d<rgba8unorm, write>;\r\n@group(0) @binding(1) var<uniform> scene: SceneParameter;\r\n@group(0) @binding(2) var<storage, read> scene_data: SceneData;\r\n// @group(0) @binding(3) var hdr_tex: texture_2d<f32>;\r\n// @group(0) @binding(4) var hdr_sampler: sampler;\r\n@group(0) @binding(3) var<storage, read> lights: LightData;\r\n@group(0) @binding(4) var secondary_buffer: texture_storage_2d<rgba8unorm, write>;\r\n@group(0) @binding(5) var<storage, read> scene_meta_data: SceneMetaData;\r\n\r\noverride grid_size: f32 = 2f;\r\noverride voxel_count: i32 = 4;\r\nvar<private> voxel_size: f32 = grid_size / f32(voxel_count);\r\nvar<private> boundary_min: vec3<f32> = vec3<f32>(f32(-grid_size) / 2, f32(-grid_size) / 2, f32(-grid_size) / 2);\r\nvar<private> boundary_max: vec3<f32> = vec3<f32>(f32(grid_size) / 2, f32(grid_size) / 2, f32(grid_size) / 2);\r\nvar<private> depth_clip_min: f32 = 1f;\r\nvar<private> depth_clip_max: f32 = 10f;\r\n\r\nvar<private> rng_seed: u32;\r\nvar<private> rng_seed_steady: u32;\r\n\r\nconst samples: i32 = 1;\r\nconst light_bounces: i32 = 3;\r\nconst max_penetrations: i32 = 3;\r\nconst reflection_bounces: i32 = 3;\r\nconst scatter: i32 = 5;\r\n// const ambient_light: f32 = 0.03;\r\nconst pi = 3.14159265359;\r\n\r\n// const background: vec3<f32> = vec3<f32>(24f / 255f, 24f / 255f, 37f / 255f);\r\n\r\nstruct SceneParameter {\r\n    camera_pos: vec3<f32>,\r\n    rng_start: f32,\r\n    camera_forward: vec3<f32>,\r\n    light_count: f32,\r\n    camera_right: vec3<f32>,\r\n\tao_strength: f32,\r\n    camera_up: vec3<f32>,\r\n\tambient_light: f32,\r\n    direct_light: vec3<f32>,\r\n    direct_light_brightness: f32,\r\n\tbackground_color: vec3<f32>,\r\n}\r\n\r\nstruct Voxel {\r\n\tcolor: vec3<f32>,\r\n\topacity: f32,\r\n\troughness: f32,\r\n\tlightness: f32,\r\n}\r\n\r\nstruct MetaVoxel {\r\n\tgi: vec3<f32>,\r\n\tsomethingelse: vec3<f32>\r\n}\r\n\r\nstruct SceneData {\r\n\tdata: array<Voxel>,\r\n}\r\n\r\nstruct SceneMetaData {\r\n\tdata: array<MetaVoxel>,\r\n}\r\n\r\nstruct LightData {\r\n\tdata: array<Light>,\r\n}\r\n\r\nstruct Light {\r\n\tlocation: vec3<f32>,\r\n\temitter_type: f32,\r\n}\r\n\r\nstruct Ray {\r\n    origin: vec3<f32>,\r\n    direction: vec3<f32>,\r\n    inv_direction: vec3<f32>,\r\n}\r\n\r\nstruct RayHit {\r\n\tposition: vec3<f32>,\r\n\tdepth: f32,\r\n\tvoxel_position: vec3<i32>,\r\n\tvoxel: Voxel,\r\n\tnormal: vec3<f32>,\r\n\tray_direction: vec3<f32>,\r\n\texit_position: vec3<f32>,\r\n\tao: f32,\r\n\tuv: vec2<f32>,\r\n}\r\n\r\nstruct TraceResult {\r\n\tcolor: vec3<f32>,\r\n\tao: f32,\r\n}\r\n\r\n@compute @workgroup_size(16,16,1)\r\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {\r\n    let screen_size: vec2<u32> = textureDimensions(color_buffer);\r\n    let screen_pos : vec2<i32> = vec2<i32>(i32(GlobalInvocationID.x), i32(GlobalInvocationID.y));\r\n    // rng_seed = GlobalInvocationID.x + 50 + (GlobalInvocationID.y + 50) * (GlobalInvocationID.x + 100) * 1000 * u32(scene.rng_start);\r\n    rng_seed = GlobalInvocationID.x + 50 + (GlobalInvocationID.y + 50) * (GlobalInvocationID.x + 100) * 1000;\r\n    rng_seed_steady = GlobalInvocationID.x + 150 + (GlobalInvocationID.y + 75) * (GlobalInvocationID.x + 350) * 1000;\r\n\r\n    var pixel_color: vec3<f32>;\r\n    var pixel_ao: f32;\r\n    for (var i = 0; i < samples; i++){\r\n\r\n\t    let rng_offset: vec2<f32> = select(vec2<f32>(0), vec2<f32>(rng() - 0.5, rng() - 0.5), samples > 1);\r\n\t    let horizontal_coefficient: f32 = (f32(screen_pos.x) + rng_offset.x - f32(screen_size.x) / 2) / f32(screen_size.x);\r\n\t    let vertical_coefficient: f32 = (f32(screen_pos.y) + rng_offset.y - f32(screen_size.y) / 2) / -f32(screen_size.y);\r\n\r\n\t    let ray_direction = normalize(scene.camera_forward\r\n\t\t\t    + horizontal_coefficient * scene.camera_right\r\n\t\t\t    + vertical_coefficient * scene.camera_up);\r\n\t    let ray: Ray = Ray(scene.camera_pos, ray_direction, 1 / ray_direction);\r\n\t    let trace_result = trace(ray, light_bounces);\r\n\t    // pixel_color += trace(ray, light_bounces);\r\n\t    // pixel_color += trace_result.color;\r\n\t    pixel_color += trace_result;\r\n\t    // pixel_ao += trace_result.ao;\r\n    }\r\n\r\n    // let correction = 1.0 / f32(samples);\r\n    // pixel_color = sqrt(correction * pixel_color);\r\n\r\n\tpixel_color /= f32(samples);\r\n\t// pixel_ao /= f32(samples);\r\n\r\n    /* pixel_color = textureSampleLevel(hdr_tex, hdr_sampler, vec2<f32>(f32(GlobalInvocationID.x) / f32(screen_size.x), f32(GlobalInvocationID.y) / f32(screen_size.y) * 2), 0.0).rgb; */\r\n\r\n    textureStore(color_buffer, screen_pos, vec4<f32>(pixel_color, 1.0));\r\n    // textureStore(secondary_buffer, screen_pos, vec4<f32>(pixel_ao, 0, 0, 1.0));\r\n}\r\n\r\nfn rng_hash(seed: u32) -> u32 {\r\n\tvar x = ( seed << 10u );\r\n\tx ^= ( x >>  6u );\r\n\tx += ( x <<  3u );\r\n\tx ^= ( x >> 11u );\r\n\tx += ( x << 15u );\r\n\treturn x;\r\n}\r\n\r\nfn rng() -> f32 {\r\n\trng_seed++;\r\n\treturn bitcast<f32>((rng_hash(rng_seed) >> 9) | 0x3f800000 ) - 1.0;\r\n}\r\n\r\nfn rng_steady() -> f32 {\r\n\trng_seed_steady++;\r\n\treturn bitcast<f32>((rng_hash(rng_seed_steady) >> 9) | 0x3f800000 ) - 1.0;\r\n}\r\n\r\nfn ray_reflect(ray: Ray, position: vec3<f32>, normal: vec3<f32>) -> Ray {\r\n\tlet reflect = ray.direction - 2 * dot(ray.direction, normal) * normal;\r\n\treturn Ray(position, reflect, 1 / reflect);\r\n}\r\n\r\nfn get_voxel_id(v: vec3<i32>) -> i32 {\r\n\treturn v.z * voxel_count * voxel_count + v.y * voxel_count + v.x;\r\n}\r\n\r\nfn get_voxel(v: vec3<i32>) -> Voxel {\r\n\treturn scene_data.data[v.z * voxel_count * voxel_count + v.y * voxel_count + v.x];\r\n}\r\n\r\nfn get_meta_voxel(v: vec3<i32>) -> MetaVoxel {\r\n\treturn scene_meta_data.data[v.z * voxel_count * voxel_count + v.y * voxel_count + v.x];\r\n}\r\n\r\nfn get_voxel_by_position(v: vec3<f32>) -> Voxel {\r\n\treturn get_voxel(vec3<i32>((v - boundary_min) / f32(voxel_size)));\r\n}\r\n\r\nfn sample_spherical_map(v: vec3<f32>) -> vec2<f32> {\r\n\tlet theta = atan2(v.x, v.y);\r\n\tlet phi = acos(v.z);\r\n\tlet raw_u = theta / (2 * pi);\r\n\tlet uv = vec2<f32>(\r\n\t\t1 - (raw_u + 0.5),\r\n\t\tphi / pi\r\n\t);\r\n\treturn uv;\r\n}\r\n\r\nfn random_unit_vector() -> vec3<f32> {\r\n\tlet phi = rng() * pi * 2;\r\n\tlet costheta = rng() * 2 - 1;\r\n\t\tlet theta = acos(costheta);\r\n\tlet x = sin(theta) * cos(phi);\r\n\tlet y = sin(theta) * sin(phi);\r\n\tlet z = cos(theta);\r\n\treturn vec3<f32>(x, y, z);\r\n}\r\n"+(this.pathtracing?"const light_scatter_samples: i32 = 2;\r\n\r\nfn gamma_correct(color: vec3<f32>) -> vec3<f32> {\r\n    let correction = 1.0 / f32(samples);\r\n    return sqrt(correction * color);\r\n}\r\n\r\nfn trace(ray: Ray, depth: i32) -> vec3<f32> {\r\n\tif (depth <= 0) {\r\n\t\treturn vec3<f32>(0);\r\n\t}\r\n\t\tvar accum: vec3<f32> = vec3<f32>(0.0);\r\n\t\tvar mask: vec3<f32> = vec3<f32>(1.0);\r\n\t\tvar curr_ray: Ray = ray;\r\n\t\tvar curr_hit: RayHit;\r\n\t\tvar refl: f32 = 1.0;\r\n\t\tvar hits: i32 = 0;\r\n\r\n\t\tvar bounce_results: array<RayHit, light_bounces>;\r\n\r\n\t\tfor (; hits < light_bounces;){\r\n\t\t\tif (voxel_ray_any(curr_ray, 0.0001, &curr_hit)) {\r\n\t\t\t\tlet bounce_direction = random_unit_vector() + curr_hit.normal;\r\n\t\t\t\tif (all(bounce_direction == vec3<f32>(0))){\r\n\t\t\t\t\tcurr_ray = Ray(curr_hit.position, curr_hit.normal, 1 / curr_hit.normal);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet normalized = normalize(bounce_direction);\r\n\t\t\t\t\tcurr_ray = Ray(curr_hit.position, normalized, 1 / normalized);\r\n\t\t\t\t}\r\n\t\t\t\tbounce_results[hits] = curr_hit;\r\n\t\t\t\thits++;\r\n\t\t\t} else {\r\n\t\t\t\t// accum = pow(textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(curr_ray.direction), 0.0).rgb, vec3<f32>(2)) * 5;\r\n\t\t\t\taccum = vec3<f32>(pow(max(0, dot(curr_ray.direction, scene.direct_light) - 0.98) * 40, 1));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (hits == 0){\r\n\t\t\t// return textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(ray.direction), 0.0).rgb;\r\n\t\t\treturn vec3<f32>(pow(max(0, dot(ray.direction, scene.direct_light) - 0.95) * 20, 1));\r\n\t\t}\r\n\t\tif (hits == light_bounces){\r\n\t\t\taccum = vec3<f32>(0, 0, 0);\r\n\t\t} else {\r\n\t\t\t// accum = textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(bounce_results[hits - 1].ray_direction), 0.0).rgb;\r\n\t\t\t/* accum = vec3<f32>(max(0, dot(bounce_results[hits - 1].ray_direction, scene.direct_light))); */\r\n\t\t\t// accum = vec3<f32>(0);\r\n\t\t}\r\n\t\tfor (var i: i32 = hits - 1; i >= 0; i--){\r\n\t\t\tlet bounce = bounce_results[i];\r\n\t\t\t/* accum = min(vec3<f32>(1), accum) * min(vec3<f32>(1), bounce.voxel.color); */\r\n\t\t\taccum = accum * bounce.voxel.color\r\n\t\t\t\t+ bounce_results[i].voxel.lightness * bounce_results[i].voxel.color;\r\n\t\t\t// if (all(bounce.normal == vec3<f32>(0)) && all(bounce.ray_direction == vec3<f32>(0))){\r\n\t\t\t// \t// accum = textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(bounce_results[i].ray_direction), 0.0).rgb;\r\n\t\t\t// \taccum = vec3<f32>(0.5);\r\n\t\t\t// \tcontinue;\r\n\t\t\t// }\r\n\t\t\t// accum = accum * bounce.voxel.color;\r\n\t\t\t// accum = accum * bounce.voxel.color;\r\n\t\t}\r\n\treturn accum; // / f32(light_scatter_samples);\r\n}\r\n\r\nfn direct_illumination(orig_hit: RayHit, refl: ptr<function, f32>) -> vec3<f32> {\r\n\tvar hit: RayHit;\r\n\tif (!voxel_ray_any(Ray(orig_hit.position, scene.direct_light, 1 / scene.direct_light), 0.00001, &hit)){\r\n\t\treturn scene.direct_light_brightness * orig_hit.voxel.color;\r\n\t} else {\r\n\t\treturn 0.2 * orig_hit.voxel.color;\r\n\t}\r\n}\r\n\r\nfn voxel_ray_any(ray: Ray, start_tolerance: f32, hit: ptr<function, RayHit>) -> bool {\r\n\tvar tmin: f32 = 0.0;\r\n\tvar tmax: f32 = 300000000;\r\n\tfor (var d: i32 = 0; d < 3; d++) {\r\n\t\tlet t1 = (boundary_min[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\t\tlet t2 = (boundary_max[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\r\n\t\ttmin = min(max(t1, tmin), max(t2, tmin));\r\n\t\ttmax = max(min(t1, tmax), min(t2, tmax));\r\n\t}\r\n\t// Hier ist noch ein Fehler drin, tritt nur von ausserhalb des grid auf, das kommt ja vielleicht eh noch weg\r\n\tif tmin > tmax { return false; }\r\n    \tlet ray_entry = ray.origin + ray.direction * tmin;\r\n\tlet ray_exit = ray.origin + ray.direction * tmax;\r\n\r\n\tvar voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_entry - boundary_min) / f32(voxel_size))));\r\n\t//var end_voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_exit - boundary_min - ray.direction * 0.000001) / f32(voxel_size))));\r\n\r\n\tlet direction_zeros: vec3<bool> = ray.direction == vec3<f32>(0);\r\n\tlet step: vec3<i32> = vec3<i32>(sign(ray.direction));\r\n\tlet tdelta: vec3<f32> = select(voxel_size / abs(ray.direction), vec3<f32>(tmax), direction_zeros);\r\n\tlet voxel_boundary: vec3<f32> = vec3<f32>(voxel + max(vec3<i32>(0), step)) * voxel_size;\r\n\tvar tmax_comp: vec3<f32> = select(tmin + (boundary_min + voxel_boundary - ray_entry) / ray.direction, vec3<f32>(tmax), direction_zeros);\r\n\tvar thit: f32 = tmin;\r\n\tvar hit_normal: vec3<f32> = vec3<f32>(0, 0, 0);\r\n\r\n\twhile(all(voxel >= vec3<i32>(0)) && all(voxel < vec3<i32>(voxel_count))) {\r\n\t\tlet hit_voxel = get_voxel(voxel);\r\n\t\tif (hit_voxel.opacity > 0.01 && all(tmax_comp > vec3<f32>(start_tolerance))){\r\n\t\t\t(*hit).position = ray.origin + ray.direction * thit;\r\n\t\t\t(*hit).voxel = hit_voxel;\r\n\t\t\t(*hit).voxel_position = voxel;\r\n\t\t\t(*hit).depth = 1 - (thit - depth_clip_min) / (depth_clip_max - depth_clip_min);\r\n\t\t\t(*hit).normal = hit_normal;\r\n\t\t\t(*hit).ray_direction = ray.direction;\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (tmax_comp.x < tmax_comp.y && tmax_comp.x < tmax_comp.z) {\r\n\t\t\tvoxel.x += step.x;\r\n\t\t\tthit = tmax_comp.x;\r\n\t\t\ttmax_comp.x += tdelta.x;\r\n\t\t\thit_normal = vec3<f32>(f32(-step.x), 0, 0);\r\n\t\t} else if (tmax_comp.y < tmax_comp.z){\r\n\t\t\tvoxel.y += step.y;\r\n\t\t\tthit = tmax_comp.y;\r\n\t\t\ttmax_comp.y += tdelta.y;\r\n\t\t\thit_normal = vec3<f32>(0, f32(-step.y), 0);\r\n\t\t} else {\r\n\t\t\tvoxel.z += step.z;\r\n\t\t\tthit = tmax_comp.z;\r\n\t\t\ttmax_comp.z += tdelta.z;\r\n\t\t\thit_normal = vec3<f32>(0, 0, f32(-step.z));\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n":"struct penetration {\r\n\tcolor: vec3<f32>,\r\n\tao: f32,\r\n\thit: RayHit,\r\n}\r\n\r\nfn gamma_correct(color: vec3<f32>) -> vec3<f32> {\r\n    return color / f32(samples);\r\n}\r\n\r\nfn trace(ray: Ray, depth: i32) -> vec3<f32> {\r\n\tvar hit: RayHit;\r\n\tvar bounces: array<RayHit, reflection_bounces>;\r\n\tvar curr_ray = ray;\r\n\tvar hits: i32 = 0;\r\n\tvar has_next_ray = true;\r\n\tvar penetrations: array<penetration, max_penetrations>;\r\n\tvar penetration_count = 0;\r\n\r\n\tfor (var p = 0; p < max_penetrations; p++){\r\n\t\tvar color = vec3<f32>(0.0);\r\n\t\tvar ao = 0f;\r\n\t\tvar first_hit: RayHit;\r\n\t\tfor (var i = 0; i < reflection_bounces; i++){\r\n\t\t\tif(voxel_ray_any(curr_ray, 0.001, &hit)){\r\n\t\t\t\t// return TraceResult(vec3<f32>(hit.uv.x), 0.0);\r\n\t\t\t\tbounces[i] = hit;\r\n\t\t\t\tcurr_ray = ray_reflect(curr_ray, hit.position, hit.normal);\r\n\t\t\t\thits++;\r\n\t\t\t\tif (i == 0){\r\n\t\t\t\t\tfirst_hit = hit;\r\n\t\t\t\t}\r\n\t\t\t\tif (hit.voxel.roughness > 0.99){\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// return TraceResult(vec3<f32>(0.1), 0.0);\r\n\t\t\t\tcolor = scene.background_color;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hits == 0){\r\n\t\t\tbreak;\r\n\t\t\t// return background;\r\n\t\t\t// return ray.direction;\r\n\t\t}\r\n\t\t// return vec3<f32>(0.2, 0.4, 0.5);\r\n\t\t// return vec3<f32>(bounces[0].uv.x, bounces[0].uv.y, 0.0);\r\n\r\n\t\tfor (var i: i32 = hits; i >= 0; i--){\r\n\t\t\t\t// return TraceResult(vec3<f32>(0.5), 0.0);\r\n\t\t\t// return TraceResult(vec3<f32>(bounces[i].uv.x), 0.0);\r\n\t\t\tlet t = bounces[i].voxel.roughness;\r\n\t\t\tcolor = color * (1 - t) + t * bounces[i].voxel.color * illumination(bounces[i].position);\r\n\t\t\tif (i == 0){\r\n\t\t\t\t//ao = get_point_ao(bounces[0].position);\r\n\t\t\t\tao = 0;\r\n\t\t\t\tlet nrm = vec3<i32>(bounces[i].normal);\r\n\t\t\t\tlet uv = bounces[i].uv;\r\n\t\t\t\tlet am = voxel_ao(bounces[i].voxel_position + nrm, nrm.zxy, nrm.yzx);\r\n\t\t\t\tao = mix(mix(am.z, am.w, uv.x), mix(am.y, am.x, uv.x), uv.y);\r\n\t\t\t\t// return vec3<f32>(uv.x / 10 + interp_ao, uv.y / 10 + interp_ao, interp_ao) / 2;\r\n\t\t\t\t// return vec3<f32>(interp_ao);\r\n\t\t\t\t// let interp_ao = \r\n\t\t\t\t// ao = get_point_ao_lambert(bounces[0].position, bounces[0].normal);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (var l: i32 = 0; l < i32(scene.light_count); l++){\r\n\t\t\t\tlet light = lights.data[l];\r\n\t\t\t\tif i32(light.emitter_type) == 0 {\r\n\t\t\t\t\tlet light_voxel = get_voxel(vec3<i32>(light.location));\r\n\t\t\t\t\tlet light_voxel_location = light.location * voxel_size + boundary_min;\r\n\t\t\t\t\tlet light_voxel_location_top = light_voxel_location + voxel_size;\r\n\t\t\t\t\tlet light_voxel_location_mid = (light_voxel_location + light_voxel_location_top) / 2;\r\n\t\t\t\t\tlet lray_dir = light_voxel_location_mid - bounces[i].position;\r\n\t\t\t\t\tlet lray = Ray(bounces[i].position, lray_dir, 1 / lray_dir);\r\n\t\t\t\t\tvar lhit: RayHit;\r\n\t\t\t\t\tif (voxel_ray_any(lray, 0.001, &lhit) && all(lhit.voxel_position == vec3<i32>(light.location))){\r\n\t\t\t\t\t\tlet dist = distance(light_voxel_location_mid, bounces[i].position);\r\n\t\t\t\t\t\tlet intensity = 1 / pow(dist, 2) * lhit.voxel.lightness;\r\n\t\t\t\t\t\tcolor += light_voxel.color * vec3<f32>(intensity) * bounces[i].voxel.color;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// let vox = bounces[i].voxel_position;\r\n\t\t\t// let gi_vox = vox + vec3<i32>(bounces[i].normal);\r\n\t\t\t// color += get_meta_voxel(gi_vox).gi / 5;\r\n\t\t}\r\n\t\tpenetrations[p] = penetration(color, ao, first_hit);\r\n\t\tpenetration_count++;\r\n\t\tcurr_ray = Ray(first_hit.exit_position, ray.direction, ray.inv_direction);\r\n\t\tif (first_hit.voxel.opacity > 0.99){\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tif (penetration_count == 0){\r\n\t\treturn scene.background_color;\r\n\t\t// return TraceResult(scene.background_color, 0);\r\n\t}\r\n\r\n\tvar color = penetrations[penetration_count - 1].color;\r\n\tvar ao = penetrations[penetration_count - 1].ao;\r\n\tfor (var i: i32 = penetration_count - 2; i >= 0; i--){\r\n\t\t// if (i > 0 && all(penetrations[i].voxel_color == penetrations[i - 1].voxel_color)) { continue;}\r\n\t\tlet pvoxel = penetrations[i].hit.voxel;\r\n\t\tlet phit = penetrations[i].hit;\r\n\t\tlet pcolor = penetrations[i].color;\r\n\t\tlet pao = penetrations[i].ao;\r\n\t\tlet t = pvoxel.opacity;\r\n\t\tif (i > 0 && all(penetrations[i - 1].hit.voxel.color == pvoxel.color)) { continue; }\r\n\t\tcolor = pcolor * t + (1 - t) * color;\r\n\t\tao = pao * t + (1 - t) * ao;\r\n\t\t// let t = distance(phit.position, phit.exit_position) / voxel_size;\r\n\t\t// color += pvoxel.color * t / f32(penetration_count);\r\n\t\t// color = pvoxel.color * t + color * (1 - t);\r\n\t\t// color = penetrations[i].color * pvoxel.opacity + color * (1 - pvoxel.opacity);\r\n\t\t// ao = penetrations[i].ao * pvoxel.opacity + ao * (1 - pvoxel.opacity);\r\n\t}\r\n\r\n\treturn color * ao;\r\n\t// return TraceResult(color, ao);\r\n\t// return vec3<f32>(ao);\r\n}\r\n\r\nfn illumination(p: vec3<f32>) -> f32 {\r\n\tvar hit: RayHit;\r\n\tif (!voxel_ray_any(Ray(p, scene.direct_light, 1 / scene.direct_light), 0.001, &hit)){\r\n\t\treturn max(scene.direct_light_brightness, scene.ambient_light);\r\n\t}\r\n\treturn scene.ambient_light;\r\n}\r\n\r\nfn voxel_ray_any(ray: Ray, start_tolerance: f32, hit: ptr<function, RayHit>) -> bool {\r\n\tvar tmin: f32 = 0.0;\r\n\tvar tmax: f32 = 300000000;\r\n\tfor (var d: i32 = 0; d < 3; d++) {\r\n\t\tlet t1 = (boundary_min[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\t\tlet t2 = (boundary_max[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\r\n\t\ttmin = min(max(t1, tmin), max(t2, tmin));\r\n\t\ttmax = max(min(t1, tmax), min(t2, tmax));\r\n\t}\r\n\t// Hier ist noch ein Fehler drin, tritt nur von ausserhalb des grid auf, das kommt ja vielleicht eh noch weg\r\n\tif tmin > tmax { return false; }\r\n    \tlet ray_entry = ray.origin + ray.direction * tmin;\r\n\tlet ray_exit = ray.origin + ray.direction * tmax;\r\n\r\n\tvar voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_entry - boundary_min) / f32(voxel_size))));\r\n\t//var end_voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_exit - boundary_min - ray.direction * 0.000001) / f32(voxel_size))));\r\n\r\n\tlet direction_zeros: vec3<bool> = ray.direction == vec3<f32>(0);\r\n\tlet vstep: vec3<i32> = vec3<i32>(sign(ray.direction));\r\n\tlet tdelta: vec3<f32> = select(voxel_size / abs(ray.direction), vec3<f32>(tmax), direction_zeros);\r\n\tlet voxel_boundary: vec3<f32> = vec3<f32>(voxel + max(vec3<i32>(0), vstep)) * voxel_size;\r\n\tvar tmax_comp: vec3<f32> = select(tmin + (boundary_min + voxel_boundary - ray_entry) / ray.direction, vec3<f32>(tmax), direction_zeros);\r\n\tvar thit: f32 = tmin;\r\n\tvar hit_normal: vec3<f32> = vec3<f32>(0, 0, 0);\r\n\tvar mask: vec3<f32>;\r\n\r\n\twhile(all(voxel >= vec3<i32>(0)) && all(voxel < vec3<i32>(voxel_count))) {\r\n\t\tlet hit_voxel = get_voxel(voxel);\r\n\t\tif (hit_voxel.opacity > 0.01 && all(tmax_comp > vec3<f32>(start_tolerance))){\r\n\t\t\t(*hit).position = ray.origin + ray.direction * thit;\r\n\t\t\t(*hit).voxel = hit_voxel;\r\n\t\t\t(*hit).voxel_position = voxel;\r\n\t\t\t(*hit).depth = 1 - (thit - depth_clip_min) / (depth_clip_max - depth_clip_min);\r\n\t\t\t(*hit).normal = hit_normal;\r\n\t\t\t(*hit).ray_direction = ray.direction;\r\n\t\t\t// let v_diff = (*hit).position - (vec3<f32>(voxel) * voxel_size - boundary_min);\r\n\t\t\tlet uv = (((*hit).position - boundary_min) - (vec3<f32>(voxel) * voxel_size)) / voxel_size;\r\n\t\t\tlet uvx = select(vec3<f32>(1) * mask - mask * uv.yzx, mask * uv.yzx, sign(ray.direction) < vec3<f32>(0));\r\n\t\t\tlet uvy = select(vec3<f32>(1) * mask - mask * uv.zxy, mask * uv.zxy, sign(ray.direction) < vec3<f32>(0));\r\n\t\t\t// let uvy = mask * uv.zxy;\r\n\t\t\t(*hit).uv = vec2<f32>(\r\n\t\t\t\tmax(uvx.x, max(uvx.y, uvx.z)),\r\n\t\t\t\tmax(uvy.x, max(uvy.y, uvy.z)),\r\n\t\t\t\t// dot(mask * v_diff.zxy, vec3<f32>(voxel_size)) / voxel_size,\r\n\t\t\t);\r\n\t\t\tlet next_mask = step(tmax_comp.xyz, tmax_comp.yzx) * step(tmax_comp.xyz, tmax_comp.zxy);\r\n\t\t\tlet tmax_masked = vec3<f32>(next_mask) * tmax_comp;\r\n\t\t\t(*hit).exit_position = ray.origin + ray.direction * max(tmax_masked.x, max(tmax_masked.y, tmax_masked.z));\r\n\r\n\t\t\t\t\t\t// if (tmax_comp.x < tmax_comp.y && tmax_comp.x < tmax_comp.z) {\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.x;\r\n\t\t\t// } else if (tmax_comp.y < tmax_comp.z){\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.y;\r\n\t\t\t// } else {\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.z;\r\n\t\t\t// }\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tmask = step(tmax_comp.xyz, tmax_comp.yzx) * step(tmax_comp.xyz, tmax_comp.zxy);\r\n\t\tvoxel += vstep * vec3<i32>(mask);\r\n\t\tlet tmax_masked = vec3<f32>(mask) * tmax_comp;\r\n\t\tthit = max(tmax_masked.x, max(tmax_masked.y, tmax_masked.z));\r\n\t\thit_normal = -(vec3<f32>(vstep) * mask);\r\n\t\ttmax_comp += mask * tdelta;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nfn voxel_ao(pos: vec3<i32>, d1: vec3<i32>, d2: vec3<i32>) -> vec4<f32> {\r\n\tif (get_voxel(pos).opacity > 0) { return vec4<f32>(1); }\r\n\tlet side = vec4<f32>(get_voxel(pos + d1).opacity, get_voxel(pos + d2).opacity, get_voxel(pos - d1).opacity, get_voxel(pos - d2).opacity);\r\n\tlet corner = vec4<f32>(get_voxel(pos + d1 + d2).opacity, get_voxel(pos - d1 + d2).opacity, get_voxel(pos - d1 - d2).opacity, get_voxel(pos + d1 - d2).opacity);\r\n\tlet ao = vec4<f32>(\r\n\t\tvertex_ao(side.xy, corner.x),\r\n\t\tvertex_ao(side.yz, corner.y),\r\n\t\tvertex_ao(side.zw, corner.z),\r\n\t\tvertex_ao(side.wx, corner.w),\r\n\t);\r\n\treturn 1.0 - ao * scene.ao_strength;\r\n}\r\n\r\nfn vertex_ao(side: vec2<f32>, corner: f32) -> f32 {\r\n\t// return (side.x + side.y) / 2.0;\r\n\treturn max(side.x + side.y, max(corner, side.x * side.y)) / 2;\r\n\treturn (side.x + side.y + max(corner, side.x * side.y)) / 3.0;\r\n}")}),constants:{grid_size:this.scene.grid_size,voxel_count:this.scene.voxel_count}}});const l=null===(i=this.device)||void 0===i?void 0:i.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{}}]});this.screen_bind_group=null===(a=this.device)||void 0===a?void 0:a.createBindGroup({layout:l,entries:[{binding:0,resource:this.sampler},{binding:1,resource:this.color_buffer_view},{binding:2,resource:this.secondary_buffer_view}]});const d=null===(c=this.device)||void 0===c?void 0:c.createPipelineLayout({bindGroupLayouts:[l]});this.screen_pipeline=null===(o=this.device)||void 0===o?void 0:o.createRenderPipeline({layout:d,vertex:{module:this.device.createShaderModule({code:t}),entryPoint:"vert_main"},fragment:{module:this.device.createShaderModule({code:t}),entryPoint:"frag_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list",cullMode:"back",frontFace:"cw"}})}))}}(it,ot,st.camera);ot.initialize_default_grid(),lt.initialize(!1);let dt=new class{constructor(t,e){this.background=[0,0,0],this.canvas=t,this.axis="z",this.slice=0,this.scene=e,this.context=t.getContext("2d");const r=document.getElementById("slice-input");r.addEventListener("input",(t=>{const e=Math.floor(parseInt(r.value)/100*this.scene.voxel_count);this.set_slice(e>this.scene.voxel_count-1?this.scene.voxel_count-1:e),console.log(..._t("c9c58ea0_0",e))}))}set_background(t){this.background=t,this.update()}set_axis(t){this.axis=t,this.update()}set_slice(t){this.slice=t,this.update()}update(){const t=this.canvas.width,e=this.canvas.height,r=t/this.scene.voxel_count,x=e/this.scene.voxel_count;this.context.clearRect(0,0,t,e);for(let t=0;t<this.scene.voxel_count;t++)for(let e=0;e<this.scene.voxel_count;e++){const n="x"===this.axis?[this.slice,t,e]:"y"===this.axis?[t,this.slice,e]:[t,e,this.slice],_=this.scene.get_voxel(n);Q.floor(Q.scale(_.color,255)),this.context.fillStyle=this.color_to_string(_.color,_.opacity),this.context.fillRect(t*r,e*x,r,x)}}color_to_string(t,e){const r=Q.floor(Q.scale(t,255));return"#"+r[0].toString(16)+r[1].toString(16)+r[2].toString(16)+(255*e).toString(16)}}(ct,ot);dt.slice=6,dt.background=[30/255,30/255,46/255],dt.update();let ft=performance.now(),ht=!1;addEventListener("scroll",(()=>{let t=Math.min(2,window.scrollY/window.innerHeight);document.documentElement.style.setProperty("--canv-offset",t.toString())})),requestAnimationFrame((function t(){lt.render();const e=performance.now()-ft;st.tick(e/1e3),ft=performance.now(),at.innerText=Math.round(1/e*1e3).toString()+" fps",requestAnimationFrame(t)})),addEventListener("mousedown",(t=>{2==t.button&&(ht=!0)}));let ut="mocha";const vt=document.getElementById("menu_switch_theme");null==vt||vt.addEventListener("click",(t=>{"mocha"===ut?(ut="latte",function(){const t=document.querySelector(":root");document.documentElement.dataset.theme="latte",t.style.setProperty("--ctp-crust","#dce0e8"),t.style.setProperty("--ctp-mantle","#e6e9ef"),t.style.setProperty("--ctp-base","#eff1f5"),t.style.setProperty("--ctp-surface0","#ccd0da"),t.style.setProperty("--ctp-surface1","#bcc0cc"),t.style.setProperty("--ctp-surface2","#acb0be"),t.style.setProperty("--ctp-overlay0","#9ca0b0"),t.style.setProperty("--ctp-overlay1","#8c8fa1"),t.style.setProperty("--ctp-overlay2","#7c7f93"),t.style.setProperty("--ctp-subtext0","#6c6f85"),t.style.setProperty("--ctp-subtext1","#5c5f77"),t.style.setProperty("--ctp-text","#4c4f69"),t.style.setProperty("--ctp-lavender","#7287fd"),t.style.setProperty("--ctp-blue","#1e66f5"),t.style.setProperty("--ctp-sapphire","#209fb5"),t.style.setProperty("--ctp-sky","#04a5e5"),t.style.setProperty("--ctp-teal","#179299"),t.style.setProperty("--ctp-green","#40a02b"),t.style.setProperty("--ctp-yellow","#df8e1d"),t.style.setProperty("--ctp-peach","#fe640b"),t.style.setProperty("--ctp-maroon","#e64553"),t.style.setProperty("--ctp-red","#d20f39"),t.style.setProperty("--ctp-mauve","#8839ef"),t.style.setProperty("--ctp-pink","#ea76cb"),t.style.setProperty("--ctp-flamingo","#dd7878"),t.style.setProperty("--ctp-rosewater","#dc8a78")}(),ot.background_color=[.8,208/255,218/255],dt.set_background([.8,208/255,218/255])):(ut="mocha",function(){const t=document.querySelector(":root");document.documentElement.dataset.theme="mocha",t.style.setProperty("--ctp-crust","#11111b"),t.style.setProperty("--ctp-mantle","#181825"),t.style.setProperty("--ctp-base","#1e1e2e"),t.style.setProperty("--ctp-surface0","#313244"),t.style.setProperty("--ctp-surface1","#45475a"),t.style.setProperty("--ctp-surface2","#585b70"),t.style.setProperty("--ctp-overlay0","#6c7086"),t.style.setProperty("--ctp-overlay1","#7f849c"),t.style.setProperty("--ctp-overlay2","#9399b2"),t.style.setProperty("--ctp-subtext0","#a6adc8"),t.style.setProperty("--ctp-subtext1","#bac2de"),t.style.setProperty("--ctp-text","#cdd6f4"),t.style.setProperty("--ctp-lavender","#b4befe"),t.style.setProperty("--ctp-blue","#89b4fa"),t.style.setProperty("--ctp-sapphire","#74c7ec"),t.style.setProperty("--ctp-sky","#89dceb"),t.style.setProperty("--ctp-teal","#94e2d5"),t.style.setProperty("--ctp-green","#a6e3a1"),t.style.setProperty("--ctp-yellow","#f9e2af"),t.style.setProperty("--ctp-peach","#fab387"),t.style.setProperty("--ctp-maroon","#eba0ac"),t.style.setProperty("--ctp-red","#f38ba8"),t.style.setProperty("--ctp-mauve","#cba6f7"),t.style.setProperty("--ctp-pink","#f5c2e7"),t.style.setProperty("--ctp-flamingo","#f2cdcd"),t.style.setProperty("--ctp-rosewater","#f5e0dc")}(),ot.background_color=[30/255,30/255,46/255],dt.set_background([30/255,30/255,46/255]))})),ot.background_color=[30/255,30/255,46/255];const bt=document.getElementById("menu_rescale_canvas");function pt(){const t=document.querySelector(":root"),e=.8*Math.min(window.innerWidth,window.innerHeight);t.style.setProperty("--canv-x",e.toString()+"px"),t.style.setProperty("--canv-y",e.toString()+"px"),it.height=e,it.width=e,lt.shutdown(),lt.initialize(lt.pathtracing)}null==bt||bt.addEventListener("click",(t=>{pt()})),pt();const mt=document.getElementById("menu_save_scene");null==mt||mt.addEventListener("click",(t=>{!function(){const t=new Blob([ot.serialize_scene()],{type:"text/json"}),e=document.createElement("a");e.href=URL.createObjectURL(t),e.download="scene.json",e.click(),URL.revokeObjectURL(e.href)}()}));const gt=document.getElementById("menu_load_scene");null==gt||gt.addEventListener("click",(t=>{!function(){const t=document.createElement("input");t.type="file",t.addEventListener("change",(e=>{const r=(null==t?void 0:t.files)[0],x=new FileReader;x.readAsText(r,"UTF-8"),x.addEventListener("load",(t=>{var e;const r=null===(e=t.target)||void 0===e?void 0:e.result;ot.deserialize_scene(r),lt.shutdown(),lt.initialize(lt.pathtracing)}))})),t.click()}()})),addEventListener("contextmenu",(t=>(t.preventDefault(),!1)))})();
//# sourceMappingURL=main.js.map