(()=>{"use strict";const e="@group(0) @binding(0) var screen_sampler : sampler;\r\n@group(0) @binding(1) var color_buffer : texture_2d<f32>;\r\n@group(0) @binding(2) var secondary_buffer : texture_2d<f32>;\r\n\r\nstruct VertexOutput {\r\n        @builtin(position) Position : vec4<f32>,\r\n            @location(0) TexCoord : vec2<f32>,\r\n}\r\n\r\n@vertex\r\nfn vert_main(@builtin(vertex_index) VertexIndex : u32) -> VertexOutput {\r\n    var positions = array<vec2<f32>, 6>(\r\n        vec2<f32>( 1.0,  1.0),\r\n        vec2<f32>( 1.0, -1.0),\r\n        vec2<f32>(-1.0, -1.0),\r\n        vec2<f32>( 1.0,  1.0),\r\n        vec2<f32>(-1.0, -1.0),\r\n        vec2<f32>(-1.0,  1.0)\r\n    );\r\n\r\n    var texCoords = array<vec2<f32>, 6>(\r\n        vec2<f32>(1.0, 0.0),\r\n        vec2<f32>(1.0, 1.0),\r\n        vec2<f32>(0.0, 1.0),\r\n        vec2<f32>(1.0, 0.0),\r\n        vec2<f32>(0.0, 1.0),\r\n        vec2<f32>(0.0, 0.0)\r\n    );\r\n\r\n    var output : VertexOutput;\r\n    output.Position = vec4<f32>(positions[VertexIndex], 0.0, 1.0);\r\n    output.TexCoord = texCoords[VertexIndex];\r\n    return output;\r\n}\r\n\r\nconst ao_blur_steps = 7;\r\nconst ao_blur_radius = 0.00f / f32(ao_blur_steps);\r\nconst ao_strength = 1;\r\n\r\n@fragment\r\nfn frag_main(@location(0) TexCoord : vec2<f32>) -> @location(0) vec4<f32> {\r\n\tvar acc = 0f;\r\n\tlet blur_offset = (ao_blur_radius * f32(ao_blur_steps)) / 2;\r\n\tfor (var x = 0; x < ao_blur_steps; x++){\r\n\t\tfor (var y = 0; y < ao_blur_steps; y++){\r\n\t\t\tacc += textureSample(secondary_buffer, screen_sampler, vec2<f32>(TexCoord.x - blur_offset + ao_blur_radius * f32(x), TexCoord.y - blur_offset + ao_blur_radius * f32(y))).x;\r\n\t\t}\r\n\t}\r\n\tacc /= f32(ao_blur_steps) * f32(ao_blur_steps);\r\n\r\n    // return vec4<f32>(acc, acc, acc, 1.0);\r\n    return textureSample(color_buffer, screen_sampler, TexCoord) * (1 - acc * ao_strength);\r\n}\r\n";var t=function(e,t,x,r){return new(x||(x=Promise))((function(n,a){function _(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof x?t:new x((function(e){e(t)}))).then(_,i)}c((r=r.apply(e,t||[])).next())}))};let x=1e-6,r=Float32Array;function n(e=0,t=0){const x=new r(2);return void 0!==e&&(x[0]=e,void 0!==t&&(x[1]=t)),x}const a=n;function _(e,t,x){return(x=x||new r(2))[0]=e[0]-t[0],x[1]=e[1]-t[1],x}const i=_;function c(e,t,x){return(x=x||new r(2))[0]=e[0]*t,x[1]=e[1]*t,x}const o=c;function s(e,t){return(t=t||new r(2))[0]=1/e[0],t[1]=1/e[1],t}const l=s;function d(e,t){return e[0]*t[0]+e[1]*t[1]}function f(e){const t=e[0],x=e[1];return Math.sqrt(t*t+x*x)}const h=f;function u(e){const t=e[0],x=e[1];return t*t+x*x}const v=u;function b(e,t){const x=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(x*x+r*r)}const p=b;function m(e,t){const x=e[0]-t[0],r=e[1]-t[1];return x*x+r*r}const g=m;function y(e,t){return(t=t||new r(2))[0]=e[0],t[1]=e[1],t}const w=y;function z(e,t,x){return(x=x||new r(2))[0]=e[0]*t[0],x[1]=e[1]*t[1],x}const M=z;function P(e,t,x){return(x=x||new r(2))[0]=e[0]/t[0],x[1]=e[1]/t[1],x}const E=P;var S=Object.freeze({__proto__:null,add:function(e,t,x){return(x=x||new r(2))[0]=e[0]+t[0],x[1]=e[1]+t[1],x},addScaled:function(e,t,x,n){return(n=n||new r(2))[0]=e[0]+t[0]*x,n[1]=e[1]+t[1]*x,n},angle:function(e,t){const x=e[0],r=e[1],n=e[0],a=e[1],_=Math.sqrt(x*x+r*r)*Math.sqrt(n*n+a*a),i=_&&d(e,t)/_;return Math.acos(i)},ceil:function(e,t){return(t=t||new r(2))[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},clamp:function(e,t=0,x=1,n){return(n=n||new r(2))[0]=Math.min(x,Math.max(t,e[0])),n[1]=Math.min(x,Math.max(t,e[1])),n},clone:w,copy:y,create:n,cross:function(e,t,x){x=x||new r(3);const n=e[0]*t[1]-e[1]*t[0];return x[0]=0,x[1]=0,x[2]=n,x},dist:p,distSq:g,distance:b,distanceSq:m,div:E,divScalar:function(e,t,x){return(x=x||new r(2))[0]=e[0]/t,x[1]=e[1]/t,x},divide:P,dot:d,equals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equalsApproximately:function(e,t){return Math.abs(e[0]-t[0])<x&&Math.abs(e[1]-t[1])<x},floor:function(e,t){return(t=t||new r(2))[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},fromValues:a,inverse:s,invert:l,len:h,lenSq:v,length:f,lengthSq:u,lerp:function(e,t,x,n){return(n=n||new r(2))[0]=e[0]+x*(t[0]-e[0]),n[1]=e[1]+x*(t[1]-e[1]),n},lerpV:function(e,t,x,n){return(n=n||new r(2))[0]=e[0]+x[0]*(t[0]-e[0]),n[1]=e[1]+x[1]*(t[1]-e[1]),n},max:function(e,t,x){return(x=x||new r(2))[0]=Math.max(e[0],t[0]),x[1]=Math.max(e[1],t[1]),x},min:function(e,t,x){return(x=x||new r(2))[0]=Math.min(e[0],t[0]),x[1]=Math.min(e[1],t[1]),x},mul:M,mulScalar:c,multiply:z,negate:function(e,t){return(t=t||new r(2))[0]=-e[0],t[1]=-e[1],t},normalize:function(e,t){t=t||new r(2);const x=e[0],n=e[1],a=Math.sqrt(x*x+n*n);return a>1e-5?(t[0]=x/a,t[1]=n/a):(t[0]=0,t[1]=0),t},random:function(e=1,t){t=t||new r(2);const x=2*Math.random()*Math.PI;return t[0]=Math.cos(x)*e,t[1]=Math.sin(x)*e,t},round:function(e,t){return(t=t||new r(2))[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:o,setDefaultType:function(e){const t=r;return r=e,t},sub:i,subtract:_,transformMat3:function(e,t,x){x=x||new r(2);const n=e[0],a=e[1];return x[0]=t[0]*n+t[4]*a+t[8],x[1]=t[1]*n+t[5]*a+t[9],x},transformMat4:function(e,t,x){x=x||new r(2);const n=e[0],a=e[1];return x[0]=n*t[0]+a*t[4]+t[12],x[1]=n*t[1]+a*t[5]+t[13],x},zero:function(e){return(e=e||new r(2))[0]=0,e[1]=0,e}});Float32Array;new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]).get(Float32Array);let I=Float32Array;function T(e,t,x){const r=new I(3);return void 0!==e&&(r[0]=e,void 0!==t&&(r[1]=t,void 0!==x&&(r[2]=x))),r}const k=T;function L(e,t,x){return(x=x||new I(3))[0]=e[0]-t[0],x[1]=e[1]-t[1],x[2]=e[2]-t[2],x}const R=L;function D(e,t,x){return(x=x||new I(3))[0]=e[0]*t,x[1]=e[1]*t,x[2]=e[2]*t,x}const N=D;function A(e,t){return(t=t||new I(3))[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}const O=A;function G(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function B(e){const t=e[0],x=e[1],r=e[2];return Math.sqrt(t*t+x*x+r*r)}const U=B;function C(e){const t=e[0],x=e[1],r=e[2];return t*t+x*x+r*r}const F=C;function j(e,t){const x=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(x*x+r*r+n*n)}const q=j;function V(e,t){const x=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return x*x+r*r+n*n}const H=V;function W(e,t){return(t=t||new I(3))[0]=e[0],t[1]=e[1],t[2]=e[2],t}const Y=W;function Z(e,t,x){return(x=x||new I(3))[0]=e[0]*t[0],x[1]=e[1]*t[1],x[2]=e[2]*t[2],x}const $=Z;function J(e,t,x){return(x=x||new I(3))[0]=e[0]/t[0],x[1]=e[1]/t[1],x[2]=e[2]/t[2],x}const X=J;var Q=Object.freeze({__proto__:null,add:function(e,t,x){return(x=x||new I(3))[0]=e[0]+t[0],x[1]=e[1]+t[1],x[2]=e[2]+t[2],x},addScaled:function(e,t,x,r){return(r=r||new I(3))[0]=e[0]+t[0]*x,r[1]=e[1]+t[1]*x,r[2]=e[2]+t[2]*x,r},angle:function(e,t){const x=e[0],r=e[1],n=e[2],a=e[0],_=e[1],i=e[2],c=Math.sqrt(x*x+r*r+n*n)*Math.sqrt(a*a+_*_+i*i),o=c&&G(e,t)/c;return Math.acos(o)},ceil:function(e,t){return(t=t||new I(3))[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},clamp:function(e,t=0,x=1,r){return(r=r||new I(3))[0]=Math.min(x,Math.max(t,e[0])),r[1]=Math.min(x,Math.max(t,e[1])),r[2]=Math.min(x,Math.max(t,e[2])),r},clone:Y,copy:W,create:T,cross:function(e,t,x){x=x||new I(3);const r=e[2]*t[0]-e[0]*t[2],n=e[0]*t[1]-e[1]*t[0];return x[0]=e[1]*t[2]-e[2]*t[1],x[1]=r,x[2]=n,x},dist:q,distSq:H,distance:j,distanceSq:V,div:X,divScalar:function(e,t,x){return(x=x||new I(3))[0]=e[0]/t,x[1]=e[1]/t,x[2]=e[2]/t,x},divide:J,dot:G,equals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equalsApproximately:function(e,t){return Math.abs(e[0]-t[0])<x&&Math.abs(e[1]-t[1])<x&&Math.abs(e[2]-t[2])<x},floor:function(e,t){return(t=t||new I(3))[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},fromValues:k,getAxis:function(e,t,x){const r=4*t;return(x=x||new I(3))[0]=e[r+0],x[1]=e[r+1],x[2]=e[r+2],x},getScaling:function(e,t){t=t||new I(3);const x=e[0],r=e[1],n=e[2],a=e[4],_=e[5],i=e[6],c=e[8],o=e[9],s=e[10];return t[0]=Math.sqrt(x*x+r*r+n*n),t[1]=Math.sqrt(a*a+_*_+i*i),t[2]=Math.sqrt(c*c+o*o+s*s),t},getTranslation:function(e,t){return(t=t||new I(3))[0]=e[12],t[1]=e[13],t[2]=e[14],t},inverse:A,invert:O,len:U,lenSq:F,length:B,lengthSq:C,lerp:function(e,t,x,r){return(r=r||new I(3))[0]=e[0]+x*(t[0]-e[0]),r[1]=e[1]+x*(t[1]-e[1]),r[2]=e[2]+x*(t[2]-e[2]),r},lerpV:function(e,t,x,r){return(r=r||new I(3))[0]=e[0]+x[0]*(t[0]-e[0]),r[1]=e[1]+x[1]*(t[1]-e[1]),r[2]=e[2]+x[2]*(t[2]-e[2]),r},max:function(e,t,x){return(x=x||new I(3))[0]=Math.max(e[0],t[0]),x[1]=Math.max(e[1],t[1]),x[2]=Math.max(e[2],t[2]),x},min:function(e,t,x){return(x=x||new I(3))[0]=Math.min(e[0],t[0]),x[1]=Math.min(e[1],t[1]),x[2]=Math.min(e[2],t[2]),x},mul:$,mulScalar:D,multiply:Z,negate:function(e,t){return(t=t||new I(3))[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},normalize:function(e,t){t=t||new I(3);const x=e[0],r=e[1],n=e[2],a=Math.sqrt(x*x+r*r+n*n);return a>1e-5?(t[0]=x/a,t[1]=r/a,t[2]=n/a):(t[0]=0,t[1]=0,t[2]=0),t},random:function(e=1,t){t=t||new I(3);const x=2*Math.random()*Math.PI,r=2*Math.random()-1,n=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(x)*n,t[1]=Math.sin(x)*n,t[2]=r*e,t},round:function(e,t){return(t=t||new I(3))[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:N,setDefaultType:function(e){const t=I;return I=e,t},sub:R,subtract:L,transformMat3:function(e,t,x){x=x||new I(3);const r=e[0],n=e[1],a=e[2];return x[0]=r*t[0]+n*t[4]+a*t[8],x[1]=r*t[1]+n*t[5]+a*t[9],x[2]=r*t[2]+n*t[6]+a*t[10],x},transformMat4:function(e,t,x){x=x||new I(3);const r=e[0],n=e[1],a=e[2],_=t[3]*r+t[7]*n+t[11]*a+t[15]||1;return x[0]=(t[0]*r+t[4]*n+t[8]*a+t[12])/_,x[1]=(t[1]*r+t[5]*n+t[9]*a+t[13])/_,x[2]=(t[2]*r+t[6]*n+t[10]*a+t[14])/_,x},transformMat4Upper3x3:function(e,t,x){x=x||new I(3);const r=e[0],n=e[1],a=e[2];return x[0]=r*t[0]+n*t[4]+a*t[8],x[1]=r*t[1]+n*t[5]+a*t[9],x[2]=r*t[2]+n*t[6]+a*t[10],x},zero:function(e){return(e=e||new I(3))[0]=0,e[1]=0,e[2]=0,e}});function K(e){return e*Math.PI/180}Float32Array,Float32Array,Float32Array;class ee{constructor(e,t){this.origin=e,this.direction=Q.normalize(t),this.inv_direction=[1,1,1],Q.div(this.inv_direction,t,this.inv_direction)}}class te{constructor(e,t,x,r){this.position=e,this.voxel_position=t,this.voxel=x,this.normal=r}}class xe{constructor(){this.color=Q.create(),this.opacity=0,this.roughness=1,this.lightness=0}}class re{constructor(){this.gi=Q.create()}}class ne{constructor(e,t,x){this.dragged=!1,this.velocity=[0,0],this.distance=8,this.forward=Q.create(),this.right=Q.create(),this.up=Q.create(),this.position=Q.create(),this.eulers=[0,x,t],this.distance=e}update(){this.eulers[1]=Math.min(80,Math.max(-80,this.eulers[1])),this.eulers[2]=this.eulers[2]%360,this.forward=[Math.cos(K(this.eulers[2]))*Math.cos(K(this.eulers[1])),Math.sin(K(this.eulers[2]))*Math.cos(K(this.eulers[1])),Math.sin(K(this.eulers[1]))],Q.normalize(Q.cross(this.forward,[0,0,1],this.right),this.right),Q.normalize(Q.cross(this.right,this.forward,this.up),this.up),Q.scale(this.forward,-this.distance,this.position)}tick(e){this.dragged||(this.eulers[1]-=this.velocity[1],this.eulers[2]-=this.velocity[0]),S.scale(this.velocity,.96*(1-e),this.velocity),this.update()}screen_to_ray(e,t,x,r){const n=(e-x/2)/x,a=(t-r/2)/-r;let _=Q.create();return Q.add(_,this.forward,_),Q.add(_,Q.scale(this.right,n),_),Q.add(_,Q.scale(this.up,a),_),new ee(this.position,_)}}function ae(e,...t){try{(function(){try{return(0,eval)("globalThis._console_ninja")||(0,eval)("/* https://github.com/wallabyjs/console-ninja#how-does-it-work */'use strict';var _0x26e2c0=_0x7b51;(function(_0x1ac9bd,_0x100cb4){var _0x3159c8=_0x7b51,_0x1cfafd=_0x1ac9bd();while(!![]){try{var _0x570631=parseInt(_0x3159c8(0x212))/0x1+-parseInt(_0x3159c8(0x1ed))/0x2*(parseInt(_0x3159c8(0x294))/0x3)+parseInt(_0x3159c8(0x229))/0x4*(parseInt(_0x3159c8(0x1fe))/0x5)+parseInt(_0x3159c8(0x295))/0x6*(parseInt(_0x3159c8(0x1ef))/0x7)+parseInt(_0x3159c8(0x29e))/0x8+-parseInt(_0x3159c8(0x283))/0x9*(parseInt(_0x3159c8(0x22d))/0xa)+-parseInt(_0x3159c8(0x1fc))/0xb;if(_0x570631===_0x100cb4)break;else _0x1cfafd['push'](_0x1cfafd['shift']());}catch(_0x5dd33f){_0x1cfafd['push'](_0x1cfafd['shift']());}}}(_0x2883,0x676fa));function _0x2883(){var _0x27f5bb=['unknown','278620PZaCua','cappedElements','global','array','argumentResolutionError','[object\\x20Array]','logger\\x20websocket\\x20error','_sendErrorMessage',':logPointId:','error','onerror','_connected','default','root_exp_id','capped','path','[object\\x20Date]','reload','disabledTrace','null','_addObjectProperty','NEGATIVE_INFINITY','_setNodeQueryPath','_treeNodePropertiesAfterFullValue','pop','setter','value','_setNodeExpressionPath','forEach','_setNodePermissions','_getOwnPropertySymbols','_p_name','location','_console_ninja','isArray','message','_WebSocket','node','_addFunctionsNode','_getOwnPropertyNames','getOwnPropertyDescriptor','readyState','set','log','_Symbol','_addProperty','performance','cappedProps','root_exp','_dateToString','Error','_sortProps','slice','_socket','_setNodeLabel','current','serialize','timeStamp','String','replace','constructor','failed\\x20to\\x20connect\\x20to\\x20host:\\x20','isExpressionToEvaluate','POSITIVE_INFINITY','stack','Symbol','split','parse','expId','Map','name','_isNegativeZero','call','symbol','_cleanNode','_isSet','function','_property','timeEnd','autoExpand','1.0.0','_allowedToSend','Number','__es'+'Module','_WebSocketClass','disabledLog','81mWcxxH','now','send','_HTMLAllCollection','_consoleNinjaAllowedToStart','perf_hooks','_setNodeId','process','autoExpandLimit','undefined','pathToFileURL','Console\\x20Ninja\\x20failed\\x20to\\x20send\\x20logs,\\x20restarting\\x20the\\x20process\\x20may\\x20help','_p_length','_type','_attemptToReconnectShortly','_propertyName','join','12fTgZGA','1128cCrnnM','_regExpToString','count','noFunctions','data','prototype','match','url','RegExp','3836768jJmZKa','test','_disposeWebsocket','depth','allStrLength','date','then','getOwnPropertyNames','WebSocket','[object\\x20Set]','unref','resolveGetters','level','_inBrowser','elements','_blacklistedProperty','nodeModules','getOwnPropertySymbols','props','_keyStrRegExp','object','stackTraceLimit','defineProperty','Set','_isPrimitiveWrapperType','warn','_isArray','_undefined','onopen','toLowerCase','expressionsToEvaluate','map','strLength','_isPrimitiveType','_connectToHostNow','push','_numberRegExp','onclose','autoExpandPropertyCount','_additionalMetadata','bigint','_isMap','failed\\x20to\\x20find\\x20and\\x20load\\x20WebSocket','_connecting','_treeNodePropertiesBeforeFullValue','_connectAttemptCount','hrtime','hits','negativeInfinity','close','create','_maxConnectAttemptCount','_propertyAccessor','stringify','74218CVDJfB','ws/index.js','5971zUTGks','_quotedRegExp','versions','nan','positiveInfinity','number','sortProps','trace','autoExpandPreviousObjects','index','parent','string','_isUndefined','7084022acfRSc','nuxt','35ftVoSy','totalStrLength','_objectToString','_addLoadNode','onmessage','bind','host','get','...','method','reduceLimits','_p_','\\x20server','substr','hostname','type','_processTreeNodeResult','Console\\x20Ninja\\x20failed\\x20to\\x20send\\x20logs,\\x20refreshing\\x20the\\x20page\\x20may\\x20help','toString','port','646408wcCypD','_ws','console','_getOwnPropertyDescriptor','concat',\"c:\\\\Users\\\\c\\\\.vscode\\\\extensions\\\\wallabyjs.console-ninja-0.0.153\\\\node_modules\",'getPrototypeOf','','_console_ninja_session','time','_reconnectTimeout','1686901138801','_hasSymbolPropertyOnItsPath','valueOf','_setNodeExpandableState','remix','Boolean','_allowedToConnectOnSend','\\x20browser','enumerable','[object\\x20Map]','hasOwnProperty','includes','103144gWwlpw','length','_capIfString'];_0x2883=function(){return _0x27f5bb;};return _0x2883();}var ue=Object[_0x26e2c0(0x1e9)],te=Object[_0x26e2c0(0x2b4)],he=Object[_0x26e2c0(0x255)],le=Object['getOwnPropertyNames'],fe=Object[_0x26e2c0(0x218)],_e=Object[_0x26e2c0(0x29a)][_0x26e2c0(0x227)],pe=(_0x42411d,_0x16271c,_0x199581,_0x1d0b77)=>{var _0x47af79=_0x26e2c0;if(_0x16271c&&typeof _0x16271c==_0x47af79(0x2b2)||typeof _0x16271c=='function'){for(let _0x31705f of le(_0x16271c))!_e[_0x47af79(0x275)](_0x42411d,_0x31705f)&&_0x31705f!==_0x199581&&te(_0x42411d,_0x31705f,{'get':()=>_0x16271c[_0x31705f],'enumerable':!(_0x1d0b77=he(_0x16271c,_0x31705f))||_0x1d0b77[_0x47af79(0x225)]});}return _0x42411d;},ne=(_0x2f037e,_0x3e8ac2,_0x59d36d)=>(_0x59d36d=_0x2f037e!=null?ue(fe(_0x2f037e)):{},pe(_0x3e8ac2||!_0x2f037e||!_0x2f037e[_0x26e2c0(0x280)]?te(_0x59d36d,_0x26e2c0(0x239),{'value':_0x2f037e,'enumerable':!0x0}):_0x59d36d,_0x2f037e)),Q=class{constructor(_0x574b49,_0x5d685d,_0x22833c,_0x1c6c8e){var _0x3bdaa9=_0x26e2c0;this[_0x3bdaa9(0x22f)]=_0x574b49,this['host']=_0x5d685d,this[_0x3bdaa9(0x211)]=_0x22833c,this['nodeModules']=_0x1c6c8e,this['_allowedToSend']=!0x0,this[_0x3bdaa9(0x223)]=!0x0,this[_0x3bdaa9(0x238)]=!0x1,this[_0x3bdaa9(0x1e2)]=!0x1,this[_0x3bdaa9(0x2ab)]=!!this[_0x3bdaa9(0x22f)][_0x3bdaa9(0x2a6)],this[_0x3bdaa9(0x281)]=null,this[_0x3bdaa9(0x1e4)]=0x0,this[_0x3bdaa9(0x1ea)]=0x14,this[_0x3bdaa9(0x234)]=this['_inBrowser']?_0x3bdaa9(0x20f):_0x3bdaa9(0x28e);}async['getWebSocketClass'](){var _0x91e3e=_0x26e2c0;if(this[_0x91e3e(0x281)])return this[_0x91e3e(0x281)];let _0x985c12;if(this['_inBrowser'])_0x985c12=this[_0x91e3e(0x22f)][_0x91e3e(0x2a6)];else{if(this[_0x91e3e(0x22f)][_0x91e3e(0x28a)]?.[_0x91e3e(0x251)])_0x985c12=this[_0x91e3e(0x22f)][_0x91e3e(0x28a)]?.[_0x91e3e(0x251)];else try{let _0x465609=await import(_0x91e3e(0x23c));_0x985c12=(await import((await import(_0x91e3e(0x29c)))[_0x91e3e(0x28d)](_0x465609[_0x91e3e(0x293)](this['nodeModules'],_0x91e3e(0x1ee)))[_0x91e3e(0x210)]()))[_0x91e3e(0x239)];}catch{try{_0x985c12=require(require(_0x91e3e(0x23c))[_0x91e3e(0x293)](this[_0x91e3e(0x2ae)],'ws'));}catch{throw new Error(_0x91e3e(0x1e1));}}}return this[_0x91e3e(0x281)]=_0x985c12,_0x985c12;}[_0x26e2c0(0x1d9)](){var _0x1f740d=_0x26e2c0;this['_connecting']||this[_0x1f740d(0x238)]||this[_0x1f740d(0x1e4)]>=this[_0x1f740d(0x1ea)]||(this[_0x1f740d(0x223)]=!0x1,this[_0x1f740d(0x1e2)]=!0x0,this['_connectAttemptCount']++,this['_ws']=new Promise((_0x393e0e,_0x112b28)=>{var _0x239aed=_0x1f740d;this['getWebSocketClass']()[_0x239aed(0x2a4)](_0x2a1713=>{var _0x3d333d=_0x239aed;let _0x228a34=new _0x2a1713('ws://'+this[_0x3d333d(0x204)]+':'+this[_0x3d333d(0x211)]);_0x228a34[_0x3d333d(0x237)]=()=>{var _0x16ae5d=_0x3d333d;this[_0x16ae5d(0x27e)]=!0x1,this[_0x16ae5d(0x2a0)](_0x228a34),this[_0x16ae5d(0x291)](),_0x112b28(new Error(_0x16ae5d(0x233)));},_0x228a34['onopen']=()=>{var _0x38437d=_0x3d333d;this[_0x38437d(0x2ab)]||_0x228a34['_socket']&&_0x228a34[_0x38437d(0x262)][_0x38437d(0x2a8)]&&_0x228a34[_0x38437d(0x262)][_0x38437d(0x2a8)](),_0x393e0e(_0x228a34);},_0x228a34[_0x3d333d(0x1dc)]=()=>{var _0x566b58=_0x3d333d;this[_0x566b58(0x223)]=!0x0,this['_disposeWebsocket'](_0x228a34),this[_0x566b58(0x291)]();},_0x228a34[_0x3d333d(0x202)]=_0x3abea3=>{var _0x268f66=_0x3d333d;try{_0x3abea3&&_0x3abea3[_0x268f66(0x299)]&&this['_inBrowser']&&JSON[_0x268f66(0x270)](_0x3abea3[_0x268f66(0x299)])[_0x268f66(0x207)]===_0x268f66(0x23e)&&this[_0x268f66(0x22f)][_0x268f66(0x24d)][_0x268f66(0x23e)]();}catch{}};})['then'](_0x3b3c1e=>(this[_0x239aed(0x238)]=!0x0,this[_0x239aed(0x1e2)]=!0x1,this[_0x239aed(0x223)]=!0x1,this['_allowedToSend']=!0x0,this[_0x239aed(0x1e4)]=0x0,_0x3b3c1e))['catch'](_0x5bc6c2=>(this['_connected']=!0x1,this[_0x239aed(0x1e2)]=!0x1,_0x112b28(new Error(_0x239aed(0x26a)+(_0x5bc6c2&&_0x5bc6c2[_0x239aed(0x250)])))));}));}[_0x26e2c0(0x2a0)](_0x21a23d){var _0x4a5f16=_0x26e2c0;this['_connected']=!0x1,this['_connecting']=!0x1;try{_0x21a23d[_0x4a5f16(0x1dc)]=null,_0x21a23d[_0x4a5f16(0x237)]=null,_0x21a23d[_0x4a5f16(0x1d3)]=null;}catch{}try{_0x21a23d[_0x4a5f16(0x256)]<0x2&&_0x21a23d[_0x4a5f16(0x1e8)]();}catch{}}[_0x26e2c0(0x291)](){var _0x3637a3=_0x26e2c0;clearTimeout(this[_0x3637a3(0x21c)]),!(this[_0x3637a3(0x1e4)]>=this['_maxConnectAttemptCount'])&&(this[_0x3637a3(0x21c)]=setTimeout(()=>{var _0x1dead1=_0x3637a3;this[_0x1dead1(0x238)]||this['_connecting']||(this[_0x1dead1(0x1d9)](),this[_0x1dead1(0x213)]?.['catch'](()=>this[_0x1dead1(0x291)]()));},0x1f4),this[_0x3637a3(0x21c)][_0x3637a3(0x2a8)]&&this[_0x3637a3(0x21c)][_0x3637a3(0x2a8)]());}async[_0x26e2c0(0x285)](_0x23b003){var _0x30727c=_0x26e2c0;try{if(!this[_0x30727c(0x27e)])return;this[_0x30727c(0x223)]&&this[_0x30727c(0x1d9)](),(await this['_ws'])[_0x30727c(0x285)](JSON[_0x30727c(0x1ec)](_0x23b003));}catch(_0x2aeb5d){console['warn'](this[_0x30727c(0x234)]+':\\x20'+(_0x2aeb5d&&_0x2aeb5d[_0x30727c(0x250)])),this[_0x30727c(0x27e)]=!0x1,this[_0x30727c(0x291)]();}}};function _0x7b51(_0x38ad57,_0x1c2fae){var _0x2883ee=_0x2883();return _0x7b51=function(_0x7b5116,_0x180f90){_0x7b5116=_0x7b5116-0x1d1;var _0x5f581f=_0x2883ee[_0x7b5116];return _0x5f581f;},_0x7b51(_0x38ad57,_0x1c2fae);}function V(_0xf07280,_0x4bd3e6,_0x561676,_0x176ec0,_0x581eae){var _0x396b47=_0x26e2c0;let _0x1cad29=_0x561676[_0x396b47(0x26f)](',')[_0x396b47(0x1d6)](_0x32d2db=>{var _0x51e267=_0x396b47;try{_0xf07280[_0x51e267(0x21a)]||((_0x581eae==='next.js'||_0x581eae===_0x51e267(0x221)||_0x581eae==='astro')&&(_0x581eae+=_0xf07280[_0x51e267(0x28a)]?.[_0x51e267(0x1f1)]?.[_0x51e267(0x252)]?_0x51e267(0x20a):_0x51e267(0x224)),_0xf07280[_0x51e267(0x21a)]={'id':+new Date(),'tool':_0x581eae});let _0x30df24=new Q(_0xf07280,_0x4bd3e6,_0x32d2db,_0x176ec0);return _0x30df24['send'][_0x51e267(0x203)](_0x30df24);}catch(_0x599f9c){return console[_0x51e267(0x2b7)]('logger\\x20failed\\x20to\\x20connect\\x20to\\x20host',_0x599f9c&&_0x599f9c[_0x51e267(0x250)]),()=>{};}});return _0x2c7813=>_0x1cad29[_0x396b47(0x249)](_0x5a31f1=>_0x5a31f1(_0x2c7813));}function H(_0x39a902){var _0x184938=_0x26e2c0;let _0x5c6f17=function(_0x5df3ad,_0x577738){return _0x577738-_0x5df3ad;},_0x543c96;if(_0x39a902['performance'])_0x543c96=function(){var _0x11f074=_0x7b51;return _0x39a902[_0x11f074(0x25b)][_0x11f074(0x284)]();};else{if(_0x39a902[_0x184938(0x28a)]&&_0x39a902[_0x184938(0x28a)][_0x184938(0x1e5)])_0x543c96=function(){var _0x491978=_0x184938;return _0x39a902[_0x491978(0x28a)][_0x491978(0x1e5)]();},_0x5c6f17=function(_0x1a98c3,_0x1a495b){return 0x3e8*(_0x1a495b[0x0]-_0x1a98c3[0x0])+(_0x1a495b[0x1]-_0x1a98c3[0x1])/0xf4240;};else try{let {performance:_0x52c06f}=require(_0x184938(0x288));_0x543c96=function(){var _0x2145db=_0x184938;return _0x52c06f[_0x2145db(0x284)]();};}catch{_0x543c96=function(){return+new Date();};}}return{'elapsed':_0x5c6f17,'timeStamp':_0x543c96,'now':()=>Date[_0x184938(0x284)]()};}function X(_0x34b1d2,_0x3bcd2b,_0x5d518d){var _0x2ef393=_0x26e2c0;if(_0x34b1d2[_0x2ef393(0x287)]!==void 0x0)return _0x34b1d2[_0x2ef393(0x287)];let _0x2d1571=_0x34b1d2[_0x2ef393(0x28a)]?.[_0x2ef393(0x1f1)]?.[_0x2ef393(0x252)];return _0x2d1571&&_0x5d518d===_0x2ef393(0x1fd)?_0x34b1d2[_0x2ef393(0x287)]=!0x1:_0x34b1d2[_0x2ef393(0x287)]=_0x2d1571||!_0x3bcd2b||_0x34b1d2[_0x2ef393(0x24d)]?.[_0x2ef393(0x20c)]&&_0x3bcd2b[_0x2ef393(0x228)](_0x34b1d2[_0x2ef393(0x24d)][_0x2ef393(0x20c)]),_0x34b1d2[_0x2ef393(0x287)];}((_0x3c2030,_0x4111c2,_0x562ba1,_0x34bcf7,_0x14cb2e,_0x3a0ac2,_0x3d08fa,_0x5d445b,_0x54b6cb)=>{var _0xfac518=_0x26e2c0;if(_0x3c2030[_0xfac518(0x24e)])return _0x3c2030[_0xfac518(0x24e)];if(!X(_0x3c2030,_0x5d445b,_0x14cb2e))return _0x3c2030['_console_ninja']={'consoleLog':()=>{},'consoleTrace':()=>{},'consoleTime':()=>{},'consoleTimeEnd':()=>{},'autoLog':()=>{},'autoTrace':()=>{},'autoTime':()=>{},'autoTimeEnd':()=>{}},_0x3c2030[_0xfac518(0x24e)];let _0x2512fc={'props':0x64,'elements':0x64,'strLength':0x400*0x32,'totalStrLength':0x400*0x32,'autoExpandLimit':0x1388,'autoExpandMaxDepth':0xa},_0x221b92={'props':0x5,'elements':0x5,'strLength':0x100,'totalStrLength':0x100*0x3,'autoExpandLimit':0x1e,'autoExpandMaxDepth':0x2},_0x1bc17c=H(_0x3c2030),_0x187fcc=_0x1bc17c['elapsed'],_0x333b6e=_0x1bc17c[_0xfac518(0x266)],_0xd32590=_0x1bc17c[_0xfac518(0x284)],_0x3bc3e9={'hits':{},'ts':{}},_0x7daffa=_0x1a3290=>{_0x3bc3e9['ts'][_0x1a3290]=_0x333b6e();},_0x5e4019=(_0x4deb87,_0x25f664)=>{let _0x34e508=_0x3bc3e9['ts'][_0x25f664];if(delete _0x3bc3e9['ts'][_0x25f664],_0x34e508){let _0xdca87f=_0x187fcc(_0x34e508,_0x333b6e());_0x10a021(_0x303638('time',_0x4deb87,_0xd32590(),_0x476296,[_0xdca87f],_0x25f664));}},_0x31c61a=_0x156608=>_0x557f71=>{var _0x1ea78c=_0xfac518;try{_0x7daffa(_0x557f71),_0x156608(_0x557f71);}finally{_0x3c2030[_0x1ea78c(0x214)]['time']=_0x156608;}},_0x2fb0b9=_0x23e1a1=>_0x31d29d=>{var _0x48d8ed=_0xfac518;try{let [_0x5d9a27,_0x22948b]=_0x31d29d[_0x48d8ed(0x26f)](_0x48d8ed(0x235));_0x5e4019(_0x22948b,_0x5d9a27),_0x23e1a1(_0x5d9a27);}finally{_0x3c2030[_0x48d8ed(0x214)]['timeEnd']=_0x23e1a1;}};_0x3c2030[_0xfac518(0x24e)]={'consoleLog':(_0x305570,_0x110539)=>{var _0x145b1c=_0xfac518;_0x3c2030[_0x145b1c(0x214)][_0x145b1c(0x258)]['name']!==_0x145b1c(0x282)&&_0x10a021(_0x303638('log',_0x305570,_0xd32590(),_0x476296,_0x110539));},'consoleTrace':(_0x42e89a,_0x57532f)=>{var _0xebf80a=_0xfac518;_0x3c2030[_0xebf80a(0x214)][_0xebf80a(0x258)][_0xebf80a(0x273)]!==_0xebf80a(0x23f)&&_0x10a021(_0x303638('trace',_0x42e89a,_0xd32590(),_0x476296,_0x57532f));},'consoleTime':()=>{var _0x2a6f74=_0xfac518;_0x3c2030[_0x2a6f74(0x214)][_0x2a6f74(0x21b)]=_0x31c61a(_0x3c2030[_0x2a6f74(0x214)][_0x2a6f74(0x21b)]);},'consoleTimeEnd':()=>{var _0x134dcb=_0xfac518;_0x3c2030['console'][_0x134dcb(0x27b)]=_0x2fb0b9(_0x3c2030[_0x134dcb(0x214)][_0x134dcb(0x27b)]);},'autoLog':(_0x21d679,_0xb1aee0)=>{var _0x289fb2=_0xfac518;_0x10a021(_0x303638(_0x289fb2(0x258),_0xb1aee0,_0xd32590(),_0x476296,[_0x21d679]));},'autoTrace':(_0x1607a7,_0x3cff6c)=>{_0x10a021(_0x303638('trace',_0x3cff6c,_0xd32590(),_0x476296,[_0x1607a7]));},'autoTime':(_0x2eaef2,_0x21d161,_0x277743)=>{_0x7daffa(_0x277743);},'autoTimeEnd':(_0x5bc357,_0x1da053,_0x323481)=>{_0x5e4019(_0x1da053,_0x323481);}};let _0x10a021=V(_0x3c2030,_0x4111c2,_0x562ba1,_0x34bcf7,_0x14cb2e),_0x476296=_0x3c2030[_0xfac518(0x21a)];class _0x33de08{constructor(){var _0x4de291=_0xfac518;this[_0x4de291(0x2b1)]=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*$/,this[_0x4de291(0x1db)]=/^(0|[1-9][0-9]*)$/,this[_0x4de291(0x1f0)]=/'([^\\\\']|\\\\')*'/,this[_0x4de291(0x1d2)]=_0x3c2030[_0x4de291(0x28c)],this[_0x4de291(0x286)]=_0x3c2030['HTMLAllCollection'],this['_getOwnPropertyDescriptor']=Object['getOwnPropertyDescriptor'],this['_getOwnPropertyNames']=Object[_0x4de291(0x2a5)],this[_0x4de291(0x259)]=_0x3c2030[_0x4de291(0x26e)],this[_0x4de291(0x296)]=RegExp['prototype'][_0x4de291(0x210)],this[_0x4de291(0x25e)]=Date[_0x4de291(0x29a)][_0x4de291(0x210)];}[_0xfac518(0x265)](_0x36eb4f,_0x1eb9da,_0x3679e4,_0xba94cc){var _0x155a5e=_0xfac518,_0x39899b=this,_0x270cb4=_0x3679e4[_0x155a5e(0x27c)];function _0x2ca2b7(_0x1bdae1,_0x1f033e,_0x35b6df){var _0x10e3b8=_0x155a5e;_0x1f033e['type']=_0x10e3b8(0x22c),_0x1f033e[_0x10e3b8(0x236)]=_0x1bdae1[_0x10e3b8(0x250)],_0x221f50=_0x35b6df[_0x10e3b8(0x252)][_0x10e3b8(0x264)],_0x35b6df[_0x10e3b8(0x252)][_0x10e3b8(0x264)]=_0x1f033e,_0x39899b[_0x10e3b8(0x1e3)](_0x1f033e,_0x35b6df);}if(_0x1eb9da&&_0x1eb9da[_0x155a5e(0x231)])_0x2ca2b7(_0x1eb9da,_0x36eb4f,_0x3679e4);else try{_0x3679e4[_0x155a5e(0x2aa)]++,_0x3679e4[_0x155a5e(0x27c)]&&_0x3679e4[_0x155a5e(0x1f7)][_0x155a5e(0x1da)](_0x1eb9da);var _0x275789,_0x122eae,_0x537ffb,_0x29308f,_0x1f6347=[],_0x521204=[],_0x292e3d,_0x5d638b=this['_type'](_0x1eb9da),_0x4b12eb=_0x5d638b===_0x155a5e(0x230),_0x489de2=!0x1,_0x55f911=_0x5d638b==='function',_0x30e0bf=this[_0x155a5e(0x1d8)](_0x5d638b),_0x8f43cb=this[_0x155a5e(0x2b6)](_0x5d638b),_0x14a3fe=_0x30e0bf||_0x8f43cb,_0x1e723a={},_0x5a312a=0x0,_0x2beb9a=!0x1,_0x221f50,_0xb9f77c=/^(([1-9]{1}[0-9]*)|0)$/;if(_0x3679e4['depth']){if(_0x4b12eb){if(_0x122eae=_0x1eb9da['length'],_0x122eae>_0x3679e4[_0x155a5e(0x2ac)]){for(_0x537ffb=0x0,_0x29308f=_0x3679e4['elements'],_0x275789=_0x537ffb;_0x275789<_0x29308f;_0x275789++)_0x521204[_0x155a5e(0x1da)](_0x39899b[_0x155a5e(0x25a)](_0x1f6347,_0x1eb9da,_0x5d638b,_0x275789,_0x3679e4));_0x36eb4f[_0x155a5e(0x22e)]=!0x0;}else{for(_0x537ffb=0x0,_0x29308f=_0x122eae,_0x275789=_0x537ffb;_0x275789<_0x29308f;_0x275789++)_0x521204['push'](_0x39899b[_0x155a5e(0x25a)](_0x1f6347,_0x1eb9da,_0x5d638b,_0x275789,_0x3679e4));}_0x3679e4[_0x155a5e(0x1dd)]+=_0x521204['length'];}if(!(_0x5d638b===_0x155a5e(0x240)||_0x5d638b===_0x155a5e(0x28c))&&!_0x30e0bf&&_0x5d638b!==_0x155a5e(0x267)&&_0x5d638b!=='Buffer'&&_0x5d638b!==_0x155a5e(0x1df)){var _0xb39293=_0xba94cc['props']||_0x3679e4[_0x155a5e(0x2b0)];if(this[_0x155a5e(0x278)](_0x1eb9da)?(_0x275789=0x0,_0x1eb9da['forEach'](function(_0x2e6d30){var _0x5ce59a=_0x155a5e;if(_0x5a312a++,_0x3679e4[_0x5ce59a(0x1dd)]++,_0x5a312a>_0xb39293){_0x2beb9a=!0x0;return;}if(!_0x3679e4['isExpressionToEvaluate']&&_0x3679e4[_0x5ce59a(0x27c)]&&_0x3679e4[_0x5ce59a(0x1dd)]>_0x3679e4['autoExpandLimit']){_0x2beb9a=!0x0;return;}_0x521204[_0x5ce59a(0x1da)](_0x39899b[_0x5ce59a(0x25a)](_0x1f6347,_0x1eb9da,'Set',_0x275789++,_0x3679e4,function(_0x4663f3){return function(){return _0x4663f3;};}(_0x2e6d30)));})):this[_0x155a5e(0x1e0)](_0x1eb9da)&&_0x1eb9da[_0x155a5e(0x249)](function(_0x592510,_0x3d6712){var _0x3a47c0=_0x155a5e;if(_0x5a312a++,_0x3679e4[_0x3a47c0(0x1dd)]++,_0x5a312a>_0xb39293){_0x2beb9a=!0x0;return;}if(!_0x3679e4['isExpressionToEvaluate']&&_0x3679e4[_0x3a47c0(0x27c)]&&_0x3679e4[_0x3a47c0(0x1dd)]>_0x3679e4[_0x3a47c0(0x28b)]){_0x2beb9a=!0x0;return;}var _0x753bdc=_0x3d6712[_0x3a47c0(0x210)]();_0x753bdc['length']>0x64&&(_0x753bdc=_0x753bdc[_0x3a47c0(0x261)](0x0,0x64)+_0x3a47c0(0x206)),_0x521204['push'](_0x39899b[_0x3a47c0(0x25a)](_0x1f6347,_0x1eb9da,_0x3a47c0(0x272),_0x753bdc,_0x3679e4,function(_0x7f582e){return function(){return _0x7f582e;};}(_0x592510)));}),!_0x489de2){try{for(_0x292e3d in _0x1eb9da)if(!(_0x4b12eb&&_0xb9f77c['test'](_0x292e3d))&&!this[_0x155a5e(0x2ad)](_0x1eb9da,_0x292e3d,_0x3679e4)){if(_0x5a312a++,_0x3679e4[_0x155a5e(0x1dd)]++,_0x5a312a>_0xb39293){_0x2beb9a=!0x0;break;}if(!_0x3679e4[_0x155a5e(0x26b)]&&_0x3679e4[_0x155a5e(0x27c)]&&_0x3679e4[_0x155a5e(0x1dd)]>_0x3679e4['autoExpandLimit']){_0x2beb9a=!0x0;break;}_0x521204['push'](_0x39899b[_0x155a5e(0x241)](_0x1f6347,_0x1e723a,_0x1eb9da,_0x5d638b,_0x292e3d,_0x3679e4));}}catch{}if(_0x1e723a[_0x155a5e(0x28f)]=!0x0,_0x55f911&&(_0x1e723a[_0x155a5e(0x24c)]=!0x0),!_0x2beb9a){var _0xc9d8d9=[][_0x155a5e(0x216)](this[_0x155a5e(0x254)](_0x1eb9da))[_0x155a5e(0x216)](this[_0x155a5e(0x24b)](_0x1eb9da));for(_0x275789=0x0,_0x122eae=_0xc9d8d9[_0x155a5e(0x22a)];_0x275789<_0x122eae;_0x275789++)if(_0x292e3d=_0xc9d8d9[_0x275789],!(_0x4b12eb&&_0xb9f77c[_0x155a5e(0x29f)](_0x292e3d['toString']()))&&!this[_0x155a5e(0x2ad)](_0x1eb9da,_0x292e3d,_0x3679e4)&&!_0x1e723a[_0x155a5e(0x209)+_0x292e3d['toString']()]){if(_0x5a312a++,_0x3679e4[_0x155a5e(0x1dd)]++,_0x5a312a>_0xb39293){_0x2beb9a=!0x0;break;}if(!_0x3679e4[_0x155a5e(0x26b)]&&_0x3679e4[_0x155a5e(0x27c)]&&_0x3679e4[_0x155a5e(0x1dd)]>_0x3679e4[_0x155a5e(0x28b)]){_0x2beb9a=!0x0;break;}_0x521204[_0x155a5e(0x1da)](_0x39899b[_0x155a5e(0x241)](_0x1f6347,_0x1e723a,_0x1eb9da,_0x5d638b,_0x292e3d,_0x3679e4));}}}}}if(_0x36eb4f[_0x155a5e(0x20d)]=_0x5d638b,_0x14a3fe?(_0x36eb4f[_0x155a5e(0x247)]=_0x1eb9da[_0x155a5e(0x21f)](),this[_0x155a5e(0x22b)](_0x5d638b,_0x36eb4f,_0x3679e4,_0xba94cc)):_0x5d638b===_0x155a5e(0x2a3)?_0x36eb4f[_0x155a5e(0x247)]=this[_0x155a5e(0x25e)]['call'](_0x1eb9da):_0x5d638b===_0x155a5e(0x1df)?_0x36eb4f[_0x155a5e(0x247)]=_0x1eb9da[_0x155a5e(0x210)]():_0x5d638b===_0x155a5e(0x29d)?_0x36eb4f[_0x155a5e(0x247)]=this[_0x155a5e(0x296)][_0x155a5e(0x275)](_0x1eb9da):_0x5d638b===_0x155a5e(0x276)&&this['_Symbol']?_0x36eb4f[_0x155a5e(0x247)]=this[_0x155a5e(0x259)]['prototype'][_0x155a5e(0x210)][_0x155a5e(0x275)](_0x1eb9da):!_0x3679e4[_0x155a5e(0x2a1)]&&!(_0x5d638b===_0x155a5e(0x240)||_0x5d638b===_0x155a5e(0x28c))&&(delete _0x36eb4f[_0x155a5e(0x247)],_0x36eb4f['capped']=!0x0),_0x2beb9a&&(_0x36eb4f[_0x155a5e(0x25c)]=!0x0),_0x221f50=_0x3679e4['node'][_0x155a5e(0x264)],_0x3679e4[_0x155a5e(0x252)][_0x155a5e(0x264)]=_0x36eb4f,this[_0x155a5e(0x1e3)](_0x36eb4f,_0x3679e4),_0x521204[_0x155a5e(0x22a)]){for(_0x275789=0x0,_0x122eae=_0x521204['length'];_0x275789<_0x122eae;_0x275789++)_0x521204[_0x275789](_0x275789);}_0x1f6347[_0x155a5e(0x22a)]&&(_0x36eb4f[_0x155a5e(0x2b0)]=_0x1f6347);}catch(_0x364d86){_0x2ca2b7(_0x364d86,_0x36eb4f,_0x3679e4);}return this[_0x155a5e(0x1de)](_0x1eb9da,_0x36eb4f),this[_0x155a5e(0x244)](_0x36eb4f,_0x3679e4),_0x3679e4[_0x155a5e(0x252)][_0x155a5e(0x264)]=_0x221f50,_0x3679e4['level']--,_0x3679e4[_0x155a5e(0x27c)]=_0x270cb4,_0x3679e4[_0x155a5e(0x27c)]&&_0x3679e4[_0x155a5e(0x1f7)][_0x155a5e(0x245)](),_0x36eb4f;}[_0xfac518(0x24b)](_0x454bfc){var _0x56b73d=_0xfac518;return Object[_0x56b73d(0x2af)]?Object[_0x56b73d(0x2af)](_0x454bfc):[];}[_0xfac518(0x278)](_0x1d42d0){var _0x30c85b=_0xfac518;return!!(_0x1d42d0&&_0x3c2030[_0x30c85b(0x2b5)]&&this[_0x30c85b(0x200)](_0x1d42d0)===_0x30c85b(0x2a7)&&_0x1d42d0['forEach']);}[_0xfac518(0x2ad)](_0x33a665,_0xc6a8b8,_0x5cfa38){var _0x12cd99=_0xfac518;return _0x5cfa38[_0x12cd99(0x298)]?typeof _0x33a665[_0xc6a8b8]=='function':!0x1;}[_0xfac518(0x290)](_0x423ce0){var _0x4fd162=_0xfac518,_0x19ab8a='';return _0x19ab8a=typeof _0x423ce0,_0x19ab8a===_0x4fd162(0x2b2)?this['_objectToString'](_0x423ce0)===_0x4fd162(0x232)?_0x19ab8a='array':this[_0x4fd162(0x200)](_0x423ce0)===_0x4fd162(0x23d)?_0x19ab8a=_0x4fd162(0x2a3):this[_0x4fd162(0x200)](_0x423ce0)==='[object\\x20BigInt]'?_0x19ab8a=_0x4fd162(0x1df):_0x423ce0===null?_0x19ab8a='null':_0x423ce0[_0x4fd162(0x269)]&&(_0x19ab8a=_0x423ce0[_0x4fd162(0x269)][_0x4fd162(0x273)]||_0x19ab8a):_0x19ab8a==='undefined'&&this[_0x4fd162(0x286)]&&_0x423ce0 instanceof this[_0x4fd162(0x286)]&&(_0x19ab8a='HTMLAllCollection'),_0x19ab8a;}[_0xfac518(0x200)](_0x32f0b9){var _0x34fe04=_0xfac518;return Object[_0x34fe04(0x29a)][_0x34fe04(0x210)][_0x34fe04(0x275)](_0x32f0b9);}[_0xfac518(0x1d8)](_0x2b0008){var _0x4034f1=_0xfac518;return _0x2b0008==='boolean'||_0x2b0008===_0x4034f1(0x1fa)||_0x2b0008===_0x4034f1(0x1f4);}[_0xfac518(0x2b6)](_0x5d0d7f){var _0x86fd44=_0xfac518;return _0x5d0d7f===_0x86fd44(0x222)||_0x5d0d7f===_0x86fd44(0x267)||_0x5d0d7f===_0x86fd44(0x27f);}[_0xfac518(0x25a)](_0x122367,_0x3512a0,_0x2a22b5,_0x303ad0,_0x1436f3,_0x5e3aac){var _0x3e91e1=this;return function(_0x3a427c){var _0x11f0a3=_0x7b51,_0x134f35=_0x1436f3[_0x11f0a3(0x252)][_0x11f0a3(0x264)],_0x4115a5=_0x1436f3['node']['index'],_0x37e3e3=_0x1436f3[_0x11f0a3(0x252)]['parent'];_0x1436f3[_0x11f0a3(0x252)][_0x11f0a3(0x1f9)]=_0x134f35,_0x1436f3['node']['index']=typeof _0x303ad0==_0x11f0a3(0x1f4)?_0x303ad0:_0x3a427c,_0x122367['push'](_0x3e91e1[_0x11f0a3(0x27a)](_0x3512a0,_0x2a22b5,_0x303ad0,_0x1436f3,_0x5e3aac)),_0x1436f3['node'][_0x11f0a3(0x1f9)]=_0x37e3e3,_0x1436f3[_0x11f0a3(0x252)][_0x11f0a3(0x1f8)]=_0x4115a5;};}[_0xfac518(0x241)](_0x35d57c,_0x3a56e1,_0x150fa0,_0x5897f9,_0x32ea44,_0x583c2f,_0x1b672a){var _0x50ad83=_0xfac518,_0x59f708=this;return _0x3a56e1['_p_'+_0x32ea44[_0x50ad83(0x210)]()]=!0x0,function(_0x3d9e31){var _0x1cd652=_0x50ad83,_0x34004a=_0x583c2f[_0x1cd652(0x252)][_0x1cd652(0x264)],_0x3d58d1=_0x583c2f[_0x1cd652(0x252)][_0x1cd652(0x1f8)],_0x10a66f=_0x583c2f[_0x1cd652(0x252)][_0x1cd652(0x1f9)];_0x583c2f[_0x1cd652(0x252)][_0x1cd652(0x1f9)]=_0x34004a,_0x583c2f[_0x1cd652(0x252)]['index']=_0x3d9e31,_0x35d57c['push'](_0x59f708['_property'](_0x150fa0,_0x5897f9,_0x32ea44,_0x583c2f,_0x1b672a)),_0x583c2f[_0x1cd652(0x252)][_0x1cd652(0x1f9)]=_0x10a66f,_0x583c2f[_0x1cd652(0x252)]['index']=_0x3d58d1;};}[_0xfac518(0x27a)](_0x4c83cd,_0x4dc891,_0x402bbf,_0x52e386,_0xaf4b0e){var _0x282a96=_0xfac518,_0x2891cc=this;_0xaf4b0e||(_0xaf4b0e=function(_0x1c4e24,_0x3679b3){return _0x1c4e24[_0x3679b3];});var _0x1aa6e5=_0x402bbf[_0x282a96(0x210)](),_0x5b215a=_0x52e386[_0x282a96(0x1d5)]||{},_0x547af1=_0x52e386[_0x282a96(0x2a1)],_0x22f4d8=_0x52e386[_0x282a96(0x26b)];try{var _0x2c365c=this['_isMap'](_0x4c83cd),_0x419d56=_0x1aa6e5;_0x2c365c&&_0x419d56[0x0]==='\\x27'&&(_0x419d56=_0x419d56[_0x282a96(0x20b)](0x1,_0x419d56['length']-0x2));var _0x44bcc1=_0x52e386[_0x282a96(0x1d5)]=_0x5b215a[_0x282a96(0x209)+_0x419d56];_0x44bcc1&&(_0x52e386[_0x282a96(0x2a1)]=_0x52e386[_0x282a96(0x2a1)]+0x1),_0x52e386['isExpressionToEvaluate']=!!_0x44bcc1;var _0x495115=typeof _0x402bbf==_0x282a96(0x276),_0x51c80f={'name':_0x495115||_0x2c365c?_0x1aa6e5:this[_0x282a96(0x292)](_0x1aa6e5)};if(_0x495115&&(_0x51c80f[_0x282a96(0x276)]=!0x0),!(_0x4dc891===_0x282a96(0x230)||_0x4dc891===_0x282a96(0x25f))){var _0x317851=this[_0x282a96(0x215)](_0x4c83cd,_0x402bbf);if(_0x317851&&(_0x317851[_0x282a96(0x257)]&&(_0x51c80f[_0x282a96(0x246)]=!0x0),_0x317851[_0x282a96(0x205)]&&!_0x44bcc1&&!_0x52e386[_0x282a96(0x2a9)]))return _0x51c80f['getter']=!0x0,this[_0x282a96(0x20e)](_0x51c80f,_0x52e386),_0x51c80f;}var _0x5756a1;try{_0x5756a1=_0xaf4b0e(_0x4c83cd,_0x402bbf);}catch(_0x28d674){return _0x51c80f={'name':_0x1aa6e5,'type':_0x282a96(0x22c),'error':_0x28d674[_0x282a96(0x250)]},this[_0x282a96(0x20e)](_0x51c80f,_0x52e386),_0x51c80f;}var _0x239635=this['_type'](_0x5756a1),_0x1efa2=this[_0x282a96(0x1d8)](_0x239635);if(_0x51c80f[_0x282a96(0x20d)]=_0x239635,_0x1efa2)this[_0x282a96(0x20e)](_0x51c80f,_0x52e386,_0x5756a1,function(){var _0x3b9d16=_0x282a96;_0x51c80f['value']=_0x5756a1[_0x3b9d16(0x21f)](),!_0x44bcc1&&_0x2891cc['_capIfString'](_0x239635,_0x51c80f,_0x52e386,{});});else{var _0x33012a=_0x52e386['autoExpand']&&_0x52e386[_0x282a96(0x2aa)]<_0x52e386['autoExpandMaxDepth']&&_0x52e386[_0x282a96(0x1f7)]['indexOf'](_0x5756a1)<0x0&&_0x239635!==_0x282a96(0x279)&&_0x52e386[_0x282a96(0x1dd)]<_0x52e386['autoExpandLimit'];_0x33012a||_0x52e386[_0x282a96(0x2aa)]<_0x547af1||_0x44bcc1?(this[_0x282a96(0x265)](_0x51c80f,_0x5756a1,_0x52e386,_0x44bcc1||{}),this[_0x282a96(0x1de)](_0x5756a1,_0x51c80f)):this[_0x282a96(0x20e)](_0x51c80f,_0x52e386,_0x5756a1,function(){var _0x38beaa=_0x282a96;_0x239635===_0x38beaa(0x240)||_0x239635==='undefined'||(delete _0x51c80f[_0x38beaa(0x247)],_0x51c80f[_0x38beaa(0x23b)]=!0x0);});}return _0x51c80f;}finally{_0x52e386[_0x282a96(0x1d5)]=_0x5b215a,_0x52e386[_0x282a96(0x2a1)]=_0x547af1,_0x52e386[_0x282a96(0x26b)]=_0x22f4d8;}}['_capIfString'](_0x47882d,_0x203521,_0x3cece6,_0x367946){var _0x3b1e1f=_0xfac518,_0x7ab3fc=_0x367946[_0x3b1e1f(0x1d7)]||_0x3cece6[_0x3b1e1f(0x1d7)];if((_0x47882d==='string'||_0x47882d===_0x3b1e1f(0x267))&&_0x203521['value']){let _0x4d961d=_0x203521[_0x3b1e1f(0x247)][_0x3b1e1f(0x22a)];_0x3cece6[_0x3b1e1f(0x2a2)]+=_0x4d961d,_0x3cece6[_0x3b1e1f(0x2a2)]>_0x3cece6[_0x3b1e1f(0x1ff)]?(_0x203521[_0x3b1e1f(0x23b)]='',delete _0x203521[_0x3b1e1f(0x247)]):_0x4d961d>_0x7ab3fc&&(_0x203521[_0x3b1e1f(0x23b)]=_0x203521['value'][_0x3b1e1f(0x20b)](0x0,_0x7ab3fc),delete _0x203521[_0x3b1e1f(0x247)]);}}[_0xfac518(0x1e0)](_0x2d19fd){var _0x5be0ef=_0xfac518;return!!(_0x2d19fd&&_0x3c2030[_0x5be0ef(0x272)]&&this[_0x5be0ef(0x200)](_0x2d19fd)===_0x5be0ef(0x226)&&_0x2d19fd[_0x5be0ef(0x249)]);}[_0xfac518(0x292)](_0x10ea33){var _0x486cd1=_0xfac518;if(_0x10ea33['match'](/^\\d+$/))return _0x10ea33;var _0x2d4626;try{_0x2d4626=JSON['stringify'](''+_0x10ea33);}catch{_0x2d4626='\\x22'+this[_0x486cd1(0x200)](_0x10ea33)+'\\x22';}return _0x2d4626[_0x486cd1(0x29b)](/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)?_0x2d4626=_0x2d4626['substr'](0x1,_0x2d4626['length']-0x2):_0x2d4626=_0x2d4626[_0x486cd1(0x268)](/'/g,'\\x5c\\x27')[_0x486cd1(0x268)](/\\\\\"/g,'\\x22')[_0x486cd1(0x268)](/(^\"|\"$)/g,'\\x27'),_0x2d4626;}[_0xfac518(0x20e)](_0x5a3f52,_0x31632c,_0x505b7d,_0x4cbc85){var _0x45c2a8=_0xfac518;this[_0x45c2a8(0x1e3)](_0x5a3f52,_0x31632c),_0x4cbc85&&_0x4cbc85(),this['_additionalMetadata'](_0x505b7d,_0x5a3f52),this['_treeNodePropertiesAfterFullValue'](_0x5a3f52,_0x31632c);}[_0xfac518(0x1e3)](_0x18c6fc,_0x24aaa8){var _0x3e900c=_0xfac518;this[_0x3e900c(0x289)](_0x18c6fc,_0x24aaa8),this[_0x3e900c(0x243)](_0x18c6fc,_0x24aaa8),this[_0x3e900c(0x248)](_0x18c6fc,_0x24aaa8),this[_0x3e900c(0x24a)](_0x18c6fc,_0x24aaa8);}['_setNodeId'](_0x197a7f,_0x3573a9){}['_setNodeQueryPath'](_0x2915ed,_0x1f6947){}[_0xfac518(0x263)](_0x2255ec,_0x195851){}[_0xfac518(0x1fb)](_0x52d607){var _0x4cc553=_0xfac518;return _0x52d607===this[_0x4cc553(0x1d2)];}['_treeNodePropertiesAfterFullValue'](_0x26293f,_0x1497d8){var _0x3d05fa=_0xfac518;this[_0x3d05fa(0x263)](_0x26293f,_0x1497d8),this[_0x3d05fa(0x220)](_0x26293f),_0x1497d8[_0x3d05fa(0x1f5)]&&this[_0x3d05fa(0x260)](_0x26293f),this[_0x3d05fa(0x253)](_0x26293f,_0x1497d8),this[_0x3d05fa(0x201)](_0x26293f,_0x1497d8),this[_0x3d05fa(0x277)](_0x26293f);}[_0xfac518(0x1de)](_0x1a48fb,_0x25f8e9){var _0x2af9b4=_0xfac518;try{_0x1a48fb&&typeof _0x1a48fb['length']==_0x2af9b4(0x1f4)&&(_0x25f8e9[_0x2af9b4(0x22a)]=_0x1a48fb[_0x2af9b4(0x22a)]);}catch{}if(_0x25f8e9[_0x2af9b4(0x20d)]===_0x2af9b4(0x1f4)||_0x25f8e9[_0x2af9b4(0x20d)]===_0x2af9b4(0x27f)){if(isNaN(_0x25f8e9['value']))_0x25f8e9[_0x2af9b4(0x1f2)]=!0x0,delete _0x25f8e9[_0x2af9b4(0x247)];else switch(_0x25f8e9[_0x2af9b4(0x247)]){case Number[_0x2af9b4(0x26c)]:_0x25f8e9[_0x2af9b4(0x1f3)]=!0x0,delete _0x25f8e9['value'];break;case Number[_0x2af9b4(0x242)]:_0x25f8e9[_0x2af9b4(0x1e7)]=!0x0,delete _0x25f8e9[_0x2af9b4(0x247)];break;case 0x0:this['_isNegativeZero'](_0x25f8e9[_0x2af9b4(0x247)])&&(_0x25f8e9['negativeZero']=!0x0);break;}}else _0x25f8e9[_0x2af9b4(0x20d)]===_0x2af9b4(0x279)&&typeof _0x1a48fb[_0x2af9b4(0x273)]==_0x2af9b4(0x1fa)&&_0x1a48fb[_0x2af9b4(0x273)]&&_0x25f8e9[_0x2af9b4(0x273)]&&_0x1a48fb[_0x2af9b4(0x273)]!==_0x25f8e9[_0x2af9b4(0x273)]&&(_0x25f8e9['funcName']=_0x1a48fb[_0x2af9b4(0x273)]);}[_0xfac518(0x274)](_0x29967f){return 0x1/_0x29967f===Number['NEGATIVE_INFINITY'];}[_0xfac518(0x260)](_0xc14eca){var _0x1a87ac=_0xfac518;!_0xc14eca[_0x1a87ac(0x2b0)]||!_0xc14eca[_0x1a87ac(0x2b0)][_0x1a87ac(0x22a)]||_0xc14eca[_0x1a87ac(0x20d)]===_0x1a87ac(0x230)||_0xc14eca[_0x1a87ac(0x20d)]===_0x1a87ac(0x272)||_0xc14eca[_0x1a87ac(0x20d)]===_0x1a87ac(0x2b5)||_0xc14eca[_0x1a87ac(0x2b0)]['sort'](function(_0x18e40b,_0x9fe87e){var _0xc14ae5=_0x1a87ac,_0x419189=_0x18e40b[_0xc14ae5(0x273)][_0xc14ae5(0x1d4)](),_0x2b796b=_0x9fe87e[_0xc14ae5(0x273)]['toLowerCase']();return _0x419189<_0x2b796b?-0x1:_0x419189>_0x2b796b?0x1:0x0;});}[_0xfac518(0x253)](_0x3b8833,_0x37cb8b){var _0x334fda=_0xfac518;if(!(_0x37cb8b[_0x334fda(0x298)]||!_0x3b8833[_0x334fda(0x2b0)]||!_0x3b8833[_0x334fda(0x2b0)][_0x334fda(0x22a)])){for(var _0x15b00a=[],_0x9422b2=[],_0x4531c1=0x0,_0x10d956=_0x3b8833[_0x334fda(0x2b0)][_0x334fda(0x22a)];_0x4531c1<_0x10d956;_0x4531c1++){var _0x242256=_0x3b8833[_0x334fda(0x2b0)][_0x4531c1];_0x242256[_0x334fda(0x20d)]===_0x334fda(0x279)?_0x15b00a[_0x334fda(0x1da)](_0x242256):_0x9422b2[_0x334fda(0x1da)](_0x242256);}if(!(!_0x9422b2[_0x334fda(0x22a)]||_0x15b00a['length']<=0x1)){_0x3b8833[_0x334fda(0x2b0)]=_0x9422b2;var _0x1750d0={'functionsNode':!0x0,'props':_0x15b00a};this[_0x334fda(0x289)](_0x1750d0,_0x37cb8b),this['_setNodeLabel'](_0x1750d0,_0x37cb8b),this['_setNodeExpandableState'](_0x1750d0),this['_setNodePermissions'](_0x1750d0,_0x37cb8b),_0x1750d0['id']+='\\x20f',_0x3b8833['props']['unshift'](_0x1750d0);}}}[_0xfac518(0x201)](_0x9737b2,_0x4cb329){}['_setNodeExpandableState'](_0x3179e2){}[_0xfac518(0x1d1)](_0x1289c3){var _0x350d53=_0xfac518;return Array[_0x350d53(0x24f)](_0x1289c3)||typeof _0x1289c3==_0x350d53(0x2b2)&&this[_0x350d53(0x200)](_0x1289c3)===_0x350d53(0x232);}[_0xfac518(0x24a)](_0x4b7a9c,_0x34dc0b){}[_0xfac518(0x277)](_0x3354e3){var _0x4f1924=_0xfac518;delete _0x3354e3[_0x4f1924(0x21e)],delete _0x3354e3['_hasSetOnItsPath'],delete _0x3354e3['_hasMapOnItsPath'];}[_0xfac518(0x248)](_0x12ce64,_0x443737){}[_0xfac518(0x1eb)](_0x428811){var _0x210888=_0xfac518;return _0x428811?_0x428811[_0x210888(0x29b)](this[_0x210888(0x1db)])?'['+_0x428811+']':_0x428811[_0x210888(0x29b)](this[_0x210888(0x2b1)])?'.'+_0x428811:_0x428811[_0x210888(0x29b)](this[_0x210888(0x1f0)])?'['+_0x428811+']':'[\\x27'+_0x428811+'\\x27]':'';}}let _0xa9254c=new _0x33de08();function _0x303638(_0x311d30,_0x469526,_0x183155,_0x21b8dd,_0x20d5c4,_0x184e20){var _0x18cc7b=_0xfac518;let _0x5693f2,_0xe7c430;try{_0xe7c430=_0x333b6e(),_0x5693f2=_0x3bc3e9[_0x469526],!_0x5693f2||_0xe7c430-_0x5693f2['ts']>0x1f4&&_0x5693f2[_0x18cc7b(0x297)]&&_0x5693f2[_0x18cc7b(0x21b)]/_0x5693f2[_0x18cc7b(0x297)]<0x64?(_0x3bc3e9[_0x469526]=_0x5693f2={'count':0x0,'time':0x0,'ts':_0xe7c430},_0x3bc3e9[_0x18cc7b(0x1e6)]={}):_0xe7c430-_0x3bc3e9[_0x18cc7b(0x1e6)]['ts']>0x32&&_0x3bc3e9[_0x18cc7b(0x1e6)][_0x18cc7b(0x297)]&&_0x3bc3e9['hits'][_0x18cc7b(0x21b)]/_0x3bc3e9[_0x18cc7b(0x1e6)][_0x18cc7b(0x297)]<0x64&&(_0x3bc3e9[_0x18cc7b(0x1e6)]={});let _0x4ee8a1=[],_0x2725be=_0x5693f2[_0x18cc7b(0x208)]||_0x3bc3e9['hits']['reduceLimits']?_0x221b92:_0x2512fc,_0x15d24c=_0x494738=>{var _0x7f5e07=_0x18cc7b;let _0x59cda5={};return _0x59cda5[_0x7f5e07(0x2b0)]=_0x494738['props'],_0x59cda5[_0x7f5e07(0x2ac)]=_0x494738[_0x7f5e07(0x2ac)],_0x59cda5[_0x7f5e07(0x1d7)]=_0x494738['strLength'],_0x59cda5[_0x7f5e07(0x1ff)]=_0x494738[_0x7f5e07(0x1ff)],_0x59cda5[_0x7f5e07(0x28b)]=_0x494738[_0x7f5e07(0x28b)],_0x59cda5['autoExpandMaxDepth']=_0x494738['autoExpandMaxDepth'],_0x59cda5[_0x7f5e07(0x1f5)]=!0x1,_0x59cda5[_0x7f5e07(0x298)]=!_0x54b6cb,_0x59cda5[_0x7f5e07(0x2a1)]=0x1,_0x59cda5[_0x7f5e07(0x2aa)]=0x0,_0x59cda5[_0x7f5e07(0x271)]=_0x7f5e07(0x23a),_0x59cda5['rootExpression']=_0x7f5e07(0x25d),_0x59cda5[_0x7f5e07(0x27c)]=!0x0,_0x59cda5['autoExpandPreviousObjects']=[],_0x59cda5[_0x7f5e07(0x1dd)]=0x0,_0x59cda5[_0x7f5e07(0x2a9)]=!0x0,_0x59cda5[_0x7f5e07(0x2a2)]=0x0,_0x59cda5['node']={'current':void 0x0,'parent':void 0x0,'index':0x0},_0x59cda5;};for(var _0x4e0156=0x0;_0x4e0156<_0x20d5c4[_0x18cc7b(0x22a)];_0x4e0156++)_0x4ee8a1[_0x18cc7b(0x1da)](_0xa9254c[_0x18cc7b(0x265)]({'timeNode':_0x311d30===_0x18cc7b(0x21b)||void 0x0},_0x20d5c4[_0x4e0156],_0x15d24c(_0x2725be),{}));if(_0x311d30===_0x18cc7b(0x1f6)){let _0x1f92d0=Error[_0x18cc7b(0x2b3)];try{Error[_0x18cc7b(0x2b3)]=0x1/0x0,_0x4ee8a1[_0x18cc7b(0x1da)](_0xa9254c[_0x18cc7b(0x265)]({'stackNode':!0x0},new Error()[_0x18cc7b(0x26d)],_0x15d24c(_0x2725be),{'strLength':0x1/0x0}));}finally{Error[_0x18cc7b(0x2b3)]=_0x1f92d0;}}return{'method':_0x18cc7b(0x258),'version':_0x3a0ac2,'args':[{'ts':_0x183155,'session':_0x21b8dd,'args':_0x4ee8a1,'id':_0x469526,'context':_0x184e20}]};}catch(_0x5784d6){return{'method':_0x18cc7b(0x258),'version':_0x3a0ac2,'args':[{'ts':_0x183155,'session':_0x21b8dd,'args':[{'type':_0x18cc7b(0x22c),'error':_0x5784d6&&_0x5784d6[_0x18cc7b(0x250)]}],'id':_0x469526,'context':_0x184e20}]};}finally{try{if(_0x5693f2&&_0xe7c430){let _0x16ce6a=_0x333b6e();_0x5693f2[_0x18cc7b(0x297)]++,_0x5693f2[_0x18cc7b(0x21b)]+=_0x187fcc(_0xe7c430,_0x16ce6a),_0x5693f2['ts']=_0x16ce6a,_0x3bc3e9[_0x18cc7b(0x1e6)][_0x18cc7b(0x297)]++,_0x3bc3e9[_0x18cc7b(0x1e6)][_0x18cc7b(0x21b)]+=_0x187fcc(_0xe7c430,_0x16ce6a),_0x3bc3e9[_0x18cc7b(0x1e6)]['ts']=_0x16ce6a,(_0x5693f2[_0x18cc7b(0x297)]>0x32||_0x5693f2[_0x18cc7b(0x21b)]>0x64)&&(_0x5693f2[_0x18cc7b(0x208)]=!0x0),(_0x3bc3e9[_0x18cc7b(0x1e6)][_0x18cc7b(0x297)]>0x3e8||_0x3bc3e9[_0x18cc7b(0x1e6)]['time']>0x12c)&&(_0x3bc3e9[_0x18cc7b(0x1e6)]['reduceLimits']=!0x0);}}catch{}}}return _0x3c2030[_0xfac518(0x24e)];})(globalThis,'127.0.0.1','51961',_0x26e2c0(0x217),'webpack',_0x26e2c0(0x27d),_0x26e2c0(0x21d),[\"localhost\",\"127.0.0.1\",\"example.cypress.io\",\"csys\",\"192.168.178.20\"],_0x26e2c0(0x219));")}catch(e){}})().consoleLog(e,t)}catch(e){}return t}const _e=document.getElementById("canv"),ie=document.getElementById("fps"),ce=(document.getElementById("kloppenheim_02"),document.getElementById("slice-canvas")),oe=new class{constructor(){this.grid_size=9,this.voxel_count=24,this.direct_light_phi=0,this.direct_light_theta=0,this.ao_strength=.8,this.ambient_light=.2,this.grid=new Array(this.grid_size*this.grid_size*this.grid_size),this.meta_grid=new Array(this.grid_size*this.grid_size*this.grid_size),this.boundary_min=[-this.grid_size/2,-this.grid_size/2,-this.grid_size/2],this.boundary_max=[this.grid_size/2,this.grid_size/2,this.grid_size/2],this.voxel_size=this.grid_size/this.voxel_count,this.initialize_grid(),this.direct_light=Q.normalize([1.5,.6,3]),this.direct_light_brightness=1,this.background_color=[0,0,0],this.input_direct_light=document.getElementById("sun_strength"),this.input_direct_light.addEventListener("input",(e=>{this.direct_light_brightness=parseInt(this.input_direct_light.value)/50})),this.input_direct_light_phi=document.getElementById("sun_phi"),this.input_direct_light_theta=document.getElementById("sun_theta"),this.input_direct_light_phi.addEventListener("input",(e=>{this.updateDirectLight(parseInt(this.input_direct_light_phi.value),parseInt(this.input_direct_light_theta.value))})),this.input_direct_light_theta.addEventListener("input",(e=>{this.updateDirectLight(parseInt(this.input_direct_light_phi.value),parseInt(this.input_direct_light_theta.value))})),this.input_ao_strength=document.getElementById("ao_strength"),this.input_ao_strength.addEventListener("input",(e=>{this.ao_strength=parseInt(this.input_ao_strength.value)/100})),this.input_ambient_light=document.getElementById("ambient_light"),this.input_ambient_light.addEventListener("input",(e=>{this.ambient_light=parseInt(this.input_ambient_light.value)/100}))}updateDirectLight(e,t){this.direct_light_phi=e,this.direct_light_theta=t,this.direct_light=[Math.cos(K(t))*Math.cos(K(e)),Math.sin(K(t))*Math.cos(K(e)),Math.sin(K(e))]}serialize_scene(){return JSON.stringify(this)}deserialize_scene(e){const t=JSON.parse(e);this.grid=t.grid,this.grid_size=this.grid_size,this.boundary_min=t.boundary_min,this.boundary_max=t.boundary_max,this.voxel_count=t.voxel_count,this.direct_light=t.direct_light,this.direct_light_brightness=t.direct_light_brightness,this.input_direct_light.value=(100*t.direct_light_brightness).toString(),this.ao_strength=t.ao_strength,this.input_ao_strength.value=(100*t.ao_strength).toString(),this.ambient_light=t.ambient_light,this.input_ambient_light.value=(100*t.ambient_light).toString(),this.direct_light_phi=t.direct_light_phi,this.input_direct_light_phi.value=t.direct_light_phi.toString(),this.direct_light_theta=t.direct_light_theta,this.input_direct_light_theta.value=t.direct_light_theta.toString()}initialize_grid(){this.grid=new Array(this.voxel_count**3),this.meta_grid=new Array(this.voxel_count**3);for(let e=0;e<this.voxel_count;e++)for(let t=0;t<this.voxel_count;t++)for(let x=0;x<this.voxel_count;x++){let r=new xe;r.color=[0,0,0],r.opacity=0,this.grid[x*this.voxel_count*this.voxel_count+t*this.voxel_count+e]=r;let n=new re;this.meta_grid[x*this.voxel_count*this.voxel_count+t*this.voxel_count+e]=n}}initialize_default_grid(){for(let e=0;e<this.voxel_count;e++)for(let t=0;t<this.voxel_count;t++)for(let x=0;x<this.voxel_count;x++){let r=new xe;x<3&&(r.color=[e/this.voxel_count,t/this.voxel_count,x/this.voxel_count],Q.scale(r.color,2,r.color),r.opacity=1,r.lightness=0,r.roughness=1),r.color[0]=Math.min(1,r.color[0]),r.color[1]=Math.min(1,r.color[1]),r.color[2]=Math.min(1,r.color[2]),this.set_voxel_comp(r,e,t,x)}this.calc_gi()}calc_gi(){for(let e=0;e<this.voxel_count;e++)for(let t=0;t<this.voxel_count;t++)for(let x=0;x<this.voxel_count;x++){const r=new ee(this.get_voxel_center([e,t,x]),Q.inverse(this.direct_light));this.ray_any(r)||(this.meta_grid[this.get_voxel_id([e,t,x])].gi=Q.scale([1,1,1],this.direct_light_brightness))}}ray_any(e){let t=0,x=1/0;for(let r=0;r<3;r++){let n=(this.boundary_min[r]-e.origin[r])*e.inv_direction[r],a=(this.boundary_max[r]-e.origin[r])*e.inv_direction[r];t=Math.min(Math.max(n,t),Math.max(a,t)),x=Math.max(Math.min(n,x),Math.min(a,x))}if(t>x)return;const r=Q.add(e.origin,Q.scale(e.direction,t)),n=Q.add(e.origin,Q.scale(e.direction,x));let a=[Math.max(0,Math.min(this.voxel_count-1,Math.floor((r[0]-this.boundary_min[0])/this.voxel_size))),Math.max(0,Math.min(this.voxel_count-1,Math.floor((r[1]-this.boundary_min[1])/this.voxel_size))),Math.max(0,Math.min(this.voxel_count-1,Math.floor((r[2]-this.boundary_min[2])/this.voxel_size)))],_=[a[0]+1,a[1]+1,a[2]+1],i=[0,0,0],c=[0,0,0],o=[0,0,0],s=[0,0,0],l=t,d=[0,0,0];for(let l=0;l<3;l++)s[l]=Math.max(0,Math.min(this.voxel_count-1,Math.floor((n[l]-this.boundary_min[l])/this.voxel_size))),e.direction[l]>0?(i[l]=1,o[l]=this.voxel_size/e.direction[l],c[l]=t+(this.boundary_min[l]+_[l]*this.voxel_size-r[l])/e.direction[l]):e.direction[l]<0?(i[l]=-1,o[l]=this.voxel_size/-e.direction[l],c[l]=t+(this.boundary_min[l]+a[l]*this.voxel_size-r[l])/e.direction[l]):(i[l]=0,o[l]=x,c[l]=x);for(;a[0]<this.voxel_count&&a[0]>=0&&a[1]<this.voxel_count&&a[1]>=0&&a[2]<this.voxel_count&&a[2]>=0;){if(this.get_voxel(a).opacity>.01){const t=Q.add(e.origin,Q.scale(e.direction,l));return new te(t,a,this.get_voxel(a),d)}c[0]<c[1]&&c[0]<c[2]?(a[0]+=i[0],l=c[0],c[0]+=o[0],d=[-i[0],0,0]):c[1]<c[2]?(a[1]+=i[1],l=c[1],c[1]+=o[1],d=[0,-i[1],0]):(a[2]+=i[2],l=c[2],c[2]+=o[2],d=[0,0,-i[2]])}}get_voxel_center(e){return[e[0]*this.voxel_size-this.boundary_min[0],e[1]*this.voxel_size-this.boundary_min[1],e[2]*this.voxel_size-this.boundary_min[2]]}get_voxel_id_comp(e,t,x){return x*this.voxel_count*this.voxel_count+t*this.voxel_count+e}get_voxel_id(e){return e[2]*this.voxel_count*this.voxel_count+e[1]*this.voxel_count+e[0]}get_voxel_comp(e,t,x){return this.grid[x*this.voxel_count*this.voxel_count+t*this.voxel_count+e]}get_voxel(e){return this.grid[e[2]*this.voxel_count*this.voxel_count+e[1]*this.voxel_count+e[0]]}set_voxel(e,t){t[0]>0&&t[0]<this.voxel_count-1&&t[1]>0&&t[1]<this.voxel_count-1&&t[2]>0&&t[2]<this.voxel_count-1&&(this.grid[t[2]*this.voxel_count*this.voxel_count+t[1]*this.voxel_count+t[0]]=e)}set_voxel_comp(e,t,x,r){t>0&&t<this.voxel_count-1&&x>0&&x<this.voxel_count-1&&r>0&&r<this.voxel_count-1&&(this.grid[r*this.voxel_count*this.voxel_count+x*this.voxel_count+t]=e)}};let se=new class{constructor(e,t,x,r,n){this.mouse_down=!1,this.mouse_dragged=!1,this.over_canvas=!1,this.last_move=0,this.velocity=[0,0],this.selected_color=[0,0,0],this.selected_roughness=1,this.selected_opacity=1,this.selected_lightness=0,this.multidraw=!1,this.last_drawn=[0,0,0],this.camera=new ne(x,r,n),this.last_move=performance.now(),this.last_movement=[0,0],this.scene=e,this.canvas=t,this.selected_tool="place",this.blub_high=document.getElementById("blub_high"),this.blub_low=document.getElementById("blub_low"),this.setup()}tick(e){this.camera.tick(e)}setup(){var e,t,x,r,n,a,_;this.canvas.addEventListener("mouseover",(e=>{this.over_canvas=!0})),this.canvas.addEventListener("mouseout",(e=>{this.over_canvas=!1})),addEventListener("mousedown",(e=>{this.over_canvas&&0==e.button&&(e.shiftKey&&(this.multidraw=!0),this.mouse_down=!0,this.mouse_dragged=!1,this.camera.dragged=!0,this.last_move=performance.now())})),addEventListener("mouseup",(e=>{if(0==e.button&&(this.mouse_down&&(this.camera.velocity=[...this.velocity]),this.mouse_down=!1,this.camera.dragged=!1,this.multidraw=!1,!this.mouse_dragged)){const t=this.canvas.getBoundingClientRect(),x=e.clientX-t.left,r=e.clientY-t.top;let n=this.scene.ray_any(this.camera.screen_to_ray(x,r,t.width,t.height));if(n)switch(this.selected_tool){case"place":let e=new xe;e.color=this.selected_color,e.roughness=this.selected_roughness,e.lightness=this.selected_lightness,e.opacity=this.selected_opacity;let t=n.voxel_position.map(((e,t)=>e+n.normal[t]));this.scene.set_voxel(e,t),this.blub_high.play(),this.last_drawn=t;break;case"replace":let x=new xe;x.color=this.selected_color,x.roughness=this.selected_roughness,x.lightness=this.selected_lightness,x.opacity=this.selected_opacity,this.scene.set_voxel(x,n.voxel_position),this.blub_high.play(),this.last_drawn=n.voxel_position;break;case"remove":let r=new xe;r.opacity=0,this.scene.set_voxel(r,n.voxel_position),this.blub_low.play()}}})),addEventListener("mousemove",(e=>{if(this.last_movement=S.scale([e.movementX,e.movementY],.2),this.mouse_down&&(this.mouse_drag(e),this.multidraw)){const t=this.canvas.getBoundingClientRect(),x=e.clientX-t.left,r=e.clientY-t.top;let n=this.scene.ray_any(this.camera.screen_to_ray(x,r,t.width,t.height));if(n&&n.voxel_position.toString()!==this.last_drawn.toString()){if("place"==this.selected_tool){let e=new xe;e.color=this.selected_color,e.roughness=this.selected_roughness,e.lightness=this.selected_lightness,e.opacity=this.selected_opacity;let t=n.voxel_position.map(((e,t)=>e+n.normal[t]));this.scene.set_voxel(e,t),this.blub_high.play(),this.last_drawn=t}if("replace"==this.selected_tool){let e=new xe;e.color=this.selected_color,e.roughness=this.selected_roughness,e.lightness=this.selected_lightness,e.opacity=this.selected_opacity,this.scene.set_voxel(e,n.voxel_position),this.blub_high.play(),this.last_drawn=n.voxel_position}if("remove"==this.selected_tool){let e=new xe;e.opacity=0,this.scene.set_voxel(e,n.voxel_position),this.blub_low.play();let a=this.scene.ray_any(this.camera.screen_to_ray(x,r,t.width,t.height));a&&(this.last_drawn=a.voxel_position)}}}this.calculate_velocity(),this.last_move=performance.now()})),null===(e=document.getElementById("color_value"))||void 0===e||e.addEventListener("input",(e=>{var t;const x=e.target.value;this.selected_color=Q.scale(null===(t=x.match(/\w\w/g))||void 0===t?void 0:t.map((e=>parseInt(e,16))),1/255)})),null===(t=document.getElementById("roughness_value"))||void 0===t||t.addEventListener("input",(e=>{this.selected_roughness=1-parseInt(e.target.value)/100})),null===(x=document.getElementById("lightness_value"))||void 0===x||x.addEventListener("input",(e=>{this.selected_lightness=parseInt(e.target.value)/25})),null===(r=document.getElementById("opacity_value"))||void 0===r||r.addEventListener("input",(e=>{this.selected_opacity=parseInt(e.target.value)/100})),null===(n=document.getElementById("tool-place-button"))||void 0===n||n.addEventListener("change",(e=>{this.selected_tool="place"})),null===(a=document.getElementById("tool-replace-button"))||void 0===a||a.addEventListener("change",(e=>{this.selected_tool="replace"})),null===(_=document.getElementById("tool-remove-button"))||void 0===_||_.addEventListener("change",(e=>{this.selected_tool="remove"}))}calculate_velocity(){const e=performance.now()-this.last_move;S.scale(this.last_movement,1/e,this.velocity)}mouse_drag(e){this.multidraw||(this.camera.eulers[1]=this.camera.eulers[1]-this.last_movement[1],this.camera.eulers[2]=this.camera.eulers[2]-this.last_movement[0],this.mouse_dragged=!0)}}(oe,_e,12,0,0),le=new class{constructor(e,t,x){this.initialized=!1,this.render=()=>{var e,t,x,r,n,a,_;if(!this.initialized)return;let i=[];for(let e=0;e<this.scene.voxel_count;e++)for(let t=0;t<this.scene.voxel_count;t++)for(let x=0;x<this.scene.voxel_count;x++)this.scene.get_voxel([e,t,x]).lightness>0&&i.push([e,t,x]);null===(e=this.device)||void 0===e||e.queue.writeBuffer(this.sceneParameters,0,new Float32Array([this.camera.position[0],this.camera.position[1],this.camera.position[2],(new Date).getMilliseconds(),this.camera.forward[0],this.camera.forward[1],this.camera.forward[2],i.length,this.camera.right[0],this.camera.right[1],this.camera.right[2],this.scene.ao_strength,this.camera.up[0],this.camera.up[1],this.camera.up[2],this.scene.ambient_light,this.scene.direct_light[0],this.scene.direct_light[1],this.scene.direct_light[2],this.scene.direct_light_brightness,this.scene.background_color[0],this.scene.background_color[1],this.scene.background_color[2],0]),0,24);const c=new Float32Array(4*i.length);for(let e=0;e<i.length;++e)c[4*e]=i[e][0],c[4*e+1]=i[e][1],c[4*e+2]=i[e][2],c[4*e+3]=0;null===(t=this.device)||void 0===t||t.queue.writeBuffer(this.lightData,0,c,0,4*i.length);const o=new Float32Array(8*this.scene.grid.length);for(let e=0;e<this.scene.grid.length;++e)o[8*e]=this.scene.grid[e].color[0],o[8*e+1]=this.scene.grid[e].color[1],o[8*e+2]=this.scene.grid[e].color[2],o[8*e+3]=this.scene.grid[e].opacity,o[8*e+4]=this.scene.grid[e].roughness,o[8*e+5]=this.scene.grid[e].lightness,o[8*e+6]=0,o[8*e+7]=0;const s=new Float32Array(8*this.scene.grid.length);for(let e=0;e<this.scene.grid.length;++e)s[8*e]=this.scene.meta_grid[e].gi[0],s[8*e+1]=this.scene.meta_grid[e].gi[1],s[8*e+2]=this.scene.meta_grid[e].gi[2],s[8*e+3]=0,s[8*e+4]=0,s[8*e+5]=0,s[8*e+6]=0,s[8*e+7]=0;null===(x=this.device)||void 0===x||x.queue.writeBuffer(this.sceneData,0,o,0,8*this.scene.grid.length),null===(r=this.device)||void 0===r||r.queue.writeBuffer(this.sceneMetaData,0,s,0,8*this.scene.grid.length);const l=null===(n=this.device)||void 0===n?void 0:n.createCommandEncoder(),d=null==l?void 0:l.beginComputePass();null==d||d.setPipeline(this.ray_tracing_pipeline),null==d||d.setBindGroup(0,this.ray_tracing_bind_group),null==d||d.dispatchWorkgroups(this.canvas.width/16,this.canvas.height/16,1),null==d||d.end();const f=null===(a=this.context)||void 0===a?void 0:a.getCurrentTexture().createView(),h=null==l?void 0:l.beginRenderPass({colorAttachments:[{view:f,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}]});null==h||h.setPipeline(this.screen_pipeline),null==h||h.setBindGroup(0,this.screen_bind_group),null==h||h.draw(6,1,0,0),null==h||h.end(),null===(_=this.device)||void 0===_||_.queue.submit([null==l?void 0:l.finish()])},this.canvas=e,this.scene=t,this.pathtracing=!1,this.camera=x}initialize(e){return t(this,void 0,void 0,(function*(){this.pathtracing=e,yield this.setupDevice(),yield this.createAssets(),yield this.setupPipeline(),this.initialized=!0}))}set_hdr(e){}shutdown(){var e,t,x;this.initialized=!1,null===(e=this.device)||void 0===e||e.destroy(),null===(t=this.color_buffer)||void 0===t||t.destroy(),null===(x=this.secondary_buffer)||void 0===x||x.destroy()}setupDevice(){var e,x;return t(this,void 0,void 0,(function*(){this.adapter=yield null===(e=navigator.gpu)||void 0===e?void 0:e.requestAdapter(),this.device=yield null===(x=this.adapter)||void 0===x?void 0:x.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}))}createAssets(){var e,x,r,n,a,_,i,c,o;return t(this,void 0,void 0,(function*(){this.color_buffer=null===(e=this.device)||void 0===e?void 0:e.createTexture({size:{width:this.canvas.width,height:this.canvas.height},format:"rgba8unorm",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING}),this.secondary_buffer=null===(x=this.device)||void 0===x?void 0:x.createTexture({size:{width:this.canvas.width,height:this.canvas.height},format:"rgba8unorm",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING}),this.color_buffer_view=null===(r=this.color_buffer)||void 0===r?void 0:r.createView(),this.secondary_buffer_view=null===(n=this.secondary_buffer)||void 0===n?void 0:n.createView(),this.sampler=null===(a=this.device)||void 0===a?void 0:a.createSampler({addressModeU:"repeat",addressModeV:"repeat",magFilter:"linear",minFilter:"nearest",mipmapFilter:"nearest",maxAnisotropy:1}),this.sceneParameters=null===(_=this.device)||void 0===_?void 0:_.createBuffer({size:96,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const t=this.scene.voxel_count*this.scene.voxel_count*this.scene.voxel_count;this.sceneData=null===(i=this.device)||void 0===i?void 0:i.createBuffer({size:8*t*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.sceneMetaData=null===(c=this.device)||void 0===c?void 0:c.createBuffer({size:8*t*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.lightData=null===(o=this.device)||void 0===o?void 0:o.createBuffer({size:512,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})}))}setupPipeline(){var x,r,n,a,_,i,c,o;return t(this,void 0,void 0,(function*(){const t=null===(x=this.device)||void 0===x?void 0:x.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm",viewDimension:"2d"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:4,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm",viewDimension:"2d"}},{binding:5,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}}]});this.ray_tracing_bind_group=null===(r=this.device)||void 0===r?void 0:r.createBindGroup({layout:t,label:"Ray tracing bind group",entries:[{binding:0,resource:this.color_buffer_view},{binding:1,resource:{buffer:this.sceneParameters}},{binding:2,resource:{buffer:this.sceneData}},{binding:3,resource:{buffer:this.lightData}},{binding:4,resource:this.secondary_buffer_view},{binding:5,resource:{buffer:this.sceneMetaData}}]});const s=null===(n=this.device)||void 0===n?void 0:n.createPipelineLayout({bindGroupLayouts:[t]});this.ray_tracing_pipeline=null===(a=this.device)||void 0===a?void 0:a.createComputePipeline({label:"Ray tracing pipeline",layout:s,compute:{entryPoint:"main",module:this.device.createShaderModule({code:"@group(0) @binding(0) var color_buffer: texture_storage_2d<rgba8unorm, write>;\r\n@group(0) @binding(1) var<uniform> scene: SceneParameter;\r\n@group(0) @binding(2) var<storage, read> scene_data: SceneData;\r\n// @group(0) @binding(3) var hdr_tex: texture_2d<f32>;\r\n// @group(0) @binding(4) var hdr_sampler: sampler;\r\n@group(0) @binding(3) var<storage, read> lights: LightData;\r\n@group(0) @binding(4) var secondary_buffer: texture_storage_2d<rgba8unorm, write>;\r\n@group(0) @binding(5) var<storage, read> scene_meta_data: SceneMetaData;\r\n\r\noverride grid_size: f32 = 2f;\r\noverride voxel_count: i32 = 4;\r\nvar<private> voxel_size: f32 = grid_size / f32(voxel_count);\r\nvar<private> boundary_min: vec3<f32> = vec3<f32>(f32(-grid_size) / 2, f32(-grid_size) / 2, f32(-grid_size) / 2);\r\nvar<private> boundary_max: vec3<f32> = vec3<f32>(f32(grid_size) / 2, f32(grid_size) / 2, f32(grid_size) / 2);\r\nvar<private> depth_clip_min: f32 = 1f;\r\nvar<private> depth_clip_max: f32 = 10f;\r\n\r\nvar<private> rng_seed: u32;\r\nvar<private> rng_seed_steady: u32;\r\n\r\nconst samples: i32 = 1;\r\nconst light_bounces: i32 = 3;\r\nconst max_penetrations: i32 = 3;\r\nconst reflection_bounces: i32 = 3;\r\nconst scatter: i32 = 5;\r\n// const ambient_light: f32 = 0.03;\r\nconst pi = 3.14159265359;\r\n\r\n// const background: vec3<f32> = vec3<f32>(24f / 255f, 24f / 255f, 37f / 255f);\r\n\r\nstruct SceneParameter {\r\n    camera_pos: vec3<f32>,\r\n    rng_start: f32,\r\n    camera_forward: vec3<f32>,\r\n    light_count: f32,\r\n    camera_right: vec3<f32>,\r\n\tao_strength: f32,\r\n    camera_up: vec3<f32>,\r\n\tambient_light: f32,\r\n    direct_light: vec3<f32>,\r\n    direct_light_brightness: f32,\r\n\tbackground_color: vec3<f32>,\r\n}\r\n\r\nstruct Voxel {\r\n\tcolor: vec3<f32>,\r\n\topacity: f32,\r\n\troughness: f32,\r\n\tlightness: f32,\r\n}\r\n\r\nstruct MetaVoxel {\r\n\tgi: vec3<f32>,\r\n\tsomethingelse: vec3<f32>\r\n}\r\n\r\nstruct SceneData {\r\n\tdata: array<Voxel>,\r\n}\r\n\r\nstruct SceneMetaData {\r\n\tdata: array<MetaVoxel>,\r\n}\r\n\r\nstruct LightData {\r\n\tdata: array<Light>,\r\n}\r\n\r\nstruct Light {\r\n\tlocation: vec3<f32>,\r\n\temitter_type: f32,\r\n}\r\n\r\nstruct Ray {\r\n    origin: vec3<f32>,\r\n    direction: vec3<f32>,\r\n    inv_direction: vec3<f32>,\r\n}\r\n\r\nstruct RayHit {\r\n\tposition: vec3<f32>,\r\n\tdepth: f32,\r\n\tvoxel_position: vec3<i32>,\r\n\tvoxel: Voxel,\r\n\tnormal: vec3<f32>,\r\n\tray_direction: vec3<f32>,\r\n\texit_position: vec3<f32>,\r\n\tao: f32,\r\n\tuv: vec2<f32>,\r\n}\r\n\r\nstruct TraceResult {\r\n\tcolor: vec3<f32>,\r\n\tao: f32,\r\n}\r\n\r\n@compute @workgroup_size(16,16,1)\r\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {\r\n    let screen_size: vec2<u32> = textureDimensions(color_buffer);\r\n    let screen_pos : vec2<i32> = vec2<i32>(i32(GlobalInvocationID.x), i32(GlobalInvocationID.y));\r\n    // rng_seed = GlobalInvocationID.x + 50 + (GlobalInvocationID.y + 50) * (GlobalInvocationID.x + 100) * 1000 * u32(scene.rng_start);\r\n    rng_seed = GlobalInvocationID.x + 50 + (GlobalInvocationID.y + 50) * (GlobalInvocationID.x + 100) * 1000;\r\n    rng_seed_steady = GlobalInvocationID.x + 150 + (GlobalInvocationID.y + 75) * (GlobalInvocationID.x + 350) * 1000;\r\n\r\n    var pixel_color: vec3<f32>;\r\n    var pixel_ao: f32;\r\n    for (var i = 0; i < samples; i++){\r\n\r\n\t    let rng_offset: vec2<f32> = select(vec2<f32>(0), vec2<f32>(rng() - 0.5, rng() - 0.5), samples > 1);\r\n\t    let horizontal_coefficient: f32 = (f32(screen_pos.x) + rng_offset.x - f32(screen_size.x) / 2) / f32(screen_size.x);\r\n\t    let vertical_coefficient: f32 = (f32(screen_pos.y) + rng_offset.y - f32(screen_size.y) / 2) / -f32(screen_size.y);\r\n\r\n\t    let ray_direction = normalize(scene.camera_forward\r\n\t\t\t    + horizontal_coefficient * scene.camera_right\r\n\t\t\t    + vertical_coefficient * scene.camera_up);\r\n\t    let ray: Ray = Ray(scene.camera_pos, ray_direction, 1 / ray_direction);\r\n\t    let trace_result = trace(ray, light_bounces);\r\n\t    // pixel_color += trace(ray, light_bounces);\r\n\t    // pixel_color += trace_result.color;\r\n\t    pixel_color += trace_result;\r\n\t    // pixel_ao += trace_result.ao;\r\n    }\r\n\r\n    // let correction = 1.0 / f32(samples);\r\n    // pixel_color = sqrt(correction * pixel_color);\r\n\r\n\tpixel_color /= f32(samples);\r\n\t// pixel_ao /= f32(samples);\r\n\r\n    /* pixel_color = textureSampleLevel(hdr_tex, hdr_sampler, vec2<f32>(f32(GlobalInvocationID.x) / f32(screen_size.x), f32(GlobalInvocationID.y) / f32(screen_size.y) * 2), 0.0).rgb; */\r\n\r\n    textureStore(color_buffer, screen_pos, vec4<f32>(pixel_color, 1.0));\r\n    // textureStore(secondary_buffer, screen_pos, vec4<f32>(pixel_ao, 0, 0, 1.0));\r\n}\r\n\r\nfn rng_hash(seed: u32) -> u32 {\r\n\tvar x = ( seed << 10u );\r\n\tx ^= ( x >>  6u );\r\n\tx += ( x <<  3u );\r\n\tx ^= ( x >> 11u );\r\n\tx += ( x << 15u );\r\n\treturn x;\r\n}\r\n\r\nfn rng() -> f32 {\r\n\trng_seed++;\r\n\treturn bitcast<f32>((rng_hash(rng_seed) >> 9) | 0x3f800000 ) - 1.0;\r\n}\r\n\r\nfn rng_steady() -> f32 {\r\n\trng_seed_steady++;\r\n\treturn bitcast<f32>((rng_hash(rng_seed_steady) >> 9) | 0x3f800000 ) - 1.0;\r\n}\r\n\r\nfn ray_reflect(ray: Ray, position: vec3<f32>, normal: vec3<f32>) -> Ray {\r\n\tlet reflect = ray.direction - 2 * dot(ray.direction, normal) * normal;\r\n\treturn Ray(position, reflect, 1 / reflect);\r\n}\r\n\r\nfn get_voxel_id(v: vec3<i32>) -> i32 {\r\n\treturn v.z * voxel_count * voxel_count + v.y * voxel_count + v.x;\r\n}\r\n\r\nfn get_voxel(v: vec3<i32>) -> Voxel {\r\n\treturn scene_data.data[v.z * voxel_count * voxel_count + v.y * voxel_count + v.x];\r\n}\r\n\r\nfn get_meta_voxel(v: vec3<i32>) -> MetaVoxel {\r\n\treturn scene_meta_data.data[v.z * voxel_count * voxel_count + v.y * voxel_count + v.x];\r\n}\r\n\r\nfn get_voxel_by_position(v: vec3<f32>) -> Voxel {\r\n\treturn get_voxel(vec3<i32>((v - boundary_min) / f32(voxel_size)));\r\n}\r\n\r\nfn sample_spherical_map(v: vec3<f32>) -> vec2<f32> {\r\n\tlet theta = atan2(v.x, v.y);\r\n\tlet phi = acos(v.z);\r\n\tlet raw_u = theta / (2 * pi);\r\n\tlet uv = vec2<f32>(\r\n\t\t1 - (raw_u + 0.5),\r\n\t\tphi / pi\r\n\t);\r\n\treturn uv;\r\n}\r\n\r\nfn random_unit_vector() -> vec3<f32> {\r\n\tlet phi = rng() * pi * 2;\r\n\tlet costheta = rng() * 2 - 1;\r\n\t\tlet theta = acos(costheta);\r\n\tlet x = sin(theta) * cos(phi);\r\n\tlet y = sin(theta) * sin(phi);\r\n\tlet z = cos(theta);\r\n\treturn vec3<f32>(x, y, z);\r\n}\r\n"+(this.pathtracing?"const light_scatter_samples: i32 = 2;\r\n\r\nfn gamma_correct(color: vec3<f32>) -> vec3<f32> {\r\n    let correction = 1.0 / f32(samples);\r\n    return sqrt(correction * color);\r\n}\r\n\r\nfn trace(ray: Ray, depth: i32) -> vec3<f32> {\r\n\tif (depth <= 0) {\r\n\t\treturn vec3<f32>(0);\r\n\t}\r\n\t\tvar accum: vec3<f32> = vec3<f32>(0.0);\r\n\t\tvar mask: vec3<f32> = vec3<f32>(1.0);\r\n\t\tvar curr_ray: Ray = ray;\r\n\t\tvar curr_hit: RayHit;\r\n\t\tvar refl: f32 = 1.0;\r\n\t\tvar hits: i32 = 0;\r\n\r\n\t\tvar bounce_results: array<RayHit, light_bounces>;\r\n\r\n\t\tfor (; hits < light_bounces;){\r\n\t\t\tif (voxel_ray_any(curr_ray, 0.0001, &curr_hit)) {\r\n\t\t\t\tlet bounce_direction = random_unit_vector() + curr_hit.normal;\r\n\t\t\t\tif (all(bounce_direction == vec3<f32>(0))){\r\n\t\t\t\t\tcurr_ray = Ray(curr_hit.position, curr_hit.normal, 1 / curr_hit.normal);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet normalized = normalize(bounce_direction);\r\n\t\t\t\t\tcurr_ray = Ray(curr_hit.position, normalized, 1 / normalized);\r\n\t\t\t\t}\r\n\t\t\t\tbounce_results[hits] = curr_hit;\r\n\t\t\t\thits++;\r\n\t\t\t} else {\r\n\t\t\t\t// accum = pow(textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(curr_ray.direction), 0.0).rgb, vec3<f32>(2)) * 5;\r\n\t\t\t\taccum = vec3<f32>(pow(max(0, dot(curr_ray.direction, scene.direct_light) - 0.98) * 40, 1));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (hits == 0){\r\n\t\t\t// return textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(ray.direction), 0.0).rgb;\r\n\t\t\treturn vec3<f32>(pow(max(0, dot(ray.direction, scene.direct_light) - 0.95) * 20, 1));\r\n\t\t}\r\n\t\tif (hits == light_bounces){\r\n\t\t\taccum = vec3<f32>(0, 0, 0);\r\n\t\t} else {\r\n\t\t\t// accum = textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(bounce_results[hits - 1].ray_direction), 0.0).rgb;\r\n\t\t\t/* accum = vec3<f32>(max(0, dot(bounce_results[hits - 1].ray_direction, scene.direct_light))); */\r\n\t\t\t// accum = vec3<f32>(0);\r\n\t\t}\r\n\t\tfor (var i: i32 = hits - 1; i >= 0; i--){\r\n\t\t\tlet bounce = bounce_results[i];\r\n\t\t\t/* accum = min(vec3<f32>(1), accum) * min(vec3<f32>(1), bounce.voxel.color); */\r\n\t\t\taccum = accum * bounce.voxel.color\r\n\t\t\t\t+ bounce_results[i].voxel.lightness * bounce_results[i].voxel.color;\r\n\t\t\t// if (all(bounce.normal == vec3<f32>(0)) && all(bounce.ray_direction == vec3<f32>(0))){\r\n\t\t\t// \t// accum = textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(bounce_results[i].ray_direction), 0.0).rgb;\r\n\t\t\t// \taccum = vec3<f32>(0.5);\r\n\t\t\t// \tcontinue;\r\n\t\t\t// }\r\n\t\t\t// accum = accum * bounce.voxel.color;\r\n\t\t\t// accum = accum * bounce.voxel.color;\r\n\t\t}\r\n\treturn accum; // / f32(light_scatter_samples);\r\n}\r\n\r\nfn direct_illumination(orig_hit: RayHit, refl: ptr<function, f32>) -> vec3<f32> {\r\n\tvar hit: RayHit;\r\n\tif (!voxel_ray_any(Ray(orig_hit.position, scene.direct_light, 1 / scene.direct_light), 0.00001, &hit)){\r\n\t\treturn scene.direct_light_brightness * orig_hit.voxel.color;\r\n\t} else {\r\n\t\treturn 0.2 * orig_hit.voxel.color;\r\n\t}\r\n}\r\n\r\nfn voxel_ray_any(ray: Ray, start_tolerance: f32, hit: ptr<function, RayHit>) -> bool {\r\n\tvar tmin: f32 = 0.0;\r\n\tvar tmax: f32 = 300000000;\r\n\tfor (var d: i32 = 0; d < 3; d++) {\r\n\t\tlet t1 = (boundary_min[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\t\tlet t2 = (boundary_max[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\r\n\t\ttmin = min(max(t1, tmin), max(t2, tmin));\r\n\t\ttmax = max(min(t1, tmax), min(t2, tmax));\r\n\t}\r\n\t// Hier ist noch ein Fehler drin, tritt nur von ausserhalb des grid auf, das kommt ja vielleicht eh noch weg\r\n\tif tmin > tmax { return false; }\r\n    \tlet ray_entry = ray.origin + ray.direction * tmin;\r\n\tlet ray_exit = ray.origin + ray.direction * tmax;\r\n\r\n\tvar voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_entry - boundary_min) / f32(voxel_size))));\r\n\t//var end_voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_exit - boundary_min - ray.direction * 0.000001) / f32(voxel_size))));\r\n\r\n\tlet direction_zeros: vec3<bool> = ray.direction == vec3<f32>(0);\r\n\tlet step: vec3<i32> = vec3<i32>(sign(ray.direction));\r\n\tlet tdelta: vec3<f32> = select(voxel_size / abs(ray.direction), vec3<f32>(tmax), direction_zeros);\r\n\tlet voxel_boundary: vec3<f32> = vec3<f32>(voxel + max(vec3<i32>(0), step)) * voxel_size;\r\n\tvar tmax_comp: vec3<f32> = select(tmin + (boundary_min + voxel_boundary - ray_entry) / ray.direction, vec3<f32>(tmax), direction_zeros);\r\n\tvar thit: f32 = tmin;\r\n\tvar hit_normal: vec3<f32> = vec3<f32>(0, 0, 0);\r\n\r\n\twhile(all(voxel >= vec3<i32>(0)) && all(voxel < vec3<i32>(voxel_count))) {\r\n\t\tlet hit_voxel = get_voxel(voxel);\r\n\t\tif (hit_voxel.opacity > 0.01 && all(tmax_comp > vec3<f32>(start_tolerance))){\r\n\t\t\t(*hit).position = ray.origin + ray.direction * thit;\r\n\t\t\t(*hit).voxel = hit_voxel;\r\n\t\t\t(*hit).voxel_position = voxel;\r\n\t\t\t(*hit).depth = 1 - (thit - depth_clip_min) / (depth_clip_max - depth_clip_min);\r\n\t\t\t(*hit).normal = hit_normal;\r\n\t\t\t(*hit).ray_direction = ray.direction;\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (tmax_comp.x < tmax_comp.y && tmax_comp.x < tmax_comp.z) {\r\n\t\t\tvoxel.x += step.x;\r\n\t\t\tthit = tmax_comp.x;\r\n\t\t\ttmax_comp.x += tdelta.x;\r\n\t\t\thit_normal = vec3<f32>(f32(-step.x), 0, 0);\r\n\t\t} else if (tmax_comp.y < tmax_comp.z){\r\n\t\t\tvoxel.y += step.y;\r\n\t\t\tthit = tmax_comp.y;\r\n\t\t\ttmax_comp.y += tdelta.y;\r\n\t\t\thit_normal = vec3<f32>(0, f32(-step.y), 0);\r\n\t\t} else {\r\n\t\t\tvoxel.z += step.z;\r\n\t\t\tthit = tmax_comp.z;\r\n\t\t\ttmax_comp.z += tdelta.z;\r\n\t\t\thit_normal = vec3<f32>(0, 0, f32(-step.z));\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n":"struct penetration {\r\n\tcolor: vec3<f32>,\r\n\tao: f32,\r\n\thit: RayHit,\r\n}\r\n\r\nfn gamma_correct(color: vec3<f32>) -> vec3<f32> {\r\n    return color / f32(samples);\r\n}\r\n\r\nfn trace(ray: Ray, depth: i32) -> vec3<f32> {\r\n\tvar hit: RayHit;\r\n\tvar bounces: array<RayHit, reflection_bounces>;\r\n\tvar curr_ray = ray;\r\n\tvar hits: i32 = 0;\r\n\tvar has_next_ray = true;\r\n\tvar penetrations: array<penetration, max_penetrations>;\r\n\tvar penetration_count = 0;\r\n\r\n\tfor (var p = 0; p < max_penetrations; p++){\r\n\t\tvar color = vec3<f32>(0.0);\r\n\t\tvar ao = 0f;\r\n\t\tvar first_hit: RayHit;\r\n\t\tfor (var i = 0; i < reflection_bounces; i++){\r\n\t\t\tif(voxel_ray_any(curr_ray, 0.001, &hit)){\r\n\t\t\t\t// return TraceResult(vec3<f32>(hit.uv.x), 0.0);\r\n\t\t\t\tbounces[i] = hit;\r\n\t\t\t\tcurr_ray = ray_reflect(curr_ray, hit.position, hit.normal);\r\n\t\t\t\thits++;\r\n\t\t\t\tif (i == 0){\r\n\t\t\t\t\tfirst_hit = hit;\r\n\t\t\t\t}\r\n\t\t\t\tif (hit.voxel.roughness > 0.99){\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// return TraceResult(vec3<f32>(0.1), 0.0);\r\n\t\t\t\tcolor = scene.background_color;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hits == 0){\r\n\t\t\tbreak;\r\n\t\t\t// return background;\r\n\t\t\t// return ray.direction;\r\n\t\t}\r\n\t\t// return vec3<f32>(0.2, 0.4, 0.5);\r\n\t\t// return vec3<f32>(bounces[0].uv.x, bounces[0].uv.y, 0.0);\r\n\r\n\t\tfor (var i: i32 = hits; i >= 0; i--){\r\n\t\t\t\t// return TraceResult(vec3<f32>(0.5), 0.0);\r\n\t\t\t// return TraceResult(vec3<f32>(bounces[i].uv.x), 0.0);\r\n\t\t\tlet t = bounces[i].voxel.roughness;\r\n\t\t\tcolor = color * (1 - t) + t * bounces[i].voxel.color * illumination(bounces[i].position);\r\n\t\t\tif (i == 0){\r\n\t\t\t\t//ao = get_point_ao(bounces[0].position);\r\n\t\t\t\tao = 0;\r\n\t\t\t\tlet nrm = vec3<i32>(bounces[i].normal);\r\n\t\t\t\tlet uv = bounces[i].uv;\r\n\t\t\t\tlet am = voxel_ao(bounces[i].voxel_position + nrm, nrm.zxy, nrm.yzx);\r\n\t\t\t\tao = mix(mix(am.z, am.w, uv.x), mix(am.y, am.x, uv.x), uv.y);\r\n\t\t\t\t// return vec3<f32>(uv.x / 10 + interp_ao, uv.y / 10 + interp_ao, interp_ao) / 2;\r\n\t\t\t\t// return vec3<f32>(interp_ao);\r\n\t\t\t\t// let interp_ao = \r\n\t\t\t\t// ao = get_point_ao_lambert(bounces[0].position, bounces[0].normal);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (var l: i32 = 0; l < i32(scene.light_count); l++){\r\n\t\t\t\tlet light = lights.data[l];\r\n\t\t\t\tif i32(light.emitter_type) == 0 {\r\n\t\t\t\t\tlet light_voxel = get_voxel(vec3<i32>(light.location));\r\n\t\t\t\t\tlet light_voxel_location = light.location * voxel_size + boundary_min;\r\n\t\t\t\t\tlet light_voxel_location_top = light_voxel_location + voxel_size;\r\n\t\t\t\t\tlet light_voxel_location_mid = (light_voxel_location + light_voxel_location_top) / 2;\r\n\t\t\t\t\tlet lray_dir = light_voxel_location_mid - bounces[i].position;\r\n\t\t\t\t\tlet lray = Ray(bounces[i].position, lray_dir, 1 / lray_dir);\r\n\t\t\t\t\tvar lhit: RayHit;\r\n\t\t\t\t\tif (voxel_ray_any(lray, 0.001, &lhit) && all(lhit.voxel_position == vec3<i32>(light.location))){\r\n\t\t\t\t\t\tlet dist = distance(light_voxel_location_mid, bounces[i].position);\r\n\t\t\t\t\t\tlet intensity = 1 / pow(dist, 2) * lhit.voxel.lightness;\r\n\t\t\t\t\t\tcolor += light_voxel.color * vec3<f32>(intensity) * bounces[i].voxel.color;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// let vox = bounces[i].voxel_position;\r\n\t\t\t// let gi_vox = vox + vec3<i32>(bounces[i].normal);\r\n\t\t\t// color += get_meta_voxel(gi_vox).gi / 5;\r\n\t\t}\r\n\t\tpenetrations[p] = penetration(color, ao, first_hit);\r\n\t\tpenetration_count++;\r\n\t\tcurr_ray = Ray(first_hit.exit_position, ray.direction, ray.inv_direction);\r\n\t\tif (first_hit.voxel.opacity > 0.99){\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tif (penetration_count == 0){\r\n\t\treturn scene.background_color;\r\n\t\t// return TraceResult(scene.background_color, 0);\r\n\t}\r\n\r\n\tvar color = penetrations[penetration_count - 1].color;\r\n\tvar ao = penetrations[penetration_count - 1].ao;\r\n\tfor (var i: i32 = penetration_count - 2; i >= 0; i--){\r\n\t\t// if (i > 0 && all(penetrations[i].voxel_color == penetrations[i - 1].voxel_color)) { continue;}\r\n\t\tlet pvoxel = penetrations[i].hit.voxel;\r\n\t\tlet phit = penetrations[i].hit;\r\n\t\tlet pcolor = penetrations[i].color;\r\n\t\tlet pao = penetrations[i].ao;\r\n\t\tlet t = pvoxel.opacity;\r\n\t\tif (i > 0 && all(penetrations[i - 1].hit.voxel.color == pvoxel.color)) { continue; }\r\n\t\tcolor = pcolor * t + (1 - t) * color;\r\n\t\tao = pao * t + (1 - t) * ao;\r\n\t\t// let t = distance(phit.position, phit.exit_position) / voxel_size;\r\n\t\t// color += pvoxel.color * t / f32(penetration_count);\r\n\t\t// color = pvoxel.color * t + color * (1 - t);\r\n\t\t// color = penetrations[i].color * pvoxel.opacity + color * (1 - pvoxel.opacity);\r\n\t\t// ao = penetrations[i].ao * pvoxel.opacity + ao * (1 - pvoxel.opacity);\r\n\t}\r\n\r\n\treturn color * ao;\r\n\t// return TraceResult(color, ao);\r\n\t// return vec3<f32>(ao);\r\n}\r\n\r\nfn illumination(p: vec3<f32>) -> f32 {\r\n\tvar hit: RayHit;\r\n\tif (!voxel_ray_any(Ray(p, scene.direct_light, 1 / scene.direct_light), 0.001, &hit)){\r\n\t\treturn max(scene.direct_light_brightness, scene.ambient_light);\r\n\t}\r\n\treturn scene.ambient_light;\r\n}\r\n\r\nfn voxel_ray_any(ray: Ray, start_tolerance: f32, hit: ptr<function, RayHit>) -> bool {\r\n\tvar tmin: f32 = 0.0;\r\n\tvar tmax: f32 = 300000000;\r\n\tfor (var d: i32 = 0; d < 3; d++) {\r\n\t\tlet t1 = (boundary_min[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\t\tlet t2 = (boundary_max[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\r\n\t\ttmin = min(max(t1, tmin), max(t2, tmin));\r\n\t\ttmax = max(min(t1, tmax), min(t2, tmax));\r\n\t}\r\n\t// Hier ist noch ein Fehler drin, tritt nur von ausserhalb des grid auf, das kommt ja vielleicht eh noch weg\r\n\tif tmin > tmax { return false; }\r\n    \tlet ray_entry = ray.origin + ray.direction * tmin;\r\n\tlet ray_exit = ray.origin + ray.direction * tmax;\r\n\r\n\tvar voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_entry - boundary_min) / f32(voxel_size))));\r\n\t//var end_voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_exit - boundary_min - ray.direction * 0.000001) / f32(voxel_size))));\r\n\r\n\tlet direction_zeros: vec3<bool> = ray.direction == vec3<f32>(0);\r\n\tlet vstep: vec3<i32> = vec3<i32>(sign(ray.direction));\r\n\tlet tdelta: vec3<f32> = select(voxel_size / abs(ray.direction), vec3<f32>(tmax), direction_zeros);\r\n\tlet voxel_boundary: vec3<f32> = vec3<f32>(voxel + max(vec3<i32>(0), vstep)) * voxel_size;\r\n\tvar tmax_comp: vec3<f32> = select(tmin + (boundary_min + voxel_boundary - ray_entry) / ray.direction, vec3<f32>(tmax), direction_zeros);\r\n\tvar thit: f32 = tmin;\r\n\tvar hit_normal: vec3<f32> = vec3<f32>(0, 0, 0);\r\n\tvar mask: vec3<f32>;\r\n\r\n\twhile(all(voxel >= vec3<i32>(0)) && all(voxel < vec3<i32>(voxel_count))) {\r\n\t\tlet hit_voxel = get_voxel(voxel);\r\n\t\tif (hit_voxel.opacity > 0.01 && all(tmax_comp > vec3<f32>(start_tolerance))){\r\n\t\t\t(*hit).position = ray.origin + ray.direction * thit;\r\n\t\t\t(*hit).voxel = hit_voxel;\r\n\t\t\t(*hit).voxel_position = voxel;\r\n\t\t\t(*hit).depth = 1 - (thit - depth_clip_min) / (depth_clip_max - depth_clip_min);\r\n\t\t\t(*hit).normal = hit_normal;\r\n\t\t\t(*hit).ray_direction = ray.direction;\r\n\t\t\t// let v_diff = (*hit).position - (vec3<f32>(voxel) * voxel_size - boundary_min);\r\n\t\t\tlet uv = (((*hit).position - boundary_min) - (vec3<f32>(voxel) * voxel_size)) / voxel_size;\r\n\t\t\tlet uvx = select(vec3<f32>(1) * mask - mask * uv.yzx, mask * uv.yzx, sign(ray.direction) < vec3<f32>(0));\r\n\t\t\tlet uvy = select(vec3<f32>(1) * mask - mask * uv.zxy, mask * uv.zxy, sign(ray.direction) < vec3<f32>(0));\r\n\t\t\t// let uvy = mask * uv.zxy;\r\n\t\t\t(*hit).uv = vec2<f32>(\r\n\t\t\t\tmax(uvx.x, max(uvx.y, uvx.z)),\r\n\t\t\t\tmax(uvy.x, max(uvy.y, uvy.z)),\r\n\t\t\t\t// dot(mask * v_diff.zxy, vec3<f32>(voxel_size)) / voxel_size,\r\n\t\t\t);\r\n\t\t\tlet next_mask = step(tmax_comp.xyz, tmax_comp.yzx) * step(tmax_comp.xyz, tmax_comp.zxy);\r\n\t\t\tlet tmax_masked = vec3<f32>(next_mask) * tmax_comp;\r\n\t\t\t(*hit).exit_position = ray.origin + ray.direction * max(tmax_masked.x, max(tmax_masked.y, tmax_masked.z));\r\n\r\n\t\t\t\t\t\t// if (tmax_comp.x < tmax_comp.y && tmax_comp.x < tmax_comp.z) {\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.x;\r\n\t\t\t// } else if (tmax_comp.y < tmax_comp.z){\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.y;\r\n\t\t\t// } else {\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.z;\r\n\t\t\t// }\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tmask = step(tmax_comp.xyz, tmax_comp.yzx) * step(tmax_comp.xyz, tmax_comp.zxy);\r\n\t\tvoxel += vstep * vec3<i32>(mask);\r\n\t\tlet tmax_masked = vec3<f32>(mask) * tmax_comp;\r\n\t\tthit = max(tmax_masked.x, max(tmax_masked.y, tmax_masked.z));\r\n\t\thit_normal = -(vec3<f32>(vstep) * mask);\r\n\t\ttmax_comp += mask * tdelta;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nfn voxel_ao(pos: vec3<i32>, d1: vec3<i32>, d2: vec3<i32>) -> vec4<f32> {\r\n\tif (get_voxel(pos).opacity > 0) { return vec4<f32>(1); }\r\n\tlet side = vec4<f32>(get_voxel(pos + d1).opacity, get_voxel(pos + d2).opacity, get_voxel(pos - d1).opacity, get_voxel(pos - d2).opacity);\r\n\tlet corner = vec4<f32>(get_voxel(pos + d1 + d2).opacity, get_voxel(pos - d1 + d2).opacity, get_voxel(pos - d1 - d2).opacity, get_voxel(pos + d1 - d2).opacity);\r\n\tlet ao = vec4<f32>(\r\n\t\tvertex_ao(side.xy, corner.x),\r\n\t\tvertex_ao(side.yz, corner.y),\r\n\t\tvertex_ao(side.zw, corner.z),\r\n\t\tvertex_ao(side.wx, corner.w),\r\n\t);\r\n\treturn 1.0 - ao * scene.ao_strength;\r\n}\r\n\r\nfn vertex_ao(side: vec2<f32>, corner: f32) -> f32 {\r\n\t// return (side.x + side.y) / 2.0;\r\n\treturn max(side.x + side.y, max(corner, side.x * side.y)) / 2;\r\n\treturn (side.x + side.y + max(corner, side.x * side.y)) / 3.0;\r\n}")}),constants:{grid_size:this.scene.grid_size,voxel_count:this.scene.voxel_count}}});const l=null===(_=this.device)||void 0===_?void 0:_.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{}}]});this.screen_bind_group=null===(i=this.device)||void 0===i?void 0:i.createBindGroup({layout:l,entries:[{binding:0,resource:this.sampler},{binding:1,resource:this.color_buffer_view},{binding:2,resource:this.secondary_buffer_view}]});const d=null===(c=this.device)||void 0===c?void 0:c.createPipelineLayout({bindGroupLayouts:[l]});this.screen_pipeline=null===(o=this.device)||void 0===o?void 0:o.createRenderPipeline({layout:d,vertex:{module:this.device.createShaderModule({code:e}),entryPoint:"vert_main"},fragment:{module:this.device.createShaderModule({code:e}),entryPoint:"frag_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list",cullMode:"back",frontFace:"cw"}})}))}}(_e,oe,se.camera);oe.initialize_default_grid(),le.initialize(!1);let de=new class{constructor(e,t){this.background=[0,0,0],this.canvas=e,this.axis="z",this.slice=0,this.scene=t,this.context=e.getContext("2d");const x=document.getElementById("slice-input");x.addEventListener("input",(e=>{const t=Math.floor(parseInt(x.value)/100*this.scene.voxel_count);this.set_slice(t>this.scene.voxel_count-1?this.scene.voxel_count-1:t),console.log(...ae("c9c58ea0_0",t))}))}set_background(e){this.background=e,this.update()}set_axis(e){this.axis=e,this.update()}set_slice(e){this.slice=e,this.update()}update(){const e=this.canvas.width,t=this.canvas.height,x=e/this.scene.voxel_count,r=t/this.scene.voxel_count;this.context.clearRect(0,0,e,t);for(let e=0;e<this.scene.voxel_count;e++)for(let t=0;t<this.scene.voxel_count;t++){const n="x"===this.axis?[this.slice,e,t]:"y"===this.axis?[e,this.slice,t]:[e,t,this.slice],a=this.scene.get_voxel(n);Q.floor(Q.scale(a.color,255)),this.context.fillStyle=this.color_to_string(a.color,a.opacity),this.context.fillRect(e*x,t*r,x,r)}}color_to_string(e,t){const x=Q.floor(Q.scale(e,255));return"#"+x[0].toString(16)+x[1].toString(16)+x[2].toString(16)+(255*t).toString(16)}}(ce,oe);de.slice=6,de.background=[30/255,30/255,46/255],de.update();let fe=performance.now(),he=!1;addEventListener("scroll",(()=>{let e=Math.min(2,window.scrollY/window.innerHeight);document.documentElement.style.setProperty("--canv-offset",e.toString())})),requestAnimationFrame((function e(){le.render();const t=performance.now()-fe;se.tick(t/1e3),fe=performance.now(),ie.innerText=Math.round(1/t*1e3).toString()+" fps",requestAnimationFrame(e)})),addEventListener("mousedown",(e=>{2==e.button&&(he=!0)}));let ue="mocha";const ve=document.getElementById("menu_switch_theme");null==ve||ve.addEventListener("click",(e=>{"mocha"===ue?(ue="latte",function(){const e=document.querySelector(":root");document.documentElement.dataset.theme="latte",e.style.setProperty("--ctp-crust","#dce0e8"),e.style.setProperty("--ctp-mantle","#e6e9ef"),e.style.setProperty("--ctp-base","#eff1f5"),e.style.setProperty("--ctp-surface0","#ccd0da"),e.style.setProperty("--ctp-surface1","#bcc0cc"),e.style.setProperty("--ctp-surface2","#acb0be"),e.style.setProperty("--ctp-overlay0","#9ca0b0"),e.style.setProperty("--ctp-overlay1","#8c8fa1"),e.style.setProperty("--ctp-overlay2","#7c7f93"),e.style.setProperty("--ctp-subtext0","#6c6f85"),e.style.setProperty("--ctp-subtext1","#5c5f77"),e.style.setProperty("--ctp-text","#4c4f69"),e.style.setProperty("--ctp-lavender","#7287fd"),e.style.setProperty("--ctp-blue","#1e66f5"),e.style.setProperty("--ctp-sapphire","#209fb5"),e.style.setProperty("--ctp-sky","#04a5e5"),e.style.setProperty("--ctp-teal","#179299"),e.style.setProperty("--ctp-green","#40a02b"),e.style.setProperty("--ctp-yellow","#df8e1d"),e.style.setProperty("--ctp-peach","#fe640b"),e.style.setProperty("--ctp-maroon","#e64553"),e.style.setProperty("--ctp-red","#d20f39"),e.style.setProperty("--ctp-mauve","#8839ef"),e.style.setProperty("--ctp-pink","#ea76cb"),e.style.setProperty("--ctp-flamingo","#dd7878"),e.style.setProperty("--ctp-rosewater","#dc8a78")}(),oe.background_color=[.8,208/255,218/255],de.set_background([.8,208/255,218/255])):(ue="mocha",function(){const e=document.querySelector(":root");document.documentElement.dataset.theme="mocha",e.style.setProperty("--ctp-crust","#11111b"),e.style.setProperty("--ctp-mantle","#181825"),e.style.setProperty("--ctp-base","#1e1e2e"),e.style.setProperty("--ctp-surface0","#313244"),e.style.setProperty("--ctp-surface1","#45475a"),e.style.setProperty("--ctp-surface2","#585b70"),e.style.setProperty("--ctp-overlay0","#6c7086"),e.style.setProperty("--ctp-overlay1","#7f849c"),e.style.setProperty("--ctp-overlay2","#9399b2"),e.style.setProperty("--ctp-subtext0","#a6adc8"),e.style.setProperty("--ctp-subtext1","#bac2de"),e.style.setProperty("--ctp-text","#cdd6f4"),e.style.setProperty("--ctp-lavender","#b4befe"),e.style.setProperty("--ctp-blue","#89b4fa"),e.style.setProperty("--ctp-sapphire","#74c7ec"),e.style.setProperty("--ctp-sky","#89dceb"),e.style.setProperty("--ctp-teal","#94e2d5"),e.style.setProperty("--ctp-green","#a6e3a1"),e.style.setProperty("--ctp-yellow","#f9e2af"),e.style.setProperty("--ctp-peach","#fab387"),e.style.setProperty("--ctp-maroon","#eba0ac"),e.style.setProperty("--ctp-red","#f38ba8"),e.style.setProperty("--ctp-mauve","#cba6f7"),e.style.setProperty("--ctp-pink","#f5c2e7"),e.style.setProperty("--ctp-flamingo","#f2cdcd"),e.style.setProperty("--ctp-rosewater","#f5e0dc")}(),oe.background_color=[30/255,30/255,46/255],de.set_background([30/255,30/255,46/255]))})),oe.background_color=[30/255,30/255,46/255];const be=document.getElementById("menu_rescale_canvas");function pe(){const e=document.querySelector(":root"),t=.8*Math.min(window.innerWidth,window.innerHeight);e.style.setProperty("--canv-x",t.toString()+"px"),e.style.setProperty("--canv-y",t.toString()+"px"),_e.height=t,_e.width=t,le.shutdown(),le.initialize(le.pathtracing)}null==be||be.addEventListener("click",(e=>{pe()})),pe();const me=document.getElementById("menu_save_scene");null==me||me.addEventListener("click",(e=>{!function(){const e=new Blob([oe.serialize_scene()],{type:"text/json"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="scene.json",t.click(),URL.revokeObjectURL(t.href)}()}));const ge=document.getElementById("menu_load_scene");null==ge||ge.addEventListener("click",(e=>{!function(){const e=document.createElement("input");e.type="file",e.addEventListener("change",(t=>{const x=(null==e?void 0:e.files)[0],r=new FileReader;r.readAsText(x,"UTF-8"),r.addEventListener("load",(e=>{var t;const x=null===(t=e.target)||void 0===t?void 0:t.result;oe.deserialize_scene(x),le.shutdown(),le.initialize(le.pathtracing)}))})),e.click()}()})),addEventListener("contextmenu",(e=>(e.preventDefault(),!1)))})();
//# sourceMappingURL=main.js.map