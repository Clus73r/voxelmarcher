(()=>{"use strict";const e="@group(0) @binding(0) var screen_sampler : sampler;\r\n@group(0) @binding(1) var color_buffer : texture_2d<f32>;\r\n@group(0) @binding(2) var secondary_buffer : texture_2d<f32>;\r\n\r\nstruct VertexOutput {\r\n        @builtin(position) Position : vec4<f32>,\r\n            @location(0) TexCoord : vec2<f32>,\r\n}\r\n\r\n@vertex\r\nfn vert_main(@builtin(vertex_index) VertexIndex : u32) -> VertexOutput {\r\n    var positions = array<vec2<f32>, 6>(\r\n        vec2<f32>( 1.0,  1.0),\r\n        vec2<f32>( 1.0, -1.0),\r\n        vec2<f32>(-1.0, -1.0),\r\n        vec2<f32>( 1.0,  1.0),\r\n        vec2<f32>(-1.0, -1.0),\r\n        vec2<f32>(-1.0,  1.0)\r\n    );\r\n\r\n    var texCoords = array<vec2<f32>, 6>(\r\n        vec2<f32>(1.0, 0.0),\r\n        vec2<f32>(1.0, 1.0),\r\n        vec2<f32>(0.0, 1.0),\r\n        vec2<f32>(1.0, 0.0),\r\n        vec2<f32>(0.0, 1.0),\r\n        vec2<f32>(0.0, 0.0)\r\n    );\r\n\r\n    var output : VertexOutput;\r\n    output.Position = vec4<f32>(positions[VertexIndex], 0.0, 1.0);\r\n    output.TexCoord = texCoords[VertexIndex];\r\n    return output;\r\n}\r\n\r\nconst ao_blur_steps = 7;\r\nconst ao_blur_radius = 0.00f / f32(ao_blur_steps);\r\nconst ao_strength = 1;\r\n\r\n@fragment\r\nfn frag_main(@location(0) TexCoord : vec2<f32>) -> @location(0) vec4<f32> {\r\n\tvar acc = 0f;\r\n\tlet blur_offset = (ao_blur_radius * f32(ao_blur_steps)) / 2;\r\n\tfor (var x = 0; x < ao_blur_steps; x++){\r\n\t\tfor (var y = 0; y < ao_blur_steps; y++){\r\n\t\t\tacc += textureSample(secondary_buffer, screen_sampler, vec2<f32>(TexCoord.x - blur_offset + ao_blur_radius * f32(x), TexCoord.y - blur_offset + ao_blur_radius * f32(y))).x;\r\n\t\t}\r\n\t}\r\n\tacc /= f32(ao_blur_steps) * f32(ao_blur_steps);\r\n\r\n    // return vec4<f32>(acc, acc, acc, 1.0);\r\n    return textureSample(color_buffer, screen_sampler, TexCoord) * (1 - acc * ao_strength);\r\n}\r\n";var t=function(e,t,r,x){return new(r||(r=Promise))((function(n,_){function i(e){try{o(x.next(e))}catch(e){_(e)}}function a(e){try{o(x.throw(e))}catch(e){_(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}o((x=x.apply(e,t||[])).next())}))};let r=1e-6,x=Float32Array;function n(e=0,t=0){const r=new x(2);return void 0!==e&&(r[0]=e,void 0!==t&&(r[1]=t)),r}const _=n;function i(e,t,r){return(r=r||new x(2))[0]=e[0]-t[0],r[1]=e[1]-t[1],r}const a=i;function o(e,t,r){return(r=r||new x(2))[0]=e[0]*t,r[1]=e[1]*t,r}const c=o;function s(e,t){return(t=t||new x(2))[0]=1/e[0],t[1]=1/e[1],t}const d=s;function l(e,t){return e[0]*t[0]+e[1]*t[1]}function f(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}const u=f;function h(e){const t=e[0],r=e[1];return t*t+r*r}const b=h;function v(e,t){const r=e[0]-t[0],x=e[1]-t[1];return Math.sqrt(r*r+x*x)}const p=v;function m(e,t){const r=e[0]-t[0],x=e[1]-t[1];return r*r+x*x}const g=m;function y(e,t){return(t=t||new x(2))[0]=e[0],t[1]=e[1],t}const w=y;function P(e,t,r){return(r=r||new x(2))[0]=e[0]*t[0],r[1]=e[1]*t[1],r}const z=P;function M(e,t,r){return(r=r||new x(2))[0]=e[0]/t[0],r[1]=e[1]/t[1],r}const S=M;var E=Object.freeze({__proto__:null,add:function(e,t,r){return(r=r||new x(2))[0]=e[0]+t[0],r[1]=e[1]+t[1],r},addScaled:function(e,t,r,n){return(n=n||new x(2))[0]=e[0]+t[0]*r,n[1]=e[1]+t[1]*r,n},angle:function(e,t){const r=e[0],x=e[1],n=e[0],_=e[1],i=Math.sqrt(r*r+x*x)*Math.sqrt(n*n+_*_),a=i&&l(e,t)/i;return Math.acos(a)},ceil:function(e,t){return(t=t||new x(2))[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},clamp:function(e,t=0,r=1,n){return(n=n||new x(2))[0]=Math.min(r,Math.max(t,e[0])),n[1]=Math.min(r,Math.max(t,e[1])),n},clone:w,copy:y,create:n,cross:function(e,t,r){r=r||new x(3);const n=e[0]*t[1]-e[1]*t[0];return r[0]=0,r[1]=0,r[2]=n,r},dist:p,distSq:g,distance:v,distanceSq:m,div:S,divScalar:function(e,t,r){return(r=r||new x(2))[0]=e[0]/t,r[1]=e[1]/t,r},divide:M,dot:l,equals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equalsApproximately:function(e,t){return Math.abs(e[0]-t[0])<r&&Math.abs(e[1]-t[1])<r},floor:function(e,t){return(t=t||new x(2))[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},fromValues:_,inverse:s,invert:d,len:u,lenSq:b,length:f,lengthSq:h,lerp:function(e,t,r,n){return(n=n||new x(2))[0]=e[0]+r*(t[0]-e[0]),n[1]=e[1]+r*(t[1]-e[1]),n},lerpV:function(e,t,r,n){return(n=n||new x(2))[0]=e[0]+r[0]*(t[0]-e[0]),n[1]=e[1]+r[1]*(t[1]-e[1]),n},max:function(e,t,r){return(r=r||new x(2))[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r},min:function(e,t,r){return(r=r||new x(2))[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r},mul:z,mulScalar:o,multiply:P,negate:function(e,t){return(t=t||new x(2))[0]=-e[0],t[1]=-e[1],t},normalize:function(e,t){t=t||new x(2);const r=e[0],n=e[1],_=Math.sqrt(r*r+n*n);return _>1e-5?(t[0]=r/_,t[1]=n/_):(t[0]=0,t[1]=0),t},random:function(e=1,t){t=t||new x(2);const r=2*Math.random()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},round:function(e,t){return(t=t||new x(2))[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:c,setDefaultType:function(e){const t=x;return x=e,t},sub:a,subtract:i,transformMat3:function(e,t,r){r=r||new x(2);const n=e[0],_=e[1];return r[0]=t[0]*n+t[4]*_+t[8],r[1]=t[1]*n+t[5]*_+t[9],r},transformMat4:function(e,t,r){r=r||new x(2);const n=e[0],_=e[1];return r[0]=n*t[0]+_*t[4]+t[12],r[1]=n*t[1]+_*t[5]+t[13],r},zero:function(e){return(e=e||new x(2))[0]=0,e[1]=0,e}});Float32Array;new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]).get(Float32Array);let I=Float32Array;function T(e,t,r){const x=new I(3);return void 0!==e&&(x[0]=e,void 0!==t&&(x[1]=t,void 0!==r&&(x[2]=r))),x}const k=T;function L(e,t,r){return(r=r||new I(3))[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}const R=L;function N(e,t,r){return(r=r||new I(3))[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}const O=N;function A(e,t){return(t=t||new I(3))[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}const B=A;function D(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function G(e){const t=e[0],r=e[1],x=e[2];return Math.sqrt(t*t+r*r+x*x)}const U=G;function j(e){const t=e[0],r=e[1],x=e[2];return t*t+r*r+x*x}const C=j;function F(e,t){const r=e[0]-t[0],x=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+x*x+n*n)}const q=F;function V(e,t){const r=e[0]-t[0],x=e[1]-t[1],n=e[2]-t[2];return r*r+x*x+n*n}const H=V;function Y(e,t){return(t=t||new I(3))[0]=e[0],t[1]=e[1],t[2]=e[2],t}const W=Y;function $(e,t,r){return(r=r||new I(3))[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}const X=$;function Z(e,t,r){return(r=r||new I(3))[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r}const J=Z;var Q=Object.freeze({__proto__:null,add:function(e,t,r){return(r=r||new I(3))[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r},addScaled:function(e,t,r,x){return(x=x||new I(3))[0]=e[0]+t[0]*r,x[1]=e[1]+t[1]*r,x[2]=e[2]+t[2]*r,x},angle:function(e,t){const r=e[0],x=e[1],n=e[2],_=e[0],i=e[1],a=e[2],o=Math.sqrt(r*r+x*x+n*n)*Math.sqrt(_*_+i*i+a*a),c=o&&D(e,t)/o;return Math.acos(c)},ceil:function(e,t){return(t=t||new I(3))[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},clamp:function(e,t=0,r=1,x){return(x=x||new I(3))[0]=Math.min(r,Math.max(t,e[0])),x[1]=Math.min(r,Math.max(t,e[1])),x[2]=Math.min(r,Math.max(t,e[2])),x},clone:W,copy:Y,create:T,cross:function(e,t,r){r=r||new I(3);const x=e[2]*t[0]-e[0]*t[2],n=e[0]*t[1]-e[1]*t[0];return r[0]=e[1]*t[2]-e[2]*t[1],r[1]=x,r[2]=n,r},dist:q,distSq:H,distance:F,distanceSq:V,div:J,divScalar:function(e,t,r){return(r=r||new I(3))[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t,r},divide:Z,dot:D,equals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equalsApproximately:function(e,t){return Math.abs(e[0]-t[0])<r&&Math.abs(e[1]-t[1])<r&&Math.abs(e[2]-t[2])<r},floor:function(e,t){return(t=t||new I(3))[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},fromValues:k,getAxis:function(e,t,r){const x=4*t;return(r=r||new I(3))[0]=e[x+0],r[1]=e[x+1],r[2]=e[x+2],r},getScaling:function(e,t){t=t||new I(3);const r=e[0],x=e[1],n=e[2],_=e[4],i=e[5],a=e[6],o=e[8],c=e[9],s=e[10];return t[0]=Math.sqrt(r*r+x*x+n*n),t[1]=Math.sqrt(_*_+i*i+a*a),t[2]=Math.sqrt(o*o+c*c+s*s),t},getTranslation:function(e,t){return(t=t||new I(3))[0]=e[12],t[1]=e[13],t[2]=e[14],t},inverse:A,invert:B,len:U,lenSq:C,length:G,lengthSq:j,lerp:function(e,t,r,x){return(x=x||new I(3))[0]=e[0]+r*(t[0]-e[0]),x[1]=e[1]+r*(t[1]-e[1]),x[2]=e[2]+r*(t[2]-e[2]),x},lerpV:function(e,t,r,x){return(x=x||new I(3))[0]=e[0]+r[0]*(t[0]-e[0]),x[1]=e[1]+r[1]*(t[1]-e[1]),x[2]=e[2]+r[2]*(t[2]-e[2]),x},max:function(e,t,r){return(r=r||new I(3))[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r},min:function(e,t,r){return(r=r||new I(3))[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r},mul:X,mulScalar:N,multiply:$,negate:function(e,t){return(t=t||new I(3))[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},normalize:function(e,t){t=t||new I(3);const r=e[0],x=e[1],n=e[2],_=Math.sqrt(r*r+x*x+n*n);return _>1e-5?(t[0]=r/_,t[1]=x/_,t[2]=n/_):(t[0]=0,t[1]=0,t[2]=0),t},random:function(e=1,t){t=t||new I(3);const r=2*Math.random()*Math.PI,x=2*Math.random()-1,n=Math.sqrt(1-x*x)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=x*e,t},round:function(e,t){return(t=t||new I(3))[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:O,setDefaultType:function(e){const t=I;return I=e,t},sub:R,subtract:L,transformMat3:function(e,t,r){r=r||new I(3);const x=e[0],n=e[1],_=e[2];return r[0]=x*t[0]+n*t[4]+_*t[8],r[1]=x*t[1]+n*t[5]+_*t[9],r[2]=x*t[2]+n*t[6]+_*t[10],r},transformMat4:function(e,t,r){r=r||new I(3);const x=e[0],n=e[1],_=e[2],i=t[3]*x+t[7]*n+t[11]*_+t[15]||1;return r[0]=(t[0]*x+t[4]*n+t[8]*_+t[12])/i,r[1]=(t[1]*x+t[5]*n+t[9]*_+t[13])/i,r[2]=(t[2]*x+t[6]*n+t[10]*_+t[14])/i,r},transformMat4Upper3x3:function(e,t,r){r=r||new I(3);const x=e[0],n=e[1],_=e[2];return r[0]=x*t[0]+n*t[4]+_*t[8],r[1]=x*t[1]+n*t[5]+_*t[9],r[2]=x*t[2]+n*t[6]+_*t[10],r},zero:function(e){return(e=e||new I(3))[0]=0,e[1]=0,e[2]=0,e}});function K(e){return e*Math.PI/180}Float32Array,Float32Array,Float32Array;class ee{constructor(e,t){this.origin=e,this.direction=Q.normalize(t),this.inv_direction=[1,1,1],Q.div(this.inv_direction,t,this.inv_direction)}}class te{constructor(e,t,r,x){this.position=e,this.voxel_position=t,this.voxel=r,this.normal=x}}class re{constructor(){this.color=Q.create(),this.opacity=0,this.roughness=1,this.lightness=0}}class xe{constructor(){this.gi=Q.create()}}class ne{constructor(e,t,r){this.dragged=!1,this.velocity=[0,0],this.distance=8,this.forward=Q.create(),this.right=Q.create(),this.up=Q.create(),this.position=Q.create(),this.eulers=[0,r,t],this.distance=e}update(){this.eulers[1]=Math.min(80,Math.max(-80,this.eulers[1])),this.eulers[2]=this.eulers[2]%360,this.forward=[Math.cos(K(this.eulers[2]))*Math.cos(K(this.eulers[1])),Math.sin(K(this.eulers[2]))*Math.cos(K(this.eulers[1])),Math.sin(K(this.eulers[1]))],Q.normalize(Q.cross(this.forward,[0,0,1],this.right),this.right),Q.normalize(Q.cross(this.right,this.forward,this.up),this.up),Q.scale(this.forward,-this.distance,this.position)}tick(e){this.dragged||(this.eulers[1]-=this.velocity[1],this.eulers[2]-=this.velocity[0]),E.scale(this.velocity,.96*(1-e),this.velocity),this.update()}screen_to_ray(e,t,r,x){const n=(e-r/2)/r,_=(t-x/2)/-x;let i=Q.create();return Q.add(i,this.forward,i),Q.add(i,Q.scale(this.right,n),i),Q.add(i,Q.scale(this.up,_),i),new ee(this.position,i)}}function _e(e,...t){try{(function(){try{return(0,eval)("globalThis._console_ninja")||(0,eval)("/* https://github.com/wallabyjs/console-ninja#how-does-it-work */'use strict';function _0x4cb1(_0x4f848e,_0x9f6681){var _0x382e6d=_0x382e();return _0x4cb1=function(_0x4cb1d,_0x385ce4){_0x4cb1d=_0x4cb1d-0x104;var _0x258f0e=_0x382e6d[_0x4cb1d];return _0x258f0e;},_0x4cb1(_0x4f848e,_0x9f6681);}var _0x5c041f=_0x4cb1;(function(_0x41f6bb,_0x590643){var _0x32cf76=_0x4cb1,_0x349fd4=_0x41f6bb();while(!![]){try{var _0x587f11=parseInt(_0x32cf76(0x1b2))/0x1+parseInt(_0x32cf76(0x16e))/0x2+parseInt(_0x32cf76(0x170))/0x3+-parseInt(_0x32cf76(0x1b4))/0x4*(parseInt(_0x32cf76(0x1a0))/0x5)+parseInt(_0x32cf76(0x1a8))/0x6*(parseInt(_0x32cf76(0x194))/0x7)+parseInt(_0x32cf76(0x136))/0x8+-parseInt(_0x32cf76(0x179))/0x9;if(_0x587f11===_0x590643)break;else _0x349fd4['push'](_0x349fd4['shift']());}catch(_0x3419a0){_0x349fd4['push'](_0x349fd4['shift']());}}}(_0x382e,0x92987));var ue=Object['create'],te=Object['defineProperty'],he=Object[_0x5c041f(0x142)],le=Object[_0x5c041f(0x15c)],fe=Object['getPrototypeOf'],_e=Object[_0x5c041f(0x14f)][_0x5c041f(0x1a2)],pe=(_0x4a860d,_0x2991b2,_0x244fb2,_0x1ae054)=>{var _0x5076d7=_0x5c041f;if(_0x2991b2&&typeof _0x2991b2==_0x5076d7(0x1d1)||typeof _0x2991b2==_0x5076d7(0x1c5)){for(let _0x3968f6 of le(_0x2991b2))!_e[_0x5076d7(0x197)](_0x4a860d,_0x3968f6)&&_0x3968f6!==_0x244fb2&&te(_0x4a860d,_0x3968f6,{'get':()=>_0x2991b2[_0x3968f6],'enumerable':!(_0x1ae054=he(_0x2991b2,_0x3968f6))||_0x1ae054[_0x5076d7(0x1d3)]});}return _0x4a860d;},ne=(_0x2d78ff,_0x2bde4e,_0xe92645)=>(_0xe92645=_0x2d78ff!=null?ue(fe(_0x2d78ff)):{},pe(_0x2bde4e||!_0x2d78ff||!_0x2d78ff[_0x5c041f(0x191)]?te(_0xe92645,_0x5c041f(0x1c6),{'value':_0x2d78ff,'enumerable':!0x0}):_0xe92645,_0x2d78ff)),Q=class{constructor(_0x187a81,_0x47eeea,_0xfb14bc,_0x112373){var _0x4ccd8d=_0x5c041f;this[_0x4ccd8d(0x143)]=_0x187a81,this['host']=_0x47eeea,this['port']=_0xfb14bc,this[_0x4ccd8d(0x113)]=_0x112373,this[_0x4ccd8d(0x1b9)]=!0x0,this[_0x4ccd8d(0x1cd)]=!0x0,this[_0x4ccd8d(0x17c)]=!0x1,this[_0x4ccd8d(0x107)]=!0x1,this['_inBrowser']=!!this[_0x4ccd8d(0x143)][_0x4ccd8d(0x181)],this[_0x4ccd8d(0x186)]=null,this[_0x4ccd8d(0x112)]=0x0,this[_0x4ccd8d(0x1b1)]=0x14,this['_sendErrorMessage']=this[_0x4ccd8d(0x146)]?_0x4ccd8d(0x19c):_0x4ccd8d(0x121);}async[_0x5c041f(0x130)](){var _0x1b0d94=_0x5c041f;if(this['_WebSocketClass'])return this[_0x1b0d94(0x186)];let _0x4389b0;if(this[_0x1b0d94(0x146)])_0x4389b0=this[_0x1b0d94(0x143)][_0x1b0d94(0x181)];else{if(this[_0x1b0d94(0x143)][_0x1b0d94(0x1a3)]?.['_WebSocket'])_0x4389b0=this[_0x1b0d94(0x143)]['process']?.[_0x1b0d94(0x1bd)];else try{let _0x51e77f=await import(_0x1b0d94(0x1df));_0x4389b0=(await import((await import(_0x1b0d94(0x138)))[_0x1b0d94(0x10c)](_0x51e77f[_0x1b0d94(0x153)](this['nodeModules'],'ws/index.js'))['toString']()))[_0x1b0d94(0x1c6)];}catch{try{_0x4389b0=require(require('path')['join'](this[_0x1b0d94(0x113)],'ws'));}catch{throw new Error(_0x1b0d94(0x128));}}}return this[_0x1b0d94(0x186)]=_0x4389b0,_0x4389b0;}[_0x5c041f(0x1b5)](){var _0x1be63c=_0x5c041f;this['_connecting']||this['_connected']||this['_connectAttemptCount']>=this[_0x1be63c(0x1b1)]||(this[_0x1be63c(0x1cd)]=!0x1,this['_connecting']=!0x0,this[_0x1be63c(0x112)]++,this['_ws']=new Promise((_0x34a063,_0x5b7758)=>{var _0x560b0e=_0x1be63c;this[_0x560b0e(0x130)]()['then'](_0x2eca62=>{var _0x4fd847=_0x560b0e;let _0x2ba1af=new _0x2eca62(_0x4fd847(0x185)+this['host']+':'+this[_0x4fd847(0x17e)]);_0x2ba1af['onerror']=()=>{var _0x2b225e=_0x4fd847;this[_0x2b225e(0x1b9)]=!0x1,this[_0x2b225e(0x135)](_0x2ba1af),this[_0x2b225e(0x175)](),_0x5b7758(new Error('logger\\x20websocket\\x20error'));},_0x2ba1af[_0x4fd847(0x15f)]=()=>{var _0x5e4efc=_0x4fd847;this['_inBrowser']||_0x2ba1af[_0x5e4efc(0x119)]&&_0x2ba1af[_0x5e4efc(0x119)][_0x5e4efc(0x1c8)]&&_0x2ba1af['_socket'][_0x5e4efc(0x1c8)](),_0x34a063(_0x2ba1af);},_0x2ba1af[_0x4fd847(0x12f)]=()=>{var _0x587a15=_0x4fd847;this['_allowedToConnectOnSend']=!0x0,this[_0x587a15(0x135)](_0x2ba1af),this['_attemptToReconnectShortly']();},_0x2ba1af[_0x4fd847(0x176)]=_0x5c46e0=>{var _0x166b3f=_0x4fd847;try{_0x5c46e0&&_0x5c46e0[_0x166b3f(0x1af)]&&this[_0x166b3f(0x146)]&&JSON[_0x166b3f(0x1d2)](_0x5c46e0[_0x166b3f(0x1af)])[_0x166b3f(0x11c)]===_0x166b3f(0x1a7)&&this[_0x166b3f(0x143)][_0x166b3f(0x180)][_0x166b3f(0x1a7)]();}catch{}};})['then'](_0x2a47ca=>(this[_0x560b0e(0x17c)]=!0x0,this[_0x560b0e(0x107)]=!0x1,this['_allowedToConnectOnSend']=!0x1,this[_0x560b0e(0x1b9)]=!0x0,this[_0x560b0e(0x112)]=0x0,_0x2a47ca))[_0x560b0e(0x13f)](_0x449b17=>(this['_connected']=!0x1,this[_0x560b0e(0x107)]=!0x1,_0x5b7758(new Error(_0x560b0e(0x1ce)+(_0x449b17&&_0x449b17[_0x560b0e(0x155)])))));}));}[_0x5c041f(0x135)](_0x11dfe2){var _0x35b03a=_0x5c041f;this[_0x35b03a(0x17c)]=!0x1,this['_connecting']=!0x1;try{_0x11dfe2['onclose']=null,_0x11dfe2[_0x35b03a(0x1c9)]=null,_0x11dfe2['onopen']=null;}catch{}try{_0x11dfe2[_0x35b03a(0x15d)]<0x2&&_0x11dfe2[_0x35b03a(0x13c)]();}catch{}}[_0x5c041f(0x175)](){var _0x31aeaf=_0x5c041f;clearTimeout(this[_0x31aeaf(0x1d0)]),!(this[_0x31aeaf(0x112)]>=this[_0x31aeaf(0x1b1)])&&(this[_0x31aeaf(0x1d0)]=setTimeout(()=>{var _0x395757=_0x31aeaf;this[_0x395757(0x17c)]||this['_connecting']||(this['_connectToHostNow'](),this[_0x395757(0x156)]?.[_0x395757(0x13f)](()=>this['_attemptToReconnectShortly']()));},0x1f4),this[_0x31aeaf(0x1d0)][_0x31aeaf(0x1c8)]&&this[_0x31aeaf(0x1d0)][_0x31aeaf(0x1c8)]());}async['send'](_0x353d6f){var _0x36feac=_0x5c041f;try{if(!this[_0x36feac(0x1b9)])return;this[_0x36feac(0x1cd)]&&this[_0x36feac(0x1b5)](),(await this[_0x36feac(0x156)])['send'](JSON[_0x36feac(0x183)](_0x353d6f));}catch(_0xea0863){console[_0x36feac(0x137)](this[_0x36feac(0x159)]+':\\x20'+(_0xea0863&&_0xea0863[_0x36feac(0x155)])),this[_0x36feac(0x1b9)]=!0x1,this[_0x36feac(0x175)]();}}};function V(_0x316ec2,_0x37b6b9,_0x242e78,_0x2a8d2f,_0x23fccf){var _0x12a29b=_0x5c041f;let _0xd77357=_0x242e78[_0x12a29b(0x1cc)](',')['map'](_0xe82dc7=>{var _0x319735=_0x12a29b;try{_0x316ec2[_0x319735(0x1d6)]||((_0x23fccf===_0x319735(0x140)||_0x23fccf===_0x319735(0x1cf)||_0x23fccf===_0x319735(0x1dd))&&(_0x23fccf+=_0x316ec2['process']?.[_0x319735(0x168)]?.['node']?_0x319735(0x1a1):_0x319735(0x150)),_0x316ec2[_0x319735(0x1d6)]={'id':+new Date(),'tool':_0x23fccf});let _0x16f072=new Q(_0x316ec2,_0x37b6b9,_0xe82dc7,_0x2a8d2f);return _0x16f072[_0x319735(0x1b0)]['bind'](_0x16f072);}catch(_0x5c7fa8){return console[_0x319735(0x137)](_0x319735(0x10a),_0x5c7fa8&&_0x5c7fa8[_0x319735(0x155)]),()=>{};}});return _0x502d2e=>_0xd77357[_0x12a29b(0x1ab)](_0x43bc6b=>_0x43bc6b(_0x502d2e));}function H(_0x5af7b2){var _0x44da05=_0x5c041f;let _0x4d0c7c=function(_0x2df01d,_0x18687f){return _0x18687f-_0x2df01d;},_0x5b3ffd;if(_0x5af7b2['performance'])_0x5b3ffd=function(){var _0x18cc82=_0x4cb1;return _0x5af7b2[_0x18cc82(0x187)][_0x18cc82(0x1b8)]();};else{if(_0x5af7b2[_0x44da05(0x1a3)]&&_0x5af7b2[_0x44da05(0x1a3)]['hrtime'])_0x5b3ffd=function(){var _0x36a33e=_0x44da05;return _0x5af7b2['process'][_0x36a33e(0x104)]();},_0x4d0c7c=function(_0x17a6ca,_0x1ffd49){return 0x3e8*(_0x1ffd49[0x0]-_0x17a6ca[0x0])+(_0x1ffd49[0x1]-_0x17a6ca[0x1])/0xf4240;};else try{let {performance:_0x280329}=require('perf_hooks');_0x5b3ffd=function(){return _0x280329['now']();};}catch{_0x5b3ffd=function(){return+new Date();};}}return{'elapsed':_0x4d0c7c,'timeStamp':_0x5b3ffd,'now':()=>Date['now']()};}function X(_0x12e8bd,_0x14d6a9,_0xacee0b){var _0x30debf=_0x5c041f;if(_0x12e8bd[_0x30debf(0x14a)]!==void 0x0)return _0x12e8bd[_0x30debf(0x14a)];let _0x3a35d6=_0x12e8bd[_0x30debf(0x1a3)]?.[_0x30debf(0x168)]?.[_0x30debf(0x1da)];return _0x3a35d6&&_0xacee0b===_0x30debf(0x147)?_0x12e8bd['_consoleNinjaAllowedToStart']=!0x1:_0x12e8bd[_0x30debf(0x14a)]=_0x3a35d6||!_0x14d6a9||_0x12e8bd[_0x30debf(0x180)]?.[_0x30debf(0x13b)]&&_0x14d6a9[_0x30debf(0x18d)](_0x12e8bd[_0x30debf(0x180)][_0x30debf(0x13b)]),_0x12e8bd[_0x30debf(0x14a)];}function _0x382e(){var _0x3f78a3=['_setNodeExpressionPath','location','WebSocket','bigint','stringify','substr','ws://','_WebSocketClass','performance','stackTraceLimit','type','1.0.0','_console_ninja','_isUndefined','includes','[object\\x20BigInt]','autoExpandMaxDepth','timeEnd','__es'+'Module','parent','_type','635201aILuEg','Map','_setNodeQueryPath','call',[\"localhost\",\"127.0.0.1\",\"example.cypress.io\",\"csys\",\"192.168.178.20\"],'NEGATIVE_INFINITY','_undefined','webpack','Console\\x20Ninja\\x20failed\\x20to\\x20send\\x20logs,\\x20refreshing\\x20the\\x20page\\x20may\\x20help','disabledLog','reduceLimits','_getOwnPropertyNames','280CWoCPm','\\x20server','hasOwnProperty','process','HTMLAllCollection','[object\\x20Set]','console','reload','54LRIPsv','argumentResolutionError','value','forEach','push','_property','_treeNodePropertiesAfterFullValue','data','send','_maxConnectAttemptCount','935776dwgaDu','sortProps','64072xQAqIr','_connectToHostNow','log','autoExpand','now','_allowedToSend','slice','count','negativeInfinity','_WebSocket','constructor','hits','_getOwnPropertyDescriptor','date','_isPrimitiveType','_addFunctionsNode','root_exp','function','default','valueOf','unref','onerror','cappedElements','number','split','_allowedToConnectOnSend','failed\\x20to\\x20connect\\x20to\\x20host:\\x20','remix','_reconnectTimeout','object','parse','enumerable','_cleanNode','_quotedRegExp','_console_ninja_session','','_capIfString','Set','node','[object\\x20Map]','_isPrimitiveWrapperType','astro','replace','path','elements','concat','[object\\x20Array]','undefined','_blacklistedProperty','match','root_exp_id','_isNegativeZero','hrtime','String','_numberRegExp','_connecting','current','_keyStrRegExp','logger\\x20failed\\x20to\\x20connect\\x20to\\x20host','_setNodeId','pathToFileURL','level','Number','autoExpandPreviousObjects','name','serialize','_connectAttemptCount','nodeModules','RegExp','_propertyName','trace','expressionsToEvaluate','...','_socket','indexOf','_addLoadNode','method','autoExpandPropertyCount','unshift','props','_p_length','Console\\x20Ninja\\x20failed\\x20to\\x20send\\x20logs,\\x20restarting\\x20the\\x20process\\x20may\\x20help','capped','length','127.0.0.1','pop','array','_treeNodePropertiesBeforeFullValue','failed\\x20to\\x20find\\x20and\\x20load\\x20WebSocket','isExpressionToEvaluate','_addProperty','error','totalStrLength','autoExpandLimit','negativeZero','onclose','getWebSocketClass','_regExpToString','isArray',':logPointId:','_setNodePermissions','_disposeWebsocket','7576168RoOoLU','warn','url','getOwnPropertySymbols','_hasSetOnItsPath','hostname','close','_additionalMetadata','strLength','catch','next.js','rootExpression','getOwnPropertyDescriptor','global','symbol','boolean','_inBrowser','nuxt','time','[object\\x20Date]','_consoleNinjaAllowedToStart','depth','Error','positiveInfinity','string','prototype','\\x20browser','_addObjectProperty','_p_','join','_sortProps','message','_ws','_isMap','noFunctions','_sendErrorMessage','_Symbol','_setNodeExpandableState','getOwnPropertyNames','readyState','_objectToString','onopen','51961','_hasMapOnItsPath','elapsed','index','nan','resolveGetters','test','_HTMLAllCollection','versions','_setNodeLabel','null','toLowerCase','_isSet','_dateToString','1039862BHuYnR','disabledTrace','1272669ZnImvB','expId','_isArray','unknown',\"c:\\\\Users\\\\c\\\\.vscode\\\\extensions\\\\wallabyjs.console-ninja-0.0.154\\\\node_modules\",'_attemptToReconnectShortly','onmessage','Symbol','toString','19315575hkRJHr','_processTreeNodeResult','allStrLength','_connected','1687331417795','port'];_0x382e=function(){return _0x3f78a3;};return _0x382e();}((_0x5b4790,_0x458f21,_0x149466,_0x506ad4,_0x4f07aa,_0x3fd8d0,_0x20a513,_0x2e806b,_0x2df5e3)=>{var _0x27b5f4=_0x5c041f;if(_0x5b4790['_console_ninja'])return _0x5b4790['_console_ninja'];if(!X(_0x5b4790,_0x2e806b,_0x4f07aa))return _0x5b4790[_0x27b5f4(0x18b)]={'consoleLog':()=>{},'consoleTrace':()=>{},'consoleTime':()=>{},'consoleTimeEnd':()=>{},'autoLog':()=>{},'autoTrace':()=>{},'autoTime':()=>{},'autoTimeEnd':()=>{}},_0x5b4790[_0x27b5f4(0x18b)];let _0x538d0c={'props':0x64,'elements':0x64,'strLength':0x400*0x32,'totalStrLength':0x400*0x32,'autoExpandLimit':0x1388,'autoExpandMaxDepth':0xa},_0x5df0c1={'props':0x5,'elements':0x5,'strLength':0x100,'totalStrLength':0x100*0x3,'autoExpandLimit':0x1e,'autoExpandMaxDepth':0x2},_0xe984aa=H(_0x5b4790),_0x272fdc=_0xe984aa[_0x27b5f4(0x162)],_0x4d049a=_0xe984aa['timeStamp'],_0x2f3f4d=_0xe984aa['now'],_0xe1c80c={'hits':{},'ts':{}},_0x3d77ad=_0x1f3b96=>{_0xe1c80c['ts'][_0x1f3b96]=_0x4d049a();},_0xe06796=(_0x13f02a,_0x2be50f)=>{let _0x40e934=_0xe1c80c['ts'][_0x2be50f];if(delete _0xe1c80c['ts'][_0x2be50f],_0x40e934){let _0x5274bc=_0x272fdc(_0x40e934,_0x4d049a());_0x4b1f73(_0x4ef4d5('time',_0x13f02a,_0x2f3f4d(),_0x5ef367,[_0x5274bc],_0x2be50f));}},_0x47ca51=_0x35ae2c=>_0x568830=>{var _0x5cbfae=_0x27b5f4;try{_0x3d77ad(_0x568830),_0x35ae2c(_0x568830);}finally{_0x5b4790[_0x5cbfae(0x1a6)]['time']=_0x35ae2c;}},_0x34454b=_0x46ef29=>_0x2cac3c=>{var _0x4e0ff3=_0x27b5f4;try{let [_0x38e816,_0xa70aed]=_0x2cac3c[_0x4e0ff3(0x1cc)](_0x4e0ff3(0x133));_0xe06796(_0xa70aed,_0x38e816),_0x46ef29(_0x38e816);}finally{_0x5b4790['console'][_0x4e0ff3(0x190)]=_0x46ef29;}};_0x5b4790['_console_ninja']={'consoleLog':(_0xbf4b2a,_0x4ee11d)=>{var _0x27c615=_0x27b5f4;_0x5b4790[_0x27c615(0x1a6)][_0x27c615(0x1b6)][_0x27c615(0x110)]!==_0x27c615(0x19d)&&_0x4b1f73(_0x4ef4d5(_0x27c615(0x1b6),_0xbf4b2a,_0x2f3f4d(),_0x5ef367,_0x4ee11d));},'consoleTrace':(_0x380929,_0x5c69db)=>{var _0x2e9541=_0x27b5f4;_0x5b4790[_0x2e9541(0x1a6)][_0x2e9541(0x1b6)][_0x2e9541(0x110)]!==_0x2e9541(0x16f)&&_0x4b1f73(_0x4ef4d5(_0x2e9541(0x116),_0x380929,_0x2f3f4d(),_0x5ef367,_0x5c69db));},'consoleTime':()=>{var _0xac082f=_0x27b5f4;_0x5b4790[_0xac082f(0x1a6)][_0xac082f(0x148)]=_0x47ca51(_0x5b4790[_0xac082f(0x1a6)][_0xac082f(0x148)]);},'consoleTimeEnd':()=>{var _0x3a096b=_0x27b5f4;_0x5b4790['console'][_0x3a096b(0x190)]=_0x34454b(_0x5b4790[_0x3a096b(0x1a6)][_0x3a096b(0x190)]);},'autoLog':(_0x400d6e,_0x1ef64c)=>{_0x4b1f73(_0x4ef4d5('log',_0x1ef64c,_0x2f3f4d(),_0x5ef367,[_0x400d6e]));},'autoTrace':(_0x5e343b,_0x2b5d86)=>{var _0x53ff97=_0x27b5f4;_0x4b1f73(_0x4ef4d5(_0x53ff97(0x116),_0x2b5d86,_0x2f3f4d(),_0x5ef367,[_0x5e343b]));},'autoTime':(_0x555514,_0x466fce,_0x7d1fbf)=>{_0x3d77ad(_0x7d1fbf);},'autoTimeEnd':(_0x596063,_0x24d50a,_0x257617)=>{_0xe06796(_0x24d50a,_0x257617);}};let _0x4b1f73=V(_0x5b4790,_0x458f21,_0x149466,_0x506ad4,_0x4f07aa),_0x5ef367=_0x5b4790['_console_ninja_session'];class _0x7302f2{constructor(){var _0x2530cf=_0x27b5f4;this[_0x2530cf(0x109)]=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*$/,this[_0x2530cf(0x106)]=/^(0|[1-9][0-9]*)$/,this[_0x2530cf(0x1d5)]=/'([^\\\\']|\\\\')*'/,this[_0x2530cf(0x19a)]=_0x5b4790[_0x2530cf(0x1e3)],this[_0x2530cf(0x167)]=_0x5b4790[_0x2530cf(0x1a4)],this[_0x2530cf(0x1c0)]=Object[_0x2530cf(0x142)],this[_0x2530cf(0x19f)]=Object['getOwnPropertyNames'],this[_0x2530cf(0x15a)]=_0x5b4790[_0x2530cf(0x177)],this[_0x2530cf(0x131)]=RegExp[_0x2530cf(0x14f)][_0x2530cf(0x178)],this['_dateToString']=Date['prototype'][_0x2530cf(0x178)];}[_0x27b5f4(0x111)](_0x4c4a88,_0x2bf3b0,_0x363f5d,_0x49674b){var _0x377020=_0x27b5f4,_0x277dde=this,_0x2bc8b0=_0x363f5d['autoExpand'];function _0x41b795(_0x639564,_0x42158d,_0x6a91ba){var _0x49c916=_0x4cb1;_0x42158d[_0x49c916(0x189)]=_0x49c916(0x173),_0x42158d[_0x49c916(0x12b)]=_0x639564['message'],_0x15be58=_0x6a91ba['node'][_0x49c916(0x108)],_0x6a91ba[_0x49c916(0x1da)][_0x49c916(0x108)]=_0x42158d,_0x277dde[_0x49c916(0x127)](_0x42158d,_0x6a91ba);}if(_0x2bf3b0&&_0x2bf3b0[_0x377020(0x1a9)])_0x41b795(_0x2bf3b0,_0x4c4a88,_0x363f5d);else try{_0x363f5d[_0x377020(0x10d)]++,_0x363f5d[_0x377020(0x1b7)]&&_0x363f5d[_0x377020(0x10f)]['push'](_0x2bf3b0);var _0x18fcbd,_0x433fb1,_0x474096,_0x5d1925,_0x4376b6=[],_0x410b80=[],_0x1c2cde,_0x4e4ecd=this[_0x377020(0x193)](_0x2bf3b0),_0x4ab547=_0x4e4ecd==='array',_0x1715f4=!0x1,_0x2b510e=_0x4e4ecd==='function',_0x33450e=this[_0x377020(0x1c2)](_0x4e4ecd),_0x1a4f47=this[_0x377020(0x1dc)](_0x4e4ecd),_0x51c872=_0x33450e||_0x1a4f47,_0x5bab85={},_0xeee57b=0x0,_0x3447ef=!0x1,_0x15be58,_0x2144f8=/^(([1-9]{1}[0-9]*)|0)$/;if(_0x363f5d[_0x377020(0x14b)]){if(_0x4ab547){if(_0x433fb1=_0x2bf3b0[_0x377020(0x123)],_0x433fb1>_0x363f5d['elements']){for(_0x474096=0x0,_0x5d1925=_0x363f5d[_0x377020(0x1e0)],_0x18fcbd=_0x474096;_0x18fcbd<_0x5d1925;_0x18fcbd++)_0x410b80[_0x377020(0x1ac)](_0x277dde[_0x377020(0x12a)](_0x4376b6,_0x2bf3b0,_0x4e4ecd,_0x18fcbd,_0x363f5d));_0x4c4a88[_0x377020(0x1ca)]=!0x0;}else{for(_0x474096=0x0,_0x5d1925=_0x433fb1,_0x18fcbd=_0x474096;_0x18fcbd<_0x5d1925;_0x18fcbd++)_0x410b80[_0x377020(0x1ac)](_0x277dde[_0x377020(0x12a)](_0x4376b6,_0x2bf3b0,_0x4e4ecd,_0x18fcbd,_0x363f5d));}_0x363f5d[_0x377020(0x11d)]+=_0x410b80[_0x377020(0x123)];}if(!(_0x4e4ecd===_0x377020(0x16a)||_0x4e4ecd===_0x377020(0x1e3))&&!_0x33450e&&_0x4e4ecd!==_0x377020(0x105)&&_0x4e4ecd!=='Buffer'&&_0x4e4ecd!==_0x377020(0x182)){var _0x42c5c6=_0x49674b[_0x377020(0x11f)]||_0x363f5d[_0x377020(0x11f)];if(this[_0x377020(0x16c)](_0x2bf3b0)?(_0x18fcbd=0x0,_0x2bf3b0[_0x377020(0x1ab)](function(_0x387777){var _0x5be22f=_0x377020;if(_0xeee57b++,_0x363f5d[_0x5be22f(0x11d)]++,_0xeee57b>_0x42c5c6){_0x3447ef=!0x0;return;}if(!_0x363f5d[_0x5be22f(0x129)]&&_0x363f5d[_0x5be22f(0x1b7)]&&_0x363f5d[_0x5be22f(0x11d)]>_0x363f5d[_0x5be22f(0x12d)]){_0x3447ef=!0x0;return;}_0x410b80[_0x5be22f(0x1ac)](_0x277dde[_0x5be22f(0x12a)](_0x4376b6,_0x2bf3b0,_0x5be22f(0x1d9),_0x18fcbd++,_0x363f5d,function(_0x2a9834){return function(){return _0x2a9834;};}(_0x387777)));})):this['_isMap'](_0x2bf3b0)&&_0x2bf3b0[_0x377020(0x1ab)](function(_0x316b01,_0x47e14e){var _0x48f2d9=_0x377020;if(_0xeee57b++,_0x363f5d[_0x48f2d9(0x11d)]++,_0xeee57b>_0x42c5c6){_0x3447ef=!0x0;return;}if(!_0x363f5d[_0x48f2d9(0x129)]&&_0x363f5d[_0x48f2d9(0x1b7)]&&_0x363f5d[_0x48f2d9(0x11d)]>_0x363f5d[_0x48f2d9(0x12d)]){_0x3447ef=!0x0;return;}var _0x3e2f2f=_0x47e14e[_0x48f2d9(0x178)]();_0x3e2f2f[_0x48f2d9(0x123)]>0x64&&(_0x3e2f2f=_0x3e2f2f[_0x48f2d9(0x1ba)](0x0,0x64)+_0x48f2d9(0x118)),_0x410b80[_0x48f2d9(0x1ac)](_0x277dde[_0x48f2d9(0x12a)](_0x4376b6,_0x2bf3b0,_0x48f2d9(0x195),_0x3e2f2f,_0x363f5d,function(_0x2f0290){return function(){return _0x2f0290;};}(_0x316b01)));}),!_0x1715f4){try{for(_0x1c2cde in _0x2bf3b0)if(!(_0x4ab547&&_0x2144f8[_0x377020(0x166)](_0x1c2cde))&&!this[_0x377020(0x1e4)](_0x2bf3b0,_0x1c2cde,_0x363f5d)){if(_0xeee57b++,_0x363f5d[_0x377020(0x11d)]++,_0xeee57b>_0x42c5c6){_0x3447ef=!0x0;break;}if(!_0x363f5d['isExpressionToEvaluate']&&_0x363f5d[_0x377020(0x1b7)]&&_0x363f5d['autoExpandPropertyCount']>_0x363f5d[_0x377020(0x12d)]){_0x3447ef=!0x0;break;}_0x410b80[_0x377020(0x1ac)](_0x277dde[_0x377020(0x151)](_0x4376b6,_0x5bab85,_0x2bf3b0,_0x4e4ecd,_0x1c2cde,_0x363f5d));}}catch{}if(_0x5bab85[_0x377020(0x120)]=!0x0,_0x2b510e&&(_0x5bab85['_p_name']=!0x0),!_0x3447ef){var _0x591c0f=[][_0x377020(0x1e1)](this[_0x377020(0x19f)](_0x2bf3b0))['concat'](this['_getOwnPropertySymbols'](_0x2bf3b0));for(_0x18fcbd=0x0,_0x433fb1=_0x591c0f['length'];_0x18fcbd<_0x433fb1;_0x18fcbd++)if(_0x1c2cde=_0x591c0f[_0x18fcbd],!(_0x4ab547&&_0x2144f8[_0x377020(0x166)](_0x1c2cde[_0x377020(0x178)]()))&&!this['_blacklistedProperty'](_0x2bf3b0,_0x1c2cde,_0x363f5d)&&!_0x5bab85['_p_'+_0x1c2cde[_0x377020(0x178)]()]){if(_0xeee57b++,_0x363f5d[_0x377020(0x11d)]++,_0xeee57b>_0x42c5c6){_0x3447ef=!0x0;break;}if(!_0x363f5d[_0x377020(0x129)]&&_0x363f5d[_0x377020(0x1b7)]&&_0x363f5d[_0x377020(0x11d)]>_0x363f5d[_0x377020(0x12d)]){_0x3447ef=!0x0;break;}_0x410b80[_0x377020(0x1ac)](_0x277dde['_addObjectProperty'](_0x4376b6,_0x5bab85,_0x2bf3b0,_0x4e4ecd,_0x1c2cde,_0x363f5d));}}}}}if(_0x4c4a88[_0x377020(0x189)]=_0x4e4ecd,_0x51c872?(_0x4c4a88[_0x377020(0x1aa)]=_0x2bf3b0[_0x377020(0x1c7)](),this[_0x377020(0x1d8)](_0x4e4ecd,_0x4c4a88,_0x363f5d,_0x49674b)):_0x4e4ecd===_0x377020(0x1c1)?_0x4c4a88[_0x377020(0x1aa)]=this[_0x377020(0x16d)][_0x377020(0x197)](_0x2bf3b0):_0x4e4ecd==='bigint'?_0x4c4a88[_0x377020(0x1aa)]=_0x2bf3b0[_0x377020(0x178)]():_0x4e4ecd===_0x377020(0x114)?_0x4c4a88['value']=this['_regExpToString'][_0x377020(0x197)](_0x2bf3b0):_0x4e4ecd===_0x377020(0x144)&&this['_Symbol']?_0x4c4a88[_0x377020(0x1aa)]=this[_0x377020(0x15a)][_0x377020(0x14f)]['toString']['call'](_0x2bf3b0):!_0x363f5d[_0x377020(0x14b)]&&!(_0x4e4ecd===_0x377020(0x16a)||_0x4e4ecd===_0x377020(0x1e3))&&(delete _0x4c4a88[_0x377020(0x1aa)],_0x4c4a88[_0x377020(0x122)]=!0x0),_0x3447ef&&(_0x4c4a88['cappedProps']=!0x0),_0x15be58=_0x363f5d[_0x377020(0x1da)][_0x377020(0x108)],_0x363f5d['node'][_0x377020(0x108)]=_0x4c4a88,this['_treeNodePropertiesBeforeFullValue'](_0x4c4a88,_0x363f5d),_0x410b80[_0x377020(0x123)]){for(_0x18fcbd=0x0,_0x433fb1=_0x410b80[_0x377020(0x123)];_0x18fcbd<_0x433fb1;_0x18fcbd++)_0x410b80[_0x18fcbd](_0x18fcbd);}_0x4376b6[_0x377020(0x123)]&&(_0x4c4a88['props']=_0x4376b6);}catch(_0x1fa9b2){_0x41b795(_0x1fa9b2,_0x4c4a88,_0x363f5d);}return this[_0x377020(0x13d)](_0x2bf3b0,_0x4c4a88),this[_0x377020(0x1ae)](_0x4c4a88,_0x363f5d),_0x363f5d[_0x377020(0x1da)]['current']=_0x15be58,_0x363f5d['level']--,_0x363f5d[_0x377020(0x1b7)]=_0x2bc8b0,_0x363f5d[_0x377020(0x1b7)]&&_0x363f5d['autoExpandPreviousObjects'][_0x377020(0x125)](),_0x4c4a88;}['_getOwnPropertySymbols'](_0xb5846){var _0x52041f=_0x27b5f4;return Object['getOwnPropertySymbols']?Object[_0x52041f(0x139)](_0xb5846):[];}[_0x27b5f4(0x16c)](_0x5282f4){var _0x3228cc=_0x27b5f4;return!!(_0x5282f4&&_0x5b4790[_0x3228cc(0x1d9)]&&this[_0x3228cc(0x15e)](_0x5282f4)===_0x3228cc(0x1a5)&&_0x5282f4[_0x3228cc(0x1ab)]);}['_blacklistedProperty'](_0x3e1e02,_0x19f7da,_0x2ed27d){var _0x3d5f32=_0x27b5f4;return _0x2ed27d[_0x3d5f32(0x158)]?typeof _0x3e1e02[_0x19f7da]==_0x3d5f32(0x1c5):!0x1;}[_0x27b5f4(0x193)](_0x1d8bce){var _0xf22702=_0x27b5f4,_0x8f3c98='';return _0x8f3c98=typeof _0x1d8bce,_0x8f3c98==='object'?this[_0xf22702(0x15e)](_0x1d8bce)===_0xf22702(0x1e2)?_0x8f3c98=_0xf22702(0x126):this[_0xf22702(0x15e)](_0x1d8bce)===_0xf22702(0x149)?_0x8f3c98=_0xf22702(0x1c1):this[_0xf22702(0x15e)](_0x1d8bce)===_0xf22702(0x18e)?_0x8f3c98='bigint':_0x1d8bce===null?_0x8f3c98=_0xf22702(0x16a):_0x1d8bce['constructor']&&(_0x8f3c98=_0x1d8bce[_0xf22702(0x1be)][_0xf22702(0x110)]||_0x8f3c98):_0x8f3c98===_0xf22702(0x1e3)&&this['_HTMLAllCollection']&&_0x1d8bce instanceof this['_HTMLAllCollection']&&(_0x8f3c98='HTMLAllCollection'),_0x8f3c98;}['_objectToString'](_0x362d66){var _0x3c798c=_0x27b5f4;return Object[_0x3c798c(0x14f)][_0x3c798c(0x178)][_0x3c798c(0x197)](_0x362d66);}['_isPrimitiveType'](_0x291f7d){var _0x5359d4=_0x27b5f4;return _0x291f7d===_0x5359d4(0x145)||_0x291f7d===_0x5359d4(0x14e)||_0x291f7d==='number';}[_0x27b5f4(0x1dc)](_0x4cbff7){var _0x3ee85a=_0x27b5f4;return _0x4cbff7==='Boolean'||_0x4cbff7===_0x3ee85a(0x105)||_0x4cbff7===_0x3ee85a(0x10e);}['_addProperty'](_0x2378df,_0x35fcbe,_0x1b181f,_0xaf562b,_0xd53cb8,_0x399f00){var _0x452e20=this;return function(_0x144d49){var _0x201876=_0x4cb1,_0x46a7c6=_0xd53cb8[_0x201876(0x1da)][_0x201876(0x108)],_0x3d1f64=_0xd53cb8[_0x201876(0x1da)][_0x201876(0x163)],_0x411984=_0xd53cb8['node'][_0x201876(0x192)];_0xd53cb8[_0x201876(0x1da)][_0x201876(0x192)]=_0x46a7c6,_0xd53cb8['node'][_0x201876(0x163)]=typeof _0xaf562b==_0x201876(0x1cb)?_0xaf562b:_0x144d49,_0x2378df['push'](_0x452e20['_property'](_0x35fcbe,_0x1b181f,_0xaf562b,_0xd53cb8,_0x399f00)),_0xd53cb8[_0x201876(0x1da)][_0x201876(0x192)]=_0x411984,_0xd53cb8['node'][_0x201876(0x163)]=_0x3d1f64;};}[_0x27b5f4(0x151)](_0x447828,_0x14c2cb,_0x2514be,_0x499052,_0x3ac241,_0x50d530,_0x5931a7){var _0x5d6f85=_0x27b5f4,_0x22fac8=this;return _0x14c2cb[_0x5d6f85(0x152)+_0x3ac241[_0x5d6f85(0x178)]()]=!0x0,function(_0x2163ab){var _0x46ef79=_0x5d6f85,_0x4e6994=_0x50d530['node'][_0x46ef79(0x108)],_0x379fad=_0x50d530[_0x46ef79(0x1da)][_0x46ef79(0x163)],_0x4648ab=_0x50d530[_0x46ef79(0x1da)]['parent'];_0x50d530[_0x46ef79(0x1da)][_0x46ef79(0x192)]=_0x4e6994,_0x50d530[_0x46ef79(0x1da)][_0x46ef79(0x163)]=_0x2163ab,_0x447828[_0x46ef79(0x1ac)](_0x22fac8[_0x46ef79(0x1ad)](_0x2514be,_0x499052,_0x3ac241,_0x50d530,_0x5931a7)),_0x50d530[_0x46ef79(0x1da)]['parent']=_0x4648ab,_0x50d530['node']['index']=_0x379fad;};}[_0x27b5f4(0x1ad)](_0x11ba45,_0x2c8472,_0x75afa4,_0xef2682,_0x2e97cf){var _0x5d139e=_0x27b5f4,_0x2f2ead=this;_0x2e97cf||(_0x2e97cf=function(_0x2f3675,_0x36e0f8){return _0x2f3675[_0x36e0f8];});var _0x1d0670=_0x75afa4['toString'](),_0x127b27=_0xef2682['expressionsToEvaluate']||{},_0x3818ef=_0xef2682[_0x5d139e(0x14b)],_0x501535=_0xef2682[_0x5d139e(0x129)];try{var _0x1654e3=this[_0x5d139e(0x157)](_0x11ba45),_0x22d9d0=_0x1d0670;_0x1654e3&&_0x22d9d0[0x0]==='\\x27'&&(_0x22d9d0=_0x22d9d0[_0x5d139e(0x184)](0x1,_0x22d9d0[_0x5d139e(0x123)]-0x2));var _0x10bfe0=_0xef2682[_0x5d139e(0x117)]=_0x127b27[_0x5d139e(0x152)+_0x22d9d0];_0x10bfe0&&(_0xef2682[_0x5d139e(0x14b)]=_0xef2682['depth']+0x1),_0xef2682[_0x5d139e(0x129)]=!!_0x10bfe0;var _0x108f45=typeof _0x75afa4==_0x5d139e(0x144),_0x289b97={'name':_0x108f45||_0x1654e3?_0x1d0670:this[_0x5d139e(0x115)](_0x1d0670)};if(_0x108f45&&(_0x289b97[_0x5d139e(0x144)]=!0x0),!(_0x2c8472===_0x5d139e(0x126)||_0x2c8472===_0x5d139e(0x14c))){var _0x2bf7ad=this[_0x5d139e(0x1c0)](_0x11ba45,_0x75afa4);if(_0x2bf7ad&&(_0x2bf7ad['set']&&(_0x289b97['setter']=!0x0),_0x2bf7ad['get']&&!_0x10bfe0&&!_0xef2682[_0x5d139e(0x165)]))return _0x289b97['getter']=!0x0,this[_0x5d139e(0x17a)](_0x289b97,_0xef2682),_0x289b97;}var _0x1f14f8;try{_0x1f14f8=_0x2e97cf(_0x11ba45,_0x75afa4);}catch(_0x309f6f){return _0x289b97={'name':_0x1d0670,'type':_0x5d139e(0x173),'error':_0x309f6f[_0x5d139e(0x155)]},this['_processTreeNodeResult'](_0x289b97,_0xef2682),_0x289b97;}var _0x19f7d6=this[_0x5d139e(0x193)](_0x1f14f8),_0x21be7b=this[_0x5d139e(0x1c2)](_0x19f7d6);if(_0x289b97[_0x5d139e(0x189)]=_0x19f7d6,_0x21be7b)this['_processTreeNodeResult'](_0x289b97,_0xef2682,_0x1f14f8,function(){var _0x24bfe4=_0x5d139e;_0x289b97[_0x24bfe4(0x1aa)]=_0x1f14f8[_0x24bfe4(0x1c7)](),!_0x10bfe0&&_0x2f2ead[_0x24bfe4(0x1d8)](_0x19f7d6,_0x289b97,_0xef2682,{});});else{var _0x24f667=_0xef2682['autoExpand']&&_0xef2682['level']<_0xef2682[_0x5d139e(0x18f)]&&_0xef2682[_0x5d139e(0x10f)][_0x5d139e(0x11a)](_0x1f14f8)<0x0&&_0x19f7d6!==_0x5d139e(0x1c5)&&_0xef2682[_0x5d139e(0x11d)]<_0xef2682['autoExpandLimit'];_0x24f667||_0xef2682['level']<_0x3818ef||_0x10bfe0?(this[_0x5d139e(0x111)](_0x289b97,_0x1f14f8,_0xef2682,_0x10bfe0||{}),this[_0x5d139e(0x13d)](_0x1f14f8,_0x289b97)):this['_processTreeNodeResult'](_0x289b97,_0xef2682,_0x1f14f8,function(){var _0x55b27e=_0x5d139e;_0x19f7d6===_0x55b27e(0x16a)||_0x19f7d6==='undefined'||(delete _0x289b97[_0x55b27e(0x1aa)],_0x289b97['capped']=!0x0);});}return _0x289b97;}finally{_0xef2682[_0x5d139e(0x117)]=_0x127b27,_0xef2682[_0x5d139e(0x14b)]=_0x3818ef,_0xef2682[_0x5d139e(0x129)]=_0x501535;}}[_0x27b5f4(0x1d8)](_0x345b2b,_0x37826c,_0x493a0b,_0x5bbe39){var _0x41c5d3=_0x27b5f4,_0x4e7ce2=_0x5bbe39[_0x41c5d3(0x13e)]||_0x493a0b[_0x41c5d3(0x13e)];if((_0x345b2b==='string'||_0x345b2b==='String')&&_0x37826c[_0x41c5d3(0x1aa)]){let _0x58e7f0=_0x37826c['value'][_0x41c5d3(0x123)];_0x493a0b[_0x41c5d3(0x17b)]+=_0x58e7f0,_0x493a0b[_0x41c5d3(0x17b)]>_0x493a0b['totalStrLength']?(_0x37826c[_0x41c5d3(0x122)]='',delete _0x37826c[_0x41c5d3(0x1aa)]):_0x58e7f0>_0x4e7ce2&&(_0x37826c[_0x41c5d3(0x122)]=_0x37826c[_0x41c5d3(0x1aa)][_0x41c5d3(0x184)](0x0,_0x4e7ce2),delete _0x37826c[_0x41c5d3(0x1aa)]);}}[_0x27b5f4(0x157)](_0x27e462){var _0x52af29=_0x27b5f4;return!!(_0x27e462&&_0x5b4790[_0x52af29(0x195)]&&this[_0x52af29(0x15e)](_0x27e462)===_0x52af29(0x1db)&&_0x27e462[_0x52af29(0x1ab)]);}['_propertyName'](_0x4009b0){var _0xaac64b=_0x27b5f4;if(_0x4009b0[_0xaac64b(0x1e5)](/^\\d+$/))return _0x4009b0;var _0x3df4b1;try{_0x3df4b1=JSON[_0xaac64b(0x183)](''+_0x4009b0);}catch{_0x3df4b1='\\x22'+this[_0xaac64b(0x15e)](_0x4009b0)+'\\x22';}return _0x3df4b1[_0xaac64b(0x1e5)](/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)?_0x3df4b1=_0x3df4b1['substr'](0x1,_0x3df4b1[_0xaac64b(0x123)]-0x2):_0x3df4b1=_0x3df4b1[_0xaac64b(0x1de)](/'/g,'\\x5c\\x27')[_0xaac64b(0x1de)](/\\\\\"/g,'\\x22')[_0xaac64b(0x1de)](/(^\"|\"$)/g,'\\x27'),_0x3df4b1;}['_processTreeNodeResult'](_0x19824d,_0x5c5e8f,_0x1680fa,_0x5b0779){var _0x3d2550=_0x27b5f4;this['_treeNodePropertiesBeforeFullValue'](_0x19824d,_0x5c5e8f),_0x5b0779&&_0x5b0779(),this[_0x3d2550(0x13d)](_0x1680fa,_0x19824d),this[_0x3d2550(0x1ae)](_0x19824d,_0x5c5e8f);}[_0x27b5f4(0x127)](_0x5aff2e,_0x47d2f7){var _0x5cd962=_0x27b5f4;this[_0x5cd962(0x10b)](_0x5aff2e,_0x47d2f7),this[_0x5cd962(0x196)](_0x5aff2e,_0x47d2f7),this[_0x5cd962(0x17f)](_0x5aff2e,_0x47d2f7),this[_0x5cd962(0x134)](_0x5aff2e,_0x47d2f7);}['_setNodeId'](_0x452ae7,_0x297f1b){}[_0x27b5f4(0x196)](_0xece9cb,_0x4e0399){}['_setNodeLabel'](_0x2c0a1b,_0x23ac11){}[_0x27b5f4(0x18c)](_0x41f0d5){var _0x5db41b=_0x27b5f4;return _0x41f0d5===this[_0x5db41b(0x19a)];}[_0x27b5f4(0x1ae)](_0x327dda,_0x2ed747){var _0x28aea0=_0x27b5f4;this['_setNodeLabel'](_0x327dda,_0x2ed747),this[_0x28aea0(0x15b)](_0x327dda),_0x2ed747['sortProps']&&this[_0x28aea0(0x154)](_0x327dda),this[_0x28aea0(0x1c3)](_0x327dda,_0x2ed747),this[_0x28aea0(0x11b)](_0x327dda,_0x2ed747),this[_0x28aea0(0x1d4)](_0x327dda);}[_0x27b5f4(0x13d)](_0x28ed57,_0x2f9ad0){var _0x2f2aa2=_0x27b5f4;try{_0x28ed57&&typeof _0x28ed57[_0x2f2aa2(0x123)]==_0x2f2aa2(0x1cb)&&(_0x2f9ad0[_0x2f2aa2(0x123)]=_0x28ed57[_0x2f2aa2(0x123)]);}catch{}if(_0x2f9ad0[_0x2f2aa2(0x189)]===_0x2f2aa2(0x1cb)||_0x2f9ad0['type']==='Number'){if(isNaN(_0x2f9ad0['value']))_0x2f9ad0[_0x2f2aa2(0x164)]=!0x0,delete _0x2f9ad0['value'];else switch(_0x2f9ad0[_0x2f2aa2(0x1aa)]){case Number['POSITIVE_INFINITY']:_0x2f9ad0[_0x2f2aa2(0x14d)]=!0x0,delete _0x2f9ad0[_0x2f2aa2(0x1aa)];break;case Number[_0x2f2aa2(0x199)]:_0x2f9ad0[_0x2f2aa2(0x1bc)]=!0x0,delete _0x2f9ad0[_0x2f2aa2(0x1aa)];break;case 0x0:this[_0x2f2aa2(0x1e7)](_0x2f9ad0[_0x2f2aa2(0x1aa)])&&(_0x2f9ad0[_0x2f2aa2(0x12e)]=!0x0);break;}}else _0x2f9ad0[_0x2f2aa2(0x189)]===_0x2f2aa2(0x1c5)&&typeof _0x28ed57[_0x2f2aa2(0x110)]=='string'&&_0x28ed57[_0x2f2aa2(0x110)]&&_0x2f9ad0[_0x2f2aa2(0x110)]&&_0x28ed57[_0x2f2aa2(0x110)]!==_0x2f9ad0['name']&&(_0x2f9ad0['funcName']=_0x28ed57[_0x2f2aa2(0x110)]);}[_0x27b5f4(0x1e7)](_0x2ebacd){return 0x1/_0x2ebacd===Number['NEGATIVE_INFINITY'];}[_0x27b5f4(0x154)](_0x33f55f){var _0x2880b5=_0x27b5f4;!_0x33f55f[_0x2880b5(0x11f)]||!_0x33f55f['props'][_0x2880b5(0x123)]||_0x33f55f[_0x2880b5(0x189)]==='array'||_0x33f55f[_0x2880b5(0x189)]===_0x2880b5(0x195)||_0x33f55f[_0x2880b5(0x189)]===_0x2880b5(0x1d9)||_0x33f55f[_0x2880b5(0x11f)]['sort'](function(_0xeb1d3d,_0x1e5ad8){var _0x465665=_0x2880b5,_0x228711=_0xeb1d3d[_0x465665(0x110)][_0x465665(0x16b)](),_0x4a8d2e=_0x1e5ad8[_0x465665(0x110)][_0x465665(0x16b)]();return _0x228711<_0x4a8d2e?-0x1:_0x228711>_0x4a8d2e?0x1:0x0;});}['_addFunctionsNode'](_0x44bb25,_0x246ec6){var _0x22ee2b=_0x27b5f4;if(!(_0x246ec6['noFunctions']||!_0x44bb25[_0x22ee2b(0x11f)]||!_0x44bb25[_0x22ee2b(0x11f)][_0x22ee2b(0x123)])){for(var _0xdec3bc=[],_0x3df253=[],_0x3979be=0x0,_0x45594a=_0x44bb25[_0x22ee2b(0x11f)][_0x22ee2b(0x123)];_0x3979be<_0x45594a;_0x3979be++){var _0x5162e2=_0x44bb25[_0x22ee2b(0x11f)][_0x3979be];_0x5162e2[_0x22ee2b(0x189)]==='function'?_0xdec3bc[_0x22ee2b(0x1ac)](_0x5162e2):_0x3df253[_0x22ee2b(0x1ac)](_0x5162e2);}if(!(!_0x3df253[_0x22ee2b(0x123)]||_0xdec3bc['length']<=0x1)){_0x44bb25[_0x22ee2b(0x11f)]=_0x3df253;var _0x21a1e2={'functionsNode':!0x0,'props':_0xdec3bc};this[_0x22ee2b(0x10b)](_0x21a1e2,_0x246ec6),this[_0x22ee2b(0x169)](_0x21a1e2,_0x246ec6),this[_0x22ee2b(0x15b)](_0x21a1e2),this[_0x22ee2b(0x134)](_0x21a1e2,_0x246ec6),_0x21a1e2['id']+='\\x20f',_0x44bb25[_0x22ee2b(0x11f)][_0x22ee2b(0x11e)](_0x21a1e2);}}}[_0x27b5f4(0x11b)](_0x4447de,_0x39bc80){}[_0x27b5f4(0x15b)](_0x2ad7d8){}[_0x27b5f4(0x172)](_0x21c674){var _0x201530=_0x27b5f4;return Array[_0x201530(0x132)](_0x21c674)||typeof _0x21c674==_0x201530(0x1d1)&&this[_0x201530(0x15e)](_0x21c674)===_0x201530(0x1e2);}['_setNodePermissions'](_0x2c4127,_0x25c7dc){}[_0x27b5f4(0x1d4)](_0x368d9f){var _0x1076c1=_0x27b5f4;delete _0x368d9f['_hasSymbolPropertyOnItsPath'],delete _0x368d9f[_0x1076c1(0x13a)],delete _0x368d9f[_0x1076c1(0x161)];}[_0x27b5f4(0x17f)](_0x3b452d,_0x210ca2){}['_propertyAccessor'](_0x40ae2e){var _0x9d2342=_0x27b5f4;return _0x40ae2e?_0x40ae2e[_0x9d2342(0x1e5)](this[_0x9d2342(0x106)])?'['+_0x40ae2e+']':_0x40ae2e[_0x9d2342(0x1e5)](this['_keyStrRegExp'])?'.'+_0x40ae2e:_0x40ae2e[_0x9d2342(0x1e5)](this['_quotedRegExp'])?'['+_0x40ae2e+']':'[\\x27'+_0x40ae2e+'\\x27]':'';}}let _0x103982=new _0x7302f2();function _0x4ef4d5(_0x447b63,_0x2ac7e6,_0x1a6859,_0x160f8a,_0x430090,_0x134fa9){var _0x27e421=_0x27b5f4;let _0x16431e,_0x4089ff;try{_0x4089ff=_0x4d049a(),_0x16431e=_0xe1c80c[_0x2ac7e6],!_0x16431e||_0x4089ff-_0x16431e['ts']>0x1f4&&_0x16431e[_0x27e421(0x1bb)]&&_0x16431e[_0x27e421(0x148)]/_0x16431e['count']<0x64?(_0xe1c80c[_0x2ac7e6]=_0x16431e={'count':0x0,'time':0x0,'ts':_0x4089ff},_0xe1c80c['hits']={}):_0x4089ff-_0xe1c80c[_0x27e421(0x1bf)]['ts']>0x32&&_0xe1c80c[_0x27e421(0x1bf)]['count']&&_0xe1c80c['hits'][_0x27e421(0x148)]/_0xe1c80c[_0x27e421(0x1bf)][_0x27e421(0x1bb)]<0x64&&(_0xe1c80c[_0x27e421(0x1bf)]={});let _0x2f24ca=[],_0x2739a9=_0x16431e[_0x27e421(0x19e)]||_0xe1c80c[_0x27e421(0x1bf)][_0x27e421(0x19e)]?_0x5df0c1:_0x538d0c,_0x147472=_0x372ec9=>{var _0x4a7838=_0x27e421;let _0x5c2b64={};return _0x5c2b64[_0x4a7838(0x11f)]=_0x372ec9['props'],_0x5c2b64[_0x4a7838(0x1e0)]=_0x372ec9[_0x4a7838(0x1e0)],_0x5c2b64[_0x4a7838(0x13e)]=_0x372ec9[_0x4a7838(0x13e)],_0x5c2b64[_0x4a7838(0x12c)]=_0x372ec9[_0x4a7838(0x12c)],_0x5c2b64[_0x4a7838(0x12d)]=_0x372ec9['autoExpandLimit'],_0x5c2b64['autoExpandMaxDepth']=_0x372ec9[_0x4a7838(0x18f)],_0x5c2b64[_0x4a7838(0x1b3)]=!0x1,_0x5c2b64[_0x4a7838(0x158)]=!_0x2df5e3,_0x5c2b64[_0x4a7838(0x14b)]=0x1,_0x5c2b64[_0x4a7838(0x10d)]=0x0,_0x5c2b64[_0x4a7838(0x171)]=_0x4a7838(0x1e6),_0x5c2b64[_0x4a7838(0x141)]=_0x4a7838(0x1c4),_0x5c2b64['autoExpand']=!0x0,_0x5c2b64['autoExpandPreviousObjects']=[],_0x5c2b64[_0x4a7838(0x11d)]=0x0,_0x5c2b64['resolveGetters']=!0x0,_0x5c2b64[_0x4a7838(0x17b)]=0x0,_0x5c2b64[_0x4a7838(0x1da)]={'current':void 0x0,'parent':void 0x0,'index':0x0},_0x5c2b64;};for(var _0x1e1001=0x0;_0x1e1001<_0x430090[_0x27e421(0x123)];_0x1e1001++)_0x2f24ca[_0x27e421(0x1ac)](_0x103982['serialize']({'timeNode':_0x447b63===_0x27e421(0x148)||void 0x0},_0x430090[_0x1e1001],_0x147472(_0x2739a9),{}));if(_0x447b63==='trace'){let _0x58fe7f=Error['stackTraceLimit'];try{Error['stackTraceLimit']=0x1/0x0,_0x2f24ca[_0x27e421(0x1ac)](_0x103982[_0x27e421(0x111)]({'stackNode':!0x0},new Error()['stack'],_0x147472(_0x2739a9),{'strLength':0x1/0x0}));}finally{Error[_0x27e421(0x188)]=_0x58fe7f;}}return{'method':_0x27e421(0x1b6),'version':_0x3fd8d0,'args':[{'ts':_0x1a6859,'session':_0x160f8a,'args':_0x2f24ca,'id':_0x2ac7e6,'context':_0x134fa9}]};}catch(_0xe8878a){return{'method':_0x27e421(0x1b6),'version':_0x3fd8d0,'args':[{'ts':_0x1a6859,'session':_0x160f8a,'args':[{'type':'unknown','error':_0xe8878a&&_0xe8878a[_0x27e421(0x155)]}],'id':_0x2ac7e6,'context':_0x134fa9}]};}finally{try{if(_0x16431e&&_0x4089ff){let _0x956241=_0x4d049a();_0x16431e[_0x27e421(0x1bb)]++,_0x16431e[_0x27e421(0x148)]+=_0x272fdc(_0x4089ff,_0x956241),_0x16431e['ts']=_0x956241,_0xe1c80c[_0x27e421(0x1bf)][_0x27e421(0x1bb)]++,_0xe1c80c[_0x27e421(0x1bf)][_0x27e421(0x148)]+=_0x272fdc(_0x4089ff,_0x956241),_0xe1c80c['hits']['ts']=_0x956241,(_0x16431e[_0x27e421(0x1bb)]>0x32||_0x16431e['time']>0x64)&&(_0x16431e[_0x27e421(0x19e)]=!0x0),(_0xe1c80c[_0x27e421(0x1bf)][_0x27e421(0x1bb)]>0x3e8||_0xe1c80c['hits'][_0x27e421(0x148)]>0x12c)&&(_0xe1c80c[_0x27e421(0x1bf)]['reduceLimits']=!0x0);}}catch{}}}return _0x5b4790[_0x27b5f4(0x18b)];})(globalThis,_0x5c041f(0x124),_0x5c041f(0x160),_0x5c041f(0x174),_0x5c041f(0x19b),_0x5c041f(0x18a),_0x5c041f(0x17d),_0x5c041f(0x198),_0x5c041f(0x1d7));")}catch(e){}})().consoleLog(e,t)}catch(e){}return t}const ie=document.getElementById("canv"),ae=document.getElementById("fps"),oe=(document.getElementById("kloppenheim_02"),document.getElementById("slice-canvas")),ce=new class{constructor(){this.grid_size=9,this.voxel_count=24,this.direct_light_phi=0,this.direct_light_theta=0,this.ao_strength=.8,this.ambient_light=.2,this.grid=new Array(this.grid_size*this.grid_size*this.grid_size),this.meta_grid=new Array(this.grid_size*this.grid_size*this.grid_size),this.boundary_min=[-this.grid_size/2,-this.grid_size/2,-this.grid_size/2],this.boundary_max=[this.grid_size/2,this.grid_size/2,this.grid_size/2],this.voxel_size=this.grid_size/this.voxel_count,this.initialize_grid(),this.direct_light=Q.normalize([1.5,.6,3]),this.direct_light_brightness=1,this.background_color=[0,0,0],this.input_direct_light=document.getElementById("sun_strength"),this.input_direct_light.addEventListener("input",(e=>{this.direct_light_brightness=parseInt(this.input_direct_light.value)/50})),this.input_direct_light_phi=document.getElementById("sun_phi"),this.input_direct_light_theta=document.getElementById("sun_theta"),this.input_direct_light_phi.addEventListener("input",(e=>{this.updateDirectLight(parseInt(this.input_direct_light_phi.value),parseInt(this.input_direct_light_theta.value))})),this.input_direct_light_theta.addEventListener("input",(e=>{this.updateDirectLight(parseInt(this.input_direct_light_phi.value),parseInt(this.input_direct_light_theta.value))})),this.input_ao_strength=document.getElementById("ao_strength"),this.input_ao_strength.addEventListener("input",(e=>{this.ao_strength=parseInt(this.input_ao_strength.value)/100})),this.input_ambient_light=document.getElementById("ambient_light"),this.input_ambient_light.addEventListener("input",(e=>{this.ambient_light=parseInt(this.input_ambient_light.value)/100}))}updateDirectLight(e,t){this.direct_light_phi=e,this.direct_light_theta=t,this.direct_light=[Math.cos(K(t))*Math.cos(K(e)),Math.sin(K(t))*Math.cos(K(e)),Math.sin(K(e))]}serialize_scene(){return JSON.stringify(this)}deserialize_scene(e){const t=JSON.parse(e);this.grid=t.grid,this.grid_size=this.grid_size,this.boundary_min=t.boundary_min,this.boundary_max=t.boundary_max,this.voxel_count=t.voxel_count,this.direct_light=t.direct_light,this.direct_light_brightness=t.direct_light_brightness,this.input_direct_light.value=(100*t.direct_light_brightness).toString(),this.ao_strength=t.ao_strength,this.input_ao_strength.value=(100*t.ao_strength).toString(),this.ambient_light=t.ambient_light,this.input_ambient_light.value=(100*t.ambient_light).toString(),this.direct_light_phi=t.direct_light_phi,this.input_direct_light_phi.value=t.direct_light_phi.toString(),this.direct_light_theta=t.direct_light_theta,this.input_direct_light_theta.value=t.direct_light_theta.toString()}reset(){this.initialize_grid(),this.initialize_default_grid()}initialize_grid(){this.grid=new Array(this.voxel_count**3),this.meta_grid=new Array(this.voxel_count**3);for(let e=0;e<this.voxel_count;e++)for(let t=0;t<this.voxel_count;t++)for(let r=0;r<this.voxel_count;r++){let x=new re;x.color=[0,0,0],x.opacity=0,this.grid[r*this.voxel_count*this.voxel_count+t*this.voxel_count+e]=x;let n=new xe;this.meta_grid[r*this.voxel_count*this.voxel_count+t*this.voxel_count+e]=n}}initialize_default_grid(){for(let e=0;e<this.voxel_count;e++)for(let t=0;t<this.voxel_count;t++)for(let r=0;r<this.voxel_count;r++){let x=new re;r<3&&(x.color=[e/this.voxel_count,t/this.voxel_count,r/this.voxel_count],Q.scale(x.color,2,x.color),x.opacity=1,x.lightness=0,x.roughness=1),x.color[0]=Math.min(1,x.color[0]),x.color[1]=Math.min(1,x.color[1]),x.color[2]=Math.min(1,x.color[2]),this.set_voxel_comp(x,e,t,r)}this.calc_gi()}calc_gi(){for(let e=0;e<this.voxel_count;e++)for(let t=0;t<this.voxel_count;t++)for(let r=0;r<this.voxel_count;r++){const x=new ee(this.get_voxel_center([e,t,r]),Q.inverse(this.direct_light));this.ray_any(x)||(this.meta_grid[this.get_voxel_id([e,t,r])].gi=Q.scale([1,1,1],this.direct_light_brightness))}}ray_any(e){let t=0,r=1/0;for(let x=0;x<3;x++){let n=(this.boundary_min[x]-e.origin[x])*e.inv_direction[x],_=(this.boundary_max[x]-e.origin[x])*e.inv_direction[x];t=Math.min(Math.max(n,t),Math.max(_,t)),r=Math.max(Math.min(n,r),Math.min(_,r))}if(t>r)return;const x=Q.add(e.origin,Q.scale(e.direction,t)),n=Q.add(e.origin,Q.scale(e.direction,r));let _=[Math.max(0,Math.min(this.voxel_count-1,Math.floor((x[0]-this.boundary_min[0])/this.voxel_size))),Math.max(0,Math.min(this.voxel_count-1,Math.floor((x[1]-this.boundary_min[1])/this.voxel_size))),Math.max(0,Math.min(this.voxel_count-1,Math.floor((x[2]-this.boundary_min[2])/this.voxel_size)))],i=[_[0]+1,_[1]+1,_[2]+1],a=[0,0,0],o=[0,0,0],c=[0,0,0],s=[0,0,0],d=t,l=[0,0,0];for(let d=0;d<3;d++)s[d]=Math.max(0,Math.min(this.voxel_count-1,Math.floor((n[d]-this.boundary_min[d])/this.voxel_size))),e.direction[d]>0?(a[d]=1,c[d]=this.voxel_size/e.direction[d],o[d]=t+(this.boundary_min[d]+i[d]*this.voxel_size-x[d])/e.direction[d]):e.direction[d]<0?(a[d]=-1,c[d]=this.voxel_size/-e.direction[d],o[d]=t+(this.boundary_min[d]+_[d]*this.voxel_size-x[d])/e.direction[d]):(a[d]=0,c[d]=r,o[d]=r);for(;_[0]<this.voxel_count&&_[0]>=0&&_[1]<this.voxel_count&&_[1]>=0&&_[2]<this.voxel_count&&_[2]>=0;){if(this.get_voxel(_).opacity>.01){const t=Q.add(e.origin,Q.scale(e.direction,d));return new te(t,_,this.get_voxel(_),l)}o[0]<o[1]&&o[0]<o[2]?(_[0]+=a[0],d=o[0],o[0]+=c[0],l=[-a[0],0,0]):o[1]<o[2]?(_[1]+=a[1],d=o[1],o[1]+=c[1],l=[0,-a[1],0]):(_[2]+=a[2],d=o[2],o[2]+=c[2],l=[0,0,-a[2]])}}get_voxel_center(e){return[e[0]*this.voxel_size-this.boundary_min[0],e[1]*this.voxel_size-this.boundary_min[1],e[2]*this.voxel_size-this.boundary_min[2]]}get_voxel_id_comp(e,t,r){return r*this.voxel_count*this.voxel_count+t*this.voxel_count+e}get_voxel_id(e){return e[2]*this.voxel_count*this.voxel_count+e[1]*this.voxel_count+e[0]}get_voxel_comp(e,t,r){return this.grid[r*this.voxel_count*this.voxel_count+t*this.voxel_count+e]}get_voxel(e){return this.grid[e[2]*this.voxel_count*this.voxel_count+e[1]*this.voxel_count+e[0]]}set_voxel(e,t){t[0]>0&&t[0]<this.voxel_count-1&&t[1]>0&&t[1]<this.voxel_count-1&&t[2]>0&&t[2]<this.voxel_count-1&&(this.grid[t[2]*this.voxel_count*this.voxel_count+t[1]*this.voxel_count+t[0]]=e)}set_voxel_comp(e,t,r,x){t>0&&t<this.voxel_count-1&&r>0&&r<this.voxel_count-1&&x>0&&x<this.voxel_count-1&&(this.grid[x*this.voxel_count*this.voxel_count+r*this.voxel_count+t]=e)}};let se=new class{constructor(e,t,r,x,n){this.mouse_down=!1,this.mouse_dragged=!1,this.over_canvas=!1,this.last_move=0,this.velocity=[0,0],this.selected_color=[0,0,0],this.selected_roughness=1,this.selected_opacity=1,this.selected_lightness=0,this.multidraw=!1,this.last_drawn=[0,0,0],this.camera=new ne(r,x,n),this.last_move=performance.now(),this.last_movement=[0,0],this.scene=e,this.canvas=t,this.selected_tool="place",this.blub_high=document.getElementById("blub_high"),this.blub_low=document.getElementById("blub_low"),this.setup()}tick(e){this.camera.tick(e)}setup(){var e,t,r,x,n,_,i;this.canvas.addEventListener("mouseover",(e=>{this.over_canvas=!0})),this.canvas.addEventListener("mouseout",(e=>{this.over_canvas=!1})),addEventListener("mousedown",(e=>{this.over_canvas&&0==e.button&&(e.shiftKey&&(this.multidraw=!0),this.mouse_down=!0,this.mouse_dragged=!1,this.camera.dragged=!0,this.last_move=performance.now())})),addEventListener("mouseup",(e=>{if(0==e.button&&(this.mouse_down&&(this.camera.velocity=[...this.velocity]),this.mouse_down=!1,this.camera.dragged=!1,this.multidraw=!1,!this.mouse_dragged)){const t=this.canvas.getBoundingClientRect(),r=e.clientX-t.left,x=e.clientY-t.top;let n=this.scene.ray_any(this.camera.screen_to_ray(r,x,t.width,t.height));if(n)switch(this.selected_tool){case"place":let e=new re;e.color=this.selected_color,e.roughness=this.selected_roughness,e.lightness=this.selected_lightness,e.opacity=this.selected_opacity;let t=n.voxel_position.map(((e,t)=>e+n.normal[t]));this.scene.set_voxel(e,t),this.blub_high.play(),this.last_drawn=t;break;case"replace":let r=new re;r.color=this.selected_color,r.roughness=this.selected_roughness,r.lightness=this.selected_lightness,r.opacity=this.selected_opacity,this.scene.set_voxel(r,n.voxel_position),this.blub_high.play(),this.last_drawn=n.voxel_position;break;case"remove":let x=new re;x.opacity=0,this.scene.set_voxel(x,n.voxel_position),this.blub_low.play()}}})),addEventListener("mousemove",(e=>{if(this.last_movement=E.scale([e.movementX,e.movementY],.2),this.mouse_down&&(this.mouse_drag(e),this.multidraw)){const t=this.canvas.getBoundingClientRect(),r=e.clientX-t.left,x=e.clientY-t.top;let n=this.scene.ray_any(this.camera.screen_to_ray(r,x,t.width,t.height));if(n&&n.voxel_position.toString()!==this.last_drawn.toString()){if("place"==this.selected_tool){let e=new re;e.color=this.selected_color,e.roughness=this.selected_roughness,e.lightness=this.selected_lightness,e.opacity=this.selected_opacity;let t=n.voxel_position.map(((e,t)=>e+n.normal[t]));this.scene.set_voxel(e,t),this.blub_high.play(),this.last_drawn=t}if("replace"==this.selected_tool){let e=new re;e.color=this.selected_color,e.roughness=this.selected_roughness,e.lightness=this.selected_lightness,e.opacity=this.selected_opacity,this.scene.set_voxel(e,n.voxel_position),this.blub_high.play(),this.last_drawn=n.voxel_position}if("remove"==this.selected_tool){let e=new re;e.opacity=0,this.scene.set_voxel(e,n.voxel_position),this.blub_low.play();let _=this.scene.ray_any(this.camera.screen_to_ray(r,x,t.width,t.height));_&&(this.last_drawn=_.voxel_position)}}}this.calculate_velocity(),this.last_move=performance.now()})),null===(e=document.getElementById("color_value"))||void 0===e||e.addEventListener("input",(e=>{var t;const r=e.target.value;this.selected_color=Q.scale(null===(t=r.match(/\w\w/g))||void 0===t?void 0:t.map((e=>parseInt(e,16))),1/255)})),null===(t=document.getElementById("roughness_value"))||void 0===t||t.addEventListener("input",(e=>{this.selected_roughness=1-parseInt(e.target.value)/100})),null===(r=document.getElementById("lightness_value"))||void 0===r||r.addEventListener("input",(e=>{this.selected_lightness=parseInt(e.target.value)/25})),null===(x=document.getElementById("opacity_value"))||void 0===x||x.addEventListener("input",(e=>{this.selected_opacity=parseInt(e.target.value)/100})),null===(n=document.getElementById("tool-place-button"))||void 0===n||n.addEventListener("change",(e=>{this.selected_tool="place"})),null===(_=document.getElementById("tool-replace-button"))||void 0===_||_.addEventListener("change",(e=>{this.selected_tool="replace"})),null===(i=document.getElementById("tool-remove-button"))||void 0===i||i.addEventListener("change",(e=>{this.selected_tool="remove"}))}calculate_velocity(){const e=performance.now()-this.last_move;E.scale(this.last_movement,1/e,this.velocity)}mouse_drag(e){this.multidraw||(this.camera.eulers[1]=this.camera.eulers[1]-this.last_movement[1],this.camera.eulers[2]=this.camera.eulers[2]-this.last_movement[0],this.mouse_dragged=!0)}}(ce,ie,12,0,0),de=new class{constructor(e,t,r){this.initialized=!1,this.render=()=>{var e,t,r,x,n,_,i;if(!this.initialized)return;let a=[];for(let e=0;e<this.scene.voxel_count;e++)for(let t=0;t<this.scene.voxel_count;t++)for(let r=0;r<this.scene.voxel_count;r++)this.scene.get_voxel([e,t,r]).lightness>0&&a.push([e,t,r]);null===(e=this.device)||void 0===e||e.queue.writeBuffer(this.sceneParameters,0,new Float32Array([this.camera.position[0],this.camera.position[1],this.camera.position[2],(new Date).getMilliseconds(),this.camera.forward[0],this.camera.forward[1],this.camera.forward[2],a.length,this.camera.right[0],this.camera.right[1],this.camera.right[2],this.scene.ao_strength,this.camera.up[0],this.camera.up[1],this.camera.up[2],this.scene.ambient_light,this.scene.direct_light[0],this.scene.direct_light[1],this.scene.direct_light[2],this.scene.direct_light_brightness,this.scene.background_color[0],this.scene.background_color[1],this.scene.background_color[2],0]),0,24);const o=new Float32Array(4*a.length);for(let e=0;e<a.length;++e)o[4*e]=a[e][0],o[4*e+1]=a[e][1],o[4*e+2]=a[e][2],o[4*e+3]=0;null===(t=this.device)||void 0===t||t.queue.writeBuffer(this.lightData,0,o,0,4*a.length);const c=new Float32Array(8*this.scene.grid.length);for(let e=0;e<this.scene.grid.length;++e)c[8*e]=this.scene.grid[e].color[0],c[8*e+1]=this.scene.grid[e].color[1],c[8*e+2]=this.scene.grid[e].color[2],c[8*e+3]=this.scene.grid[e].opacity,c[8*e+4]=this.scene.grid[e].roughness,c[8*e+5]=this.scene.grid[e].lightness,c[8*e+6]=0,c[8*e+7]=0;const s=new Float32Array(8*this.scene.grid.length);for(let e=0;e<this.scene.grid.length;++e)s[8*e]=this.scene.meta_grid[e].gi[0],s[8*e+1]=this.scene.meta_grid[e].gi[1],s[8*e+2]=this.scene.meta_grid[e].gi[2],s[8*e+3]=0,s[8*e+4]=0,s[8*e+5]=0,s[8*e+6]=0,s[8*e+7]=0;null===(r=this.device)||void 0===r||r.queue.writeBuffer(this.sceneData,0,c,0,8*this.scene.grid.length),null===(x=this.device)||void 0===x||x.queue.writeBuffer(this.sceneMetaData,0,s,0,8*this.scene.grid.length);const d=null===(n=this.device)||void 0===n?void 0:n.createCommandEncoder(),l=null==d?void 0:d.beginComputePass();null==l||l.setPipeline(this.ray_tracing_pipeline),null==l||l.setBindGroup(0,this.ray_tracing_bind_group),null==l||l.dispatchWorkgroups(this.canvas.width/16,this.canvas.height/16,1),null==l||l.end();const f=null===(_=this.context)||void 0===_?void 0:_.getCurrentTexture().createView(),u=null==d?void 0:d.beginRenderPass({colorAttachments:[{view:f,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}]});null==u||u.setPipeline(this.screen_pipeline),null==u||u.setBindGroup(0,this.screen_bind_group),null==u||u.draw(6,1,0,0),null==u||u.end(),null===(i=this.device)||void 0===i||i.queue.submit([null==d?void 0:d.finish()])},this.canvas=e,this.scene=t,this.pathtracing=!1,this.camera=r}initialize(e){return t(this,void 0,void 0,(function*(){this.pathtracing=e,yield this.setupDevice(),yield this.createAssets(),yield this.setupPipeline(),this.initialized=!0}))}set_hdr(e){}shutdown(){var e,t,r;this.initialized=!1,null===(e=this.device)||void 0===e||e.destroy(),null===(t=this.color_buffer)||void 0===t||t.destroy(),null===(r=this.secondary_buffer)||void 0===r||r.destroy()}setupDevice(){var e,r;return t(this,void 0,void 0,(function*(){this.adapter=yield null===(e=navigator.gpu)||void 0===e?void 0:e.requestAdapter(),this.device=yield null===(r=this.adapter)||void 0===r?void 0:r.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm";const t=document.getElementById("canv-error");this.context?t.textContent="":t.textContent="Sorry, this canvas requires a WebGPU capable browser :(",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}))}createAssets(){var e,r,x,n,_,i,a,o,c;return t(this,void 0,void 0,(function*(){this.color_buffer=null===(e=this.device)||void 0===e?void 0:e.createTexture({size:{width:this.canvas.width,height:this.canvas.height},format:"rgba8unorm",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING}),this.secondary_buffer=null===(r=this.device)||void 0===r?void 0:r.createTexture({size:{width:this.canvas.width,height:this.canvas.height},format:"rgba8unorm",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING}),this.color_buffer_view=null===(x=this.color_buffer)||void 0===x?void 0:x.createView(),this.secondary_buffer_view=null===(n=this.secondary_buffer)||void 0===n?void 0:n.createView(),this.sampler=null===(_=this.device)||void 0===_?void 0:_.createSampler({addressModeU:"repeat",addressModeV:"repeat",magFilter:"linear",minFilter:"nearest",mipmapFilter:"nearest",maxAnisotropy:1}),this.sceneParameters=null===(i=this.device)||void 0===i?void 0:i.createBuffer({size:96,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const t=this.scene.voxel_count*this.scene.voxel_count*this.scene.voxel_count;this.sceneData=null===(a=this.device)||void 0===a?void 0:a.createBuffer({size:8*t*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.sceneMetaData=null===(o=this.device)||void 0===o?void 0:o.createBuffer({size:8*t*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.lightData=null===(c=this.device)||void 0===c?void 0:c.createBuffer({size:512,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})}))}setupPipeline(){var r,x,n,_,i,a,o,c;return t(this,void 0,void 0,(function*(){const t=null===(r=this.device)||void 0===r?void 0:r.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm",viewDimension:"2d"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:4,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm",viewDimension:"2d"}},{binding:5,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}}]});this.ray_tracing_bind_group=null===(x=this.device)||void 0===x?void 0:x.createBindGroup({layout:t,label:"Ray tracing bind group",entries:[{binding:0,resource:this.color_buffer_view},{binding:1,resource:{buffer:this.sceneParameters}},{binding:2,resource:{buffer:this.sceneData}},{binding:3,resource:{buffer:this.lightData}},{binding:4,resource:this.secondary_buffer_view},{binding:5,resource:{buffer:this.sceneMetaData}}]});const s=null===(n=this.device)||void 0===n?void 0:n.createPipelineLayout({bindGroupLayouts:[t]});this.ray_tracing_pipeline=null===(_=this.device)||void 0===_?void 0:_.createComputePipeline({label:"Ray tracing pipeline",layout:s,compute:{entryPoint:"main",module:this.device.createShaderModule({code:"@group(0) @binding(0) var color_buffer: texture_storage_2d<rgba8unorm, write>;\r\n@group(0) @binding(1) var<uniform> scene: SceneParameter;\r\n@group(0) @binding(2) var<storage, read> scene_data: SceneData;\r\n// @group(0) @binding(3) var hdr_tex: texture_2d<f32>;\r\n// @group(0) @binding(4) var hdr_sampler: sampler;\r\n@group(0) @binding(3) var<storage, read> lights: LightData;\r\n@group(0) @binding(4) var secondary_buffer: texture_storage_2d<rgba8unorm, write>;\r\n@group(0) @binding(5) var<storage, read> scene_meta_data: SceneMetaData;\r\n\r\noverride grid_size: f32 = 2f;\r\noverride voxel_count: i32 = 4;\r\nvar<private> voxel_size: f32 = grid_size / f32(voxel_count);\r\nvar<private> boundary_min: vec3<f32> = vec3<f32>(f32(-grid_size) / 2, f32(-grid_size) / 2, f32(-grid_size) / 2);\r\nvar<private> boundary_max: vec3<f32> = vec3<f32>(f32(grid_size) / 2, f32(grid_size) / 2, f32(grid_size) / 2);\r\nvar<private> depth_clip_min: f32 = 1f;\r\nvar<private> depth_clip_max: f32 = 10f;\r\n\r\nvar<private> rng_seed: u32;\r\nvar<private> rng_seed_steady: u32;\r\n\r\nconst samples: i32 = 1;\r\nconst light_bounces: i32 = 3;\r\nconst max_penetrations: i32 = 3;\r\nconst reflection_bounces: i32 = 3;\r\nconst scatter: i32 = 5;\r\n// const ambient_light: f32 = 0.03;\r\nconst pi = 3.14159265359;\r\n\r\n// const background: vec3<f32> = vec3<f32>(24f / 255f, 24f / 255f, 37f / 255f);\r\n\r\nstruct SceneParameter {\r\n    camera_pos: vec3<f32>,\r\n    rng_start: f32,\r\n    camera_forward: vec3<f32>,\r\n    light_count: f32,\r\n    camera_right: vec3<f32>,\r\n\tao_strength: f32,\r\n    camera_up: vec3<f32>,\r\n\tambient_light: f32,\r\n    direct_light: vec3<f32>,\r\n    direct_light_brightness: f32,\r\n\tbackground_color: vec3<f32>,\r\n}\r\n\r\nstruct Voxel {\r\n\tcolor: vec3<f32>,\r\n\topacity: f32,\r\n\troughness: f32,\r\n\tlightness: f32,\r\n}\r\n\r\nstruct MetaVoxel {\r\n\tgi: vec3<f32>,\r\n\tsomethingelse: vec3<f32>\r\n}\r\n\r\nstruct SceneData {\r\n\tdata: array<Voxel>,\r\n}\r\n\r\nstruct SceneMetaData {\r\n\tdata: array<MetaVoxel>,\r\n}\r\n\r\nstruct LightData {\r\n\tdata: array<Light>,\r\n}\r\n\r\nstruct Light {\r\n\tlocation: vec3<f32>,\r\n\temitter_type: f32,\r\n}\r\n\r\nstruct Ray {\r\n    origin: vec3<f32>,\r\n    direction: vec3<f32>,\r\n    inv_direction: vec3<f32>,\r\n}\r\n\r\nstruct RayHit {\r\n\tposition: vec3<f32>,\r\n\tdepth: f32,\r\n\tvoxel_position: vec3<i32>,\r\n\tvoxel: Voxel,\r\n\tnormal: vec3<f32>,\r\n\tray_direction: vec3<f32>,\r\n\texit_position: vec3<f32>,\r\n\tao: f32,\r\n\tuv: vec2<f32>,\r\n}\r\n\r\nstruct TraceResult {\r\n\tcolor: vec3<f32>,\r\n\tao: f32,\r\n}\r\n\r\n@compute @workgroup_size(16,16,1)\r\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {\r\n    let screen_size: vec2<u32> = textureDimensions(color_buffer);\r\n    let screen_pos : vec2<i32> = vec2<i32>(i32(GlobalInvocationID.x), i32(GlobalInvocationID.y));\r\n    // rng_seed = GlobalInvocationID.x + 50 + (GlobalInvocationID.y + 50) * (GlobalInvocationID.x + 100) * 1000 * u32(scene.rng_start);\r\n    rng_seed = GlobalInvocationID.x + 50 + (GlobalInvocationID.y + 50) * (GlobalInvocationID.x + 100) * 1000;\r\n    rng_seed_steady = GlobalInvocationID.x + 150 + (GlobalInvocationID.y + 75) * (GlobalInvocationID.x + 350) * 1000;\r\n\r\n    var pixel_color: vec3<f32>;\r\n    var pixel_ao: f32;\r\n    for (var i = 0; i < samples; i++){\r\n\r\n\t    let rng_offset: vec2<f32> = select(vec2<f32>(0), vec2<f32>(rng() - 0.5, rng() - 0.5), samples > 1);\r\n\t    let horizontal_coefficient: f32 = (f32(screen_pos.x) + rng_offset.x - f32(screen_size.x) / 2) / f32(screen_size.x);\r\n\t    let vertical_coefficient: f32 = (f32(screen_pos.y) + rng_offset.y - f32(screen_size.y) / 2) / -f32(screen_size.y);\r\n\r\n\t    let ray_direction = normalize(scene.camera_forward\r\n\t\t\t    + horizontal_coefficient * scene.camera_right\r\n\t\t\t    + vertical_coefficient * scene.camera_up);\r\n\t    let ray: Ray = Ray(scene.camera_pos, ray_direction, 1 / ray_direction);\r\n\t    let trace_result = trace(ray, light_bounces);\r\n\t    // pixel_color += trace(ray, light_bounces);\r\n\t    // pixel_color += trace_result.color;\r\n\t    pixel_color += trace_result;\r\n\t    // pixel_ao += trace_result.ao;\r\n    }\r\n\r\n    // let correction = 1.0 / f32(samples);\r\n    // pixel_color = sqrt(correction * pixel_color);\r\n\r\n\tpixel_color /= f32(samples);\r\n\t// pixel_ao /= f32(samples);\r\n\r\n    /* pixel_color = textureSampleLevel(hdr_tex, hdr_sampler, vec2<f32>(f32(GlobalInvocationID.x) / f32(screen_size.x), f32(GlobalInvocationID.y) / f32(screen_size.y) * 2), 0.0).rgb; */\r\n\r\n    textureStore(color_buffer, screen_pos, vec4<f32>(pixel_color, 1.0));\r\n    // textureStore(secondary_buffer, screen_pos, vec4<f32>(pixel_ao, 0, 0, 1.0));\r\n}\r\n\r\nfn rng_hash(seed: u32) -> u32 {\r\n\tvar x = ( seed << 10u );\r\n\tx ^= ( x >>  6u );\r\n\tx += ( x <<  3u );\r\n\tx ^= ( x >> 11u );\r\n\tx += ( x << 15u );\r\n\treturn x;\r\n}\r\n\r\nfn rng() -> f32 {\r\n\trng_seed++;\r\n\treturn bitcast<f32>((rng_hash(rng_seed) >> 9) | 0x3f800000 ) - 1.0;\r\n}\r\n\r\nfn rng_steady() -> f32 {\r\n\trng_seed_steady++;\r\n\treturn bitcast<f32>((rng_hash(rng_seed_steady) >> 9) | 0x3f800000 ) - 1.0;\r\n}\r\n\r\nfn ray_reflect(ray: Ray, position: vec3<f32>, normal: vec3<f32>) -> Ray {\r\n\tlet reflect = ray.direction - 2 * dot(ray.direction, normal) * normal;\r\n\treturn Ray(position, reflect, 1 / reflect);\r\n}\r\n\r\nfn get_voxel_id(v: vec3<i32>) -> i32 {\r\n\treturn v.z * voxel_count * voxel_count + v.y * voxel_count + v.x;\r\n}\r\n\r\nfn get_voxel(v: vec3<i32>) -> Voxel {\r\n\treturn scene_data.data[v.z * voxel_count * voxel_count + v.y * voxel_count + v.x];\r\n}\r\n\r\nfn get_meta_voxel(v: vec3<i32>) -> MetaVoxel {\r\n\treturn scene_meta_data.data[v.z * voxel_count * voxel_count + v.y * voxel_count + v.x];\r\n}\r\n\r\nfn get_voxel_by_position(v: vec3<f32>) -> Voxel {\r\n\treturn get_voxel(vec3<i32>((v - boundary_min) / f32(voxel_size)));\r\n}\r\n\r\nfn sample_spherical_map(v: vec3<f32>) -> vec2<f32> {\r\n\tlet theta = atan2(v.x, v.y);\r\n\tlet phi = acos(v.z);\r\n\tlet raw_u = theta / (2 * pi);\r\n\tlet uv = vec2<f32>(\r\n\t\t1 - (raw_u + 0.5),\r\n\t\tphi / pi\r\n\t);\r\n\treturn uv;\r\n}\r\n\r\nfn random_unit_vector() -> vec3<f32> {\r\n\tlet phi = rng() * pi * 2;\r\n\tlet costheta = rng() * 2 - 1;\r\n\t\tlet theta = acos(costheta);\r\n\tlet x = sin(theta) * cos(phi);\r\n\tlet y = sin(theta) * sin(phi);\r\n\tlet z = cos(theta);\r\n\treturn vec3<f32>(x, y, z);\r\n}\r\n"+(this.pathtracing?"const light_scatter_samples: i32 = 2;\r\n\r\nfn gamma_correct(color: vec3<f32>) -> vec3<f32> {\r\n    let correction = 1.0 / f32(samples);\r\n    return sqrt(correction * color);\r\n}\r\n\r\nfn trace(ray: Ray, depth: i32) -> vec3<f32> {\r\n\tif (depth <= 0) {\r\n\t\treturn vec3<f32>(0);\r\n\t}\r\n\t\tvar accum: vec3<f32> = vec3<f32>(0.0);\r\n\t\tvar mask: vec3<f32> = vec3<f32>(1.0);\r\n\t\tvar curr_ray: Ray = ray;\r\n\t\tvar curr_hit: RayHit;\r\n\t\tvar refl: f32 = 1.0;\r\n\t\tvar hits: i32 = 0;\r\n\r\n\t\tvar bounce_results: array<RayHit, light_bounces>;\r\n\r\n\t\tfor (; hits < light_bounces;){\r\n\t\t\tif (voxel_ray_any(curr_ray, 0.0001, &curr_hit)) {\r\n\t\t\t\tlet bounce_direction = random_unit_vector() + curr_hit.normal;\r\n\t\t\t\tif (all(bounce_direction == vec3<f32>(0))){\r\n\t\t\t\t\tcurr_ray = Ray(curr_hit.position, curr_hit.normal, 1 / curr_hit.normal);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet normalized = normalize(bounce_direction);\r\n\t\t\t\t\tcurr_ray = Ray(curr_hit.position, normalized, 1 / normalized);\r\n\t\t\t\t}\r\n\t\t\t\tbounce_results[hits] = curr_hit;\r\n\t\t\t\thits++;\r\n\t\t\t} else {\r\n\t\t\t\t// accum = pow(textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(curr_ray.direction), 0.0).rgb, vec3<f32>(2)) * 5;\r\n\t\t\t\taccum = vec3<f32>(pow(max(0, dot(curr_ray.direction, scene.direct_light) - 0.98) * 40, 1));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (hits == 0){\r\n\t\t\t// return textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(ray.direction), 0.0).rgb;\r\n\t\t\treturn vec3<f32>(pow(max(0, dot(ray.direction, scene.direct_light) - 0.95) * 20, 1));\r\n\t\t}\r\n\t\tif (hits == light_bounces){\r\n\t\t\taccum = vec3<f32>(0, 0, 0);\r\n\t\t} else {\r\n\t\t\t// accum = textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(bounce_results[hits - 1].ray_direction), 0.0).rgb;\r\n\t\t\t/* accum = vec3<f32>(max(0, dot(bounce_results[hits - 1].ray_direction, scene.direct_light))); */\r\n\t\t\t// accum = vec3<f32>(0);\r\n\t\t}\r\n\t\tfor (var i: i32 = hits - 1; i >= 0; i--){\r\n\t\t\tlet bounce = bounce_results[i];\r\n\t\t\t/* accum = min(vec3<f32>(1), accum) * min(vec3<f32>(1), bounce.voxel.color); */\r\n\t\t\taccum = accum * bounce.voxel.color\r\n\t\t\t\t+ bounce_results[i].voxel.lightness * bounce_results[i].voxel.color;\r\n\t\t\t// if (all(bounce.normal == vec3<f32>(0)) && all(bounce.ray_direction == vec3<f32>(0))){\r\n\t\t\t// \t// accum = textureSampleLevel(hdr_tex, hdr_sampler, sample_spherical_map(bounce_results[i].ray_direction), 0.0).rgb;\r\n\t\t\t// \taccum = vec3<f32>(0.5);\r\n\t\t\t// \tcontinue;\r\n\t\t\t// }\r\n\t\t\t// accum = accum * bounce.voxel.color;\r\n\t\t\t// accum = accum * bounce.voxel.color;\r\n\t\t}\r\n\treturn accum; // / f32(light_scatter_samples);\r\n}\r\n\r\nfn direct_illumination(orig_hit: RayHit, refl: ptr<function, f32>) -> vec3<f32> {\r\n\tvar hit: RayHit;\r\n\tif (!voxel_ray_any(Ray(orig_hit.position, scene.direct_light, 1 / scene.direct_light), 0.00001, &hit)){\r\n\t\treturn scene.direct_light_brightness * orig_hit.voxel.color;\r\n\t} else {\r\n\t\treturn 0.2 * orig_hit.voxel.color;\r\n\t}\r\n}\r\n\r\nfn voxel_ray_any(ray: Ray, start_tolerance: f32, hit: ptr<function, RayHit>) -> bool {\r\n\tvar tmin: f32 = 0.0;\r\n\tvar tmax: f32 = 300000000;\r\n\tfor (var d: i32 = 0; d < 3; d++) {\r\n\t\tlet t1 = (boundary_min[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\t\tlet t2 = (boundary_max[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\r\n\t\ttmin = min(max(t1, tmin), max(t2, tmin));\r\n\t\ttmax = max(min(t1, tmax), min(t2, tmax));\r\n\t}\r\n\t// Hier ist noch ein Fehler drin, tritt nur von ausserhalb des grid auf, das kommt ja vielleicht eh noch weg\r\n\tif tmin > tmax { return false; }\r\n    \tlet ray_entry = ray.origin + ray.direction * tmin;\r\n\tlet ray_exit = ray.origin + ray.direction * tmax;\r\n\r\n\tvar voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_entry - boundary_min) / f32(voxel_size))));\r\n\t//var end_voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_exit - boundary_min - ray.direction * 0.000001) / f32(voxel_size))));\r\n\r\n\tlet direction_zeros: vec3<bool> = ray.direction == vec3<f32>(0);\r\n\tlet step: vec3<i32> = vec3<i32>(sign(ray.direction));\r\n\tlet tdelta: vec3<f32> = select(voxel_size / abs(ray.direction), vec3<f32>(tmax), direction_zeros);\r\n\tlet voxel_boundary: vec3<f32> = vec3<f32>(voxel + max(vec3<i32>(0), step)) * voxel_size;\r\n\tvar tmax_comp: vec3<f32> = select(tmin + (boundary_min + voxel_boundary - ray_entry) / ray.direction, vec3<f32>(tmax), direction_zeros);\r\n\tvar thit: f32 = tmin;\r\n\tvar hit_normal: vec3<f32> = vec3<f32>(0, 0, 0);\r\n\r\n\twhile(all(voxel >= vec3<i32>(0)) && all(voxel < vec3<i32>(voxel_count))) {\r\n\t\tlet hit_voxel = get_voxel(voxel);\r\n\t\tif (hit_voxel.opacity > 0.01 && all(tmax_comp > vec3<f32>(start_tolerance))){\r\n\t\t\t(*hit).position = ray.origin + ray.direction * thit;\r\n\t\t\t(*hit).voxel = hit_voxel;\r\n\t\t\t(*hit).voxel_position = voxel;\r\n\t\t\t(*hit).depth = 1 - (thit - depth_clip_min) / (depth_clip_max - depth_clip_min);\r\n\t\t\t(*hit).normal = hit_normal;\r\n\t\t\t(*hit).ray_direction = ray.direction;\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (tmax_comp.x < tmax_comp.y && tmax_comp.x < tmax_comp.z) {\r\n\t\t\tvoxel.x += step.x;\r\n\t\t\tthit = tmax_comp.x;\r\n\t\t\ttmax_comp.x += tdelta.x;\r\n\t\t\thit_normal = vec3<f32>(f32(-step.x), 0, 0);\r\n\t\t} else if (tmax_comp.y < tmax_comp.z){\r\n\t\t\tvoxel.y += step.y;\r\n\t\t\tthit = tmax_comp.y;\r\n\t\t\ttmax_comp.y += tdelta.y;\r\n\t\t\thit_normal = vec3<f32>(0, f32(-step.y), 0);\r\n\t\t} else {\r\n\t\t\tvoxel.z += step.z;\r\n\t\t\tthit = tmax_comp.z;\r\n\t\t\ttmax_comp.z += tdelta.z;\r\n\t\t\thit_normal = vec3<f32>(0, 0, f32(-step.z));\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n":"struct penetration {\r\n\tcolor: vec3<f32>,\r\n\tao: f32,\r\n\thit: RayHit,\r\n}\r\n\r\nfn gamma_correct(color: vec3<f32>) -> vec3<f32> {\r\n    return color / f32(samples);\r\n}\r\n\r\nfn trace(ray: Ray, depth: i32) -> vec3<f32> {\r\n\tvar hit: RayHit;\r\n\tvar bounces: array<RayHit, reflection_bounces>;\r\n\tvar curr_ray = ray;\r\n\tvar hits: i32 = 0;\r\n\tvar has_next_ray = true;\r\n\tvar penetrations: array<penetration, max_penetrations>;\r\n\tvar penetration_count = 0;\r\n\r\n\tfor (var p = 0; p < max_penetrations; p++){\r\n\t\tvar color = vec3<f32>(0.0);\r\n\t\tvar ao = 0f;\r\n\t\tvar first_hit: RayHit;\r\n\t\tfor (var i = 0; i < reflection_bounces; i++){\r\n\t\t\tif(voxel_ray_any(curr_ray, 0.001, &hit)){\r\n\t\t\t\t// return TraceResult(vec3<f32>(hit.uv.x), 0.0);\r\n\t\t\t\tbounces[i] = hit;\r\n\t\t\t\tcurr_ray = ray_reflect(curr_ray, hit.position, hit.normal);\r\n\t\t\t\thits++;\r\n\t\t\t\tif (i == 0){\r\n\t\t\t\t\tfirst_hit = hit;\r\n\t\t\t\t}\r\n\t\t\t\tif (hit.voxel.roughness > 0.99){\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// return TraceResult(vec3<f32>(0.1), 0.0);\r\n\t\t\t\tcolor = scene.background_color;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hits == 0){\r\n\t\t\tbreak;\r\n\t\t\t// return background;\r\n\t\t\t// return ray.direction;\r\n\t\t}\r\n\t\t// return vec3<f32>(0.2, 0.4, 0.5);\r\n\t\t// return vec3<f32>(bounces[0].uv.x, bounces[0].uv.y, 0.0);\r\n\r\n\t\tfor (var i: i32 = hits; i >= 0; i--){\r\n\t\t\t\t// return TraceResult(vec3<f32>(0.5), 0.0);\r\n\t\t\t// return TraceResult(vec3<f32>(bounces[i].uv.x), 0.0);\r\n\t\t\tlet t = bounces[i].voxel.roughness;\r\n\t\t\tcolor = color * (1 - t) + t * bounces[i].voxel.color * illumination(bounces[i].position);\r\n\t\t\tif (i == 0){\r\n\t\t\t\t//ao = get_point_ao(bounces[0].position);\r\n\t\t\t\tao = 0;\r\n\t\t\t\tlet nrm = vec3<i32>(bounces[i].normal);\r\n\t\t\t\tlet uv = bounces[i].uv;\r\n\t\t\t\tlet am = voxel_ao(bounces[i].voxel_position + nrm, nrm.zxy, nrm.yzx);\r\n\t\t\t\tao = mix(mix(am.z, am.w, uv.x), mix(am.y, am.x, uv.x), uv.y);\r\n\t\t\t\t// return vec3<f32>(uv.x / 10 + interp_ao, uv.y / 10 + interp_ao, interp_ao) / 2;\r\n\t\t\t\t// return vec3<f32>(interp_ao);\r\n\t\t\t\t// let interp_ao = \r\n\t\t\t\t// ao = get_point_ao_lambert(bounces[0].position, bounces[0].normal);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (var l: i32 = 0; l < i32(scene.light_count); l++){\r\n\t\t\t\tlet light = lights.data[l];\r\n\t\t\t\tif i32(light.emitter_type) == 0 {\r\n\t\t\t\t\tlet light_voxel = get_voxel(vec3<i32>(light.location));\r\n\t\t\t\t\tlet light_voxel_location = light.location * voxel_size + boundary_min;\r\n\t\t\t\t\tlet light_voxel_location_top = light_voxel_location + voxel_size;\r\n\t\t\t\t\tlet light_voxel_location_mid = (light_voxel_location + light_voxel_location_top) / 2;\r\n\t\t\t\t\tlet lray_dir = light_voxel_location_mid - bounces[i].position;\r\n\t\t\t\t\tlet lray = Ray(bounces[i].position, lray_dir, 1 / lray_dir);\r\n\t\t\t\t\tvar lhit: RayHit;\r\n\t\t\t\t\tif (voxel_ray_any(lray, 0.001, &lhit) && all(lhit.voxel_position == vec3<i32>(light.location))){\r\n\t\t\t\t\t\tlet dist = distance(light_voxel_location_mid, bounces[i].position);\r\n\t\t\t\t\t\tlet intensity = 1 / pow(dist, 2) * lhit.voxel.lightness;\r\n\t\t\t\t\t\tcolor += light_voxel.color * vec3<f32>(intensity) * bounces[i].voxel.color;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// let vox = bounces[i].voxel_position;\r\n\t\t\t// let gi_vox = vox + vec3<i32>(bounces[i].normal);\r\n\t\t\t// color += get_meta_voxel(gi_vox).gi / 5;\r\n\t\t}\r\n\t\tpenetrations[p] = penetration(color, ao, first_hit);\r\n\t\tpenetration_count++;\r\n\t\tcurr_ray = Ray(first_hit.exit_position, ray.direction, ray.inv_direction);\r\n\t\tif (first_hit.voxel.opacity > 0.99){\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tif (penetration_count == 0){\r\n\t\treturn scene.background_color;\r\n\t\t// return TraceResult(scene.background_color, 0);\r\n\t}\r\n\r\n\tvar color = penetrations[penetration_count - 1].color;\r\n\tvar ao = penetrations[penetration_count - 1].ao;\r\n\tfor (var i: i32 = penetration_count - 2; i >= 0; i--){\r\n\t\t// if (i > 0 && all(penetrations[i].voxel_color == penetrations[i - 1].voxel_color)) { continue;}\r\n\t\tlet pvoxel = penetrations[i].hit.voxel;\r\n\t\tlet phit = penetrations[i].hit;\r\n\t\tlet pcolor = penetrations[i].color;\r\n\t\tlet pao = penetrations[i].ao;\r\n\t\tlet t = pvoxel.opacity;\r\n\t\tif (i > 0 && all(penetrations[i - 1].hit.voxel.color == pvoxel.color)) { continue; }\r\n\t\tcolor = pcolor * t + (1 - t) * color;\r\n\t\tao = pao * t + (1 - t) * ao;\r\n\t\t// let t = distance(phit.position, phit.exit_position) / voxel_size;\r\n\t\t// color += pvoxel.color * t / f32(penetration_count);\r\n\t\t// color = pvoxel.color * t + color * (1 - t);\r\n\t\t// color = penetrations[i].color * pvoxel.opacity + color * (1 - pvoxel.opacity);\r\n\t\t// ao = penetrations[i].ao * pvoxel.opacity + ao * (1 - pvoxel.opacity);\r\n\t}\r\n\r\n\treturn color * ao;\r\n\t// return TraceResult(color, ao);\r\n\t// return vec3<f32>(ao);\r\n}\r\n\r\nfn illumination(p: vec3<f32>) -> f32 {\r\n\tvar hit: RayHit;\r\n\tif (!voxel_ray_any(Ray(p, scene.direct_light, 1 / scene.direct_light), 0.001, &hit)){\r\n\t\treturn max(scene.direct_light_brightness, scene.ambient_light);\r\n\t}\r\n\treturn scene.ambient_light;\r\n}\r\n\r\nfn voxel_ray_any(ray: Ray, start_tolerance: f32, hit: ptr<function, RayHit>) -> bool {\r\n\tvar tmin: f32 = 0.0;\r\n\tvar tmax: f32 = 300000000;\r\n\tfor (var d: i32 = 0; d < 3; d++) {\r\n\t\tlet t1 = (boundary_min[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\t\tlet t2 = (boundary_max[d] - ray.origin[d]) * ray.inv_direction[d];\r\n\r\n\t\ttmin = min(max(t1, tmin), max(t2, tmin));\r\n\t\ttmax = max(min(t1, tmax), min(t2, tmax));\r\n\t}\r\n\t// Hier ist noch ein Fehler drin, tritt nur von ausserhalb des grid auf, das kommt ja vielleicht eh noch weg\r\n\tif tmin > tmax { return false; }\r\n    \tlet ray_entry = ray.origin + ray.direction * tmin;\r\n\tlet ray_exit = ray.origin + ray.direction * tmax;\r\n\r\n\tvar voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_entry - boundary_min) / f32(voxel_size))));\r\n\t//var end_voxel: vec3<i32> = max(vec3<i32>(0), min(vec3<i32>(voxel_count - 1), vec3<i32>((ray_exit - boundary_min - ray.direction * 0.000001) / f32(voxel_size))));\r\n\r\n\tlet direction_zeros: vec3<bool> = ray.direction == vec3<f32>(0);\r\n\tlet vstep: vec3<i32> = vec3<i32>(sign(ray.direction));\r\n\tlet tdelta: vec3<f32> = select(voxel_size / abs(ray.direction), vec3<f32>(tmax), direction_zeros);\r\n\tlet voxel_boundary: vec3<f32> = vec3<f32>(voxel + max(vec3<i32>(0), vstep)) * voxel_size;\r\n\tvar tmax_comp: vec3<f32> = select(tmin + (boundary_min + voxel_boundary - ray_entry) / ray.direction, vec3<f32>(tmax), direction_zeros);\r\n\tvar thit: f32 = tmin;\r\n\tvar hit_normal: vec3<f32> = vec3<f32>(0, 0, 0);\r\n\tvar mask: vec3<f32>;\r\n\r\n\twhile(all(voxel >= vec3<i32>(0)) && all(voxel < vec3<i32>(voxel_count))) {\r\n\t\tlet hit_voxel = get_voxel(voxel);\r\n\t\tif (hit_voxel.opacity > 0.01 && all(tmax_comp > vec3<f32>(start_tolerance))){\r\n\t\t\t(*hit).position = ray.origin + ray.direction * thit;\r\n\t\t\t(*hit).voxel = hit_voxel;\r\n\t\t\t(*hit).voxel_position = voxel;\r\n\t\t\t(*hit).depth = 1 - (thit - depth_clip_min) / (depth_clip_max - depth_clip_min);\r\n\t\t\t(*hit).normal = hit_normal;\r\n\t\t\t(*hit).ray_direction = ray.direction;\r\n\t\t\t// let v_diff = (*hit).position - (vec3<f32>(voxel) * voxel_size - boundary_min);\r\n\t\t\tlet uv = (((*hit).position - boundary_min) - (vec3<f32>(voxel) * voxel_size)) / voxel_size;\r\n\t\t\tlet uvx = select(vec3<f32>(1) * mask - mask * uv.yzx, mask * uv.yzx, sign(ray.direction) < vec3<f32>(0));\r\n\t\t\tlet uvy = select(vec3<f32>(1) * mask - mask * uv.zxy, mask * uv.zxy, sign(ray.direction) < vec3<f32>(0));\r\n\t\t\t// let uvy = mask * uv.zxy;\r\n\t\t\t(*hit).uv = vec2<f32>(\r\n\t\t\t\tmax(uvx.x, max(uvx.y, uvx.z)),\r\n\t\t\t\tmax(uvy.x, max(uvy.y, uvy.z)),\r\n\t\t\t\t// dot(mask * v_diff.zxy, vec3<f32>(voxel_size)) / voxel_size,\r\n\t\t\t);\r\n\t\t\tlet next_mask = step(tmax_comp.xyz, tmax_comp.yzx) * step(tmax_comp.xyz, tmax_comp.zxy);\r\n\t\t\tlet tmax_masked = vec3<f32>(next_mask) * tmax_comp;\r\n\t\t\t(*hit).exit_position = ray.origin + ray.direction * max(tmax_masked.x, max(tmax_masked.y, tmax_masked.z));\r\n\r\n\t\t\t\t\t\t// if (tmax_comp.x < tmax_comp.y && tmax_comp.x < tmax_comp.z) {\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.x;\r\n\t\t\t// } else if (tmax_comp.y < tmax_comp.z){\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.y;\r\n\t\t\t// } else {\r\n\t\t\t// \t(*hit).exit_position = ray.origin + ray.direction * tmax_comp.z;\r\n\t\t\t// }\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tmask = step(tmax_comp.xyz, tmax_comp.yzx) * step(tmax_comp.xyz, tmax_comp.zxy);\r\n\t\tvoxel += vstep * vec3<i32>(mask);\r\n\t\tlet tmax_masked = vec3<f32>(mask) * tmax_comp;\r\n\t\tthit = max(tmax_masked.x, max(tmax_masked.y, tmax_masked.z));\r\n\t\thit_normal = -(vec3<f32>(vstep) * mask);\r\n\t\ttmax_comp += mask * tdelta;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nfn voxel_ao(pos: vec3<i32>, d1: vec3<i32>, d2: vec3<i32>) -> vec4<f32> {\r\n\tif (get_voxel(pos).opacity > 0) { return vec4<f32>(1); }\r\n\tlet side = vec4<f32>(get_voxel(pos + d1).opacity, get_voxel(pos + d2).opacity, get_voxel(pos - d1).opacity, get_voxel(pos - d2).opacity);\r\n\tlet corner = vec4<f32>(get_voxel(pos + d1 + d2).opacity, get_voxel(pos - d1 + d2).opacity, get_voxel(pos - d1 - d2).opacity, get_voxel(pos + d1 - d2).opacity);\r\n\tlet ao = vec4<f32>(\r\n\t\tvertex_ao(side.xy, corner.x),\r\n\t\tvertex_ao(side.yz, corner.y),\r\n\t\tvertex_ao(side.zw, corner.z),\r\n\t\tvertex_ao(side.wx, corner.w),\r\n\t);\r\n\treturn 1.0 - ao * scene.ao_strength;\r\n}\r\n\r\nfn vertex_ao(side: vec2<f32>, corner: f32) -> f32 {\r\n\t// return (side.x + side.y) / 2.0;\r\n\treturn max(side.x + side.y, max(corner, side.x * side.y)) / 2;\r\n\treturn (side.x + side.y + max(corner, side.x * side.y)) / 3.0;\r\n}")}),constants:{grid_size:this.scene.grid_size,voxel_count:this.scene.voxel_count}}});const d=null===(i=this.device)||void 0===i?void 0:i.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{}}]});this.screen_bind_group=null===(a=this.device)||void 0===a?void 0:a.createBindGroup({layout:d,entries:[{binding:0,resource:this.sampler},{binding:1,resource:this.color_buffer_view},{binding:2,resource:this.secondary_buffer_view}]});const l=null===(o=this.device)||void 0===o?void 0:o.createPipelineLayout({bindGroupLayouts:[d]});this.screen_pipeline=null===(c=this.device)||void 0===c?void 0:c.createRenderPipeline({layout:l,vertex:{module:this.device.createShaderModule({code:e}),entryPoint:"vert_main"},fragment:{module:this.device.createShaderModule({code:e}),entryPoint:"frag_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list",cullMode:"back",frontFace:"cw"}})}))}}(ie,ce,se.camera);ce.initialize_default_grid(),de.initialize(!1);let le=new class{constructor(e,t){this.background=[0,0,0],this.canvas=e,this.axis="z",this.slice=0,this.scene=t,this.context=e.getContext("2d");const r=document.getElementById("slice-input");r.addEventListener("input",(e=>{const t=Math.floor(parseInt(r.value)/100*this.scene.voxel_count);this.set_slice(t>this.scene.voxel_count-1?this.scene.voxel_count-1:t),console.log(..._e("c9c58ea0_0",t))}))}set_background(e){this.background=e,this.update()}set_axis(e){this.axis=e,this.update()}set_slice(e){this.slice=e,this.update()}update(){const e=this.canvas.width,t=this.canvas.height,r=e/this.scene.voxel_count,x=t/this.scene.voxel_count;this.context.clearRect(0,0,e,t);for(let e=0;e<this.scene.voxel_count;e++)for(let t=0;t<this.scene.voxel_count;t++){const n="x"===this.axis?[this.slice,e,t]:"y"===this.axis?[e,this.slice,t]:[e,t,this.slice],_=this.scene.get_voxel(n);Q.floor(Q.scale(_.color,255)),this.context.fillStyle=this.color_to_string(_.color,_.opacity),this.context.fillRect(e*r,t*x,r,x)}}color_to_string(e,t){const r=Q.floor(Q.scale(e,255));return"#"+r[0].toString(16)+r[1].toString(16)+r[2].toString(16)+(255*t).toString(16)}}(oe,ce);le.slice=6,le.background=[30/255,30/255,46/255],le.update();let fe=performance.now(),ue=!1;addEventListener("scroll",(()=>{let e=Math.min(2,window.scrollY/window.innerHeight);document.documentElement.style.setProperty("--canv-offset",e.toString())})),requestAnimationFrame((function e(){de.render();const t=performance.now()-fe;se.tick(t/1e3),fe=performance.now(),ae.innerText=Math.round(1/t*1e3).toString()+" fps",requestAnimationFrame(e)})),addEventListener("mousedown",(e=>{2==e.button&&(ue=!0)}));let he="mocha";const be=document.getElementById("menu_switch_theme");null==be||be.addEventListener("click",(e=>{"mocha"===he?(he="latte",function(){const e=document.querySelector(":root");document.documentElement.dataset.theme="latte",e.style.setProperty("--ctp-crust","#dce0e8"),e.style.setProperty("--ctp-mantle","#e6e9ef"),e.style.setProperty("--ctp-base","#eff1f5"),e.style.setProperty("--ctp-surface0","#ccd0da"),e.style.setProperty("--ctp-surface1","#bcc0cc"),e.style.setProperty("--ctp-surface2","#acb0be"),e.style.setProperty("--ctp-overlay0","#9ca0b0"),e.style.setProperty("--ctp-overlay1","#8c8fa1"),e.style.setProperty("--ctp-overlay2","#7c7f93"),e.style.setProperty("--ctp-subtext0","#6c6f85"),e.style.setProperty("--ctp-subtext1","#5c5f77"),e.style.setProperty("--ctp-text","#4c4f69"),e.style.setProperty("--ctp-lavender","#7287fd"),e.style.setProperty("--ctp-blue","#1e66f5"),e.style.setProperty("--ctp-sapphire","#209fb5"),e.style.setProperty("--ctp-sky","#04a5e5"),e.style.setProperty("--ctp-teal","#179299"),e.style.setProperty("--ctp-green","#40a02b"),e.style.setProperty("--ctp-yellow","#df8e1d"),e.style.setProperty("--ctp-peach","#fe640b"),e.style.setProperty("--ctp-maroon","#e64553"),e.style.setProperty("--ctp-red","#d20f39"),e.style.setProperty("--ctp-mauve","#8839ef"),e.style.setProperty("--ctp-pink","#ea76cb"),e.style.setProperty("--ctp-flamingo","#dd7878"),e.style.setProperty("--ctp-rosewater","#dc8a78")}(),ce.background_color=[.8,208/255,218/255],le.set_background([.8,208/255,218/255])):(he="mocha",function(){const e=document.querySelector(":root");document.documentElement.dataset.theme="mocha",e.style.setProperty("--ctp-crust","#11111b"),e.style.setProperty("--ctp-mantle","#181825"),e.style.setProperty("--ctp-base","#1e1e2e"),e.style.setProperty("--ctp-surface0","#313244"),e.style.setProperty("--ctp-surface1","#45475a"),e.style.setProperty("--ctp-surface2","#585b70"),e.style.setProperty("--ctp-overlay0","#6c7086"),e.style.setProperty("--ctp-overlay1","#7f849c"),e.style.setProperty("--ctp-overlay2","#9399b2"),e.style.setProperty("--ctp-subtext0","#a6adc8"),e.style.setProperty("--ctp-subtext1","#bac2de"),e.style.setProperty("--ctp-text","#cdd6f4"),e.style.setProperty("--ctp-lavender","#b4befe"),e.style.setProperty("--ctp-blue","#89b4fa"),e.style.setProperty("--ctp-sapphire","#74c7ec"),e.style.setProperty("--ctp-sky","#89dceb"),e.style.setProperty("--ctp-teal","#94e2d5"),e.style.setProperty("--ctp-green","#a6e3a1"),e.style.setProperty("--ctp-yellow","#f9e2af"),e.style.setProperty("--ctp-peach","#fab387"),e.style.setProperty("--ctp-maroon","#eba0ac"),e.style.setProperty("--ctp-red","#f38ba8"),e.style.setProperty("--ctp-mauve","#cba6f7"),e.style.setProperty("--ctp-pink","#f5c2e7"),e.style.setProperty("--ctp-flamingo","#f2cdcd"),e.style.setProperty("--ctp-rosewater","#f5e0dc")}(),ce.background_color=[30/255,30/255,46/255],le.set_background([30/255,30/255,46/255]))})),ce.background_color=[30/255,30/255,46/255];const ve=document.getElementById("menu_rescale_canvas");function pe(){const e=document.querySelector(":root"),t=.8*Math.min(window.innerWidth,window.innerHeight);e.style.setProperty("--canv-x",t.toString()+"px"),e.style.setProperty("--canv-y",t.toString()+"px"),ie.height=t,ie.width=t,de.shutdown(),de.initialize(de.pathtracing)}null==ve||ve.addEventListener("click",(e=>{pe()})),pe();const me=document.getElementById("menu_save_scene");null==me||me.addEventListener("click",(e=>{!function(){const e=new Blob([ce.serialize_scene()],{type:"text/json"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="scene.json",t.click(),URL.revokeObjectURL(t.href)}()}));const ge=document.getElementById("menu_load_scene");null==ge||ge.addEventListener("click",(e=>{!function(){const e=document.createElement("input");e.type="file",e.addEventListener("change",(t=>{const r=(null==e?void 0:e.files)[0],x=new FileReader;x.readAsText(r,"UTF-8"),x.addEventListener("load",(e=>{var t;const r=null===(t=e.target)||void 0===t?void 0:t.result;ce.deserialize_scene(r),de.shutdown(),de.initialize(de.pathtracing)}))})),e.click()}()}));const ye=document.getElementById("menu_reset");null==ye||ye.addEventListener("click",(e=>{ce.reset()})),addEventListener("contextmenu",(e=>(e.preventDefault(),!1)))})();
//# sourceMappingURL=main.js.map